<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-09-30 ÖÜËÄ 13:08 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ç”¨Dockeræ‰“åŒ…Tornadoé¡¹ç›®</title>
<meta name="generator" content="Org mode">
<meta name="author" content="saltb0rn">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"> -->
<meta name="referrer" content="same-origin">
<link rel="stylesheet" type="text/css" href="../../../css/stylesheet.css"/>
<link rel="icon" type="image/png" href="../../../img/icon.png" />
<!-- <script type="text/javascript" src="../../../js/live.js" defer></script> -->
<script src="../../../js/main.js" defer></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="org-div-home-and-up">
    <nav>
        <a href="../../../"><img src="../../../img/logo.png" alt="Logo is on the way"/></a>
        <ul>
            <li><a accesskey="H" href="../../../"> Home </a></li>
            <li><a accesskey="T" href="../../../tags"> Tags </a></li>
            <li><a accesskey="A" href="../../../about"> About </a></li>
            <li><a accesskey="L" href="../../../todos"> Todos </a></li>
        </ul>
    </nav>
</div>
<div id="content">
<h1 class="title">ç”¨Dockeræ‰“åŒ…Tornadoé¡¹ç›®</h1>
<div class="abstract" id="org564cda7">
<p>
Dockeræ˜¯è¿‘å‡ å¹´ä¸€ç§æ–°çš„å®¹å™¨æŠ€æœ¯,å®ƒçš„åº”ç”¨åœºæ™¯å®åœ¨æ˜¯å¤ªå¹¿æ³›äº†,é™¤äº†åœ¨äº§å“çº¿ä¸Šä½¿ç”¨,æˆ‘è¿˜è§åˆ°è¿‡ç”¨æ¥æ‰“åŒ…GUIåº”ç”¨çš„
<a href="http://fabiorehm.com/blog/2014/09/11/running-gui-apps-with-docker/">åˆ©ç”¨X11 socketä¸æ‰“åŒ…çš„Firefoxé€šä¿¡</a>,è¿˜æœ‰åˆ©ç”¨åŒæ ·åŸç†å¯¹<a href="https://github.com/JAremko/docker-emacs">Emacsè¿›è¡Œæ‰“åŒ…</a>. ç„¶è€Œå¼ºå¤§çš„å·¥å…·éƒ½éœ€è¦æ¯”è¾ƒé•¿çš„æ—¶é—´æ¥å­¦
ä¹ ,å…¶å®æˆ‘è‡ªå·±ä¹Ÿæ²¡æœ‰ç”¨è¿‡å¤šå°‘æ¬¡,ç”¨Dockerçš„æ—¶å€™å¤§å¤šæ•°éƒ½æ˜¯ç”¨æ¥æ­ä¸ªç®€å•çš„APIæœåŠ¡å™¨ç”¨æ¥æµ‹è¯•,æ‰€ä»¥è¿™é‡Œå†™ä¸€ç¯‡ç®€å•
çš„æ•™ç¨‹æ¥ç¤ºèŒƒå¦‚ä½•ç®€å•çš„æ‰“åŒ…,å¦‚æœæ ‡é¢˜æ‰€ç¤º,æ‰“åŒ…çš„é¡¹ç›®æ˜¯ä¸€ä¸ªTornadoé¡¹ç›®.
</p>

</div>

<p>
<b>å‰æ</b>
</p>

<p>
è¿™ç¯‡æ–‡ç« é€‚åˆçœ‹äº†å®˜æ–¹ä¾‹å­å’Œå‚è€ƒæ–‡æ¡£åä»ç„¶ä¸€å¤´é›¾æ°´æˆ–è€…ä¸çŸ¥é“æ€ä¹ˆç”¨æ¥æ‰“åŒ…å’Œè°ƒè¯•é¡¹ç›®çš„ä»»åŠ¡çš„äººç¾¤,æ²¡æœ‰çœ‹è¿‡å®˜æ–¹
ä¾‹å­çš„äººçœ‹è¿™ç¯‡æ–‡ç« ä¹Ÿä¼šä¸€å¤´é›¾æ°´,æ‰€ä»¥å»ºè®®å»ç®€å•çš„è¿‡ä¸€ä¸‹å®˜æ–¹çš„ä¾‹å­å†è¿‡æ¥.å¦‚æœè¿™ç¯‡æ–‡ç« ä¸­çš„Tornadoéƒ¨åˆ†å®åœ¨ä¼šå¯¼
è‡´ä¸äº†è§£Tornadoçš„ä½ çœ‹ä¸æ‡‚çš„è¯,é‚£ä½ æœ‰ä¸¤ç§é€‰æ‹©,å»æ‰¾å…¶ä»–ç¬¦åˆä½ è¦æ±‚çš„æ•™ç¨‹;ç¬¬äºŒç§,è‡ªè¡Œäº†è§£ä¸€ä¸‹Tornadoé¡¹ç›®çš„è¿
è¡Œæ–¹å¼å°±å¯ä»¥äº†,è‡³äºæˆ‘ä¸ºä»€ä¹ˆè¦è´´å‡ºä»£ç åªæ˜¯å› ä¸ºæä¾›ç»™æƒ³è¦åŠ¨æ‰‹å®è·µçš„æœ‹å‹ä¸€ä¸ªä¾‹å­,ä½ å¯ä»¥ä¸ç”¨ç®¡å®ƒå†™ä»€ä¹ˆ,è·ŸDocker
çš„å…³ç³»ä¸å¤ªå¤§,è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯Pythonçš„ä¾èµ–ç®¡ç†é—®é¢˜,è¿™æ˜¯éœ€è¦ä½ å»äº†è§£çš„ä¸€ç‚¹,çŸ¥é“è¿™ä¸ªä¾‹å­çš„requirements.txtæ˜¯è®°å½•
greeting.pyå¾—ä¾èµ–å°±å¯ä»¥äº†.
</p>

<p>
<b>ç›®æ ‡</b> æ‰“åŒ…é¡¹ç›®å¹¶ä¸”ä¿å­˜é¡¹ç›®è¿è¡Œæ—¶å€™çš„logæ–‡ä»¶
</p>

<p>
<b>Tornadoé¡¹ç›®ç»“æ„</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents/greeting-docker$ tree greeting
greeting/
&#9500;&#9472;&#9472; greeting.py
&#9492;&#9472;&#9472; requirements.txt

0 directories, 2 files
</pre>
</div>

<p>
å…¶ä¸­greeting.pyçš„ä»£ç ä¸º
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">! /usr/bin/env python3</span>

<span style="color: #F0DFAF; font-weight: bold;">import</span> tornado.httpserver
<span style="color: #F0DFAF; font-weight: bold;">import</span> tornado.ioloop
<span style="color: #F0DFAF; font-weight: bold;">import</span> tornado.options
<span style="color: #F0DFAF; font-weight: bold;">import</span> tornado.web
<span style="color: #F0DFAF; font-weight: bold;">from</span> tornado.options <span style="color: #F0DFAF; font-weight: bold;">import</span> define, options

define<span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"port"</span>, default=8000, <span style="color: #DCDCCC; font-weight: bold;">help</span>=<span style="color: #CC9393;">"run on the given port"</span>, <span style="color: #DCDCCC; font-weight: bold;">type</span>=<span style="color: #DCDCCC; font-weight: bold;">int</span><span style="color: #DCDCCC;">)</span>


<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">header_checker</span><span style="color: #DCDCCC;">(</span>header_name, header_value, msg=<span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">func_wrapper</span><span style="color: #DCDCCC;">(</span>func<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">wrapper</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, *args, **kwargs<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">content_type</span> = <span style="color: #F0DFAF; font-weight: bold;">self</span>.request.headers.get<span style="color: #DCDCCC;">(</span>header_name<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">if</span> content_type == header_value:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   func<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, *args, **kwargs<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">else</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>.write<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">{</span><span style="color: #CC9393;">"error"</span>: msg <span style="color: #F0DFAF; font-weight: bold;">or</span> <span style="color: #CC9393;">"Header is invalid"</span><span style="color: #BFEBBF;">}</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> wrapper
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> func_wrapper


<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">IndexHandler</span><span style="color: #DCDCCC;">(</span>tornado.web.RequestHandler<span style="color: #DCDCCC;">)</span>:

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, application, request, **kwargs<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; font-weight: bold;">super</span><span style="color: #DCDCCC;">()</span>.__init__<span style="color: #DCDCCC;">(</span>application, request, **kwargs<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>._headers<span style="color: #DCDCCC;">[</span><span style="color: #CC9393;">"Content-Type"</span><span style="color: #DCDCCC;">]</span> = <span style="color: #CC9393;">"application/json"</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">get</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span><span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">greeting</span> = <span style="color: #F0DFAF; font-weight: bold;">self</span>.get_argument<span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">'greeting'</span>, <span style="color: #CC9393;">'Hello'</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">text</span> = tornado.escape.json_encode<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">{</span><span style="color: #CC9393;">"messages"</span>: greeting<span style="color: #BFEBBF;">}</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>.write<span style="color: #DCDCCC;">(</span>text<span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #7CB8BB;">@header_checker</span><span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"Content-Type"</span>, <span style="color: #CC9393;">"application/json"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">post</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span><span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">try</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">data</span> = tornado.escape.json_decode<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>.request.body<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">except</span> tornado.escape.json.JSONDecodeError:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>.write<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">{</span><span style="color: #CC9393;">"error"</span>: <span style="color: #CC9393;">"Invalid JSON format"</span><span style="color: #BFEBBF;">}</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">else</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>.write<span style="color: #DCDCCC;">(</span>tornado.escape.json_encode<span style="color: #BFEBBF;">(</span>data<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>


<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">TestHandler</span><span style="color: #DCDCCC;">(</span>tornado.web.RequestHandler<span style="color: #DCDCCC;">)</span>:

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">post</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, intro, msg<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">self</span>.write<span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">'%s %s'</span> % <span style="color: #BFEBBF;">(</span>intro, msg<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>


<span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #DCDCCC; font-weight: bold;">__name__</span> == <span style="color: #CC9393;">"__main__"</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   tornado.options.parse_command_line<span style="color: #DCDCCC;">()</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">settings</span> = <span style="color: #DCDCCC;">{</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"debug"</span>: <span style="color: #BFEBBF;">True</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC;">}</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">app</span> = tornado.web.Application<span style="color: #DCDCCC;">(</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   handlers=<span style="color: #BFEBBF;">[</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #D0BF8F;">(</span>r<span style="color: #CC9393;">"/"</span>, IndexHandler<span style="color: #D0BF8F;">)</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #D0BF8F;">(</span>r<span style="color: #CC9393;">'/test/(?P&lt;intro&gt;[^/]+)/msg/(?P&lt;msg&gt;[^/]+)/'</span>, TestHandler<span style="color: #D0BF8F;">)</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #BFEBBF;">]</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   **settings
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">http_server</span> = tornado.httpserver.HTTPServer<span style="color: #DCDCCC;">(</span>app<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   http_server.listen<span style="color: #DCDCCC;">(</span>options.port<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   tornado.ioloop.IOLoop.instance<span style="color: #DCDCCC;">()</span>.start<span style="color: #DCDCCC;">()</span>
</pre>
</div>

<p>
requirements.txtå°±ä¸€ä¸ªtornadoçš„ä¾èµ–
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents/greeting-docker$ cat greeting/requirements.txt
<span style="color: #DFAF8F;">tornado</span>==5.1
</pre>
</div>

<p>
<b>æ‰“åŒ…å¼€å§‹</b>
</p>

<ol class="org-ol">
<li><p>
æŠŠgreetingæ”¾åœ¨greeting-dockeræ–‡ä»¶å¤¹é‡Œé¢(è¿™ä¸ªä¾‹å­å·²ç»æ”¾äº†,å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨åˆ«çš„åå­—åšä¸ºç›®å½•å),åœ¨greeting-docker
çš„ç›®å½•ä¸‹ç¼–å†™ä¸€ä¸ªDockerfile,å¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªç”¨äºåœ¨å®¹å™¨é‡Œé¢å¯åŠ¨Tornadoé¡¹ç›®çš„è„šæœ¬docker-entrypoint.sh.æ•´ä¸ªæ‰“åŒ…ç”¨çš„
ç›®å½•ç»“æ„å¦‚ä¸‹
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ tree greeting-docker
greeting-docker/
&#9500;&#9472;&#9472; docker-entrypoint.sh
&#9500;&#9472;&#9472; Dockerfile
&#9492;&#9472;&#9472; greeting
    &#9500;&#9472;&#9472; greeting.py
    &#9492;&#9472;&#9472; requirements.txt

1 directory, 4 files
</pre>
</div>

<p>
å…ˆè¯´è¯´Dockerfileçš„å†…å®¹,æˆ‘ä¼šåœ¨Dockerfileé‡Œé¢ç”¨æ³¨é‡Šè§£ææ¯ä¸€ä¸ªå‘½ä»¤çš„ä½œç”¨
</p>

<div class="org-src-container">
<pre class="src src-sh">FROM frolvlad/alpine-python3:latest
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#36873;&#25321;alpine-python3&#20316;&#20026;&#22522;&#30784;&#38236;&#20687;</span>
MAINTAINER saltb0rn
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#22768;&#26126;&#32500;&#25252;&#20154;&#30340;&#21517;&#23383;</span>
ENV <span style="color: #DFAF8F;">DOCKYARD_SRC</span>=greeting
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">ENV&#29992;&#20110;&#35774;&#23450;&#29615;&#22659;&#21464;&#37327;,&#30456;&#23545;&#20110;bash&#37324;&#38754;&#30452;&#25509;&#21019;&#24314;&#21464;&#37327;&#25110;&#32773;&#32473;&#21464;&#37327;&#36171;&#20540;</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#36825;&#37324;DOCKYARD_SRC&#35774;&#23450;&#30340;&#26159;&#36319;Dockerfile&#21516;&#32423;&#30340;greeting&#30446;&#24405;&#20301;&#32622;,</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#22240;&#20026;&#21019;&#24314;&#38236;&#20687;&#26102;&#20505;&#38656;&#35201;&#25351;&#23450;Dockerfile&#25152;&#22312;&#30340;&#30446;&#24405;,&#25152;&#20197;greeting&#26159;&#30456;</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#23545;Dockerfile&#20301;&#32622;&#32780;&#35328;&#30340;.DOCKYARD_SRC&#19981;&#26159;&#20869;&#32622;&#30340;&#21464;&#37327;,&#25152;&#20197;&#23427;&#26412;&#36523;</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#19981;&#23384;&#22312;&#20160;&#20040;&#29305;&#27530;&#24847;&#20041;,&#25105;&#20204;&#21482;&#26159;&#29992;&#20110;&#21518;&#38754;&#26576;&#20123;&#30446;&#30340;&#32780;&#24050;,&#19979;&#38754;&#20004;&#20010;&#21464;&#37327;&#20063;&#19968;&#26679;,</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#23601;&#19981;&#22810;&#35828;&#20102;</span>
ENV <span style="color: #DFAF8F;">DOCKYARD_SRVHOME</span>=/srv
ENV <span style="color: #DFAF8F;">DOCKYARD_SRVPROJ</span>=/srv/greeting

RUN apk update
RUN apk add bash
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#36825;&#20457;&#26465;RUN&#25351;&#20196;&#25191;&#34892;&#30340;&#26159;Alpine Linux&#30340;&#21629;&#20196;,&#31532;&#19968;&#26465;&#26159;&#26356;&#26032;&#36719;&#20214;&#28304;&#32531;&#23384;;</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#31532;&#20108;&#20010;&#26159;&#30001;&#20110;&#20043;&#21518;&#30340;docker-entrypoint.sh&#33050;&#26412;&#29992;&#30340;&#30340;&#26159;bash&#25191;&#34892;,&#32780;</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#36825;&#20010;&#38236;&#20687;&#27809;&#26377;bash,&#25152;&#20197;&#31532;&#20108;&#20010;&#26159;&#29992;&#26469;&#23433;&#35013;bash&#30340;</span>

WORKDIR $<span style="color: #DFAF8F;">DOCKYARD_SRVHOME</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#20999;&#25442;&#24403;&#21069;&#30446;&#24405;&#20026;/srv/greeting</span>

VOLUME [<span style="color: #CC9393;">"$DOCKYARD_SRVHOME/logs"</span>]
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#36825;&#20010;&#20363;&#23376;&#38656;&#35201;&#25226;&#26085;&#24535;&#25991;&#20214;&#20445;&#30041;&#19979;&#26469;,VOLUME&#21487;&#20197;&#25226;&#36825;&#20123;&#25991;&#20214;&#32473;&#20854;&#23427;&#23481;&#22120;&#35775;&#38382;,</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#21487;&#20197;&#23545;&#36825;&#20123;&#25991;&#20214;&#36827;&#34892;&#22791;&#20221;,&#20043;&#21518;&#20877;&#35828;</span>

COPY $<span style="color: #DFAF8F;">DOCKYARD_SRC</span> $<span style="color: #DFAF8F;">DOCKYARD_SRVPROJ</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">COPY&#21629;&#20196;&#23601;&#26159;&#25226;greeting&#22797;&#21046;&#21040;&#23481;&#22120;(&#24212;&#35813;&#26159;&#26032;&#38236;&#20687;&#25165;&#23545;)&#37324;&#36793;,&#22914;&#26524;&#26159;</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#22312;&#23481;&#22120;&#37324;&#36793;&#22797;&#21046;&#37324;&#38754;&#30340;&#25991;&#20214;,&#35831;&#29992;RUN cp file1 file2 &#36825;&#26679;&#30340;&#21629;&#20196;</span>

RUN pip3 install -U pip
RUN pip3 install -r $<span style="color: #DFAF8F;">DOCKYARD_SRVPROJ</span>/requirements.txt
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#23433;&#35013;&#39033;&#30446;&#20381;&#36182;</span>

EXPOSE 8000
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#36825;&#20010;Tornado&#39033;&#30446;&#26159;&#30417;&#21548;8000&#31471;&#21475;&#30340;,EXPOSE&#21487;&#20197;&#35753;&#36825;&#20010;&#31471;&#21475;&#32473;&#22806;&#30028;&#35775;&#38382;&#21040;,</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#20854;&#23454;&#36825;&#20010;&#21487;&#20197;&#19981;&#29992;&#25351;&#23450;&#37117;&#21487;&#20197;,&#21518;&#38754;&#21487;&#20197;&#36890;&#36807;&#21551;&#21160;&#26102;&#20505;&#30340;&#35774;&#23450;&#38543;&#20415;&#26144;&#23556;&#31471;&#21475;.</span>

WORKDIR $<span style="color: #DFAF8F;">DOCKYARD_SRVPROJ</span>
COPY ./docker-entrypoint.sh /bin/
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#20999;&#25442;&#24403;&#21069;&#30446;&#24405;,&#25226;&#21551;&#21160;&#33050;&#26412;&#22797;&#21046;&#21040;&#23481;&#22120;&#30340;/bin&#30446;&#24405;&#19979;</span>
ENTRYPOINT [<span style="color: #CC9393;">"docker-entrypoint.sh"</span>]
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#23481;&#22120;&#20837;&#21475;,&#21551;&#21160;&#23481;&#22120;&#23601;&#20250;&#25191;&#34892;ENTRYPOINT&#25351;&#20196;&#25152;&#25351;&#23450;&#30340;&#21629;&#20196;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">!/bin/</span><span style="color: #F0DFAF; font-weight: bold;">bash</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">docker-entrypoint.sh</span>
<span style="color: #F0DFAF; font-weight: bold;">if</span> [ <span style="color: #F0DFAF; font-weight: bold;">!</span> -d <span style="color: #CC9393;">"/srv/logs"</span> ];<span style="color: #F0DFAF; font-weight: bold;">then</span>
    mkdir -p <span style="color: #CC9393;">"/srv/logs"</span>
<span style="color: #F0DFAF; font-weight: bold;">fi</span>
<span style="color: #DCDCCC; font-weight: bold;">echo</span> <span style="color: #CC9393;">"Server is running ..."</span>
<span style="color: #F0DFAF; font-weight: bold;">exec</span> python3 <span style="color: #CC9393;">\</span>
     greeting.py <span style="color: #CC9393;">\</span>
     --log-file-prefix=<span style="color: #CC9393;">"/srv/logs/greeting.log"</span> <span style="color: #CC9393;">\</span>
     <span style="color: #CC9393;">"$@"</span>
</pre>
</div>

<p>
å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„è„šæœ¬,æœ‰éœ€è¦çš„æƒ…å†µä¸‹å°±åˆ›å»º/srv/logsç›®å½•,ç”¨æ¥å­˜æ”¾logæ–‡ä»¶,æœ€åå°±æ˜¯å¯åŠ¨greeting.py.
é‡Œé¢çš„"$@"æœ‰ç‚¹ç±»ä¼¼ä¸Pythoné‡Œé¢çš„*argså½¢å‚,è¡¨ç¤ºå‰©ä¸‹çš„æ‰€æœ‰å‚æ•°,å¯ä»¥é€šè¿‡å®ƒæ¥ä¼ é€’é¢å¤–çš„å‚æ•°.
</p></li>

<li><p>
æ‰§è¡Œæ‰“åŒ…å‘½ä»¤
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker build -t saltb0rn/greeting greeting-docker
</pre>
</div>

<p>
-tç”¨äºæŒ‡å®šæ‰“åŒ…åçš„é•œåƒtag,è¿™é‡Œæ˜¯salt0brn/greeting,ä½ å¯ä»¥æ¢ä¸€ä¸ªå–œæ¬¢çš„,æœ€åé¢ä¸€ä¸ªå‚æ•°å°±æ˜¯
æŒ‡å®šDockerfileæ‰€å¤„çš„ç›®å½•.å¦‚æœæ–‡ä»¶æ²¡æœ‰å‡†å¤‡é”™,é‚£ä¹ˆå°±å¯ä»¥å»ºç«‹æˆåŠŸ.
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker image ls
REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE
saltb0rn/greeting         latest              0b0472b2426f        3 seconds ago       70.2MB
frolvlad/alpine-python3   latest              a056c2d555fe        5 weeks ago         54.2MB
</pre>
</div></li>
</ol>


<p>
<b>è¿è¡Œé¡¹ç›®</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker run --name greeting saltb0rn/greeting
</pre>
</div>

<p>
è¿™æ ·å°±è¿è¡Œäº†ä¸€ä¸ªåå­—å«greetingçš„å®¹å™¨äº†.è¿™ç§æ–¹å¼è¿è¡Œä¼šå¯¼è‡´ç»ˆç«¯è¢«è¿™ä¸ªè¿›ç¨‹å ç”¨,å¯ä»¥
æŠŠå®ƒè®¾ä¸ºå®ˆæŠ¤è¿›ç¨‹,ä¹Ÿå°±æ˜¯åœ¨èƒŒåè¿è¡Œ.
</p>

<p>
å¦‚æœä½ æ‰§è¡Œçš„ä¸Šé¢å‘½ä»¤å¹¶ä¸”Ctrl-Cä¸­æ­¢äº†å®¹å™¨,æƒ³è¦ä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„è¯å°±å¾—å…ˆæŠŠåŸæ¥å¾—å®¹å™¨åˆ 
é™¤æ‰(é™¤éä½ ç»™äº†å®¹å™¨åˆ«åå­—,æ¯”å¦‚ &#x2013;name greeting2).ç”±äºè®¾å®šäº†&#x2013;name,æ‰€ä»¥åˆ é™¤å¾ˆç®€å•,
rmæŒ‡å®šgreetingå°±å¥½äº†.
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker container rm greeting
</pre>
</div>

<p>
å‡å¦‚æ²¡æœ‰æŒ‡å®š&#x2013;nameä¹Ÿæ²¡æœ‰å…³ç³»,å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹åœ¨è¿è¡Œä¸­çš„å®¹å™¨
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
358973f5d79f        saltb0rn/greeting   <span style="color: #CC9393;">"docker-entrypoint.sh"</span>   13 minutes ago      Up 13 minutes       8000/tcp            greeting
</pre>
</div>

<p>
è¿™ä¸ªæ—¶å€™å¦‚æœæœ‰å¾ˆå¤šä¸ªç±»ä¼¼çš„å®¹å™¨,é‚£ä¹ˆå°±è¦è‡ªè¡Œæ ¹æ®ä¿¡æ¯æ¥åˆ¤æ–­å“ªä¸ªå®¹å™¨æ˜¯ä½ æƒ³è¦è¿›è¡Œæ“ä½œçš„.
è¿™é‡Œé¢CONTAINER IDå’ŒNAMESéƒ½æ˜¯å”¯ä¸€çš„.å…¶å®ä¸Šé¢çš„åˆ é™¤å‘½ä»¤å¯ä»¥æ ¹æ®CONTAINER IDæ¥åˆ é™¤çš„,
è¿™é‡Œçš„è¯ä½ è¦å…ˆåœæ­¢å®¹å™¨å†è¿›è¡Œåˆ é™¤
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker container stop 358973f5d79f
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker container rm 358973f5d79f
</pre>
</div>

<p>
ç°åœ¨å¼€å§‹ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œ
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents/$ sudo docker run -d --name greeting saltb0rn/greeting
</pre>
</div>

<p>
<b>è®¿é—®VOLUMEæŒ‡å®šçš„ç›®å½•</b>
</p>

<p>
ä¸Šé¢ä¹Ÿè¯´è¿‡VOLUMEæŒ‡ä»¤æ˜¯æŠŠå®¹å™¨é‚£æŒ‡å®šçš„ç›®å½•ç»™åˆ«çš„å®¹å™¨è®¿é—®,é‚£ä¹ˆå¯ä»¥é€šè¿‡ä½¿ç”¨åˆ«çš„å®¹å™¨æ¥è¿™ä¸ªå®éªŒ,å°±ç”¨
frolvlad/alpine-python3æ¥è®¿é—®ä¸Šé¢çš„greetingå®¹å™¨
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker run -i -t --volumes-from=greeting frolvlad/alpine-python3
</pre>
</div>

<p>
ä¸Šé¢çš„-i -tåˆ†åˆ«è¡¨ç¤ºä½¿ç”¨äº¤äº’æ¨¡å¼å’Œä½¿ç”¨ä¼ªç»ˆç«¯,ä¹Ÿå°±æ˜¯è¯´åœ¨æ‰§è¡Œå®¹å™¨é‡Œé¢çš„ç»ˆç«¯(shell),&#x2013;volumes-from=greeting
å°±æ˜¯æŒ‡è®¿é—®æ­£åœ¨è¿è¡Œçš„greetingå®¹å™¨.å¦‚æœä½ æ‰§è¡Œ"ls /srv/logs/greeting.log",å®ƒä¼šæ‰§è¡ŒæˆåŠŸ,å¦‚æœè¿è¡Œæ²¡æœ‰&#x2013;volumes-from=greeting
çš„è¯,è¿™å¥å‘½ä»¤å°±ä¼šå¤±è´¥.ä½ å¯ä»¥åœ¨ç™»å½•è¿›å»ååˆ©ç”¨scp,gitç­‰å·¥å…·æŠŠæ•°æ®å¤‡ä»½.
</p>

<p>
<b>æ”¹å˜è¿è¡Œæ—¶å€™çš„å…¥å£</b>
</p>

<p>
ä¹Ÿè®¸ä½ ä¸æƒ³ç”¨frolvlad/alpine-python3ä½œä¸ºäº¤äº’ä½¿ç”¨çš„å®¹å™¨,å› ä¸ºå®ƒæ²¡æœ‰bash,å°½ç®¡å¯ä»¥å®‰è£…bash,ä½†æ˜¯ä¸¤ä¸ªé•œåƒä¸­,
saltb0rn/greetingæ˜¯å·²ç»è£…å¥½äº†bash,ä¸ºä½•ä¸ç›´æ¥ç”¨å®ƒå‘¢,å…¶å®æ”¹å˜ä»¥ä¸‹å…¥å£ç‚¹å°±å¯ä»¥ä¸ä¼šä¸€è¿è¡Œå°±æ‰§è¡ŒTornadoé¡¹ç›®äº†.
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker run -i -t --entrypoint=/bin/bash saltb0rn/greeting
</pre>
</div>

<p>
<b>æŒ‚è½½ç›®å½•/æ–‡ä»¶åˆ°å®¹å™¨ä¸­</b>
</p>

<p>
å‡è®¾~/Documentsä¸‹æœ‰ä¸€ä¸ªå«Pipfileçš„æ–‡ä»¶,æƒ³æŠŠå®ƒæ”¾åˆ°å®¹å™¨é‡Œé¢,æœ‰ä¸¤ç§åšæ³•,ä¸€æ˜¯åœ¨æ–°å»ºé•œåƒçš„æ—¶å€™COPYè¿›å»,ä¸è¿‡
è¿™æ ·ä¸é€‚åˆä¸€ç§æƒ…å†µ,å¦‚æœè¿™ä¸ªæ–‡ä»¶è¦ç»å¸¸æ›´æ–°é‚£å°±è¦ä¸æ–­é‡æ–°buildé•œåƒ.ç¬¬äºŒä¸­åšæ³•æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„,æŠŠç¯å¢ƒå’Œæ•°æ®åˆ†å¼€
ç®¡ç†,ç”¨æŒ‚è½½å°±å¯ä»¥äº†,å°±åƒå¤–éƒ¨å‚¨å­˜è®¾å¤‡ä¸€æ ·,ç”¨çš„æ—¶å€™æŒ‚è½½.
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker run -i -t <span style="color: #CC9393;">\</span>
                            --volume=$(<span style="color: #DCDCCC; font-weight: bold;">pwd</span>)/Pipfile:/srv/Pipfile <span style="color: #CC9393;">\</span>
                            --entrypoint=/bin/bash saltb0rn/greeting
</pre>
</div>

<p>
è¿™ä¸ªæ—¶å€™åœ¨å®¹å™¨é‡Œé¢æ‰§è¡Œ"cat /srv/Pipfile"ä¼šçœ‹åˆ°ä¸~/Documents/Pipfileä¸€æ ·çš„å†…å®¹,å¦‚æœè¿™ä¸ªæ—¶å€™åœ¨å®¹å™¨æˆ–è€…å®¹å™¨ä¹‹å¤–
å¯¹Pipfileè¿›è¡Œå†…å®¹ä¿®æ”¹,ä¸¤è€…å†…å®¹ä¼šåŒæ­¥.å¯ä»¥è‡ªè¡Œæ‰§è¡Œ"echo edit &gt;&gt; Pipfile"è¿›è¡Œè§‚å¯Ÿ.
</p>

<p>
<b>ç»™Tornadoé¡¹ç›®ä¼ å‚æ•°</b>
</p>

<p>
æ¯”å¦‚æƒ³è¦ç»™å®ƒä¼ ä¸ª&#x2013;port=8001(æ‰§è¡Œpython3 greeting.py &#x2013;helpå¯ä»¥çœ‹åˆ°èƒ½å¤Ÿä¼ å…¥çš„å‚æ•°)
</p>

<div class="org-src-container">
<pre class="src src-sh">salt@salt:~/Documents$ sudo docker run --publish=8001:8001 saltb0rn/greeting --port=8001
</pre>
</div>

<p>
è¯´æ˜ä¸€ä¸‹,&#x2013;publish=8001:8001,ç¬¬ä¸€ä¸ª8001æ˜¯å®¹å™¨å¤–é€šè¿‡8001ç«¯å£å¯¹å®¹å™¨æš´éœ²çš„ç«¯å£è¿›è¡Œè®¿é—®,ç¬¬äºŒä¸ª8001å°±æ˜¯
å®¹å™¨å¯¹å¤–æš´éœ²çš„8001ç«¯å£,å¦‚æœæŠŠ&#x2013;port=8001å»æ‰,åœ¨æœ¬åœ°æµ‹è¯•localhost:8001ä¼šè¿æ¥å¤±è´¥,è¯æ˜å‚æ•°çš„ç¡®ä¼ åˆ°äº†.
</p>


<p>
<b>ä¸€äº›å…³äºå­¦ä¹ Dockerçš„ä¸ªäººå»ºè®®</b>
</p>

<p>
æˆ‘åˆšå¼€å§‹å­¦ä¹ ä½¿ç”¨Dockerçš„æ—¶å€™ä¼šå› ä¸ºDockerfileçš„æŒ‡ä»¤æŠ“ç‹‚,å¯èƒ½å› ä¸ºä¸€ä¸Šæ¥å°±ç›´æ¥çœ‹å‚è€ƒæ–‡æ¡£(references)çš„ç¼˜æ•…å§.
æ²¡æœ‰Demoçš„è¯å­¦ä¸€æ ·æ–°çš„ä¸œè¥¿ä¼šå¾ˆåƒåŠ›,å› ä¸ºèƒ½å¤Ÿçœ‹åˆ°ä¸€ä»½æ–‡æ¡£éœ€è¦çš„ä¸ä»…æ˜¯è¯­è¨€èƒ½åŠ›,è¿˜è¦å¯¹ç›¸å…³æ¦‚å¿µæœ‰ä¸€å®šçš„ç†è§£,æˆ–è€…
è¯´ä¸å®è·µä¸€ä¸‹æ˜¯ä¸æ‡‚å®ƒè¡¨è¾¾çš„æ„æ€,è€Œå‚è€ƒæ–‡æ¡£å°±æ˜¯åœ¨è¿™æ–¹é¢ä¸å¤ªå‹å¥½.å®˜æ–¹æ–‡æ¡£è™½ç„¶ä¹Ÿæœ‰Demo,ä¸è¿‡ä¸å¤ªå¯èƒ½èƒ½çœŸçš„æ»¡è¶³ä½ 
çš„éœ€æ±‚,æ‰€ä»¥æˆ‘åˆšå¼€å§‹å­¦çš„æ—¶å€™æ˜¯å‚è€ƒäº†ä¸€ç¯‡æ–‡ç« <a href="http://michal.karzynski.pl/blog/2015/04/19/packaging-django-applications-as-docker-container-images/">Packaging Django applications into Docker container images</a>.
è¿™ç¯‡æ–‡ç« ååˆ†å¥½,åŸºæœ¬èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚,æ¯”å¦‚å¦‚ä½•æŒ‚è½½å®¹å™¨å¤–çš„æ–‡ä»¶,RUNå‘½ä»¤ä¸€äº›å¸¸ç”¨çš„å‚æ•°ä¹‹ç±»çš„.å…¶å®æˆ‘è¿™ç¯‡ç¬”è®°å°±æ˜¯å‚è€ƒ
å®ƒçš„,åªä¸è¿‡æŠŠDjangoæ¢æˆTornadoç½¢äº†.å¥½åƒè¿˜çœ‹è¿‡æ‰“åŒ…Flaskçš„,ç½‘ä¸Šåº”è¯¥æœ‰ä¸å°‘ä¾‹å­,å…¶å®è¿‡äº†è¿™ä¸ªä¾‹å­ä¸€éä»¥ååŸºæœ¬ä¸Š
æ‰“åŒ…å…¶ä»–ä¸œè¥¿ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜äº†.è¦å¤šå‚è€ƒåˆ«äººå†™å¾—Dockerfile,ä½ å°±å¯ä»¥å†™å¾—æ›´åŠ ç†Ÿç»ƒäº†.
</p>

<p>
è¿˜æœ‰ä¸€ä¸ªå…³äºCMDå’ŒENTRYPOINTæŒ‡ä»¤çš„é—®é¢˜,ä¸¤ä¸ªéƒ½å¯ä»¥æä¾›å®¹å™¨çš„å…¥å£,æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?è¿™æ˜¯ä¸€ä¸ªæŒºè®©æ–°æ‰‹å›°æƒ‘çš„é—®é¢˜,è¿™é‡Œæˆ‘å°±
ä¸å†™äº†,æœ‰ä¸€ç¯‡æ¦‚æ‹¬å¾—è¿˜ä¸é”™çš„<a href="https://www.cnblogs.com/CloudMan6/p/6875834.html">æ–‡ç« </a>å¯ä»¥å‚è€ƒä¸€ä¸‹.
</p>

<p>
<b>ç»“æŸæ˜¯å¦å¤–ä¸€ä¸ªå¼€å§‹</b>
</p>

<p>
Dockerè¿˜æœ‰å¾ˆå¤šç”¨æ³•,è¿™é‡Œæ˜¯å†™ä¸ä¸‹äº†(ä¸æ˜¯å› ä¸ºæ‡’),æ¯”å¦‚å¦‚ä½•æŠŠä¸€ä¸ªDjangoé¡¹ç›®+Nginx+Gunicorn+æ•°æ®åº“ä¸€èµ·æ‰“åŒ…å‘¢?
å¦‚æœä½¿ç”¨Dockeræ„å»ºé›†ç¾¤?å¦‚ä½•ä½¿ç”¨Dockeræ„å»ºåˆ†å¸ƒå¼?è¿™äº›æ¶‰åŠåˆ°docker-composeå’Œdocker-swarmæŠ€æœ¯.æˆ‘æœ¬äººè™½ç„¶ç”¨
è¿‡ä¸ªä¸€ä¸¤æ¬¡,ä½†æ˜¯å¯¹è¿™å—ä¹Ÿä¸å¤ªäº†è§£.æ‰“ç®—è¿™ä¸ªæœˆå†…åšä¸€æ¬¡å®è·µç„¶åè®°å½•ä¸‹æ¥(å’• å’• å’•).
</p>
</div>
<div id="postamble" class="status">
<p class="author">Author: saltb0rn (<a href="mailto:asche34@outlook.com">asche34@outlook.com</a>)</p>
<p class="date">Date: 2018-08-16</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.4.6)</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
