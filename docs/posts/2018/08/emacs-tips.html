<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-03-04 ÖÜËÄ 09:12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Emacs Tips(æŒç»­æ›´æ–°)</title>
<meta name="generator" content="Org mode">
<meta name="author" content="saltb0rn">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"> -->
<meta name="referrer" content="same-origin">
<link rel="stylesheet" type="text/css" href="../../../css/stylesheet.css"/>
<link rel="icon" type="image/png" href="../../../img/icon.png" />
<!-- <script type="text/javascript" src="../../../js/live.js" defer></script> -->
<script src="../../../js/main.js" defer></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<div id="org-div-home-and-up">
    <nav>
        <a href="../../../"><img src="../../../img/logo.png" alt="Logo is on the way"/></a>
        <ul>
            <li><a accesskey="H" href="../../../"> Home </a></li>
            <li><a accesskey="T" href="../../../tags"> Tags </a></li>
            <li><a accesskey="A" href="../../../about"> About </a></li>
            <li><a accesskey="L" href="../../../todos"> Todos </a></li>
        </ul>
    </nav>
</div>
<div id="content">
<h1 class="title">Emacs Tips(æŒç»­æ›´æ–°)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0c02f86">ä½¿ç”¨Emacsçš„ä¸€äº›tips</a></li>
<li><a href="#org546c52f">ä½¿ç”¨é…ç½®çš„ä¸€äº›ä¼˜åŒ–</a></li>
<li><a href="#org9385718">å†™ Elisp æ—¶å€™é‡åˆ°çš„ä¸€äº›é—®é¢˜</a>
<ul>
<li><a href="#org9999d1b">å¦‚ä½•è§£å†³å†™Elispæ—¶å€™é‡åˆ°çš„ä¸€äº›éœ€è¦å¯†ç è®¤è¯çš„å‘½ä»¤è¡Œæ“ä½œ</a></li>
<li><a href="#orgc8db931">å¦‚ä½•è®©è°ƒè¯•å™¨å¯ä»¥è°ƒè¯•user-error?</a></li>
<li><a href="#org24013cb">Autoloadå‡½æ•°å¼•ç”¨æœªè¢«requireçš„å˜é‡,ä¿®æ”¹è¯¥å˜é‡åæ— æ³•è¯»å–å˜é‡?</a></li>
<li><a href="#org635b5dd">å¦‚ä½•è¯·æ±‚æ¥å£(JSON)</a></li>
<li><a href="#org070692d">å¦‚æœè¯»å–JSONæ–‡ä»¶</a></li>
</ul>
</li>
<li><a href="#org6e4aca8">Emacs Lisp å­¦ä¹ ç¬”è®°</a>
<ul>
<li><a href="#org8923b96">Emacs Lisp æ•°æ®ç±»å‹æ¦‚è§ˆ</a>
<ul>
<li><a href="#org775e5c7">Records</a></li>
<li><a href="#orgd6dc279">Finalizer Type</a></li>
</ul>
</li>
<li><a href="#orgb31ac6f">è¿ç®— (Evaluation)</a>
<ul>
<li><a href="#orgf46a92c">Forms</a></li>
<li><a href="#orgebf6f18">å¼•ç”¨ (Quoting)</a></li>
<li><a href="#org6cf39a8">åå‘å¼•ç”¨ (Backquote)</a></li>
<li><a href="#orgdc4e880">è¿ç®— (Eval)</a></li>
<li><a href="#org55106d3">å»¶è¿Ÿè¿ç®— (Deferred Eval)</a></li>
</ul>
</li>
<li><a href="#org7836fe0">æ§åˆ¶ç»“æ„ (Control Structures)</a>
<ul>
<li><a href="#orgba070fc">æŒ‰åºè®¡ç®— (Sequencing)</a></li>
<li><a href="#org9ba54eb">æ¡ä»¶åˆ¤æ–­ (Conditionals)</a></li>
<li><a href="#org6bc7332">æ··åˆæ¡ä»¶ (Constructs for Combining Conditions)</a></li>
<li><a href="#orge2eeb39">æ¨¡å¼åŒ¹é…æ¡ä»¶ (Pattern-Matching Conditional)</a></li>
<li><a href="#org0c71430">è¿­ä»£å™¨ (Iteration)</a></li>
<li><a href="#org876c8bb">ç”Ÿæˆå™¨ (Generators)</a></li>
<li><a href="#orgfd622b1">éæœ¬åœ°é€€å‡º (Nonlocal Exits)</a></li>
</ul>
</li>
<li><a href="#orgc49260a">å˜é‡ (Variables)</a></li>
<li><a href="#orga203809">å‡½æ•° (Functions)</a>
<ul>
<li><a href="#org7cfeb47">ä»€ä¹ˆæ˜¯å‡½æ•° (What is a Function)</a></li>
<li><a href="#org72844e8">Lambdaè¡¨è¾¾å¼ (Lambda Expressions)</a></li>
<li><a href="#orge3eea85">å‡½æ•°åå­— (Function Names)</a></li>
<li><a href="#org98f4c91">å®šä¹‰å‡½æ•° (Defining Functions)</a></li>
<li><a href="#org3d28a03">è°ƒç”¨å‡½æ•° (Calling Functions)</a></li>
<li><a href="#org0e1d013">Mappingå‡½æ•° (Mapping Functions)</a></li>
<li><a href="#org568c571">åŒ¿åå‡½æ•° (Anonymous Functions)</a></li>
<li><a href="#org261feba">é€šç”¨å‡½æ•° (Generic Functions)</a></li>
<li><a href="#org014cfe3">Function Cells</a></li>
<li><a href="#org6edc4eb">é—­åŒ… (Closures)</a></li>
<li><a href="#org132882d">Advising Functions</a></li>
<li><a href="#org9813429">åºŸå¼ƒå‡½æ•° (Obsolete Functions)</a></li>
<li><a href="#org1d7d84e">å†…è”å‡½æ•° (Inline Functions)</a></li>
<li><a href="#orgcac4fdb">Declare Form</a></li>
<li><a href="#org9844b9c">å£°æ˜å‡½æ•° (Declaring Functions)</a></li>
<li><a href="#orga0fa5d1">å‡½æ•°å®‰å…¨ (Function Safety)</a></li>
<li><a href="#org1a00a0b">ç›¸å…³è¯é¢˜ (Related Topics)</a></li>
</ul>
</li>
<li><a href="#org89c85bb">å® (Macros)</a>
<ul>
<li><a href="#orgcd4f6b1">å®ä¾‹å­ (Defining Macros)</a></li>
<li><a href="#org5ff31ab">å®çš„å±•å¼€å¼ (Expansion)</a></li>
<li><a href="#org3d3e0ec">å®å’Œç¼–è¯‘ (Compiling Macros)</a></li>
<li><a href="#org70bd379">å®çš„é—®é¢˜ (Problems With Macros)</a></li>
<li><a href="#orgc669422">ç¼©è¿›å® (Indenting Macros)</a></li>
</ul>
</li>
<li><a href="#org19f06ca">ä¸ªæ€§åŒ– (Customization)</a></li>
<li><a href="#org024056f">åŠ è½½ (Loading)</a>
<ul>
<li><a href="#org2a8d42e">ç¨‹åºçš„åŠ è½½è¿‡ç¨‹ (How Programs Do Loading)</a></li>
<li><a href="#orgff36548">åŠ è½½åç¼€ (Load Suffixes)</a></li>
<li><a href="#org02b15c5">åº“çš„æŸ¥æ‰¾ (Library Search)</a></li>
<li><a href="#orga118c4f">åŠ è½½é ASCII å­—ç¬¦ (Loading Non-ASCII)</a></li>
<li><a href="#orgc80a821">è‡ªåŠ¨åŠ è½½ (Autoload)</a></li>
</ul>
</li>
<li><a href="#org80073e7">å­—èŠ‚ç¼–ç  (Byte Compilation)</a>
<ul>
<li><a href="#org7923fe3">ç¼–è¯‘å­—èŠ‚å‡½æ•° (Compilation Functions)</a></li>
<li><a href="#org463b4f2">æ–‡æ¡£å­—ç¬¦ä¸²å’Œç¼–è¯‘ (Docs and Compilation)</a></li>
<li><a href="#org175f752">åŠ¨æ€åŠ è½½ä¸ªåˆ«å‡½æ•° (Dynamic Loading)</a></li>
<li><a href="#orgfa98400">åœ¨ç¼–è¯‘æœŸé—´è¿è¡Œ (Eval During Compile)</a></li>
<li><a href="#org16f4bf7">ç¼–è¯‘å™¨é”™è¯¯ (Compiler Errors)</a></li>
<li><a href="#org24682d3">å­—èŠ‚ç å‡½æ•°å¯¹è±¡ (Byte-Code Objects)</a></li>
<li><a href="#orgfb0943b">åæ±‡ç¼–å­—èŠ‚ç (Disassembly)</a></li>
</ul>
</li>
<li><a href="#org46aa24f">è°ƒè¯• (Debugging)</a>
<ul>
<li><a href="#orgb39ee7c">Debugger</a></li>
<li><a href="#org1c48640">Edebug</a></li>
<li><a href="#org77e1fbb">è¯­æ³•é”™è¯¯ (Syntax Errors)</a></li>
<li><a href="#orga1a0e29">è¦†ç›–å‚æ•° (Test Coverage)</a></li>
<li><a href="#orgde578a6">æ€§èƒ½æµ‹è¯• (Profiling)</a></li>
<li><a href="#orgf9d8b6c">ERT: Emacs Lisp Regression Testing</a></li>
</ul>
</li>
<li><a href="#org8985f08">è¯»å–å’Œæ‰“å° (Read and Print)</a>
<ul>
<li><a href="#org71b4421">è¯»å–å’Œæ‰“å°çš„ç®€ä»‹ (Streams Intro)</a></li>
<li><a href="#org7c30750">è¾“å…¥æµ (Input Streams)</a></li>
<li><a href="#org0d9ec95">è¾“å…¥å‡½æ•° (Input Functions)</a></li>
<li><a href="#orge90bfad">è¾“å‡ºæµ (Output Streams)</a></li>
<li><a href="#org265e20a">è¾“å‡ºå‡½æ•° (Output Functions)</a></li>
<li><a href="#org7cfec89">å½±å“è¾“å‡ºçš„å˜é‡ (Output Variables)</a></li>
</ul>
</li>
<li><a href="#org718b898">Minibuffers</a>
<ul>
<li><a href="#org9f7c445">å…¥é—¨Minibuffers (Intro to Minibuffers)</a></li>
<li><a href="#orgac46b65">ä»Minibufferä¸­è¯»å–æ–‡æœ¬ (Text from MInibuffer)</a></li>
<li><a href="#org678551b">ä»Minibufferä¸­è¯»å–å¯¹è±¡ (Object from Minibuffer)</a></li>
<li><a href="#org654ef46">Minibufferå†å² (Minibuffer History)</a></li>
<li><a href="#orga989135">åˆå§‹è¾“å…¥ (Initial Input)</a></li>
<li><a href="#org056232d">è¡¥å…¨ (Completion)</a></li>
<li><a href="#org8945b92">Yes-or-NoæŸ¥è¯¢ (Yes-or-No Queries)</a></li>
<li><a href="#org0a14b49">å¤šé‡é€‰æ‹©æŸ¥è¯¢ (Multiple Queries)</a></li>
<li><a href="#orgf6e8a01">è¯»å–å¯†ç  (Reading a Password)</a></li>
<li><a href="#org8384676">åœ¨Minibufferä¸­ä½¿ç”¨çš„å‘½ä»¤ (Minibuffer Commands)</a></li>
<li><a href="#org30e4cdf">Minibufferçª—å£ (Minibuffer Windows)</a></li>
<li><a href="#orged583d6">Minibufferå†…å®¹ (Minibuffer Contents)</a></li>
<li><a href="#org55e8300">é€’å½’Minibuffer (Recursive Mini)</a></li>
<li><a href="#org36abc75">Minibufferæ‚é¡¹ (Minibuffer Misc)</a></li>
</ul>
</li>
<li><a href="#org50b6df8">å‘½ä»¤å¾ªç¯ (Command Loop)</a>
<ul>
<li><a href="#org4ea0cfb">å®šä¹‰å‘½ä»¤ (Defining Commands)</a></li>
<li><a href="#orgd06a1f7">äº¤äº’å¼è°ƒç”¨ (Interactive Call)</a></li>
<li><a href="#org3a11ecd">åŒºåˆ†äº¤äº’å¼è°ƒç”¨ (Distinguish Interactive)</a></li>
<li><a href="#org7c4772e">å‘½ä»¤å¾ªç¯çš„ä¿¡æ¯ (Command Loop Info)</a></li>
<li><a href="#org034f6aa">å‘½ä»¤åè°ƒæ•´æŒ‡é’ˆ (Adjusting Point)</a></li>
<li><a href="#org22068a6">è¾“å…¥äº‹ä»¶ (Input Events)</a></li>
<li><a href="#org080e750">è¯»å–è¾“å…¥ (Reading Input)</a></li>
<li><a href="#org6ccdcaa">ç‰¹æ®Šäº‹ä»¶ (Special Events)</a></li>
<li><a href="#org1a9c913">ç­‰å¾…ç»“æŸæ—¶é—´æˆ–è€…è¾“å…¥ (Waiting)</a></li>
<li><a href="#orgf3e8612">ä¸­æ­¢ (Quitting)</a></li>
<li><a href="#org3e3d5ea">å‰ç¼€å‘½ä»¤å‚æ•° (Prefix Command Arguments)</a></li>
<li><a href="#orgaed2381">é€’å½’ç¼–è¾‘ (Recursive Editing)</a></li>
<li><a href="#org054d0d2">ç¦ç”¨å‘½ä»¤ (Disabling Commands)</a></li>
<li><a href="#orgdba5152">å‘½ä»¤å†å² (Command History)</a></li>
<li><a href="#org5fcec6f">é”®ç›˜å® (Keyboard Macros)</a></li>
</ul>
</li>
<li><a href="#orga584345">æ–‡æœ¬ (Text)</a>
<ul>
<li><a href="#orgb915e94">ç‚¹é™„è¿‘çš„æ–‡æœ¬ (Near Point)</a></li>
<li><a href="#orgf3963be">æ£€è§†ç¼“å†²åŒºçš„å†…å®¹ (Buffer Contents)</a></li>
<li><a href="#org560e1be">æ¯”è¾ƒæ–‡æœ¬ (Comparing Text)</a></li>
<li><a href="#orgea4ea9b">æ’å…¥æ–‡æœ¬ (Insertion)</a></li>
<li><a href="#org6ffe80b">æ’å…¥æ–‡æœ¬çš„å‘½ä»¤ (Commands for Insertion)</a></li>
<li><a href="#org6e22026">åˆ é™¤æ–‡æœ¬ (Deletion)</a></li>
<li><a href="#org260904f">åˆ é™¤æ–‡æœ¬çš„å‘½ä»¤ (User-Level Deletion)</a></li>
<li><a href="#org6ae9362">Kill Ring (The Kill Ring)</a></li>
<li><a href="#org58688e1">æ’¤é”€ (Undo)</a></li>
<li><a href="#org3ac2930">ç»´æŠ¤æ’¤é”€åˆ—è¡¨ (Maintaining Undo)</a></li>
<li><a href="#orge44d3a0">å¡«å…… (Filling)</a></li>
<li><a href="#orgf2b2656">å¤–è¾¹è· (Margins)</a></li>
<li><a href="#org1bfac5f">é€‚åº”å¡«å…… (Adaptive Fill)</a></li>
<li><a href="#org4e24245">è‡ªåŠ¨å¡«å…… (Auto Filling)</a></li>
<li><a href="#org4700160">æ–‡æœ¬æ’åº (Sorting)</a></li>
<li><a href="#orgebabf22">åˆ— (Columns)</a></li>
<li><a href="#org6266a8e">ç¼©è¿› (Indentation)</a></li>
<li><a href="#orgf71a383">å¤§å°å†™æ”¹å˜ (Case Changes)</a></li>
<li><a href="#org7440d36">æ–‡æœ¬å±æ€§ (Text Properties)</a></li>
</ul>
</li>
<li><a href="#orgd9deedc">è¯­æ³•è¡¨ (Syntax Tables)</a>
<ul>
<li><a href="#org311808e">è¯­æ³•è¡¨åŸºç¡€ (Syntax Basics)</a></li>
<li><a href="#org04015f8">è¯­æ³•æè¿°ç¬¦ (Syntax Descriptors)</a></li>
<li><a href="#orga85b806">è¯­æ³•è¡¨å‡½æ•° (Syntax Table Functions)</a></li>
<li><a href="#orgd261fc0">è¯­æ³•å±æ€§ (Syntax Properties)</a></li>
<li><a href="#orgbba509a">åŠ¨ä½œå’Œè¯­æ³• (Motion and Syntax)</a></li>
<li><a href="#orgcf44e82">è§£æè¡¨è¾¾å¼ (Parsing Expressions)</a></li>
<li><a href="#org9f073ae">è¯­æ³•è¡¨å†…éƒ¨å®ç° (Syntax Table Internals)</a></li>
<li><a href="#org624dce1">åˆ†ç±» (Categories)</a></li>
</ul>
</li>
<li><a href="#orga417383">çº¿ç¨‹ (Threads)</a>
<ul>
<li><a href="#org52a9f76">åŸºç¡€çš„çº¿ç¨‹å‡½æ•° (Basic Thread Functions)</a></li>
<li><a href="#org47c816f">äº’æ–¥é” (Mutexes)</a></li>
<li><a href="#orgca53d4c">æ¡ä»¶å˜é‡ (Condition Variables)</a></li>
<li><a href="#org37c24c5">çº¿ç¨‹åˆ—è¡¨ (The Thread List)</a></li>
</ul>
</li>
<li><a href="#org089e337">è¿›ç¨‹ (Processes)</a>
<ul>
<li><a href="#org7bffc2c">åˆ›å»ºå­è¿›ç¨‹ (Subprocess Creation)</a></li>
<li><a href="#org53aa405">Shellå‚æ•° (Shell Arguments)</a></li>
<li><a href="#org902e9e0">åˆ›å»ºåŒæ­¥è¿›ç¨‹ (Synchronous Processes)</a></li>
<li><a href="#orgd428d45">åˆ›å»ºå¼‚æ­¥è¿›ç¨‹ (Asynchronous Processes)</a></li>
<li><a href="#org08e93b3">åˆ é™¤è¿›ç¨‹ (Deleting Processes)</a></li>
<li><a href="#org4a5cd3c">è¿›ç¨‹ä¿¡æ¯ (Process Information)</a></li>
<li><a href="#org3fa609e">ç»™è¿›ç¨‹å‘é€è¾“å…¥ (Input to Processes)</a></li>
<li><a href="#org6c402cb">ç»™è¿›ç¨‹å‘é€ä¿¡å· (Signals to Processes)</a></li>
<li><a href="#org303b3dd">æ¥æ”¶è¿›ç¨‹çš„è¾“å‡º (Output from Processes)</a></li>
<li><a href="#org684c63b">å“¨å…µ:æ£€æµ‹è¿›ç¨‹çŠ¶æ€çš„æ”¹å˜ (Sentinels)</a></li>
<li><a href="#org2a29695">åœ¨ç»“æŸå‰è¯¢é—® (Query Before Exit)</a></li>
<li><a href="#org34bb1f9">ç³»ç»Ÿè¿›ç¨‹ (System Processes)</a></li>
<li><a href="#orgef0ed13">äº‹åŠ¡é˜Ÿåˆ— (Transaction Queues)</a></li>
<li><a href="#org3cd7b5a">ç½‘ç»œé“¾æ¥ (Network)</a></li>
<li><a href="#org89d27f3">ç½‘ç»œæœåŠ¡å™¨ (Network Servers)</a></li>
<li><a href="#orgf950d7a">æ•°æ®æŠ¥ (Datagrams)</a></li>
<li><a href="#org861f980">åº•å±‚ç½‘ç»œè®¿é—® (Low-Level Network)</a></li>
<li><a href="#org1d78224">ç½‘ç»œæ‚é¡¹ (Misc Network)</a></li>
<li><a href="#org84f4204">ä¸²å£ (Serial Ports)</a></li>
<li><a href="#org8f8982c">å­—èŠ‚æ‰“åŒ… (Byte Packing)</a></li>
</ul>
</li>
<li><a href="#orgcab3145">æ˜¾ç¤º (Display)</a></li>
<li><a href="#org77f97ed">æŒ‰é”®æ˜ å°„ (Keymaps)</a>
<ul>
<li><a href="#orgc6e2e98">æŒ‰é”®åºåˆ— (Key Sequences)</a></li>
<li><a href="#org5832b98">æŒ‰é”®æ˜ å°„çš„åŸºç¡€ (Keymap Basics)</a></li>
<li><a href="#org160be08">æŒ‰é”®æ˜ å°„çš„æ ¼å¼ (Format of Keymaps)</a></li>
<li><a href="#org95d78c9">åˆ›å»ºæŒ‰é”®æ˜ å°„ (Creating Keymaps)</a></li>
<li><a href="#org8e82ea0">ç»§æ‰¿å’ŒæŒ‰é”®æ˜ å°„ (Inheritance and Keymaps)</a></li>
<li><a href="#org80e2a3d">å‰ç¼€é”® (Prefix Keys)</a></li>
<li><a href="#org9e1b550">æ¿€æ´»çš„æŒ‰é”®æ˜ å°„ (Active Keymaps)</a></li>
<li><a href="#org1aa8cbd">æŸ¥æ‰¾æ¿€æ´»çš„æŒ‰é”®æ˜ å°„ (Searching Keymaps)</a></li>
<li><a href="#org8b3efb6">æ§åˆ¶æ¿€æ´»çš„æŒ‰é”®æ˜ å°„ (Controlling Active Maps)</a></li>
<li><a href="#org11a105d">æŒ‰é”®æŸ¥æ‰¾ (Key Lookup)</a></li>
<li><a href="#org372319a">æŒ‰é”®æŸ¥æ‰¾çš„å‡½æ•° (Functions for Key Lookup)</a></li>
<li><a href="#org74311b0">æ”¹å˜æŒ‰é”®ç»‘å®š (Changing Key Bindings)</a></li>
<li><a href="#org3f4f09f">é‡æ–°æ˜ å°„å‘½ä»¤ (Remapping Commands)</a></li>
<li><a href="#org6ae2f0b">ç”¨äºç¿»è¯‘äº‹ä»¶åºåˆ—çš„æŒ‰é”®æ˜ å°„ (Translation Keymaps)</a></li>
<li><a href="#org34d75b6">ç»‘å®šæŒ‰é”®çš„å‘½ä»¤ (Key Binding Commands)</a></li>
<li><a href="#org4b65279">æ‰«ææŒ‰é”®æ˜ å°„ (Scanning Keymaps)</a></li>
<li><a href="#org638e109">èœå•æŒ‰é”®æ˜ å°„ (Menu Keymaps)</a></li>
</ul>
</li>
<li><a href="#orga3a03e6">æ¨¡å¼ (Modes)</a>
<ul>
<li><a href="#orgb1d663e">é’©å­ (Hooks)</a></li>
</ul>
</li>
<li><a href="#org7dc9956">Emacs ç¼–ç ç³»ç»Ÿ</a></li>
<li><a href="#org564d34f">æ–‡æ¡£ (Documentation)</a></li>
<li><a href="#orgfa2012a">æ‰“åŒ… (Packaging)</a></li>
<li><a href="#orgafc9962">GNU Emacs Internals</a>
<ul>
<li><a href="#orgdc5a921">C ç¨‹åºçš„å†…å­˜æ˜ åƒ</a></li>
</ul>
</li>
<li><a href="#orgc01d618">EIEIO</a></li>
</ul>
</li>
<li><a href="#org73ff1f7">Emacs ä¹‹æ·±è—ä¸æ¼</a>
<ul>
<li><a href="#orgb558a43">Calc</a></li>
</ul>
</li>
<li><a href="#orgddcef05">ä¸ªäººè®¤ä¸ºä¸é”™çš„çš„ä¸€äº›å‚è€ƒèµ„æºå’Œåšå®¢</a></li>
<li><a href="#orgab6ee07">æˆ‘ä¸Emacsçš„ä¸€äº›äº‹æƒ…</a></li>
</ul>
</div>
</div>
<div class="abstract" id="org594b92d">
<p>
å¦‚æœå­¦ä¸€æ ·ä¸œè¥¿ä¸åšçŸ¥è¯†ç®¡ç†çš„è¯,æ—¶é—´ä¹…äº†å°±ä¼šé™·å…¥Problem-Google-Solution-Forgotten è¿™æ ·çš„å¾ªç¯ä¸­,è®°å¾—è¯»ä¹¦æ—¶å€™æœ‰äººè¯´,çœ‹é‚£ä¸ªäººåšç¬”è®°é‚£ä¹ˆ
</p>

<p>
è®¤çœŸä½†è¿˜æ˜¯è€ƒä¸å¥½,çœŸè ¢.é¦–å…ˆæˆ‘ä¸ªäººä¸è®¤ä¸ºåšç¬”è®°æ˜¯ä¸€ä»¶è ¢äº‹,ä¸è¿‡åšç¬”è®°æ˜¯éœ€è¦æŠ€å·§çš„,é‚£ä¸ªè€ƒä¸å¥½çš„äººå¯èƒ½æ˜¯è¿™é‡Œå‡ºäº†é—®é¢˜,æˆ–è€…åªæ˜¯ä»–å•çº¯çš„åªæ˜¯åšç¬”
</p>

<p>
è®°è€Œå·².æ¯å½“é‡åˆ°é—®é¢˜å»Googleå®é™…æ˜¯ä¸€ä»¶å¾ˆæµªè´¹æ—¶é—´çš„äº‹æƒ…,ä¸ºä½•ä¸æŠŠå†…å­˜é‡Œé¢çš„æ•°æ®æŒä¹…åŒ–ä¸‹å¹¶ä¸”ç»™å®ƒè¿™ä¸ªç´¢å¼•å‘¢?è®°å½•çš„ä¸œè¥¿å¤§éƒ¨ä»½éƒ½æ˜¯å¾ˆçç¢çš„,æ¯•ç«Ÿ
</p>

<p>
æ˜¯å› ä¸ºçç¢æ‰è¦ä»¥è¿™ç§å½¢ä¼¼è®°å½•ä¸‹æ¥.
</p>

<p>
P.S: è¿™æ–‡ç« åšä¸ºæˆ‘ä¸ªäººçš„çŸ¥è¯†ç®¡ç†æ–¹æ¡ˆä¹‹ä¸€ä¼šä¸€ç›´ä¼šæ›´æ–°.ä¸ºä»€ä¹ˆä¸æŠŠæ¯ä¸ªè¯é¢˜åˆ†å¼€å†™,é‚£æ—¶å› ä¸ºè®°å½•çš„ä¸œè¥¿å¤ªçç¢äº†,ä¸è®°å½•åˆä¸å¥½,æ‰€ä»¥æ‰å†™æˆä¸€ç¯‡,ä¸è¿‡åˆ†é‡å¤§çš„è¯é¢˜ä¼šåˆ†å¼€å†™,æ¯”å¦‚ä¸€äº›packagesçš„ç”¨æ³•.
</p>

</div>

<div id="outline-container-org0c02f86" class="outline-2">
<h2 id="org0c02f86">ä½¿ç”¨Emacsçš„ä¸€äº›tips</h2>
<div class="outline-text-2" id="text-org0c02f86">
<ul class="org-ul">
<li><p>
å¦‚ä½•å¿«é€Ÿäº†è§£Emacså†…ç½®åº“å’Œå†…ç½®åŠŸèƒ½çš„ç”¨æ³•
</p>

<p>
å¾ˆå¤šäºº,åŒ…æ‹¬æˆ‘,éƒ½å¾ˆå¥½å¥‡å†™Emacs Lispçš„é«˜äººæ˜¯å¦‚ä½•çŸ¥é“é‚£ä¹ˆå¤šå¥‡æ€ªçš„åŠŸèƒ½,è€Œä¸”è¿™äº›åŠŸèƒ½æ–‡æ¡£ä¸Šåˆæ²¡æåˆ°.
</p>

<p>
ç°åœ¨æœ‰ç­”æ¡ˆäº†,ä»¥ä¸‹æç¤ºå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæµè§ˆè¿™äº›å¥‡æ€ªçš„åŠŸèƒ½.
</p>

<ol class="org-ol">
<li><code>C-h p</code>,æ ¹æ®åˆ†ç±»æµè§ˆ,ç¼ºç‚¹é‡Œé¢ä¼šæ··æ‚ä¸€äº›éå†…ç½®çš„åº“å¹¶ä¸”è²Œä¼¼ä¸å…¨</li>

<li><code>M-x find-library</code>,æ ¹æ®åå­—æœç´¢åº“,ç¼ºç‚¹æ²¡æœ‰ä¸€ä¸ªç³»ç»Ÿçš„åˆ†ç±»</li>

<li><code>M-x apropos-library</code>,æ ¹æ®åå­—æœç´¢åº“,å¯ä»¥çœ‹åˆ°åº“é‡Œé¢å…¨éƒ¨é‡è¦çš„å®šä¹‰</li>

<li><code>M-x find-function</code> æŸ¥çœ‹å‡½æ•°å®šä¹‰, <code>C-h f</code> æˆ– <code>M-x describe-function</code> æŸ¥çœ‹å‡½æ•°æè¿°ä»¥åŠç”¨æ³•</li>

<li><code>M-x find-variable</code> æŸ¥çœ‹å˜é‡å®šä¹‰, <code>C-h v</code> æˆ– <code>M-x describe-variable</code> æŸ¥çœ‹å˜é‡æè¿°ä»¥åŠç”¨æ³•</li>

<li><code>C-h b</code> æˆ– <code>M-x describe-bindings</code> æŸ¥çœ‹æ‰€æœ‰æŒ‰é”®ç»‘å®šä¿¡æ¯,åŒ…å«äº†å…¨å±€æŒ‰é”®ç»‘å®š,ä»¥åŠä½¿ç”¨è¯¥å‘½ä»¤å½“å‰çš„ç¼“å†²åŒºæ‰€å¯ç”¨çš„ <code>minor mode</code> å’Œ <code>major mode</code> çš„æŒ‰é”®ç»‘å®š.
å¯ä»¥é…åˆ <code>apropos-library</code> æŸ¥çœ‹ <code>mode</code> å®šä¹‰æ¥å¿«é€ŸæŒæ¡ <code>mode</code> çš„ä½¿ç”¨.
<code>C-h k</code> åˆ™æŸ¥è¯¢æŸä¸ªç»‘å®šæŒ‰é”®æ‰€å¯¹åº”çš„ä¿¡æ¯,æ¯”å¦‚ç»‘å®šçš„æ˜¯å“ªä¸ªå‘½ä»¤,å®šä¹‰åœ¨å“ªé‡Œç­‰ç­‰.</li>

<li><code>C-h a</code> æˆ– <code>M-x apropos-command</code> è¾“å…¥æƒ³è¦æœç´¢çš„å‘½ä»¤åå­—,æ¨¡ç³Šæœç´¢å‘½ä»¤,æ¯” <code>M-x</code> è‡ªåŠ¨æç¤ºçš„å¥½</li>

<li><code>M-x apropos-variable</code> è¾“å…¥éœ€è¦æœç´¢çš„å˜é‡åå­—,æ¨¡ç³Šæœç´¢å˜é‡</li>
</ol>

<p>
æ€»ä¹‹, <code>C-h</code> æ˜¯ <code>Emacs</code> çš„ <code>help-command</code>,å¯ä»¥é€šè¿‡å®ƒæŸ¥çœ‹ä¸€äº›ä½ ä¸çŸ¥é“çš„Emacsçš„ç”¨æ³•,æ˜¯ä¸€ä¸ªæå…¶æœ‰ç”¨çš„å†…ç½®æ–‡æ¡£,å¯¹äºæ–°æ‰‹æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„èµ·ç‚¹.æ¯”å¦‚ <code>C-h C-h</code> å°±æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‘½ä»¤.
</p>

<p>
è¿˜æœ‰ <code>apropos</code> åº“æ˜¯ä¸€ä¸ªè¾…åŠ©å¼€å‘äººå‘˜å’Œç”¨æˆ·çš„å¥½ä¸œè¥¿,æ¨èä½¿ç”¨.
</p>

<p>
ä¸Šé¢éƒ½æ˜¯ä¸€äº›æ¯”è¾ƒå¸¸ç”¨å’Œæœ‰ç”¨çš„å‘½ä»¤,å¯ä»¥äº†è§£ä¸€ä¸‹.
</p>

<p>
P.S: é¡ºä¾¿æä¸€ä¸‹,ä»£ç ä¹Ÿæ˜¯å¾ˆé‡è¦çš„æ–‡æ¡£.
</p></li>

<li><p>
å¦‚ä½•å­¦ä¹ åº“çš„APIæˆ–è€…æŸä¸€ä¸ªAPIçš„ç”¨æ³•å‘¢
</p>

<p>
å­¦ä¹ ä¸€ä¸ªæ–°çš„åº“/APIä¹Ÿä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…,æ¯”å¦‚Emacsçš„æ–‡æ¡£ä¸Šæœ‰å¾ˆå¤šä¸œè¥¿éƒ½æ²¡ç»™å‡º,ç»™å‡ºäº†ä½†working exampleså¤ªå°‘,ç­‰ç­‰.å¯¹äºè¿™äº›é—®é¢˜æˆ‘æœ‰ä¸€å¥—å­¦ä¹ ç­–ç•¥.
</p>

<ol class="org-ol">
<li><p>
é˜…è¯»åº“/APIçš„æ–‡æœ¬æ–‡æ¡£/ç»´åŸº
</p>

<p>
æ–‡æ¡£è™½ç„¶ä¸ä¸€å®šæœ‰æƒ³è¦çš„ç­”æ¡ˆ,ä½†ä¾ç„¶æ˜¯ä¸€ä¸ªä¸é”™çš„èµ·ç‚¹.ä½†æ˜¯ä½¿ç”¨æ–‡æ¡£ä¹Ÿæ˜¯æœ‰å­¦é—®çš„(,æˆ‘æ²¡å¤šå°‘å°±æ˜¯äº†).
</p>

<ol class="org-ol">
<li><p>
å­¦ä¹ è¿™ä¸ªåº“/APIä¹‹å‰äº†è§£æ‰€éœ€è¦çš„æ¦‚å¿µå’Œç›¸å…³èƒŒæ™¯.
</p>

<p>
<b>æ¯”å¦‚</b>,
</p>

<ul class="org-ul">
<li>è¿™ä¸ªåº“/APIæ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„?</li>

<li>å®ƒçš„ä½¿ç”¨æµç¨‹æ˜¯æ€ä¹ˆæ ·?(åº“çš„è®¾è®¡/æ¶æ„)</li>

<li>éœ€è¦æ³¨æ„ç‰ˆæœ¬é—®é¢˜å—?(ç‰ˆæœ¬æ˜¯å¦å¯¼è‡´è·Ÿå…¶å®ƒåº“/APIå†²çª)</li>

<li>å®ƒçš„changelogåœ¨å“ª?(ä¸€èˆ¬æ–‡æ¡£é‡Œé¢æœ‰)</li>

<li>éœ€è¦äº†è§£çš„æœ¯è¯­æœ‰å“ªäº›?(ä¸€èˆ¬å¯ä»¥æ‰¾æ–‡æ¡£é‡Œé¢æ‰¾åˆ°,é‡åˆ°ä¸æ‡‚çš„å°±å¼„æ˜ç™½)</li>
</ul>

<p>
è¿™æ ·è‡ªå·±å¤§æ¦‚å°±å¯ä»¥ç»™åº“çš„APIsåˆ†ä¸ªç±»,å¯¹åº“æœ‰ä¸ªå…¨è²Œçš„è®¤è¯†,å¹¶ä¸”èƒ½å¤Ÿä¿è¯è‡ªå·±ä¸ä¼šå¯¹è¿™ä¸ªåº“/APIäº§ç”Ÿä»€ä¹ˆè¯¯è§£,å¯¹ä»¥åä½¿ç”¨åŒæ ·ç±»å‹çš„åº“ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹.
</p></li>

<li>äº†è§£æ–‡æ¡£.æ–‡æ¡£ä¹Ÿæ˜¯æœ‰åˆ†ç±»çš„,æ¯ç§æ–‡æ¡£çš„ä¾§é‡ç‚¹éƒ½ä¸å¤ªä¸€æ ·.ä»¥Racketä¸ºä¾‹å­,æœ‰ <code>tutorial</code>, <code>guide</code> å’Œ <code>reference</code> 3ç±».

<ul class="org-ul">
<li><code>tutorial</code> å°±æ˜¯ç»™æ–°æ‰‹ä¸€ä¸ªå¿«é€Ÿä¸Šæ‰‹çš„ä¾‹å­,è¿™ç§ä¾‹å­å¾ˆä¸°å¯Œ,ä½†å¾€å¾€ä¼šå¿½ç•¥å¾ˆå¤šå…³äºRacketä¸œè¥¿.</li>

<li><code>guide</code> æ¯” <code>tutorial</code> æ›´å…·å¤‡é’ˆå¯¹æ€§,ä¼šåˆ©ç”¨ä¾‹å­å¯¹æŸä¸€ä¸ªç‚¹è¿›è¡Œæ¯”è¾ƒæ·±å…¥åœ°è¯´æ˜,å±•ç¤ºè¿™ä¸ªä¸œè¥¿è¿™ä¹ˆç”¨,ä¾‹å­ä¸°å¯Œ.è¿™ç±»æ˜¯ç»™é‚£ç§åˆ·è¿‡ä¸€é <code>tutorial</code> çš„æ–°æ‰‹ä½¿ç”¨çš„.</li>

<li><code>reference</code> æ¯” <code>guide</code> æ›´åŠ è¯¦ç»†,å¤§éƒ¨ä»½è¿™ç±»æ–‡æ¡£éƒ½ä»…ä»…ç»™å‡ºä¸€å¤§æ®µçš„è¯´æ˜,ä¸ä¼šç»™å‡ºä¾‹å­æ•™ä½ æ€ä¹ˆä½¿ç”¨,æˆ–è€…ä¾‹å­ç®€é™‹éš¾ä»¥æŒæ¡ç”¨æ³•,è¿™ç§æ–‡æ¡£æ˜¯ç»™ç†Ÿæ‚‰äº†Racketä¸€æ®µæ—¶é—´çš„å¼€å‘äººå‘˜æŸ¥é˜…ç”¨çš„.(è€ŒEmacsçš„å†…ç½®æ–‡æ¡£å°±æ˜¯è¿™æ ·.)</li>
</ul></li>
</ol>

<p>
äº†è§£åº“çš„ç›¸å…³ä¿¡æ¯å,è¯»æ‡‚æ–‡æ¡£åº”è¯¥å°±é—®é¢˜ä¸å¤§äº†.æŒæ¡äº†æ–‡æ¡£å±æ€§ä»¥åå°±å¯ä»¥çŸ¥é“è¯¥å¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨æ–‡æ¡£äº†.
</p>

<p>
P.S: èº«è¾¹æœ‰ä¸å°‘,åŒ…æ‹¬æˆ‘è‡ªå·±,è¿™é‡Œæ€ä¹ˆä¸å¯¹å‘¢?è·Ÿæ–‡æ¡£è¯´çš„ä¸ä¸€æ ·å•Š?è¿™ä¸ªåº“æ˜¯ä¸æ˜¯æœ‰Bugå•Š?æ€ä¹ˆè¿™ä¸ªåº“è¿™ä¹ˆéš¾ç”¨,å°±æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•å—?æ–‡æ¡£ä¸Šé¢æ²¡æœ‰å•Š!.å…¶å®åªè¦åšè¶³äº†åŠŸè¯¾,è¿™äº›é—®é¢˜å°±å¾ˆå°‘å¬åˆ°äº†.ä¸ä»…ä»…æ˜¯è¯»æ–‡æ¡£,è¯»ä»£ç ä¹Ÿæ˜¯ä¸€æ ·çš„.
</p></li>

<li><p>
é˜…è¯»åˆ«äººåˆ©ç”¨è¯¥åº“/APIå†™çš„ä»£ç 
</p>

<p>
æœ‰æ—¶å€™æ–‡æ¡£ä¸Šé¢è¿‡ç¨‹å…³äºæŸä¸ªAPIçš„ä¾‹å­å¾ˆç®€é™‹æˆ–è€…æ²¡æœ‰ç»™å‡ºä¾‹å­,è€Œè‡ªå·±åˆå®åœ¨å¤´ç–¼,é‚£ä¹ˆåªèƒ½åˆ°ç½‘ä¸Šæ‰¾ä¾‹å­,æ¯”å¦‚Githubçš„repo,gist,Stack Exchange,åˆ«äººçš„blog,ç­‰ç­‰.
</p></li>

<li><p>
é˜…è¯»åº“/APIçš„å•å…ƒæµ‹è¯•ä»£ç 
</p>

<p>
å¦‚æœæ‰¾ä¸åˆ°åˆ«äººçš„ä»£ç å¯ä»¥å»çœ‹ä¸€çœ‹è¿™ä¸ªåº“æœ‰æ²¡æœ‰å•å…ƒæµ‹è¯•çš„ä»£ç ,å¦‚æœæœ‰,é‚£ä¹ˆå®ƒä»¬å°±æ˜¯ä½ æƒ³è¦çš„APIæ–‡æ¡£äº†.
</p></li>

<li><p>
é˜…è¯»åº“/APIçš„æºä»£ç 
</p>

<p>
å¦‚æœå•å…ƒæµ‹è¯•çš„ä»£ç ä¹Ÿæ²¡æœ‰,é‚£ä¹ˆå¯ä»¥è‡ªå·±å»è¯»æƒ³è¦äº†è§£çš„APIçš„æºä»£ç ,ä½¿ç”¨åˆ°å®ƒçš„åœ°æ–¹å°±æ˜¯ä½ æƒ³è¦çš„ä¾‹å­.
</p></li>

<li><p>
è¯·æ•™åˆ«äºº
</p>

<p>
å¦‚æœä¸Šé¢çš„æ–¹æ³•å…¨éƒ¨å¤±æ•ˆ,é‚£å»é—®åˆ«äººå§.
</p></li>
</ol></li>

<li><p>
å¿«é€Ÿåšæ­£åˆ™æµ‹è¯• (ä¸€æ¬¡å…³äºæ˜¯å¦ä½¿ç”¨ <code>\</code> çš„æ€è€ƒ,ä¸ä»…ä»…é™äº <code>Emacs Lisp</code>)
</p>

<p>
<code>Emacs Lisp</code> çš„æ­£åˆ™è¡¨è¾¾å¼å¯èƒ½ä¼šè·Ÿä½ ä¹‹å‰é‡åˆ°çš„æ­£åˆ™ä¸å¤ªä¸€æ ·,æœ‰ä¸¤ç‚¹éœ€è¦æ¸…æ¥š.
</p>

<ol class="org-ol">
<li><p>
ä¸¥æ ¼æ¥è¯´, <b>Emacs Lisp æ ¹æœ¬æ²¡æœ‰æ­£åˆ™è¡¨è¾¾å¼è¿™ä¸€æ•°æ®ç±»å‹</b>
</p>

<p>
è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åŒ¹é… "\" ç¬¦å·æ¥è¿›è¡Œç¡®è®¤.
</p>

<p>
æ¯”å¦‚ <code>Python</code> è¿™ç±»æœ‰æ­£åˆ™è¡¨è¾¾å¼ç±»å‹çš„è¯­è¨€,å¯¹å®ƒçš„æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œç¼–è¯‘åä¼šç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²,
</p>

<p>
å‡è®¾ä½ æƒ³ç”¨ <code>Python</code> çš„ <code>re.match</code> é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ‰¾å‡ºæ–‡æœ¬æ–‡ä»¶ "This is \section" é‡Œé¢çš„ <code>\section</code>,
</p>

<p>
é‚£ä¹ˆæ­£ç¡®çš„è°ƒç”¨æ–¹å¼å°±æ˜¯ <code>re.match(r"\\section", "This is \section")</code>,
</p>

<p>
åœ¨è°ƒç”¨æ—¶ <code>r"\\section"</code> è¢« <code>re.compile()</code> ç¼–è¯‘æˆ <code>"\\\\section"</code>,
</p>

<p>
å› æ­¤ <code>re.match("\\\\section", "This is \section")</code> ä¹Ÿæ˜¯æ­£ç¡®çš„.
</p>

<p>
å¦‚æœç”¨ <code>Emacs Lisp</code> å®Œæˆè¿™é¡¹å·¥ä½œ,æ‰“å¼€æ–‡ä»¶åæœ‰ä¸¤ç§åšæ³•:
</p>

<p>
ä¸€ç§æ˜¯ <b>é€šè¿‡è°ƒç”¨å‘½ä»¤çš„æ–¹å¼</b> å®Œæˆå·¥ä½œ,æ¯”å¦‚ <code>M-x re-search-forward RET</code> è¾“å…¥ <code>\\section</code> è¿›è¡Œæœç´¢,
</p>

<p>
è¿™å’Œ <code>Python re.compile()</code> çš„å‚æ•° <code>r"\\section"</code> æ˜¯ä¸€æ ·çš„,è¿™ç§æ–¹å¼ä¸‹ <code>Emacs Lisp</code> ä¼šå…ˆæŠŠå‚æ•° <code>"\\section"</code> è§£ææˆ <code>"\\\\section"</code> å†è¿›è¡ŒåŒ¹é…;
</p>

<p>
å¦å¤–ä¸€ç§å°±æ˜¯ <b>ä»¥ç¼–ç¨‹çš„æ–¹å¼</b> å®Œæˆå·¥ä½œ,ä¾ç„¶ä½¿ç”¨ <code>re-search-forward</code>,è¿™ç§æ–¹å¼ä¸‹ <code>Emacs Lisp</code> ä¸ä¼šè§£æå‚æ•°,
</p>

<p>
å› æ­¤éœ€è¦å¼€å‘äººå‘˜æ‰‹åŠ¨å†™å‡ºè§£æç»“æœæ¥è¿›è¡Œè°ƒç”¨: <code>(re-search-forward "\\\\section")</code>.
</p>

<p>
æ‰€ä»¥ç®€å•æ¥è¯´,æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ç±»å‹çš„è¯­è¨€éœ€è¦åœ¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ—¶,ä¼šå…ˆæŠŠæ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘/è§£ææˆå­—ç¬¦ä¸²,ç„¶åè¿›è¡ŒåŒ¹é…,
</p>

<p>
è€Œ <code>Emacs Lisp</code> è¿™ç§ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ç±»å‹çš„å°±éœ€è¦ç›´æ¥ä½¿ç”¨ç¼–è¯‘/è§£æç»“æœè¿›è¡ŒåŒ¹é…(ä»…é™äºç¼–ç¨‹æ—¶).
</p></li>

<li><p>
<b>åŒºåˆ†æ­£åˆ™è¡¨è¾¾å¼çš„è½¬ä¹‰å­—ç¬¦å’Œå­—ç¬¦ä¸²çš„è½¬ä¹‰å­—ç¬¦</b>
</p>

<p>
åœ¨å­—ç¬¦ä¸²ä¸­, <code>\n, \s</code> è¿™äº›å­—ç¬¦æ˜¯ç”±ç‰¹æ®Šæ„ä¹‰çš„,ç»“æ„éƒ½æ˜¯ <code>\CHARSEQ</code>, å…¶ä¸­ <code>CHARSEQ</code> æ˜¯å­—ç¬¦åºåˆ—,è¿™æ ·çš„ç»“æ„æ˜¯ä¸€ä¸ªå­—ç¬¦,
</p>

<p>
æ²¡é”™,çœŸçš„ä¸æ˜¯å­—ç¬¦ä¸²,å› ä¸ºæ•´ä¸ªå­—ç¬¦çš„å«ä¹‰å’Œåé¢çš„å­—ç¬¦åºåˆ—æ‰€è¡¨è¾¾çš„å«ä¹‰ä¸ä¸€æ ·,æ‰€ä»¥è¿™äº›å­—ç¬¦è¢«ç§°ä¸ºè½¬ä¹‰å­—ç¬¦(escape character),
</p>

<p>
æ¯”å¦‚å‰é¢çš„ <code>"This is \section"</code> ç”¨ <code>message</code> æ‰“å°çš„ç»“æœæ˜¯ <code>"This is  ection"</code>, <code>\s</code> è¿™ä¸ªå­—ç¬¦è¡¨ç¤ºçš„æ˜¯ç©ºæ ¼çš„æ„æ€,
</p>

<p>
æˆ‘ä»¬æŠŠåœ¨å­—ç¬¦åºåˆ—å‰é¢åŠ ä¸ª <code>\</code> æ¥è¡¨è¾¾ç‰¹æ®Šçš„å«ä¹‰çš„è¿™ä¸ªåŠ¨ä½œå«åšè½¬ä¹‰(escape).
</p>

<p>
å¦‚æœæˆ‘ä»¬ä¸æƒ³ <code>\s</code> è¡¨è¾¾å®ƒåŸæœ¬çš„å«ä¹‰,é‚£ä¹ˆå¯ä»¥é€šè¿‡åœ¨å‰é¢åŠ  <code>\</code> æ¥è¿›è¡Œåè½¬ä¹‰(unescape): <code>"This is \\section"</code>,
</p>

<p>
æ²¡æœ‰è¢«å®šä¹‰ä¸ºè½¬ä¹‰å­—ç¬¦çš„å­—ç¬¦,åœ¨è½¬ä¹‰åçš„ç»“æœå­—ç¬¦åºåˆ—æœ¬èº«,æ¯”å¦‚ <code>\w</code>, ç”¨ <code>message</code> æ‰“å°çš„ç»“æœæ˜¯ <code>w</code>.
</p>

<p>
ä¸åŒæ–‡æœ¬/æƒ…å†µä¸‹æœ‰ä¸åŒçš„è½¬ä¹‰å­—ç¬¦,å­—ç¬¦ä¸²æœ‰è‡ªå·±çš„è½¬ä¹‰å­—ç¬¦,æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæœ‰è‡ªå·±çš„è½¬ä¹‰å­—ç¬¦, <code>HTML</code> ä¹Ÿæœ‰è‡ªå·±çš„è½¬ä¹‰å­—ç¬¦.
</p>

<p>
å‰é¢æˆ‘ä»¬çŸ¥é“ <code>Emacs Lisp</code> ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ç±»å‹, <code>Emacs Lisp</code> çš„æ­£åˆ™è¡¨è¾¾å¼å®é™…ä¸Šå°±æ˜¯å­—ç¬¦ä¸²,
</p>

<p>
åœ¨æŠŠå­—ç¬¦ä¸²å½“ä½œæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨çš„æ—¶å€™,å­—ç¬¦ä¸²çš„è½¬ä¹‰å­—ç¬¦æ˜¯æ²¡æœ‰æ„ä¹‰çš„,æ‰€ä»¥æ²¡æœ‰å¿…è¦æ‹…å¿ƒå­—ç¬¦ä¸²çš„è½¬ä¹‰ä¼šå½±å“æ­£åˆ™è¡¨è¾¾å¼,åè¿‡æ¥ä¹Ÿä¸€æ ·.
</p>

<p>
å› æ­¤è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜è¦æ³¨æ„ä¸€ä¸‹,æ¯”å¦‚,æ­£åˆ™è¡¨è¾¾å¼çš„è½¬ä¹‰å­—ç¬¦ <code>\w</code> çš„å«ä¹‰æ˜¯åŒ¹é…ä»»æ„å•è¯æˆåˆ†çš„(word-constituent)å­—ç¬¦,
</p>

<p>
å¦‚æœç›´æ¥ç”¨ <code>(re-search-forward "\w")</code> è¿›è¡ŒåŒ¹é…,å› ä¸ºå­—ç¬¦é‡Œé¢ <code>\w</code> çš„æ„ä¹‰å°±æ˜¯ <code>w</code>,
</p>

<p>
æ‰€ä»¥å®é™…çš„åŒ¹é…ç»“æœå’Œ <code>(re-search-forward "w")</code> çš„åŒ¹é…ç»“æœä¸€æ ·çš„.
</p>

<p>
å¦‚æœæ˜¯éœ€è¦åŒ¹é…ä»»æ„å•è¯æˆåˆ†çš„å­—ç¬¦,é‚£ä¹ˆå°±å‘Šè¯‰å­—ç¬¦ä¸²ä¸è¦å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„è½¬ä¹‰å­—ç¬¦è½¬ä¹‰,å› æ­¤æ­£ç¡®åšæ³•æ˜¯ <code>(re-search-forward "\\w")</code>.
</p>

<p>
å¯¹äºæ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ®Šå­—ç¬¦(é€šå¸¸å«åšå…ƒå­—ç¬¦)ä¹Ÿæ˜¯ä¸€ä¸ªé“ç†,æ¯”å¦‚ <code>(string-match regex "test.html")</code>,å¦‚æœè¦ä¸€å­—ä¸å·®çš„åŒ¹é…,
</p>

<p>
é‚£ä¹ˆæ­£ç¡®çš„ <code>regex</code> åº”è¯¥æ˜¯ <code>"test\\.html"</code>.
</p>

<p>
<code>"test.html"</code> å’Œ <code>"test\.html"</code> è™½ç„¶ä¹Ÿèƒ½åŒ¹é…æˆåŠŸ,ä½†è¿™æ˜¯å› ä¸º <code>.</code> çš„æ„æ€æ˜¯åŒ¹é…ä»»æ„å­—ç¬¦,
</p>

<p>
è¿™ä¸¤ç§å†™æ³•åœ¨å­—ç¬¦ä¸²é‡Œé¢æœ€åå¾—åˆ°çš„éƒ½æ˜¯ <code>.</code>, è¿™å¯ä»¥é€šè¿‡ <code>(message ".")</code> ä»¥åŠ <code>(message "\.")</code> çš„æ‰“å°ç»“æœæ¥ç¡®è®¤,
</p>

<p>
è€Œæ‰“å°ç»“æœå¯¹äºæ­£åˆ™è¡¨è¾¾å¼æ¥è¯´å°±æ˜¯åŒ¹é…åˆ°ä»»æ„å­—ç¬¦çš„æ„æ€,å¹¶éåŒ¹é…åˆ° <code>.</code> ç¬¦å·æœ¬èº«ä¸Š.
</p>

<p>
åœ¨ <code>M-: (info "(elisp) Regexp Backslash")</code> å¯ä»¥çœ‹åˆ° <code>Emacs Lisp</code> çš„æ­£åˆ™è¡¨è¾¾å¼è½¬ä¹‰å­—ç¬¦.
</p></li>
</ol>

<p>
<br>
</p>

<p>
è¿™é‡Œè¿˜æœ‰ä¸€äº›è¾…åŠ©ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼,æœ¬äººè¿˜æ˜¯æåŠ›æ¨èä¸è¦ä¾èµ–è¿™äº›å·¥å…·,æ—©æ—¥ç†Ÿæ‚‰æ­£åˆ™è¡¨è¾¾å¼çš„ç¼–å†™.
</p>

<p>
è·Ÿ <code>Racket</code> æä¾› <code>regexp-quote</code> åè¾“å‡ºç”¨äºåŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²çš„æ­£åˆ™è¡¨è¾¾å¼ä¸€æ ·, <code>Emacs</code> ä¹Ÿæä¾›ä¸€äº›è¾…åŠ©å·¥å…·å¸®åŠ©ä½ å†™"RegEx":
</p>

<p>
å¯¹å½“å‰ç¼“å†²åŒºå³æ—¶æ¯”å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„ <code>M-x re-builder</code> (æ³¨æ„è¦å†™åœ¨å®ƒç»™ä½ çš„åŒå¼•å·é‡Œé¢),ä»¥åŠç®€å•å¼ºå¤§çš„ <code>rx</code>.
</p></li>

<li><p>
Linuxä¸Šè¿œç¨‹ç¼–è¾‘å’Œç¼–è¾‘éœ€è¦sudoè®¤è¯çš„æ–‡ä»¶
</p>

<p>
ä½¿ç”¨trampåº“,å®ƒä¸ä»…å¯ä»¥è¿œç¨‹ç¼–è¾‘æ–‡ä»¶,ä¹Ÿå¯ä»¥sudoä¿®æ”¹æœ¬åœ°æ–‡ä»¶
</p>

<ol class="org-ol">
<li><p>
ç¼–è¾‘è¿œç¨‹æ–‡ä»¶
</p>

<p>
<code>C-x C-f</code> è¾“å…¥ <code>/ssh:user@host#port:/path/to/file</code>, å°±æ˜¯è¯´é€šè¿‡ <code>ssh</code> ä»¥userèº«ä»½ç¼–è¾‘host:portä¸Šçš„ <code>/path/to/file</code> æ–‡ä»¶.
</p></li>

<li><p>
sudoä¿®æ”¹æ–‡ä»¶
</p>

<p>
<code>C-x C-f</code> è¾“å…¥ <code>/sudo::/path/to/file</code>, è¿™æ ·æ‰“å¼€ <code>/path/to/file</code> çš„æ—¶å€™å°±ä¼šæç¤ºè¾“å…¥å¯†ç äº†
</p></li>
</ol></li>

<li><p>
<code>Emacs Lisp</code> çš„äº¤äº’å¼ç¼–ç¨‹
</p>

<p>
å’Œå¾ˆå¤šç›´è¯‘å‹è¯­è¨€ä¸€æ ·, <code>Emacs Lisp</code> ä¹Ÿæ”¯æŒ <code>REPL</code>,ä¸è¿‡è¿™ä¸ªåŠŸèƒ½è—å¾—æŒºæ·±å¾—, <code>M-x ielm</code>.
</p>

<p>
<code>ielm</code> å…¨ç§° <code>Inferior Emacs Lisp Mode</code>. <code>Inferior Modes</code> æ˜¯ä¸ªå¥½ä¸œè¥¿.
</p></li>

<li><p>
å¦‚ä½•äº†è§£åœ¨ä½¿ç”¨ <code>Emacs</code> çš„è¿‡ç¨‹ä¸­å‘ç”Ÿçš„äº‹æƒ…
</p>

<p>
æœ‰æ—¶å€™æƒ³çŸ¥é“è‡ªå·±æ“ä½œäº†ä»€ä¹ˆ,ä½¿ç”¨æŒ‰é”®è¾“å…¥å¯¹åº”ä»€ä¹ˆå‘½ä»¤,ä½¿ç”¨å‘½ä»¤æ—¶å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ….
</p>

<p>
è¿™ç§æ—¶å€™å°±ä¼šæƒ³èµ·æ—¥å¿—,åœ¨ç½‘ä¸Šæœç´¢åå‘ç°æœ‰ä¸‰ç§æ‰“å°æ—¥å¿—:
</p>

<p>
<b>ä½¿ç”¨ Emacs è‡ªå¸¦çš„ <code>command-history</code> å˜é‡,æˆ–è€… (command-history)</b>,
</p>

<p>
ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰å¾ˆå¤šä¿¡æ¯æ²¡æœ‰è®°å½•ä¸‹æ¥,å…·ä½“å¯ä»¥çœ‹ <code>(info "(elisp)Command Loop")</code>;
</p>

<p>
<b>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ command-log-mode</b>,è¿™ç§èƒ½è®°å½•å¤§éƒ¨åˆ†å‘½ä»¤,æ¯”ç¬¬ä¸€ç§æ–¹æ¡ˆå¥½ä¸å°‘,æ”¯æŒæ—¥å¿—åºåˆ—åŒ–,
</p>

<p>
ä¸è¿‡è¿˜æ˜¯æœ‰äº›è¾“å…¥æ˜¯æ²¡æ³•è®°å½•ä¸‹æ¥çš„,æ¯”å¦‚ <code>Calc</code> é‡Œçš„è¾“å…¥æ˜¯æ²¡æœ‰è¢«è®°å½•ä¸‹æ¥çš„;
</p>

<p>
<b>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ interaction-log</b>,ç›¸æ¯” <code>command-log-mode</code> æ”¯æŒå®æ—¶æ—¥å¿—æ‰“å°,
</p>

<p>
å¹¶ä¸”èƒ½å¤Ÿè®°å½•ä¸‹ <code>command-log-mode</code> çš„ä¸€äº›ç›²ç‚¹,æ¯”å¦‚ä¸Šé¢æåˆ°åœ¨ <code>Calc</code> çš„è¾“å…¥,è¿˜ä¼šè®°å½•ä¸‹ä¸€äº›æ–‡ä»¶æŒ‰åŠ è½½ä¿¡æ¯,å†…å®¹ååˆ†è¯¦ç»†.
</p>

<p>
æˆ‘ä¸ªäººæ˜¯ç”¨çš„ç¬¬ä¸‰ç§æ–¹æ¡ˆ.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org546c52f" class="outline-2">
<h2 id="org546c52f">ä½¿ç”¨é…ç½®çš„ä¸€äº›ä¼˜åŒ–</h2>
<div class="outline-text-2" id="text-org546c52f">
<ul class="org-ul">
<li><p>
æŠŠæç¤ºè¾“å…¥yesæˆ–noç®€åŒ–æˆyæˆ–n
</p>

<div class="org-src-container">
<pre class="src src-elisp">(fset 'yes-or-no-p 'y-or-n-p)
</pre>
</div></li>

<li><p>
<code>C-x C-e</code> é»˜è®¤evalçš„è¾“å‡ºå¤ªä¸‘,æ€ä¹ˆç¾åŒ–
</p>

<div class="org-src-container">
<pre class="src src-elisp">(fset 'eval-last-sexp 'pp-eval-last-sexp)
</pre>
</div></li>
</ul>
</div>
</div>


<div id="outline-container-org9385718" class="outline-2">
<h2 id="org9385718">å†™ Elisp æ—¶å€™é‡åˆ°çš„ä¸€äº›é—®é¢˜</h2>
<div class="outline-text-2" id="text-org9385718">
</div>
<div id="outline-container-org9999d1b" class="outline-3">
<h3 id="org9999d1b">å¦‚ä½•è§£å†³å†™Elispæ—¶å€™é‡åˆ°çš„ä¸€äº›éœ€è¦å¯†ç è®¤è¯çš„å‘½ä»¤è¡Œæ“ä½œ</h3>
<div class="outline-text-3" id="text-org9999d1b">
<p>
ä»¥åœ¨ä¸ªäººç‰ˆçš„Debianä¸Šé¢å®‰è£…nodejsä¸ºä¾‹å­.
</p>

<pre class="example" id="orgfbb397e">
å…ˆäº†è§£ä¸€ä¸‹sudo,sudoçš„ä½œç”¨å°±æ˜¯ä»¥å¦å¤–ä¸€ä¸ªç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤,é»˜è®¤èº«ä»½æ˜¯superuser(è¿™é‡Œæ˜¯root),æ‰§è¡Œæ—¶å€™éœ€è¦æä¾›è¿™ä¸ªç”¨æˆ·çš„å¯†ç .
sudoæœ‰ä¸€ä¸ªsudoers policyç¼“å­˜å‡­è¯15åˆ†é’Ÿ,é™¤éé‡å†™äº†å‡­è¯,å¦åˆ™åœ¨è¿™15åˆ†é’Ÿå†…ä»¥è¿™ä¸ªç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤æ˜¯ä¸éœ€è¦å†æ¬¡è¾“å…¥ä»»ä½•å¯†ç çš„.
</pre>

<ol class="org-ol">
<li><p>
åˆ©ç”¨trampåº“,è®¾å®šé»˜è®¤ç›®å½•ä¸º"/sudo::"
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((default-directory <span style="color: #CC9393;">"/sudo::"</span>))
  (shell-command <span style="color: #CC9393;">"apt-get install nodejs"</span>))
</pre>
</div>

<p>
ç¼ºç‚¹å°±æ˜¯è®¤è¯åä¸ä¼šç”Ÿæˆå‡­è¯
</p></li>

<li><p>
å¯¹å‘½ä»¤è¿›è¡Œä¿®æ”¹
</p>

<div class="org-src-container">
<pre class="src src-elisp">(shell-command (string-join (list <span style="color: #CC9393;">"echo"</span> (shell-quote-argument (read-passwd <span style="color: #CC9393;">"Password: "</span>))
                                  <span style="color: #CC9393;">"|"</span> <span style="color: #CC9393;">"sudo"</span> <span style="color: #CC9393;">"-S"</span> <span style="color: #CC9393;">"apt-get"</span> <span style="color: #CC9393;">"install"</span> <span style="color: #CC9393;">"nodejs"</span>) <span style="color: #CC9393;">" "</span>))
</pre>
</div>

<p>
ç¼ºç‚¹å°±æ˜¯æ¯”è¾ƒéº»çƒ¦,ä¹Ÿæ²¡å‡­è¯ç®¡ç†,ä¼˜ç‚¹å°±æ˜¯ä½ å¯ä»¥è‡ªå·±å®ç°å‡­è¯ç®¡ç†(æ€ä¹ˆå®‰å…¨ç®¡ç†æ˜¯ä¸€ä¸ªé—®é¢˜).
</p></li>

<li><p>
ä½¿ç”¨ <code>eshell-command</code>
</p>

<div class="org-src-container">
<pre class="src src-elisp">(eshell-command <span style="color: #CC9393;">"sudo apt-get install nodejs"</span>)
</pre>
</div>

<p>
ä¼˜ç‚¹æ˜¯ç®€å•,ä½†è¿˜æ˜¯æ²¡æœ‰å‡­è¯ç®¡ç†.
</p></li>
</ol>
</div>
</div>


<div id="outline-container-orgc8db931" class="outline-3">
<h3 id="orgc8db931">å¦‚ä½•è®©è°ƒè¯•å™¨å¯ä»¥è°ƒè¯•user-error?</h3>
<div class="outline-text-3" id="text-orgc8db931">
<pre class="example" id="org1ba6d88">
å†™äº 2018/10/21
</pre>

<p>
Drewå·²ç»åœ¨è¿™<a href="https://superuser.com/questions/782313/emacs-make-debug-on-error-catch-errors/782365">é‡Œé¢</a>è¿›è¡Œå›ç­”äº†,æ–‡æ¡£ä¸Šåªæ˜¯åšäº†æš—ç¤º,ä¹‹æ‰€ä»¥è°ƒè¯•å™¨ä¸èƒ½è°ƒè¯• <code>user-error</code>,é‚£ä¹ˆæ˜¯å› ä¸º <code>debug-ignored-errors</code> è¿™ä¸ªå˜é‡æœ‰ <code>user-error</code> è¿™ä¸ªå˜é‡,
</p>

<p>
<code>debug-ignored-errors</code> æ˜¯å‘Šè¯‰ <code>Emacs Debugger</code> å¿½ç•¥å“ªäº›é”™è¯¯,æ‰€ä»¥åªéœ€è¦æŠŠ <code>debug-ignored-errors</code> é‡Œé¢çš„ <code>user-error</code> æ¡ç›®æ¸…ç©ºæ‰å°±å¯ä»¥äº†.ä¹Ÿå°±æ˜¯è¯´ <code>user-error</code> å®é™…ä¸Šè¿˜æ˜¯å¯ä»¥å”¤é†’ <code>debugger</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> debug-ignored-errors
      (remove-if
       (<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (item) (eq item 'user-error))
       debug-ignored-errors))
</pre>
</div>
</div>
</div>


<div id="outline-container-org24013cb" class="outline-3">
<h3 id="org24013cb">Autoloadå‡½æ•°å¼•ç”¨æœªè¢«requireçš„å˜é‡,ä¿®æ”¹è¯¥å˜é‡åæ— æ³•è¯»å–å˜é‡?</h3>
<div class="outline-text-3" id="text-org24013cb">
<pre class="example" id="orgceea3c2">
å†™äº 2018/10/21
</pre>

<p>
æ³¨æ„: <b>è¯¥é—®é¢˜è™½ç„¶å·²ç»è§£å†³äº†,ä½†æ˜¯é€”ä¸­é‡åˆ°ä¸€ä¸ªå¥‡æ€ªç°è±¡æˆ‘æ²¡æœ‰åŠæ³•è§£é‡Š,ä»¥åè¿˜æ˜¯ä¼šæ›´æ–°</b>.
</p>

<p>
è§£å†³é—®é¢˜æ—¶å€™çš„ <code>org-mode</code> ç‰ˆæœ¬ä¸º <code>org-plus-contrib-20181015</code>.
</p>

<p>
å®é™…æƒ…å†µå°±æ˜¯: å†™äº†ä¸€ä¸ªå‡½æ•° <code>publish-all-posts</code> éœ€è¦ä½¿ç”¨ <code>org-publish</code> ä½œä¸º <code>subroutine</code>, ä¸»è¦æ˜¯åˆ©ç”¨ <code>Emacs Lisp</code> çš„åŠ¨æ€ä½œç”¨åŸŸåæ¥ä¸´æ—¶ç»‘å®šå…¨å±€å˜é‡,ç‰¹åˆ«æ˜¯ <code>org-publish-project-alist</code> å¹¶ä¸”è°ƒç”¨ <code>org-publish</code>.
</p>

<p>
ç›®çš„æ˜¯ä¸ºäº†ä¸æ±¡æŸ“å…¨å±€å˜é‡å’Œç¯å¢ƒ,ç„¶è€Œæœ‰ä¸€ä¸ªé—®é¢˜, <code>org-publish</code> æ˜¯ <code>Autoload</code> å‡½æ•°,å¯æ˜¯æˆ‘å¹¶æ²¡æœ‰ <code>require</code> å®ƒå¼•ç”¨çš„å˜é‡ <code>org-publish-project-alist</code>,å°±åœ¨æˆ‘ç”¨ <code>let</code> è¿›è¡Œç»‘å®šçš„æ—¶å€™å‘ç”Ÿäº†ä¸€ä¸ªå¥‡æ€ªç°è±¡.
</p>

<p>
ç¬¬ä¸€æ¬¡æ‰§è¡Œå‡½æ•° <code>publish-all-posts</code> çš„æ—¶å€™æŠ¥é”™äº†: "Unknown component static in project DarkSalt",å¼•å‘é”™è¯¯çš„å‡½æ•°æ˜¯ <code>org-publish-expand-projects</code>, è¿™è¿˜æ˜¯å¯ä»¥ç†è§£,å› ä¸º <code>org-publish-project-alist</code> å¹¶æ²¡æœ‰è¿›è¡Œå…¨å±€ç»‘å®šé»˜è®¤æ˜¯ <code>nil</code> æ‰€ä»¥å¼•å‘å¼‚å¸¸.
</p>

<p>
æˆ‘ä¸èƒ½ç†è§£çš„åœ°æ–¹å°±åœ¨äºæ¥ä¸‹æ¥å‡½æ•° <code>publish-all-posts</code> çš„è°ƒç”¨å±…ç„¶æ­£å¸¸,æ²¡æœ‰å‘ç”ŸæŠ¥é”™.æˆ‘è¯»äº†ä¸€ä¸‹ <code>org-publish, org-publish-projects å’Œ org-publish-expand-projects</code> è¿™3ä¸ªå‡½æ•°çš„æºä»£ç å¹¶æ²¡å‘ç°åœ¨å“ªé‡Œç»™ <code>org-publish-project-alist</code> è¿›è¡Œèµ‹å€¼.
</p>

<p>
ä¸è¿‡æˆ‘è¿˜æ˜¯å¸¦ç€ç–‘æƒ‘æŠŠ<a href="https://github.com/saltb0rn/emacs.d/commit/b146dffaa096683e1f1eee171d6e292af719cdb1#diff-64ed6d0a7a4f2eaf33cacc2454a19cff">æŠ¥é”™è§£å†³</a>äº†, <code>require</code> <code>ox-publish</code> (ä¹Ÿå°±æ˜¯ <code>org-publish-project-alist</code> çš„å®šä¹‰æ–‡ä»¶) å°±å¯ä»¥è§£å†³é—®é¢˜,ä¸è¿‡è¿˜æ˜¯ä¸æ˜ç™½è¿™ä¸ªå¥‡æ€ªç°è±¡çš„åŸå› ,æœ‰å¯èƒ½æ˜¯æˆ‘æ²¡æœ‰è¯»é€ä»£ç ,æ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¸èƒ½ç®—æ˜¯å®Œå…¨è§£å†³.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">publish-all-posts</span> (project <span style="color: #7CB8BB;">&amp;optional</span> force async)
  <span style="color: #9FC59F;">"Now the project of blog is isolated from `</span><span style="color: #BFEBBF;">org-publish-project-alist</span><span style="color: #9FC59F;">'.</span>
<span style="color: #9FC59F;">That is, when calling `</span><span style="color: #BFEBBF;">org-publish-project</span><span style="color: #9FC59F;">' or `</span><span style="color: #BFEBBF;">org-publish</span><span style="color: #9FC59F;">' would not</span>
<span style="color: #9FC59F;">see any project of blog, vice versa."</span>
  (<span style="color: #F0DFAF; font-weight: bold;">interactive</span>
   (list (assoc (completing-read <span style="color: #CC9393;">"Publish project: "</span>
                                 blog-alist nil t)
                blog-alist)
         current-prefix-arg))
  (create-project-directory-if-necessary)
  (write-posts-to-tag-inc)
  (rewrite-theindex-inc)
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((org-publish-project-alist blog-alist)
        (org-html-home/up-format (ht-get home/up-formats 'blog))
        (org-html-head (ht-get html-heads 'blog))
        (org-html-preamble nil)
        (org-html-doctype <span style="color: #CC9393;">"html5"</span>)
        (org-html-link-home <span style="color: #CC9393;">"/"</span>)
        (org-html-link-up <span style="color: #CC9393;">"/"</span>)
        (org-export-with-toc nil)
        (org-export-with-author t)
        (org-export-with-email nil)
        (org-export-with-creator nil)
        (org-export-with-date nil)
        (org-export-with-section-numbers nil))
    (org-publish project))
  (rename-theindex-to-index))
</pre>
</div>
</div>
</div>


<div id="outline-container-org635b5dd" class="outline-3">
<h3 id="org635b5dd">å¦‚ä½•è¯·æ±‚æ¥å£(JSON)</h3>
<div class="outline-text-3" id="text-org635b5dd">
<pre class="example" id="orgc6e80aa">
å†™äº 2019/2/26
</pre>
<p>
<code>Emacs Lisp</code> æ²¡æœ‰ <code>Python</code> é‚£ä¹ˆç›´æ¥çš„ç½‘ç»œè¯·æ±‚åº“,ä¸è¿‡æˆ‘ä»¬å¯ä»¥è‡ªå·±æ‰‹åŠ¨å°è£…ä¸€ä¸‹(è¿™é‡Œåªæ˜¯æä¾›ä¸€ä¸‹æ€è·¯)
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">require</span> '<span style="color: #BFEBBF;">json</span>)
(<span style="color: #F0DFAF; font-weight: bold;">require</span> '<span style="color: #BFEBBF;">url</span>)

(defstruct response headers body)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">url-open</span> (url)
  <span style="color: #9FC59F;">"Return the response by requesting the url."</span>
  (<span style="color: #F0DFAF; font-weight: bold;">with-temp-buffer</span>
    (insert-buffer (url-retrieve-synchronously url)) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">the message containing the headers and body</span>
    (set-buffer-multibyte t)
    (decode-coding-region (point-min) (point-max) 'utf-8) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">needed if text contains non-ascii character</span>
    (goto-char (point-min))
    (re-search-forward <span style="color: #CC9393;">"^$"</span> nil 'move)
    (make-response <span style="color: #DCDCCC; font-weight: bold;">:headers</span> (buffer-substring-no-properties (point-min) (point))
                   <span style="color: #DCDCCC; font-weight: bold;">:body</span> (buffer-substring-no-properties (point) (point-max)))))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">response-to-json</span> (response)
  (json-read-from-string (response-body response)))

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">example</span>
(response-to-json (url-open <span style="color: #CC9393;">"https://api.jikan.moe/v3/anime/1/characters_staff"</span>))
</pre>
</div>
</div>
</div>


<div id="outline-container-org070692d" class="outline-3">
<h3 id="org070692d">å¦‚æœè¯»å–JSONæ–‡ä»¶</h3>
<div class="outline-text-3" id="text-org070692d">
<pre class="example" id="orga444849">
å†™äº 2020/10/26
</pre>
<p>
<code>Emacs Lisp</code> è¯»å– <code>JSON</code> æ–‡ä»¶çš„æ–¹å¼æ¯”å¾ˆå¤šè¯­è¨€è‡ªå¸¦çš„çµæ´»å¾—å¤š.
</p>

<p>
å‡è®¾ç°æœ‰ä¸ªJSONæ–‡ä»¶,
</p>

<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #F0DFAF; font-weight: bold;">"name"</span>: <span style="color: #CC9393;">"xxxxx"</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"job"</span>: <span style="color: #CC9393;">"xxxxxx"</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"projects"</span>: [
    {
      <span style="color: #F0DFAF; font-weight: bold;">"name"</span>: <span style="color: #CC9393;">"xxxxx"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"date"</span>: <span style="color: #CC9393;">"xxxxx"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"about"</span>: <span style="color: #CC9393;">"xxxxxxxxxx"</span>
    },
    {
      <span style="color: #F0DFAF; font-weight: bold;">"name"</span>: <span style="color: #CC9393;">"xxxxx"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"date"</span>: <span style="color: #CC9393;">"xxxxx"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"about"</span>: <span style="color: #CC9393;">"xxxxxxxxxx"</span>
    },
    {
      <span style="color: #F0DFAF; font-weight: bold;">"name"</span>: <span style="color: #CC9393;">"xxxxx"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"date"</span>: <span style="color: #CC9393;">"xxxxx"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"about"</span>: <span style="color: #CC9393;">"xxxxxxxxxx"</span>
    }
  ]
}
</pre>
</div>

<p>
ç°åœ¨éœ€è¦è¯»å–å®ƒçš„ "projects" å€¼å¹¶ä¸”é‡æ–°å°è£…æˆä¸€ä¸ª <code>JSON</code>,åœ¨ <code>Emacs Lisp</code> é‡Œé¢å¯ä»¥è¿™ä¹ˆåš,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">require</span> '<span style="color: #BFEBBF;">json</span>)

(<span style="color: #F0DFAF; font-weight: bold;">let*</span> ((json-object-type 'alist)              <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25351;&#23450; JSON &#30340;&#23545;&#35937;&#35299;&#26512;&#20026; alist &#31867;&#22411;</span>
       (json-array-type 'list)                <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25351;&#23450; JSON &#30340;&#25968;&#32452;&#35299;&#26512;&#20026; list &#31867;&#22411;</span>
       (json-key-type 'keyword)               <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25351;&#23450; JSON &#30340;&#38190;&#35299;&#26512;&#20026; keyword &#31867;&#22411;</span>
       (json (json-read-file <span style="color: #CC9393;">"~/test.json"</span>)))
  (json-encode (alist-get <span style="color: #DCDCCC; font-weight: bold;">:projects</span> json)))
</pre>
</div>

<p>
å¦‚æœä½ ä¸å–œæ¬¢æŠŠ <code>JSON</code> çš„å¯¹è±¡è§£ææˆ <code>alist</code>, å¯ä»¥æŠŠ <code>json-object-type</code> è®¾ç½®ä¸º <code>hash-table</code>, <code>plist</code> è¿™æ ·çš„å€¼,
</p>

<p>
è‡ªç”±è®¾ç½®è§£æçš„ç±»å‹æ­£æ˜¯ <code>Emacs Lisp</code> çš„ <code>json.el</code> çš„çµæ´»ä¹‹å¤„.
</p>
</div>
</div>
</div>


<div id="outline-container-org6e4aca8" class="outline-2">
<h2 id="org6e4aca8">Emacs Lisp å­¦ä¹ ç¬”è®°</h2>
<div class="outline-text-2" id="text-org6e4aca8">
<pre class="example" id="orgcbb3917">
è¿™æ®µè¯å†™äº 2018/9/30

æœ€åæ›´æ–°äº 2020/10/31
</pre>

<p>
æˆ‘æ˜¯ä»¥ç»ˆèº«ä½¿ç”¨ <code>Emacs</code> çš„ç›®çš„å»å­¦ <code>Emacs Lisp</code> çš„,è€Œæç”¨ <code>Emacs Lisp</code> çš„ä½¿ç”¨æ°´å¹³çš„æœ€å¥½æ–¹æ³•å°±æ˜¯æŒæ¡ <code>reference</code> æ–‡æ¡£çš„ä½¿ç”¨.
</p>

<p>
åŠ ä¸Šç½‘ä¸Šå¯¹äº <code>Emacs</code> çš„ç›¸å…³å†…å®¹æ•´ä½“çœ‹ä¸‹æ¥ç›¸å¯¹è¾ƒå°‘,æœ‰äº›é—®é¢˜è¿˜æœç´¢ä¸åˆ°è§£å†³åŠæ³•,è¿™æœ‰ä¸¤ç§å¯èƒ½,å…¶ä»–äººæ²¡æœ‰é‡åˆ°,é—®é¢˜æ— è§£,æˆ–è€…é—®é¢˜çš„æè¿°ä¸å¯¹,
</p>

<p>
è¿™é‡Œçš„æ‰€æœ‰å¯èƒ½éƒ½åªèƒ½é è‡ªå·±å»è¯» <code>reference</code> æ‰¾è§£å†³åŠæ³•.
</p>

<p>
<code>Emacs Lisp</code> çš„ <code>reference</code> æœ‰ä¸€ä¸ªç‰¹ç‚¹,å¾ˆå¤š <code>APIs</code> çš„è¯´æ˜æ–‡æ¡£éƒ½ç¼ºä¹è¯¦ç»†çš„ä½¿ç”¨ä¾‹å­,
</p>

<p>
å¦‚æœæŒæ¡äº†ç›¸å…³æ¦‚å¿µçš„è¯è¿™éƒ½ä¸æ˜¯é—®é¢˜,å¯ç¢°å·§å°±æ˜¯è¿™æ–¹é¢åšå¾—ä¸å¥½,å¾ˆå¤šæ¦‚å¿µè¯´æ˜éƒ½ä¸å¤Ÿç›´è§‚,
</p>

<p>
æ˜æ˜åªè¦ç”»ä¸ªç®€å•çš„å›¾å°±å¯ä»¥è§£å†³çš„é—®é¢˜,å®ƒå°±æ˜¯æ²¡æœ‰è¿™ä¹ˆåš,ä¸è¿‡è¿™ä¹Ÿåªé™äº <code>Emacs</code> ç›¸å…³çš„ <code>APIs</code> äº†.
</p>

<p>
<code>Emacs Lisp</code> å’Œå…¶å®ƒè¯­è¨€ä¸€æ ·æœ‰ç€è¿™æ“ä½œè¿›ç¨‹,çº¿ç¨‹çš„ç­‰ç­‰èƒ½åŠ›,ä¹Ÿå°±æ˜¯è¯´,å¼€å‘äººå‘˜è¦åƒç†Ÿæ‚‰ä½¿ç”¨è¿™éƒ¨åˆ†çš„æ¥å£,å°±å¿…é¡»å»äº†è§£è¿™ç±»çš„"é€šç”¨æ¦‚å¿µ",
</p>

<p>
è¿™å¯¹äºå¼€å‘äººå‘˜æ¥æ˜¯è¯´ç™¾åˆ©è€Œæ— ä¸€å®³çš„,é‡åˆ°è¿™ç±»æ¦‚å¿µåˆä¸æ‡‚çš„è¯æŠŠå°±è€å®çš„è¡¥ä¸Šå§.
</p>

<p>
æˆ‘å†™è¿™éƒ¨åˆ†çš„ç¬”è®°æœ‰ä¸¤ä¸ªç›®çš„: ä¸€æ˜¯ä¸ºäº†ç›´è§‚ç†è§£ <code>Emacs</code> é‚£äº›ä¸å¤ªå®¹æ˜“ç†è§£çš„æ¦‚å¿µ;äºŒæ˜¯ä¸ºäº†é’ˆå¯¹é€šç”¨æ¦‚å¿µè¿›è¡Œè¡¥ç›².
</p>

<p>
å› æ­¤è¿™éƒ¨åˆ†ç¬”è®°çš„ä¿¡æ¯é‡ä¼šæ¯”è¾ƒå¤§(æˆ‘ä¼šåœ¨ä¿è¯å†…å®¹ç›´è§‚çš„å‰æä¸‹å°½é‡ç²¾ç®€),æ›´æ–°æœŸä¹Ÿä¼šå¾ˆé•¿,è®¡åˆ’ä¸€ä¸ªæ˜ŸæœŸæ›´æ–°ä¸€ä¸ªæ¦‚å¿µçš„ç¬”è®°.
</p>

<p>
æœ€åé‡ä¼¸ä¸€é,è¿™å¹¶ä¸æ˜¯ <code>APIs</code> çš„ç¬”è®°(æˆ‘æ²¡æœ‰æŠ„ä¸€é <code>reference</code> çš„ç†ç”±,é¡¶å¤šè¡¥å……ä¸€äº›ä½¿ç”¨ä¾‹å­),è€Œæ˜¯ä¸€äº›æ¦‚å¿µçš„ç¬”è®°.
</p>

<p>
å½“ç„¶ä¸åŒç‰ˆæœ¬çš„ <code>Emacs</code> æ‰€å…³è”çš„æ¦‚å¿µä¹Ÿä¼šä¸ä¸€æ ·,è¿™äº›æˆ‘ä¼šå°½å¯èƒ½è¿›è¡Œè¯´æ˜.
</p>
</div>

<div id="outline-container-org8923b96" class="outline-3">
<h3 id="org8923b96">Emacs Lisp æ•°æ®ç±»å‹æ¦‚è§ˆ</h3>
<div class="outline-text-3" id="text-org8923b96">
<p>
<code>Emacs Lisp</code> çš„æ•°æ®ç±»å‹åˆ†ä¸¤å¤§ç±»: <b>è¯­è¨€å†…ç½®çš„æ•°æ®ç±»å‹</b> ä»¥åŠ <code>Emacs</code> ç¼–è¾‘å™¨å†…ç½®çš„æ•°æ®ç±»å‹.
</p>

<p>
æ‰€è°“çš„è¯­è¨€å†…ç½®çš„æ•°æ®ç±»å‹å°±æ˜¯åƒæ•´æ•°,æµ®ç‚¹æ•°,å­—ç¬¦ä¸²ç­‰ç­‰è¿™äº›åŸºæœ¬æ˜¯ç¼–ç¨‹è¯­è¨€éƒ½ä¼šæœ‰çš„ç±»å‹;
</p>

<p>
åƒçº¿ç¨‹,è¿›ç¨‹è¿™ç§ç±»å‹æ˜¯ä¸ºäº†æ“ä½œç‰¹å®šå¹³å°åŠŸèƒ½çš„æ•°æ®ç±»å‹è€Œä¸å±äºè¯­è¨€å†…ç½®çš„æ•°æ®ç±»å‹, <code>Emacs</code> ç¼–è¾‘å™¨å†…ç½®çš„æ•°æ®ç±»å‹å°±æ˜¯ç›¸å½“äºè¿™ä¸ª,
</p>

<p>
å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä¸“é—¨ç”¨äºé…ç½® <code>Emacs</code> çš„æ•°æ®ç±»å‹.åœ¨æ–‡æ¡£é‡Œé¢,è¿™ä¸¤ç±»å‹åˆ†åˆ«å«åš <code>programming types</code> å’Œ <code>editing types</code>.
</p>

<p>
<code>Emacs Lisp</code> æä¾› <code>type-of</code> æ¥è·å–å¯¹è±¡çš„ç±»å‹.
</p>


<p>
æ¯ä¸€ç§æ•°æ®ç±»å‹éƒ½æœ‰å®ƒä»¬è‡ªå·±å”¯ä¸€ <b>æ–‡æœ¬</b> è¾“å‡ºæ ¼å¼,å«åšæ‰“å°è¡¨ç¤º(textual/printed representation),å¯ä»¥ <code>prin1</code> å‡½æ•°æ¥æ‰“å°å¾—åˆ°.
</p>

<p>
æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(prin1 (<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (v) (+ v 1)))
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(closure (t) (v) (+ v 1))</span>
(prin1 (make-hash-table <span style="color: #DCDCCC; font-weight: bold;">:size</span> 30))
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">#s(hash-table size 30 test eql rehash-size 1.5 rehash-threshold 0.8125 data ())</span>
</pre>
</div>

<p>
è¦å‘ <code>Emacs Lisp</code> è¾“å…¥ä¸€ä¸ªå¯¹è±¡å¿…é¡»è¦ç¬¦åˆæŸç§çš„ <b>æ–‡æœ¬</b> è¾“å…¥æ ¼å¼è¦æ±‚,å«åšè¯»å–è¯­æ³•(read syntax),ç”¨ <code>read</code> å‡½æ•°æ¥è¯»å–.
</p>

<p>
æœ‰å¤§éƒ¨åˆ†å¯¹è±¡çš„æ‰“å°è¡¨ç¤ºå¯ä»¥ä½œä¸ºè¯»å–è¯­æ³•,çœ‹ä¸Šé¢çš„ä¾‹å­ä½ ä¼šå‘ç° <code>#s</code> å¼€å¤´çš„æ‰“å°è¡¨ç¤º,è¿™å°±æ˜¯ç‰¹æ®Šå¯¹è±¡çš„è¯»å–è¯­æ³• <code>M-: (info "(elisp)Special Read Syntax")</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(apply '(closure (t) (v) (+ v 1)) '(1)) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">2</span>
(hash-table-size #s(hash-table size 30 test eql rehash-size 1.5 rehash-threshold 0.8125 data ())) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">30</span>
</pre>
</div>

<p>
è¿˜æœ‰çš„å¯¹è±¡æ˜¯æ²¡æœ‰è¯»å–è¯­æ³•çš„,å®ƒä»¬çš„æ‰“å°è¡¨ç¤ºéƒ½æ˜¯ <code>#&lt; xxxxxx &gt;</code> è¿™ç§æ ¼å¼,è¿™ç§å¯¹è±¡è¦é€šè¿‡æ„é€ å™¨(construct)å®šä¹‰.
</p>

<p>
æ­¤å¤–,ä¸€ä¸ªå¯¹è±¡å¯èƒ½ä¼šæœ‰å¤šç§è¯»å–è¯­æ³•.
</p>

<p>
åœ¨åˆ«çš„è¯­è¨€é‡Œé¢ä¸€ä¸ªè¡¨è¾¾å¼å¾—å‡ºå°±æ˜¯ä¸€æ®µæ–‡æœ¬,ä½†åœ¨ <code>Lisp</code> é‡Œé¢ä¸€ä¸ªè¡¨è¾¾å¼é¦–å…ˆæ˜¯ä¸€ä¸ª <code>Lisp</code> å¯¹è±¡,å…¶æ¬¡æ˜¯å¯¹è±¡çš„è¯»å–è¯­æ³•,
</p>

<p>
åœ¨ <code>Lisp</code> é‡Œé¢è¡¨è¾¾å¼ä¹Ÿä¼šè¢«æˆä¸º <code>form</code> æˆ–è€… <code>S-expression(sexp)</code>,è¿™ä¸ªåè¯çš„å…³ç³»è¦æ—¶åˆ»è®°è½½å¿ƒé‡Œ,å› ä¸ºæ–‡æ¡£é‡Œé¢ç»å¸¸æ··ç”¨è¿™å‡ ä¸ªè¯.
</p>

<p>
åœ¨äº¤äº’è¿è¡Œä¸€ä¸ªè¡¨è¾¾å¼æ—¶,ç›´è¯‘å™¨ (<code>Lisp interpreter</code>) ä¼šè¯»å–å®ƒçš„æ–‡æœ¬è¡¨ç¤ºæ¥ç”Ÿæˆä¸€ä¸ª <code>Lisp</code> å¯¹è±¡,ç„¶åæ‰è¿ç®—å¯¹è±¡,
</p>

<p>
è¯»å–å’Œè¿ç®—æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ.
</p>

<p>
è¿™ä¸ªç« èŠ‚çš„å‰©ä¸‹éƒ¨åˆ†ä¸»è¦ä»‹ç»ä¸€ä¸‹åœ¨åˆ«çš„è¯­è¨€é‡Œä¸å¤ªå¸¸è§çš„è¯­è¨€å‘æ•°æ®ç±»å‹,ä¹Ÿå°±æ˜¯ <code>programming types</code>,
</p>

<p>
<code>editing types</code> ä¼šå¦è¡Œåœ¨åˆ«çš„ç« èŠ‚ä»‹ç».
</p>
</div>

<div id="outline-container-org775e5c7" class="outline-4">
<h4 id="org775e5c7">Records</h4>
<div class="outline-text-4" id="text-org775e5c7">
<p>
<code>Record</code> å…è®¸ç”¨æˆ·å®šä¹‰ <code>Emacs Lisp</code> æ²¡æœ‰çš„æ•°æ®ç±»å‹,åº•å±‚å®é™…æ˜¯ç”¨ <code>cl-defstruct</code> å’Œ <code>defclass</code> å®šä¹‰çš„å®ä¾‹ä½œä¸ºè¡¨ç¤º.
</p>

<p>
ä»å†…éƒ¨å®ç°æ¥è®²,ä¸€ä¸ª <code>record</code> å¯¹è±¡æ›´åƒæ˜¯ä¸€ä¸ªå‘é‡,å¯ä»¥æ˜¯ç”¨ <code>aref</code> æ¥è®¿é—®å®ƒçš„æ§½ä½(<code>slots</code>),ä»¥åŠèƒ½å¤Ÿä½¿ç”¨ <code>copy-sequence</code> è¿›è¡Œå¤åˆ¶.
</p>

<p>
åœ¨å½“å‰çš„å®ç°ä¸­, <code>record</code> å¯¹è±¡æœ€å¤šè‡ªç”± <code>4096</code> ä¸ªæ§½ä½,è€Œå‘é‡(<code>vector</code>)å¯ä»¥æœ‰æ›´å¤š, <code>records</code> å’Œæ•°ç»„(<code>arrays</code>)ä¸€æ ·æ˜¯ç”¨ <code>0</code> åšä¸ºç¬¬ä¸€ä¸ªç´¢å¼•çš„ (<code>zero-origin indexing</code>).
</p>

<p>
<code>record</code> çš„ç¬¬ä¸€ä¸ªæ§½ä½æ˜¯ç”¨æ¥å­˜æ”¾ç±»å‹çš„,å«åšç±»å‹æ§½(type slot),ä¸æ˜¯å«åš <code>slot one</code> (ç´¢å¼•ä¸º <code>1</code> çš„æ§½ä½æ‰æ˜¯),ç±»å‹æ§½ä½çš„å€¼å¯ä»¥é€šè¿‡ <code>(type-of RECORD)</code> è¿™ç§æ–¹å¼è·å–.
</p>

<p>
è€Œç±»å‹æ§½å­˜æ”¾çš„å€¼æœ‰ä¸¤ç§,ç±»å‹åå­—çš„ <code>symbol</code> ä»¥åŠç±»å‹æè¿°ç¬¦(<code>type descriptor</code>),ç±»å‹æè¿°ç¬¦ä¹Ÿæ˜¯ä¸€ä¸ª <code>record</code> å¯¹è±¡,ç‰¹åˆ«ä¹‹å¤„åœ¨äºè¿™ä¸ª <code>record</code> å¯¹è±¡çš„ <code>slot one</code> å­˜æ”¾çš„ç±»å‹åå­—çš„ <code>symbol</code>,è¿™ä¸ªå€¼åŒæ ·ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ <code>type-of</code> è·å–çš„.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> si (make-record 'salt 5 'x))

(type-of si)                            <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; 'salt</span>

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> sii (make-record si 5 'z))

(<span style="color: #F0DFAF; font-weight: bold;">setf</span> (aref si 1) 'saltII)

(type-of sii)                           <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; 'saltII</span>
</pre>
</div>

<p>
<code>record</code> çš„æ‰“å°æ˜¯ä¸€ä¸ªä»¥ <code>#s</code> å¼€å¤´çš„ <code>list</code>: <code>#s(elm1 elm2 ... elmn)</code>. <code>record</code> å¯¹è±¡è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¸¸
</p>

<p>
<code>recordp</code> åˆ¤æ–­å¯¹è±¡æ˜¯å¦ <code>record</code> å¯¹è±¡; <code>record</code> å’Œ <code>make-record</code> åˆ›å»ºå¹¶ä¸”è¿”å› <code>record</code> å¯¹è±¡.
</p>

<p>
è€ç‰ˆæœ¬çš„ä»£ç éƒ½æ˜¯ç”¨ <code>cl-defstruct</code> è€Œä¸æ˜¯ç”¨ <code>record</code>,å¦‚æœè¿™äº›ä»£ç åœ¨æ–°ç‰ˆæœ¬çš„ <code>Emacs</code> ä¸Šä½¿ç”¨å¯èƒ½ä¼šå¼•å‘ä¸€äº›é—®é¢˜.
</p>

<p>
<code>Emacs</code> ä¼šåœ¨æ£€æµ‹åˆ°è€ç‰ˆæœ¬çš„ <code>cl-defstruct</code> çš„è°ƒç”¨æ—¶å€™å¯ç”¨ä¸€ä¸ªæ¨¡å¼,è¿™ä¸ªæ¨¡å¼ä¸‹ <code>type-of</code> ä¼šåƒæ˜¯å¤„ç† <code>record</code> å¯¹è±¡é‚£æ ·å¤„ç†ä¸€ä¸ªè€ç‰ˆæœ¬çš„ <code>struct</code> å¯¹è±¡.
</p>

<p>
<code>(cl-old-struct-compat-mode t)</code> å°±å¯ä»¥å¯ç”¨è¿™ä¸ªæ¨¡å¼.
</p>
</div>
</div>


<div id="outline-container-orgd6dc279" class="outline-4">
<h4 id="orgd6dc279">Finalizer Type</h4>
<div class="outline-text-4" id="text-orgd6dc279">
<p>
<code>make-finalizer</code> æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°,å¹¶ä¸”è¿”å›ä¸€ä¸ªå¯¹è±¡,åœ¨ <code>Emacs</code> è¿›è¡Œåƒåœ¾å›æ”¶å,å¦‚æœè¿™ä¸ªå¯¹è±¡è¢« <code>Emacs Lisp</code> è®¤ä¸ºä¸å¯åˆ°è¾¾(<code>unreachable</code>),
</p>

<p>
é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å…³è”çš„å‡½æ•°å°±ä¼šæ‰§è¡Œ,è¿™ç§å¯¹è±¡å°±å«åšæ¸…ç†å™¨å¯¹è±¡(<code>finalizer object</code>),å®ƒå…³è”çš„å‡½æ•°ä¸€èˆ¬ç”¨æ¥æ‰§è¡Œç›¸å…³æ¸…ç†å·¥ä½œ.
</p>

<p>
å¦‚æœä¸€ä¸ªæ¸…ç†å™¨å¯¹è±¡åªè¢«åˆ«çš„æ¸…ç†å™¨å¯¹è±¡å¼•ç”¨,è¿™ç§æƒ…å†µ=Emacs= <b>ä¸</b> è®¤ä¸ºå®ƒå¯åˆ°è¾¾(<code>reachable</code>).
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> obj (make-finalizer #'(lambda () (message <span style="color: #CC9393;">"Do something"</span>))))
(<span style="color: #F0DFAF; font-weight: bold;">setq</span> obj 1)
(garbage-collect)      <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25163;&#21160;&#25191;&#34892;&#22403;&#22334;&#22238;&#25910;</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb31ac6f" class="outline-3">
<h3 id="orgb31ac6f">è¿ç®— (Evaluation)</h3>
<div class="outline-text-3" id="text-orgb31ac6f">
<p>
<code>Lisp</code> è§£é‡Šå™¨(<code>Lisp interpreter</code>),æˆ–è€…è¯´æ±‚å€¼ç¨‹åº(<code>evaluator</code>)æ˜¯ <code>Emacs</code> çš„ä¸€éƒ¨åˆ†,è´Ÿè´£è®¡ç®—è¡¨è¾¾å¼çš„å€¼.
</p>

<p>
å½“è°ƒç”¨ä¸€ä¸ª <code>Lisp</code> å‡½æ•°æ—¶,æ±‚å€¼ç¨‹åºä¼šé€šè¿‡è®¡ç®—å‡½æ•°é‡Œè¡¨è¾¾å¼çš„å€¼ä½œä¸ºå‡½æ•°çš„å€¼,å› æ­¤è¿ç®— <code>Lisp</code> ç¨‹åºå°±æ„å‘³ç€è¿è¡Œ <code>Lisp</code> è§£é‡Šå™¨.
</p>

<p>
ä»»ä½•å¯¹è±¡éƒ½å¯ä»¥è¢«è¿ç®—,å®é™…å¸¸ç”¨çš„æœ‰ <code>number</code>, <code>symbol</code> <code>list</code> å’Œ <code>string</code>.
</p>

<p>
è¯»å–(<code>reading</code>)ä¸€ä¸ª <code>form</code> ç„¶åè¿ç®—è¿™ä¸ª <code>form</code>,è¯»å–å’Œè¿ç®—æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ´»åŠ¨.è¯»å–ä¸ä¼šè¿ç®—ä»»ä½•ä¸œè¥¿,åªæ˜¯æŠŠ <code>Lisp</code> å¯¹è±¡çš„æ‰“å°è¡¨ç¤º(<code>printed representation</code>)è½¬æˆå¯¹è±¡æœ¬èº«.
</p>

<p>
è¿ç®—åˆ™æ˜¯ä¸€ä¸ªé€’å½’è¿‡ç¨‹,è¿ç®—ä¸€ä¸ª <code>form</code> é€šå¸¸éƒ½æ˜¯æ¯æ¬¡åªæ˜¯è¿ç®— <code>form</code> çš„ä¸€éƒ¨åˆ†,æ¯”å¦‚ <code>(car (cdr x))</code>:
</p>

<p>
<code>Emacs</code> é¦–å…ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªå…ƒç´  <code>car</code> æ˜¯å‡½æ•°,å®è¿˜æ˜¯ <code>special form</code>, æ˜¯å‡½æ•°,é‚£ä¹ˆè®¡ç®— <code>(cdr x)</code> çš„å€¼,åœ¨è®¡ç®— <code>(cdr x)</code> çš„æ—¶å€™åŒæ ·å…ˆæ£€æŸ¥ <code>cdr</code> æ˜¯ä»€ä¹ˆ,æ˜¯å‡½æ•°,é‚£ä¹ˆå…ˆè®¡ç®— <code>x</code> çš„å€¼,ç„¶åæ‰§è¡Œå‡½æ•° <code>cdr</code> å¾—å‡ºç»“æœ,
</p>

<p>
è¿™é‡Œæˆ‘ä»¬ç»™å®ƒä¸ªåå­— <code>res1</code>;æœ€åå°±è¿ç®— <code>(car res1)</code>,æŒ‰ç…§å‰é¢çš„æ­¥éª¤å¾—å‡ºæœ€ç»ˆç»“æœ,æ³¨æ„, <code>list form</code> çš„ç¬¬ä¸€ä¸ªå…ƒç´ (è¿™é‡Œæ˜¯ <code>car</code> å’Œ <code>cdr</code>)æ˜¯æ²¡æœ‰ä¼šè¢«è¿ç®—çš„.
</p>

<p>
è¿ç®—å‘ç”Ÿåœ¨ä¸€ä¸ªå«åšç¯å¢ƒ(<code>environment</code>)çš„ä¸Šä¸‹æ–‡ä¸­,ç”±æ‰€æœ‰ <code>Lisp</code> å˜é‡å½“å‰çš„å€¼å’Œç»‘å®š(bindings)ç»„æˆ.å½“ <code>form</code> å¼•ç”¨äº†ä¸€ä¸ªå˜é‡,å˜é‡å°±ä¼šè¿ç®—å¾—åˆ°ç”±å½“å‰ç¯å¢ƒä¸ºè¯¥å˜é‡æä¾›çš„å€¼,é™¤éç¯å¢ƒæ²¡æœ‰è¿™ä¸ªå˜é‡çš„ç»‘å®š.
</p>

<p>
å½“ç„¶è¿ç®—ä¸€ä¸ªç»‘å®šå˜é‡çš„ <code>form</code> å¯èƒ½ä¼šä¸´æ—¶æ”¹å˜ç¯å¢ƒçš„.è¿ç®— <code>form</code> çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æŒä¹…æ€§çš„æ”¹å˜,è¿™äº›æ”¹å˜å«åšå‰¯ä½œç”¨(<code>side effects</code>),æ¯”å¦‚ <code>(setq foo 1)</code> å°±æ˜¯æ”¹å˜çš„å†…å­˜ä¸Šçš„åœ°å€.
</p>
</div>

<div id="outline-container-orgf46a92c" class="outline-4">
<h4 id="orgf46a92c">Forms</h4>
<div class="outline-text-4" id="text-orgf46a92c">
<p>
<code>Form</code> åˆ†ç±»å‹,ä¸åŒç§ç±»çš„ <code>form</code> çš„è¿ç®—æ–¹å¼ä¸ä¸€æ ·,åˆ†ä¸‰ç§: <code>list</code>, <code>symbol</code> å’Œå…¶å®ƒç±»å‹.
</p>
</div>

<ul class="org-ul">
<li><a id="org8de5ef3"></a>è‡ªè¿ç®—form (Self-Evaluating Forms)<br>
<div class="outline-text-5" id="text-org8de5ef3">
<p>
è‡ªè¿ç®— <code>form</code> å°±æ˜¯ <code>list</code> å’Œ <code>symbol</code> ä¹‹å¤–çš„ <code>form</code>,å®ƒä»¬çš„è¿ç®—ç»“æœæ˜¯å®ƒä»¬è‡ªå·±,æ¯”å¦‚ <code>number</code>, <code>string</code> å’Œ <code>vector</code> å¯¹è±¡è¿ç®—ç»“æœå°±æ˜¯å®ƒä»¬è‡ªå·±.
</p>

<p>
è¿™ç§ <code>form</code> å¯ä»¥ç›´æ¥å†™ä¸‹æ¥,è¿™æ˜¯å¾ˆå¸¸è§çš„äº‹æƒ…,ä½†æ˜¯å¯¹äºé‚£äº›æ²¡æœ‰è¯»å–è¯­æ³•(read syntax)çš„ç±»å‹å°±ä¸æ€ä¹ˆå¸¸è§äº†,ä¸è¿‡è¿˜æ˜¯å¯ä»¥åšå¾—åˆ°çš„,æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Build an expression containing a buffer object.</span>
(<span style="color: #F0DFAF; font-weight: bold;">setq</span> print-exp (list 'print (current-buffer)))
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#8658; (print #&lt;buffer eval.texi&gt;)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Evaluate it.</span>
(eval print-exp)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#8867; #&lt;buffer eval.texi&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#8658; #&lt;buffer eval.texi&gt;</span>
</pre>
</div>

<p>
<code>symbol</code> ä¸­ <code>nil</code>, <code>t</code> ä»¥åŠ <code>:</code> å¼€å¤´çš„ <code>symbol</code> éƒ½æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„,å®ƒä»¬è¢« <code>Emacs Lisp</code> çœ‹åšå¸¸é‡ä¸å¯æ”¹å˜,éƒ½å±äºè‡ªè¿ç®— <code>form</code>.
</p>
</div>
</li>


<li><a id="org1408715"></a>List Formsåˆ†ç±» (Classifying Lists)<br>
<div class="outline-text-5" id="text-org1408715">
<p>
ä¸€ä¸ªéç©ºåˆ—è¡¨æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨,æˆ–è€…æ˜¯ä¸€ä¸ª <code>special form</code>,åˆæˆ–è€…æ˜¯ä¸€ä¸ªå®è°ƒç”¨, <code>Emacs</code> æ˜¯æ ¹æ®åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ¥åˆ¤æ–­çš„,å…¶å®ƒå…ƒç´ åˆ™æ˜¯ç»„æˆå‚æ•°.
</p>

<p>
å‡½æ•°,å®ä»¥åŠ <code>special form</code> ä¸‰è€…çš„è¿ç®—æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„.
</p>
</div>
</li>


<li><a id="org81bde4e"></a>å‡½æ•°çš„é—´æ¥è°ƒç”¨ (Function Indirection)<br>
<div class="outline-text-5" id="text-org81bde4e">
<p>
å¦‚æœ <code>list</code> çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ <code>symbol</code>,è¿ç®—çš„ç¬¬ä¸€æ­¥ä¼šæ£€æŸ¥è¿™ä¸ª <code>symbol</code> çš„ <code>function cell</code> å¹¶ä½¿ç”¨é‡Œé¢çš„å†…å®¹,å¦‚æœé‡Œé¢çš„å†…å®¹æ˜¯å¦å¤–ä¸€ä¸ª <code>symbol</code>,é‚£ä¹ˆé‡å¤è¿™ä¸ªè¿‡ç¨‹,ç›´åˆ°è·å–åˆ°ä¸€ä¸ª <code>non-symbol</code>.
</p>

<p>
è¿™ä¸ªè¿‡ç¨‹å«åš <code>symbol</code> å‡½æ•°çš„é—´æ¥è°ƒç”¨(<code>symbol function indirection</code>),è¿™ä¸ªè¿‡ç¨‹æœ‰å¯èƒ½ä¼šæ˜¯ä¸€ä¸ªæ— é™å¾ªç¯,ä¸€ä¸ª <code>symbol</code> çš„ <code>function cell</code> æœ€ç»ˆå¼•ç”¨åˆ°å®ƒè‡ªå·±èº«ä¸Šå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µ.
</p>

<p>
æ­£ç¡®çš„æƒ…å†µä¸‹,è¿™ä¸ª <code>non-symbol</code> åº”è¯¥æ˜¯å‡½æ•°, <code>lambda</code> è¡¨è¾¾å¼, å­—èŠ‚ç å‡½æ•°(<code>byte-code function</code>), åŸå‡½æ•°(<code>primitive function</code>),å®(macro), <code>special form</code> å’Œ <code>autoload</code> å¯¹è±¡çš„å…¶ä¸­ä¸€ä¸ª.
</p>

<p>
ä¸æ­£ç¡®çš„æƒ…å†µ <code>Emacs</code> ä¼šå¼•å‘ä¸€ä¸ª <code>invalid-function</code> é”™è¯¯. <code>fset</code> å’Œ <code>symbol-function</code> èƒ½å¤Ÿåˆ†åˆ«è®¾ç½®å’Œè·å– <code>symbol</code> çš„ <code>function cell</code>.
</p>

<p>
æ¯”å¦‚è¿™ä¸ªæ–‡æ¡£çš„ä¾‹å­,
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Build this function cell linkage:</span>
<span style="color: #5F7F5F;">;;   </span><span style="color: #7F9F7F;">-------------       -----        -------        -------</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">| #&lt;subr car&gt; | &lt;-- | car |  &lt;-- | first |  &lt;-- | erste |</span>
<span style="color: #5F7F5F;">;;   </span><span style="color: #7F9F7F;">-------------       -----        -------        -------</span>
(symbol-function 'car)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#8658; #&lt;subr car&gt;</span>
(fset 'first 'car)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#8658; car</span>
(fset 'erste 'first)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#8658; first</span>
(erste '(1 2 3))   <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">Call the function referenced by &#8216;</span><span style="color: #BFEBBF;">erste</span><span style="color: #7F9F7F;">&#8217;.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#8658; 1</span>
</pre>
</div>

<p>
å¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ <code>lambda</code> è¡¨è¾¾å¼,é‚£ä¹ˆå°±ä¸ä¼šå‘ç”Ÿå‡½æ•°é—´æ¥è°ƒç”¨äº†.
</p>

<p>
<code>indirect-function</code> èƒ½å¤Ÿè·å– <code>symbol</code> çš„çœŸæ­£å«æ„,æ¯”å¦‚ä¸Šé¢ä¾‹å­çš„åç»­,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(indirect-function 'erste) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">&#8658; #&lt;subr car&gt;</span>
</pre>
</div>
</div>
</li>


<li><a id="orgba9b0e3"></a>å‡½æ•°Form (Function Form)<br>
<div class="outline-text-5" id="text-orgba9b0e3">
<p>
å¦‚æœ <code>list</code> çš„ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ <code>function</code>, <code>byte-code function</code> æˆ–è€… <code>primitive function</code>,é‚£ä¹ˆè¿™ä¸ª <code>list</code> å°±æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨(<code>function call</code>).
</p>

<p>
<code>function call</code>. è¿ç®—çš„ç¬¬ä¸€æ­¥æ˜¯è®¡ç®—å‡ºé™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å¤–æ‰€æœ‰å…ƒç´ çš„å€¼,ä¹Ÿå°±æ˜¯å‚æ•°çš„å€¼,æ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸€ä¸ªå€¼.ä¸‹ä¸€æ­¥å°±æ˜¯æ ¹æ®è¿™äº›å€¼æ¥è°ƒç”¨å‡½æ•°: <code>(apply 'FIRST-ELEMENT '(REST-ELEMENT-VALUES ...))</code>.
</p>

<p>
å‡½æ•°æ˜¯ç”¨ <code>Lisp</code> å†™çš„,é‚£ä¹ˆå‚æ•°ä¼šè¢«ç»‘å®šåˆ°å‡½æ•°çš„å‚æ•°å˜é‡ä¸Š,ç„¶åæŒ‰é¡ºåºè¿ç®—å‡½æ•°ä½“é‡Œé¢çš„ <code>form</code>,æœ€åä¸€ä¸ª <code>form</code> çš„å€¼å°±æ˜¯å‡½æ•°è°ƒç”¨çš„ç»“æœ.
</p>
</div>
</li>


<li><a id="orgcb2c99b"></a>å®Forms (Macro Forms)<br>
<div class="outline-text-5" id="text-orgcb2c99b">
<p>
å¦‚æœ <code>list</code> çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ <code>macro</code> å¯¹è±¡,é‚£ä¹ˆè¿™ä¸ª <code>list</code> å°±æ˜¯ä¸€ä¸ªå®è°ƒç”¨ (<code>macro call</code>).å®è°ƒç”¨çš„æƒ…å†µä¸‹, <code>list</code> å‰©ä½™çš„å…ƒç´ æ˜¯ä¸ä¼šè¢«é©¬ä¸Šè¿ç®—çš„.
</p>

<p>
è¿™äº›å…ƒç´ ä¼šåšä¸ºå®çš„å‚æ•°,è®¡ç®—çš„æ—¶æœºç”±å®å†³å®š.å®çš„å®šä¹‰å®é™…æ˜¯è®¡ç®—å‡ºä¸€ä¸ªæ›¿ä»£ <code>form</code> (<code>replacement form</code>),è¿™å«åšå®çš„å±•å¼€å¼ (<code>expansion of the macro</code>): ä¸€ä¸ªæ–°çš„ <code>form</code> ç”¨æ¥æ›¿ä»£åŸæ¥çš„ <code>form</code>.
</p>

<p>
è°ƒç”¨å®å«åšå±•å¼€å®è°ƒç”¨,æˆ–è€…å«å±•å¼€å®.å®çš„å±•å¼€å¼å¯èƒ½æ˜¯ä»¥ä¸‹å…¶ä¸­ä¸€ç§ <code>form</code>: ä¸€ä¸ªè‡ªè¿ç®—å¸¸é‡,ä¸€ä¸ª <code>symbol</code> æˆ–è€…æ˜¯ä¸€ä¸ª <code>list</code>.å¦‚æœå±•å¼€å¼æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå®è°ƒç”¨,å±•å¼€å¤„ç†ä¼šä¸€ç›´é‡å¤ç›´åˆ°ä¸èƒ½è®¡ç®—å‡ºå±•å¼€å¼ä¸ºæ­¢.
</p>

<p>
ä¸€ä¸ªå®è°ƒç”¨æ˜¯ä»¥è¿ç®—å®Œå±•å¼€å¼ä¸ºç»“æŸ,ç„¶è€Œ,å¹¶éä¸€å¾—åˆ°å®çš„å±•å¼€å¼å°±é©¬ä¸Šè¿›è¡Œè¿ç®—,å› ä¸ºå…¶å®ƒ <code>Lisp</code> çš„ç¨‹åºä¹Ÿä¼šå±•å¼€å®è°ƒç”¨,å¹¶ä¸”å®ƒä»¬"å¯èƒ½"ä¼šè¿ç®—å±•å¼€å¼.
</p>

<p>
é€šå¸¸,å®çš„å‚æ•°ä¸ä¼šåœ¨è®¡ç®—å®çš„å±•å¼€å¼ä¸­è¿›è¡Œè®¡ç®—,è€Œæ˜¯åº”è¯¥åšä¸ºå®çš„å±•å¼€å¼çš„ä¸€éƒ¨åˆ†,åœ¨å±•å¼€å¼è¢«è¿ç®—çš„æ—¶å€™ä¸€èµ·è¢«è¿ç®—.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">mcadr</span> (x)
  (list 'car (list 'cdr x)))
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">or using backquote</span>

(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">mcadr</span> (x)
  `(car (cdr ,x)))


(mcadr (cons 0 '(1 2 3))) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#23637;&#24320;&#24335;&#26159; (car (cdr (cons 0 '(1 2 3))))</span>
</pre>
</div>

<p>
æ³¨æ„ä¸Šé¢ä¸Šé¢çš„å±•ç¤ºå¼æœ‰ <code>(cons 0 '(1 2 3))</code>,ä¸å®è°ƒç”¨å‘ç”Ÿæ—¶å€™ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€æ ·çš„,å¹¶ä¸æ˜¯è¢«è¿ç®—åçš„ <code>'(0 1 2 3)</code>.
</p>
</div>
</li>


<li><a id="org5c3542b"></a>Special Forms (Special Forms)<br>
<div class="outline-text-5" id="text-org5c3542b">
<p>
<code>Special Form</code> æ˜¯åŸå‡½æ•°çš„ä¸€ç§,å®ƒä»¬çš„å‚æ•°æ˜¯ä¸ä¼šè¢«å…¨éƒ¨è¿ç®—çš„.å¤§éƒ¨ä»½ <code>special forms</code> æ˜¯ç”¨æ¥å®šä¹‰æ§åˆ¶ç»“æ„æˆ–è€…æ‰§è¡Œå˜é‡ç»‘å®š,è¿™äº›éƒ½æ˜¯å‡½æ•°ä¸èƒ½åšçš„.
</p>

<p>
æ¯ä¸ª <code>special form</code> éƒ½æœ‰è‡ªå·±çš„è¿ç®—è§„åˆ™,å¯ä»¥é€šè¿‡ <code>special-form-p</code> æ¥åˆ¤æ–­å¯¹è±¡æ˜¯ä¸æ˜¯ <code>special form</code>, æ¯”å¦‚ <code>(special-form-p 'and)</code>.
</p>
</div>
</li>


<li><a id="org5ca0cf8"></a>è‡ªåŠ¨åŠ è½½ (Autoloading)<br>
<div class="outline-text-5" id="text-org5ca0cf8">
<p>
è‡ªåŠ¨åŠ è½½ç‰¹æ€§å…è®¸è°ƒç”¨ä¸€ä¸ªå®šä¹‰æœªè¢«åŠ è½½è¿› <code>Emacs</code> çš„å‡½æ•°æˆ–è€…å®,è‡ªåŠ¨åŠ è½½å¯¹è±¡æŒ‡å®šäº†åŒ…å«äº†å®šä¹‰çš„æ–‡ä»¶,å®ƒåšä¸ºä¸€ä¸ªå‡½æ•°å®šä¹‰å¯¹åº”çš„ <code>symbol</code> å‡ºç°,è°ƒç”¨è¿™ä¸ª <code>symbol</code> ä¼šè‡ªåŠ¨åŠ è½½æŒ‡å®šçš„æ–‡ä»¶,ç„¶åè°ƒç”¨çœŸæ­£çš„å‡½æ•°å®šä¹‰.
</p>
</div>
</li>
</ul>
</div>



<div id="outline-container-orgebf6f18" class="outline-4">
<h4 id="orgebf6f18">å¼•ç”¨ (Quoting)</h4>
<div class="outline-text-4" id="text-orgebf6f18">
<p>
<code>special form</code> <code>quote</code> ç›´æ¥è¿”å›å®ƒæœªè¢«ç»è¿‡è¿ç®—çš„å‚æ•°,è¿™æ˜¯ <code>Lisp</code> ç»™éè‡ªè¿ç®—å¯¹è±¡æä¾›çš„ä¸€ç§å…å—è¿ç®—çš„æ–¹æ³•.
</p>

<p>
ä¸€èˆ¬ç”¨äº <code>symbols</code> å’Œ <code>lists</code> èº«ä¸Š,å¯¹äº <code>number, string, vector</code> è¿™ç§ç±»å‹çš„å¯¹è±¡å°±æ²¡å¿…è¦ä½¿ç”¨äº†.
</p>

<p>
å› ä¸º <code>quote</code> å¾ˆå¸¸ç”¨,æ‰€ä»¥ <code>Lisp</code> ä¸ºå®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„è¯»å–è¯­æ³•(<code>read syntax</code>): <code>'</code> æ’‡å·åé¢è·Ÿç€ä¸€ä¸ª <code>Lisp</code> å¯¹è±¡,
</p>

<p>
<code>Lisp</code> ä¼šæŠŠè¿™ç§å½¢å¼å±•å¼€æˆä¸€ä¸ªç¬¬ä¸€ä¸ªå…ƒç´ ä¸º <code>quote</code> çš„ <code>list</code>,è¯¥ <code>list</code> çš„ç¬¬äºŒä¸ªå…ƒç´ å°±æ˜¯åé¢è·Ÿç€çš„ <code>Lisp</code> å¯¹è±¡.
</p>

<p>
æ‰€ä»¥ <code>'x</code> å°±æ˜¯ <code>(quote x)</code> çš„ç¼©å†™.
</p>

<p>
å…¶å®ƒç±»ä¼¼çš„ <code>quoting constructs</code> è¿˜æœ‰è®© <code>lambda</code> è¡¨è¾¾å¼è¢«ç¼–è¯‘çš„ <code>special form</code> <code>function</code>,ä»¥åŠèƒ½å¤Ÿå¼•ç”¨ <code>list</code> ä»»ä½•ä¸€éƒ¨åˆ†å¹¶ä¸”èƒ½å¤Ÿè®¡ç®—ä»¥åŠæ›¿æ¢å…¶ä»–éƒ¨åˆ†çš„ <code>backquote</code> (<code>`</code>).
</p>
</div>
</div>


<div id="outline-container-org6cf39a8" class="outline-4">
<h4 id="org6cf39a8">åå‘å¼•ç”¨ (Backquote)</h4>
<div class="outline-text-4" id="text-org6cf39a8">
<p>
åå‘å¼•ç”¨å…è®¸ä½ å¼•ç”¨ä¸€ä¸ª <code>list</code>,ä½†èƒ½å¤Ÿé€‰æ‹©æ€§åœ°è¿ç®—è¯¥ <code>list</code> çš„å…ƒç´ .åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹å®ƒçš„ä½œç”¨ç­‰åŒäº <code>quote</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp">'(a (+ 1 2))
`(a (+ 1 2))
</pre>
</div>

<p>
åå‘å¼•ç”¨æ”¯æŒä¸€äº›ç‰¹åˆ«æ ‡è®°ç¬¦å·æ¥å‘Šè¯‰ <code>Lisp</code> è¿ç®—å™¨å¦‚ä½•å¤„ç†æ ‡è®°ç¬¦å·åé¢çš„å‚æ•°.æœ‰ä¸¤ç§æ ‡è®°ç¬¦å·: <code>,</code> å’Œ <code>,@</code>.
</p>

<p>
ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜å®ƒä»¬çš„ç”¨æ³•.
</p>

<div class="org-src-container">
<pre class="src src-elisp">`(a ,(+ 1 2)) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; '(a 3)</span>
</pre>
</div>

<p>
<code>(+ 1 2)</code> è¢«è¿›è¡Œäº†è¿ç®—, <code>,</code> çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ <code>Lisp</code> è¿ç®—å™¨è·Ÿåœ¨å®ƒåé¢çš„å¯¹è±¡ä¸æ˜¯ä¸€ä¸ªå¸¸é‡,è¿™æ · <code>Lisp</code> è®¡ç®—å™¨å°±ä¼šè¿ç®—è¯¥å¯¹è±¡.
</p>

<div class="org-src-container">
<pre class="src src-elisp">`(a ,@'(1 2)) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; '(a 1 2)</span>
`(a ,@(+ 1 2)) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; '(a . 3)</span>
</pre>
</div>

<p>
è¿™é‡Œæœ‰ä¸¤ä¸ªä¾‹å­,ç¬¬ä¸€ä¸ª, <code>'(1 2)</code> è¢«å»æ‰æ‹¬å·å¹¶ä¸”æˆä¸º <code>a</code> çš„åŒçº§å…ƒç´ .
ç¬¬äºŒä¸ªå¯ä»¥çœ‹å‡º <code>,@</code> åé¢çš„å¯¹è±¡ä¹Ÿæ˜¯ä¼šè¢«è¿ç®—çš„,å¹¶éå•çº¯çš„å»æ‰æ‹¬å·,å¹¶ä¸”å’Œ <code>`(a ,(+ 1 2))</code> çš„ç»“æœä¸ä¸€æ ·,
è¿™ä¸¤ä¸ªä¾‹å­å¯ä»¥ç”¨ <code>cons</code> è¿›è¡Œæ”¹å†™,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(cons 'a '(1 2))  <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; '(a 1 2)</span>
(cons 'a (+ 1 2)) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; '(a . 3)</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-orgdc4e880" class="outline-4">
<h4 id="orgdc4e880">è¿ç®— (Eval)</h4>
<div class="outline-text-4" id="text-orgdc4e880">
<p>
å¤§éƒ¨ä»½æƒ…å†µä¸‹, <code>form</code> ä¼šåœ¨ <code>Lisp</code> ç¨‹åºè¿è¡Œä¸­è¢«ä½¿ç”¨çš„æ—¶å€™è‡ªåŠ¨è¢« <code>Lisp</code> è¿ç®—å™¨è¿ç®—,åœ¨ä¸€äº›åœºæ™¯ä¸‹å¯èƒ½éœ€è¦å†™ä¸€äº›åœ¨è¿è¡Œæ—¶å€™è¿ç®—çš„ä»£ç ,
</p>

<p>
åœ¨è¿è¡Œçš„æ—¶å€™(æ¯”å¦‚è¯»å–æ–‡æœ¬æ—¶è·å¾— <code>form</code> ,æ ¹æ®æƒ…å†µç”Ÿæˆ <code>form</code>,ä»å±æ€§åˆ—è¡¨è·å– <code>form</code> ç­‰)ä»æŸå¤„è·å¾—äº†ä¸€ä¸ª <code>form</code>,éœ€è¦å¯¹å®ƒè¿›è¡Œè¿ç®—,åœ¨è¿™äº›åœºæ™¯ä¸‹ä½¿ç”¨ <code>eval</code> è¿›è¡Œè¿ç®—.
</p>

<p>
é€šå¸¸ <code>eval</code> å¹¶ä¸æ˜¯å¿…é¡»çš„,å¦‚æœ <code>form</code> æ˜¯ä¸€ä¸ª <code>symbol</code>,é‚£ä¹ˆ <code>symbol-value</code> å°±æ›´åˆé€‚;é™¤é <code>form</code> æ˜¯ä¸€ä¸ª <code>function call</code>, å¦åˆ™ <code>funcall</code> æˆ–è€… <code>apply</code> æ›´åˆé€‚.
</p>

<p>
<code>eval</code> çš„ç”¨æ³•æ˜¯ <code>(eval FORM &amp;optional LEXICAL)</code>, <code>FORM</code> å°±æ˜¯è¦åœ¨å½“å‰ç¯å¢ƒä¸‹è¢«è¿ç®—çš„ <code>form</code>, <code>LEXICAL</code> æŒ‡å®šä½œç”¨åŸŸè§„åˆ™,é»˜è®¤æ˜¯ <code>nil</code>,è¡¨ç¤ºåŠ¨æ€ä½œç”¨åŸŸ, <code>t</code> å°±æ˜¯è¡¨ç¤ºè¯æ³•ä½œç”¨åŸŸ.
</p>

<p>
<code>LEXICAL</code> ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª <code>lexical environment</code>,è°ƒè¯•å™¨å°±ç”¨äº†è¿™ä¸ªæ¥è°ƒè¯•,æ¯”å¦‚
</p>

<div class="org-src-container">
<pre class="src src-elisp">(eval '(+ a 1) '((a . 1))) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; 2</span>
</pre>
</div>

<p>
<code>eval</code> æ˜¯ä¸€ä¸ªå‡½æ•°, <code>FORM</code> åœ¨ <code>eval</code> è°ƒç”¨å‰ä½œä¸ºå‡†å¤‡è€Œè¿ç®—ä¸€æ¬¡,ç„¶å <code>eval</code> æœ¬èº«çš„è°ƒç”¨è¿ç®—ä¸€æ¬¡,æ‰€ä»¥ä¸€ä¸ª <code>eval</code> è°ƒç”¨ä¼šè¿ç®— <code>2</code> æ¬¡.
</p>

<p>
æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­, <code>'(+ a 1)</code> è¦å…ˆè¿ç®—ä¸€æ¬¡å¾—åˆ°è‡ªå·±,ç„¶å <code>eval</code> çš„è°ƒç”¨æœ¬èº«å†è¿ç®—ä¸€æ¬¡. <code>Emacs Lisp</code> æœ‰æœ€å¤§è°ƒç”¨æ•°,ç”± <code>max-lisp-eval-depth</code> å†³å®š.
</p>

<p>
è¿˜æœ‰ <code>eval-region</code> å’Œ <code>eval-buffer</code> è¿™ä¸¤ä¸ªä»æµä¸­è¯»å– <code>form</code> è¿›è¡Œè¿ç®—,è¿˜èƒ½å¤Ÿè‡ªå®šä¹‰è¯»å–ç”¨çš„å‡½æ•°,å…·ä½“å°±ä¸ä»‹ç»äº†.
</p>

<p>
ä¸Šé¢è¯´åˆ° <code>max-lisp-eval-depth</code> ä¼šé™åˆ¶å‡½æ•°çš„æœ€å¤§è°ƒç”¨å±‚æ•°,é»˜è®¤æ˜¯ <code>800</code>, å¦‚æœè¶…è¿‡äº†è¿™ä¸ªé™åˆ¶,é‚£ä¹ˆå°±ä¼šå¼•å‘é”™è¯¯,é”™è¯¯ä¿¡æ¯ä¸º <code>Lisp nesting exceeds max-lisp-eval-depth</code>.
</p>

<p>
å®é™…ä¸Š,å±€éƒ¨ç»‘å®š(æ¯”å¦‚let)ä»¥åŠ <code>unwind-protect</code> çš„åµŒå¥—å±‚æ•°ä¹Ÿæœ‰é™åˆ¶,ç”± <code>max-specpdl-size</code> é™åˆ¶,é»˜è®¤æ˜¯1500,è¶…è¿‡è¿™ä¸ªé™åˆ¶ä¼šå¼•å‘é”™è¯¯,
</p>

<p>
é”™è¯¯ä¿¡æ¯ä¸º <code>Variable binding depth exceeds max-specpdl-size</code>.
</p>

<p>
å˜é‡ <code>values</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨,è®°å½•äº†æœ€è¿‘è¢«è¯»å–,è¢«è¿ç®—,è¢« <code>Emacs</code> å‘½ä»¤æ‰“å°åˆ°ç¼“å†²åŒº(ä¸åŒ…æ‹¬ <code>*ielm*</code> ä¸­è¿ç®—å’Œä½¿ç”¨ <code>C-j</code>, <code>C-x C-e</code> ä»¥åŠ <code>lisp-interaction-mode</code> ä¸­ç±»ä¼¼å‘½ä»¤çš„ç»“æœ)ä¸Šçš„è¡¨è¾¾å¼è¿”å›çš„ç»“æœ.
</p>

<p>
æœ€è¿‘çš„è¿ç®—ç»“æœæ’åˆ—è¡¨ç¬¬ä¸€ä½.
</p>
</div>
</div>


<div id="outline-container-org55106d3" class="outline-4">
<h4 id="org55106d3">å»¶è¿Ÿè¿ç®— (Deferred Eval)</h4>
<div class="outline-text-4" id="text-org55106d3">
<p>
<code>Emacs Lisp</code> æœ‰ä¸€ä¸ª <code>thunk</code> åº“ä¸“é—¨ç”¨æ¥å¤„ç†å»¶è¿Ÿè¿ç®—.
</p>

<p>
<code>thunk-delay</code> å®æ¥æ”¶å¤šä¸ª <code>forms</code> è¿”å›ä¸€ä¸ª <code>thunk</code>,ä¸€ä¸ª <code>thunk</code> æ˜¯ä¸€ä¸ªç»§æ‰¿äº† <code>thunk-delay</code> è°ƒç”¨æ—¶å€™çš„ç¯å¢ƒçš„é—­åŒ…,è¿™ä¸ªå®éœ€è¦å¯ç”¨ <code>lexical-binding</code>.
</p>

<p>
<code>thunk-force</code> å¼ºåˆ¶ <code>thunk</code> æ‰§è¡Œè¿ç®—å¹¶ä¸”è¿”å› <code>thunk</code> é‡Œé¢æœ€åä¸€ä¸ª <code>form</code> çš„ç»“æœ, <code>thunk</code> ä¼šè®°ä½è‡ªå·±æœ‰æ²¡æœ‰è¢«å¼ºåˆ¶æ‰§è¡Œè¿‡,å¦‚æœæœ‰è¢«å¼ºåˆ¶æ‰§è¡Œè¿‡,
</p>

<p>
å¦‚æœä»¥åå†æ¬¡è°ƒç”¨ <code>thunk-force</code> ä¼šåœ¨æ²¡è¿ç®—çš„æƒ…å†µä¸‹ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡çš„è¿ç®—ç»“æœ.
</p>

<p>
<code>thunk-let</code> å®æ˜¯ <code>let</code> çš„æƒ°æ€§ç‰ˆæœ¬,æ¯ä¸ªç»‘å®šéƒ½æ˜¯ <code>(SYMBOL VALUE-FORM)</code> è¿™ç§å½¢å¼,åªæœ‰ <code>SYMBOL</code> ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶å€™ <code>VALUE-FORM</code> æ‰ä¼šè¢«è¿ç®—,åŒæ ·éœ€è¦å¯ç”¨ <code>lexical-binding</code>.
</p>

<p>
<code>thunk-let*</code> æ˜¯ <code>let*</code> çš„æƒ°æ€§ç‰ˆæœ¬,å…·ä½“å°±ä¸è¯´äº†,å’Œ <code>thunk-let</code> å·®ä¸å¤š.
</p>

<p>
<code>thunk-let</code> å’Œ <code>thunk-let*</code> ä¼šéšå¼ä½¿ç”¨ <code>thunks</code>: å®ƒä»¬çš„å±•å¼€å¼ä¼šåˆ›å»ºåŠ©æ‰‹ <code>symbols</code> å¹¶ä¸”ç»‘å®šæŠŠè¿™äº› <code>symbols</code> ç»‘å®šåˆ°ç”± <code>value-forms</code> è½¬åŒ–æˆçš„ <code>thunks</code> ä¸Š,
</p>

<p>
å…ˆæŠŠè¿™äº› <code>thunks</code> å«åš <code>thunk-of-value-forms</code>,å•ä¸ª <code>thunk</code> å«åš <code>thunk-of-value-form</code>,
</p>

<p>
æ‰€æœ‰å‡ºç°åœ¨ <code>body forms</code> çš„å˜é‡çš„å¼•ç”¨(reference)éƒ½ä¼šåœ¨ä¹‹åè¢« <code>(thunk-force  thunk-of-form)</code> è¿™ç§å½¢å¼çš„è¡¨è¾¾å¼æ›¿æ¢.
</p>
</div>
</div>
</div>



<div id="outline-container-org7836fe0" class="outline-3">
<h3 id="org7836fe0">æ§åˆ¶ç»“æ„ (Control Structures)</h3>
<div class="outline-text-3" id="text-org7836fe0">
</div>
<div id="outline-container-orgba070fc" class="outline-4">
<h4 id="orgba070fc">æŒ‰åºè®¡ç®— (Sequencing)</h4>
<div class="outline-text-4" id="text-orgba070fc">
<p>
æŒ‰ç…§é¡ºåºè®¡ç®—,åŸºæœ¬æ‰€æœ‰ <code>Lisp</code> æ–¹è¨€å·®ä¸å¤š,å’Œ <code>Racket</code> å¯¹æ¯”çš„è¯,
</p>

<p>
<code>progn</code> ç›¸å½“äº <code>Racket</code> çš„ <code>begin</code>, <code>prog1</code> ç›¸å½“äº <code>begin0</code>, <code>prog2</code> æ˜¯ <code>prog1</code> çš„å˜ç§.
</p>

<p>
ä¸‰è€…éƒ½æ˜¯æŒ‰ç…§é¡ºåºè®¡ç®—è¡¨è¾¾å¼,å·®åˆ«åœ¨äºè¿”å›å€¼ä¸ä¸€æ ·, <code>progn</code> è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼, <code>prog1</code> è¿”å›ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼, <code>prog2</code> è¿”å›ç¬¬äºŒä¸ªè¡¨è¾¾å¼çš„å€¼.
</p>
</div>
</div>



<div id="outline-container-org9ba54eb" class="outline-4">
<h4 id="org9ba54eb">æ¡ä»¶åˆ¤æ–­ (Conditionals)</h4>
<div class="outline-text-4" id="text-org9ba54eb">
<p>
åšæ¡ä»¶åˆ¤æ–­çš„å°±æ˜¯è¿™4ä¸ª <code>if, when, unless, cond</code>.
</p>

<p>
<code>Emacs Lisp</code> å’Œå¾ˆå¤šå…ƒç¼–ç¨‹è¯­è¨€(meta programming language)ä¸€æ ·,ä¹Ÿæœ‰ <code>Pattern Matching</code>,ä¹Ÿå°±æ˜¯è®¾è®¡æ¨¡å¼é‡Œé¢é‚£åˆ«æ‰­çš„è®¿é—®è€…æ¨¡å¼(visitor pattern).
</p>

<p>
å…·ä½“ä¸å†™äº†,çœ‹æ–‡æ¡£ <code>M-: (info "(elisp) Pattern matching case statement")</code>,å¦‚æœä¸æ‡‚ <code>Pattern Matching</code> çš„æ¦‚å¿µå¯ä»¥çœ‹å…³äºè¿™ä¸€å—çš„ <code>Racket Guide</code> æ–‡æ¡£.
</p>
</div>
</div>



<div id="outline-container-org6bc7332" class="outline-4">
<h4 id="org6bc7332">æ··åˆæ¡ä»¶ (Constructs for Combining Conditions)</h4>
<div class="outline-text-4" id="text-org6bc7332">
<p>
<code>and, or, not</code> é€»è¾‘è¿ç®—ä¸‰å…„å¼Ÿå°±ä¸è¯´äº†.
</p>
</div>
</div>



<div id="outline-container-orge2eeb39" class="outline-4">
<h4 id="orge2eeb39">æ¨¡å¼åŒ¹é…æ¡ä»¶ (Pattern-Matching Conditional)</h4>
<div class="outline-text-4" id="text-orge2eeb39">
<p>
<code>Emacs Lisp</code> ä¹Ÿåƒå…¶å®ƒçš„ <code>Lisp</code> æ–¹è¨€é‚£æ ·å…·æœ‰æ¨¡å¼åŒ¹é… <code>form</code>: <code>pcase</code> å®,æ˜¯ <code>cond</code> ä»¥åŠ <code>cl-case</code> çš„æ··åˆä½“.
</p>

<p>
<code>pcase</code> å…‹æœäº† <code>cond</code> ä»¥åŠ <code>cl-case</code> çš„é™åˆ¶å¹¶å¼•å…¥äº†æ¨¡å¼åŒ¹é…ç¼–ç¨‹é£æ ¼(<code>pattern matching programming style</code>).
</p>

<p>
æ‰€å…‹æœçš„é™åˆ¶æœ‰:
</p>

<ul class="org-ul">
<li><p>
<code>cond</code> çš„ä¸»è¦é™åˆ¶åœ¨äº <code>cond</code> çš„æ¡ä»¶è¡¨è¾¾å¼é‡Œç”¨ <code>let</code> ç»‘å®šçš„å˜é‡ä¸èƒ½åœ¨ä»å¥ä½“é‡Œé¢ä½¿ç”¨;
</p>

<p>
å¦å¤–ä¸€ä¸ªå°±æ˜¯å½“ä¸€ç³»åˆ—çš„æ¡ä»¶é¢„æµ‹éƒ½æ˜¯ç­‰æ€§æµ‹è¯•(equality tests),é‚£ä¹ˆå°±ä¼šæœ‰ä¸€å¤§å †é‡å¤ä»£ç ,
</p>

<p>
(å› ä¸º <code>cond</code> çš„ç”¨æ³•éœ€è¦æ¯ä¸€ä¸ªåˆ†æ”¯éƒ½è¦å†™å…¨,è¿™ä¸ªé—®é¢˜è¢« <code>cl-case</code> çš„ <code>first-arg focus</code> é£æ ¼è§£å†³äº†.)
</p></li>

<li><p>
<code>cl-case</code> å®è¿ç®—ç¬¬ä¸€ä¸ªå…ƒç´  <code>EXPR</code> ,å¹¶æ ¹æ®è¿ç®—ç»“æœå’Œç‰¹å®šçš„å€¼é›†åˆ <code>KEYLIST</code> åšç­‰æ€§æµ‹è¯•æ¥å†³å®šæ˜¯å¦è¿ç®— <code>BODY</code>,
</p>

<p>
å®ƒçš„ç”¨æ³• <code>(cl-case EXPR (KEYLIST BODY...)...)</code>,å®ƒçš„é™åˆ¶æœ‰ä¸¤ä¸ª: ä½¿ç”¨ <code>eql</code> åšç­‰æ€§æµ‹è¯•ä»¥åŠéœ€è¦æå‰çŸ¥é“å€¼é›†åˆ <code>KEYLIST</code>.
</p>

<p>
å› ä¸ºè¿™æ ·, (<code>eql</code> çš„åŸå› ) <code>cl-case</code> ä¸é€‚åˆåˆ¤æ–­å­—ç¬¦å’Œæ··åˆå‹æ•°æ®ç»“æ„.
</p></li>
</ul>

<p>
å› æ­¤, <code>pcase</code> å€Ÿç”¨ <code>cl-case</code> çš„ <code>first-arg focus</code> çš„åšæ³•ä»¥åŠ <code>cond</code> çš„ä»å¥å¤„ç†æµ(<code>clause-processing flow</code>),
</p>

<p>
ç”¨æ¨¡å¼åŒ¹é…çš„å˜ç§ç­‰æ€§æµ‹è¯•æ¥æ›¿æ¢åˆ¤æ–­æ¡ä»¶,å¹¶ä¸”æ·»åŠ äº†ä¸€äº›åŠŸèƒ½,è¿™æ ·æ‰èƒ½ç®€å•æ˜äº†åœ°è¡¨è¾¾ä»å¥,å¹¶ä¸”èƒ½å¤Ÿåœ¨æ¡ä»¶è¯­å¥ä»¥åŠä»å¥ä¹‹é—´å…±äº« <code>let</code> ç»‘å®š.
</p>

<p>
å¯¹äºåºåˆ—,è¿˜å¯ä»¥ç”¨ <code>seq-let</code> è¿›è¡Œè§£æ„.
</p>
</div>


<ul class="org-ul">
<li><a id="org7a54f88"></a>pcaseå® (pcase Macro)<br>
<div class="outline-text-5" id="text-org7a54f88">
<p>
ç”¨æ³•: <code>(pcase EXPRESSION &amp;rest CLAUSES)</code>, <code>EXPRESSION</code> å«åšæ¨¡å¼(pattern), <code>CLAUSES</code> ä¸­æ¯ä¸€ä¸ªä»å¥éƒ½æ˜¯ <code>(PATTERN BODY-FORMS ...)</code> è¿™ç§å½¢å¼,
</p>

<p>
æ¨¡å¼ä¼šä¸ä»å¥çš„ç¬¬ä¸€ä¸ªå‚æ•° <code>PATTERN</code> åŒ¹é…,å¦‚æœè¿”å› <code>non-nil</code>,é‚£ä¹ˆå°±è¯´æ¨¡å¼åŒ¹é…äº† <code>PATTERN</code>,æˆ–è€…è¯´ <code>PATTERN</code> åŒ¹é…äº†æ¨¡å¼.
</p>

<p>
æ¯ä¸ª <code>PATTERN</code> å¿…é¡»æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>Emacs Lisp</code> æ ‡å‡†çš„æ¨¡å¼ç»„æˆçš„ <code>pcase</code> æ¨¡å¼æˆ–è€…æ˜¯é€šè¿‡ <code>pcase-defmacro</code> å®šä¹‰çš„æ¨¡å¼.
</p>

<p>
è¿™ä¸ªç« èŠ‚æœ‰ä¸å°‘ä¾‹å­,è‡ªå·±é˜…è¯».
</p>
</div>
</li>


<li><a id="org408f59a"></a>æ‹“å±•pcase (Extending pcase)<br>
<div class="outline-text-5" id="text-org408f59a">
<p>
<code>pcase</code> æœ¬èº«æ”¯æŒä¸€äº› <code>patterns</code>,è¿˜èƒ½å¤Ÿè‡ªå·±é€šè¿‡ <code>pcase-defmacro</code> å®šä¹‰.
</p>
</div>
</li>


<li><a id="org081d70a"></a>åå‘å¼•ç”¨é£æ ¼æ¨¡å¼ (Backquote Patterns)<br>
<div class="outline-text-5" id="text-org081d70a">
<p>
è‡ªå·±é˜…è¯».
</p>
</div>
</li>


<li><a id="orgd8d54cb"></a>é€šè¿‡pcaseæ¨¡å¼è§£æ„ (Destructuring with pcase Patterns)<br>
<div class="outline-text-5" id="text-orgd8d54cb">
<p>
<code>pcase</code> æ¨¡å¼ä¸ä»…èƒ½ç”¨äºåŒ¹é…,è¿˜èƒ½æ ¹æ®æ¨¡å¼ä»åŒ¹é…çš„å¯¹è±¡ä¸­è¿›è¡Œæå–å†…å®¹,è¿™å«åšè§£æ„. <code>Emacs</code> èƒ½å¤Ÿç”¨ <code>pcase-let</code>, <code>pcase-let*</code> ä»¥åŠ <code>pcase-dolist</code> è¿›è¡Œç»“æ„.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-org0c71430" class="outline-4">
<h4 id="org0c71430">è¿­ä»£å™¨ (Iteration)</h4>
<div class="outline-text-4" id="text-org0c71430">
<p>
<code>Emacs Lisp</code> ä¸­è¿­ä»£çš„æ–¹å¼æœ‰ <code>while</code>, <code>dolist</code> å’Œ <code>dotimes</code>.ç”¨æ³•å¾ˆç®€å•,æŸ¥æ–‡æ¡£å°±å¯ä»¥äº†.
</p>
</div>
</div>



<div id="outline-container-org876c8bb" class="outline-4">
<h4 id="org876c8bb">ç”Ÿæˆå™¨ (Generators)</h4>
<div class="outline-text-4" id="text-org876c8bb">
<p>
è¿­ä»£å™¨çš„å°±æ˜¯ä¸€ä¸ªäº§ç”Ÿæ½œèƒ½æ— é™(potentially-infinite)çš„æ•°å€¼æµçš„å‡½æ•°,æ¯æ¬¡äº§ç”Ÿä¸€ä¸ªå€¼ç„¶åæŒ‚èµ·è‡ªå·±,ç­‰å¾…è°ƒç”¨è€…(caller)è¯·æ±‚ä¸‹ä¸€ä¸ªå€¼.
</p>

<p>
å¦‚æœä½ æ¥è§¦è¿‡å…¶å®ƒç¼–ç¨‹è¯­è¨€çš„è¿­ä»£å™¨,æ¯”å¦‚ <code>Python</code>, <code>JavaScript</code>, <code>Racket</code> ç­‰ç­‰,é‚£ä¹ˆ <code>Emacs Lisp</code> çš„è¿­ä»£å™¨å¯¹äºä½ è€Œè¨€ä¼šå¾ˆç†Ÿæ‚‰.
</p>

<p>
<b>è¦åœ¨ <code>Emacs Lisp</code> ä½¿ç”¨è¿­ä»£å™¨å°±éœ€è¦ä½¿ç”¨ <code>generator</code> åº“å¹¶ä¸”å¼€å¯ <code>lexical-binding</code>.</b>
</p>

<p>
æ‹¿ <code>Python</code> çš„è¿­ä»£å™¨æ¥åšç±»æ¯”,è¯´çœŸçš„æˆ‘å¾ˆæƒŠè®¶å®ƒä»¬çš„è¿­ä»£å™¨æ˜¯å¦‚æ­¤ç›¸ä¼¼,
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">!/usr/bin/env python3</span>
<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">gen</span><span style="color: #DCDCCC;">(</span>x<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">while</span> x &gt; 0:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">print</span><span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"%s was passed\n"</span> % <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">yield</span> x<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">x</span> = x - 1
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> -1          <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#24341;&#21457; StopIteration &#24322;&#24120;&#26102;&#20505;&#30340;&#36820;&#22238;&#20540;</span>


<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">client</span><span style="color: #DCDCCC;">(</span>n<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">g1</span> = gen<span style="color: #DCDCCC;">(</span>n<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   g1.send<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>      <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#31561;&#20110; next(g1)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">while</span> 1:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">try</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">res</span> = g1.send<span style="color: #DCDCCC;">(</span>100<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">print</span><span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"The return value %s from generator"</span> % res<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">except</span> <span style="color: #7CB8BB;">StopIteration</span> <span style="color: #F0DFAF; font-weight: bold;">as</span> e:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> e.value


client<span style="color: #DCDCCC;">(</span>5<span style="color: #DCDCCC;">)</span>

<span style="color: #DFAF8F;">g1</span> = gen<span style="color: #DCDCCC;">(</span>5<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">g1.send(None)</span>
g1.close<span style="color: #DCDCCC;">()</span>

<span style="color: #F0DFAF; font-weight: bold;">for</span> i <span style="color: #F0DFAF; font-weight: bold;">in</span> gen<span style="color: #DCDCCC;">(</span>5<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">print</span><span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"value is %s"</span> i<span style="color: #DCDCCC;">)</span>


<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">subgen_wrapper</span><span style="color: #DCDCCC;">(</span>n<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">res</span> = <span style="color: #F0DFAF; font-weight: bold;">yield</span> <span style="color: #F0DFAF; font-weight: bold;">from</span> gen<span style="color: #DCDCCC;">(</span>n<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">print</span><span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"result is %s"</span> % res<span style="color: #DCDCCC;">)</span>


<span style="color: #F0DFAF; font-weight: bold;">for</span> i <span style="color: #F0DFAF; font-weight: bold;">in</span> subgen_wrapper<span style="color: #DCDCCC;">(</span>5<span style="color: #DCDCCC;">)</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">print</span><span style="color: #DCDCCC;">(</span>i<span style="color: #DCDCCC;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">require</span> '<span style="color: #BFEBBF;">generator</span>)
(<span style="color: #F0DFAF; font-weight: bold;">setq</span> lexical-binding t)

(<span style="color: #F0DFAF; font-weight: bold;">iter-defun</span> <span style="color: #93E0E3;">gen</span> (x)
  (<span style="color: #F0DFAF; font-weight: bold;">while</span> (&gt; x 0)
    (message (format <span style="color: #CC9393;">"return yes %s\n"</span> (<span style="color: #F0DFAF; font-weight: bold;">iter-yield</span> x)))
    (<span style="color: #F0DFAF; font-weight: bold;">setq</span> x (1- x)))
  -1)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">client</span> (n)
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((g1 (gen n)))
    (<span style="color: #F0DFAF; font-weight: bold;">condition-case</span> e
        (<span style="color: #F0DFAF; font-weight: bold;">while</span> t
          (message (format <span style="color: #CC9393;">"the return value %s from generator\n"</span> (<span style="color: #F0DFAF; font-weight: bold;">iter-next</span> g1 100))))
      (iter-end-of-sequence
       (print (cdr e))))))

(client 5)

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> g1 (gen 5))
(iter-close g1)

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> res (<span style="color: #F0DFAF; font-weight: bold;">iter-do</span> (i (gen 5))
            (message (format <span style="color: #CC9393;">"value is %s\n"</span> i))))  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">res &#20026; -1</span>

(<span style="color: #F0DFAF; font-weight: bold;">iter-defun</span> <span style="color: #93E0E3;">subgen-wrapper</span> (n)
  (message (format <span style="color: #CC9393;">"result is %s"</span> (<span style="color: #F0DFAF; font-weight: bold;">iter-yield-from</span> (gen n)))))

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> res (<span style="color: #F0DFAF; font-weight: bold;">iter-do</span> (i (subgen-wrapper 5))
            (message (format <span style="color: #CC9393;">"value is %s\n"</span> i))))
</pre>
</div>

<p>
æœ€åè¦æ³¨æ„ <code>iter-yield</code>, <code>iter-yield-from</code> åªèƒ½å‡ºç°åœ¨ <code>iter-defun</code> ä¹‹ä¸­, <code>unwind-protect</code> ä¹‹å¤–.
</p>

<p>
é™¤äº†ä¸Šé¢ä¾‹å­ä¸­çš„ <code>forms</code>,è¿˜æœ‰ä¸€ä¸ª <code>iter-lambda</code> æ˜¯ <code>iter-defun</code> çš„åŒ¿åç‰ˆ.
</p>
</div>
</div>



<div id="outline-container-orgfd622b1" class="outline-4">
<h4 id="orgfd622b1">éæœ¬åœ°é€€å‡º (Nonlocal Exits)</h4>
<div class="outline-text-4" id="text-orgfd622b1">
<pre class="example" id="org4e1a102">
å†™äº 2018/9/4
</pre>

<p>
ä¸€ä¸ª <code>nonlocal exit</code> æ˜¯ä¸€ä¸ªæŠŠå½“å‰ç¨‹åºçš„ç‚¹çš„æ§åˆ¶(control)åˆ°å¦å¤–ä¸€ä¸ªç‚¹(remote point)çš„è½¬ç§»è¿‡ç¨‹(transfer).
</p>

<p>
åœ¨ Emacs Lisp ä¸­, <code>Nonlocal exits</code> å¯ä»¥ä»¥ä¸€ä¸ªé”™è¯¯ç»“æœ(a result of errors)çš„å½¢å¼å‡ºç°,ä¹Ÿå¯ä»¥é€šè¿‡æ˜¾å¼æ§åˆ¶(explicit control)çš„æ–¹å¼ä½¿ç”¨å®ƒä»¬.
</p>

<p>
(è¿™é‡Œçš„é”™è¯¯å’Œå¼‚å¸¸æ˜¯åŒæ ·ä¸€ä¸ªæ„æ€,è™½ç„¶è‹±æ–‡ä¸­çš„è¯æ˜¯ä¸ä¸€æ ·,ä½†çš„ç¡®æŒ‡åŒä¸€ä¸ªä¸œè¥¿).
</p>

<p>
ä¸‹é¢æˆ‘ä¼šç”¨åˆ«çš„è¯­è¨€ç‰¹æ€§æ¥åšç±»æ¯”,ä¸»è¦æ˜¯ <code>C</code> è¯­è¨€å’Œ <code>Python</code>
</p>

<ul class="org-ul">
<li><p>
æ˜¾å¼æ§åˆ¶(Catch and Throw)
</p>

<p>
å®ç°æ‰‹æ®µæ˜¯åˆ©ç”¨ <code>catch</code> å’Œ <code>throw</code> ä¸¤ä¸ª special forms.å¦‚ä½•ç†è§£å®ƒä»¬?å¦‚æœå¯¹æ”¯æŒ <code>gotoåŠŸèƒ½</code> çš„è¯­è¨€æœ‰äº†è§£,é‚£ä¹ˆè¿™å°±å¾ˆå¥½ç†è§£äº†.
</p>

<p>
ç”¨ <code>C</code> è¯­è¨€ä½œä¸ºä¾‹å­, <code>catch</code> å°±ç›¸å½“äºè®¾ç½®è·³è½¬ç‚¹çš„ <code>label</code> è¯­å¥,è€Œ <code>throw</code> ç›¸å½“äºæ‰§è¡Œè·³è½¬çš„ <code>goto</code> è¯­å¥,è€Œè·³è½¬çš„ç›®çš„åœ°å°±æ˜¯ <code>catch</code> è®¾ç½®ç‚¹.
</p>

<p>
æœ€å,å®ƒä»¬çš„ <code>while</code> å¾ªç¯éƒ½ä¸ä¼šè¢«æ‰§è¡Œ,å¹¶ä¸”éƒ½è¿”å›0.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;stdio.h&gt;</span>

<span style="color: #7CB8BB;">int</span> <span style="color: #93E0E3;">main</span>()
{
  <span style="color: #F0DFAF; font-weight: bold;">goto</span> <span style="color: #BFEBBF;">back</span>;

  <span style="color: #F0DFAF; font-weight: bold;">while</span>(1){
    <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">do something</span>
    printf(<span style="color: #CC9393;">"%d"</span>, 1);
  }

 <span style="color: #BFEBBF;">back</span>: printf(<span style="color: #CC9393;">"You are going to exit now"</span>);
  <span style="color: #F0DFAF; font-weight: bold;">return</span> 0;
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">catch-throw-example</span> ()
  (<span style="color: #F0DFAF; font-weight: bold;">catch</span> '<span style="color: #BFEBBF;">back</span>
    (<span style="color: #F0DFAF; font-weight: bold;">progn</span>
      (print <span style="color: #CC9393;">"You are going to exit now"</span>)
      (<span style="color: #F0DFAF; font-weight: bold;">throw</span> '<span style="color: #BFEBBF;">back</span> 0))
    (<span style="color: #F0DFAF; font-weight: bold;">while</span> t
      (print 1))))
</pre>
</div>

<p>
åœ¨ <code>Emacs Lisp</code> ä¸­æ˜¯æ²¡æœ‰ <code>return</code> è¡¨è¾¾å¼çš„,å‡½æ•°çš„è¿”å›å€¼åªæœ‰å‡½æ•°æœ€åä¸€å¥æ‰§è¡Œçš„è¡¨è¾¾å¼çš„å€¼,å¦‚ä½•è®©å‡½æ•°åœ¨æ‰§è¡Œåˆ°ä¸€åŠçš„æ—¶å€™è¿”å›?ç°åœ¨å¯ä»¥é€šè¿‡ <code>catch</code> å’Œ <code>throw</code> æ¥å®ç°, <code>(throw tag value)</code> ç›¸å½“äº <code>c</code> è¯­è¨€çš„ <code>return value;</code>.
</p>

<p>
å…³äº <code>catch</code> å’Œ <code>throw</code> æ›´å¤šçš„ç¤ºä¾‹å¯ä»¥åœ¨ <code>M-: (info "(elisp)Examples of Catch")</code> æ‰¾åˆ°,è¿™é‡Œå°±ä¸å†™äº†.
</p></li>

<li><p>
åˆ©ç”¨é”™è¯¯/å¼‚å¸¸(Errors)
</p>

<p>
è¿™ä¸ªå°±æ˜¯ç¼–ç¨‹è¯­è¨€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶.
</p>

<p>
è¿™é‡Œç”¨ <code>Emacs Lisp</code> å’Œ <code>Python</code> çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å¯¹æ¯”ä¸€ä¸‹,é™¤äº†è¯­æ³•ä¸ä¸€æ ·ä»¥å¤–çœŸæ˜¯ååˆ†ä¸€è‡´.ä¸‹é¢ä¸¤ä¸ªä¾‹å­çš„å˜é‡çš„åå­—å·²ç»ä¿æŒä¸€æ ·äº†.
</p>

<p>
å…¶ä¸­, ä¸‹é¢çš„ <code>error</code> ä¸æ˜¯å¹³æ—¶çš„ <code>(error string &amp;rest args)</code> ,è¿™é‡Œä»£è¡¨æ‰€æœ‰ç±»å‹çš„é”™è¯¯çš„"ç¥–å…ˆ"/"root",æ‰€æœ‰ç±»å‹çš„é”™è¯¯ç›´æ¥æˆ–é—´æ¥æ´¾ç”Ÿè‡ªå®ƒ.
</p>

<p>
å®ƒä¸ <code>Python</code> çš„ <code>Exception</code> ä¸€æ ·å¯ä»¥ç”¨äºæ•æ‰ä½¿ç”¨é”™è¯¯/å¼‚å¸¸(äº‹å®ä¸Š, <code>Python</code> çš„ <code>Exception</code> æœ‰3ä¸ªç³»ç»Ÿçº§åˆ«çš„å¼‚å¸¸æ•æ‰ä¸äº†).
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">err-handle-example</span> ()
  (<span style="color: #F0DFAF; font-weight: bold;">condition-case</span> err
      (+ 1 a)
    (<span style="color: #D0BF8F; font-weight: bold;">error</span>
     (message <span style="color: #CC9393;">"Error occurs"</span>)
     err)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">err_handle_example</span><span style="color: #DCDCCC;">()</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">try</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> 1 + a
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">except</span> <span style="color: #7CB8BB;">Exception</span> <span style="color: #F0DFAF; font-weight: bold;">as</span> err:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">print</span><span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"Error occurs"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">return</span> err
</pre>
</div>

<p>
<code>Emacs Lisp</code> æœ‰3ä¸ªå¼•å‘å¼‚å¸¸çš„ special forms å’Œæ”¯æŒè‡ªå®šä¹‰å¼‚å¸¸.
</p>

<p>
å¦‚ä½•å¼•å‘ä¸€ä¸ªå¼‚å¸¸ <code>M-: (info "(elisp) Signaling Errors")</code>
</p>

<p>
å…³äºå®šä¹‰æ–°å¼‚å¸¸å’Œæ ‡å‡†çš„å¼‚å¸¸ <code>M-: (info "(elisp) Error Symbols")</code>
</p></li>

<li><p>
æ¸…ç†(Cleanups)
</p>

<p>
é€šè¿‡åˆ©ç”¨ <code>Emacs Lisp</code> çš„ <code>unwind-protect</code> æ¥ç¡®ä¿åœ¨ç»“æŸå‰æ‰§è¡ŒåŠ¨ä½œ,ä¸è®ºç»“æŸä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆ,å“ªæ€•æ˜¯å‘ç”ŸæŠ¥é”™.
</p>

<p>
å¦‚æœé—®è¿™ä¸ªè·Ÿ <code>Python</code> é‡Œé¢çš„å“ªæ ·ä¸œè¥¿æœ€åƒ,é‚£å¿…ç„¶æ˜¯å¼‚å¸¸æ•æ‰çš„ <code>finally</code> ä»è¯­,éƒ½æ˜¯ä¸ç®¡å‘ç”Ÿå‰é¢ä»€ä¹ˆäº‹æƒ…,éƒ½ä¼šåœ¨ç»“æŸå‰æ‰§è¡Œ.
</p>

<pre class="example" id="orgb05958c">

è¿™é‡Œåªæ˜¯ä¸ºäº†ä½œä¾‹å­, Python å®é™…å¤„ç†æ–‡æœ¬å†™å…¥æœ€å¥½ç”¨ with ä¸Šä¸‹æ–‡ç®¡ç†å™¨(å…¶å®ä¸€å¼€å§‹æˆ‘å°±æƒ³ç”¨ with åšç±»æ¯”,ä¸è¿‡å¯¹æ¯”å‘ç° finally æ›´åˆé€‚).

å½“ç„¶å¦‚æœ f.open() æ‰“å¼€å¤±è´¥è¿˜æ˜¯ä¸ä¼šæ‰§è¡Œä»¥åçš„è¯­å¥.æƒé™ä¸è¶³,æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸å­˜åœ¨,å°±ä¼šå‘ç”ŸæŠ¥é”™çš„æƒ…å†µ.

ä½¿ç”¨ Emacs Lisp çš„ find-file-noselect æ˜¯ä¸ä¼šå‘ç”Ÿè¿™ç§äº‹æƒ…,ç°åœ¨å‡å®š Python ä¸ä¼šå‘ç”Ÿè¿™äº›æƒ…å†µ.

</pre>

<p>
ä¸¤ä¸ªç¨‹åºéƒ½æ˜¯æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬åå«"text.txt"å¹¶ä¸”æ’å…¥"Insert content"å†…å®¹,æœ€åå…³é—­æ–‡æœ¬.
</p>

<p>
å…¶ä¸­, <code>(kill-buffer buffer)</code> è·Ÿ <code>f.close()</code> ä¸€æ ·éƒ½æ˜¯å…³é—­æ–‡æœ¬,å‰è€…æ˜¯ <code>Emacs Lisp</code> çš„ <code>unwindform</code>, åè€…æ˜¯ <code>Python</code> çš„ <code>finally</code> ä»å¥.
</p>

<p>
è€Œ <code>(insert "Insert content")</code> å’Œ <code>f.write("Insert content")</code> éƒ½æ˜¯å¤„äºå¼‚å¸¸æ•æ‰çš„ä¿æŠ¤åŒºåŸŸé‡Œé¢,è¿™æ ·ä¸¤è€…çš„å…³ç³»å°±å¾ˆæ˜äº†äº†.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((buffer (find-file-noselect <span style="color: #CC9393;">"text.txt"</span>)))
  (<span style="color: #F0DFAF; font-weight: bold;">unwind-protect</span>
      (<span style="color: #F0DFAF; font-weight: bold;">with-current-buffer</span> buffer
        (insert <span style="color: #CC9393;">"Insert content"</span>))
    (kill-buffer buffer)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">f</span> = <span style="color: #DCDCCC; font-weight: bold;">open</span><span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">'text.txt'</span>, <span style="color: #CC9393;">'w'</span><span style="color: #DCDCCC;">)</span>
<span style="color: #F0DFAF; font-weight: bold;">try</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   f.write<span style="color: #DCDCCC;">(</span><span style="color: #CC9393;">"Insert content"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #F0DFAF; font-weight: bold;">except</span> <span style="color: #7CB8BB;">Exception</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">pass</span>
<span style="color: #F0DFAF; font-weight: bold;">finally</span>:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   f.close<span style="color: #DCDCCC;">()</span>
</pre>
</div></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgc49260a" class="outline-3">
<h3 id="orgc49260a">å˜é‡ (Variables)</h3>
<div class="outline-text-3" id="text-orgc49260a">
<p>
äº‹å®ä¸Šå˜é‡å¹¶ä¸ç®€å•,å˜é‡ç»‘å®šè¿™ä¸ªæ¦‚å¿µå†³å®šäº†ä½ æ˜¯å¦å¤Ÿç†è§£ä»£ç çš„ä¸Šä¸‹æ–‡.
</p>

<p>
ç½‘ç»œä¸Šå¥½å¤šå‰ç«¯çš„é¢è¯•é—®é¢˜é‡Œé¢éƒ½æœ‰è¿™ç±»é—®é¢˜: è®²ä¸€ä¸‹ä½ å¯¹ä½œç”¨åŸŸé“¾/é—­åŒ…çš„ç†è§£,å¥½å¤šäººéƒ½æ²¡æœ‰å›åˆ°åˆ°ç‚¹ä¸Š,è¿™æ˜¯å› ä¸ºä»–ä»¬éƒ½ä¸çŸ¥é“é—®é¢˜çš„æœ¬è´¨.
</p>

<p>
è¿™é—®é¢˜å…¶å®å°±æ˜¯åœ¨é—®: è®²ä¸€ä¸‹ä½ å¯¹å˜é‡ä½œç”¨åŸŸçš„ç†è§£.
</p>

<p>
æ¯ä¸€ä¸ªå˜é‡ç»‘å®šéƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„ä½œç”¨åŸŸ(scope)å’Œç»‘å®šæŒç»­æ—¶é—´(extent),ä¹Ÿå°±æ˜¯åœ¨ç¨‹åºçš„å“ªä¸ª <b>èŒƒå›´å†…</b> èƒ½å¤Ÿè®¿é—®åˆ°å˜é‡ä»¥åŠç»‘å®šåœ¨ä»€ä¹ˆ <b>æ—¶å€™</b> æ‰å¤±æ•ˆ.
</p>

<p>
å‡å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ <code>Lisp</code> ç¨‹åº:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> a 1)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">`a' = 1, &#36825;&#20010;&#32465;&#23450;&#30340;&#20316;&#29992;&#22495;&#20026;&#25972;&#20010;&#31243;&#24207;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#20063;&#23601;&#26159;&#35828;&#22914;&#26524;&#36816;&#34892;&#30340;&#26102;&#20505;&#27809;&#26377;&#23545;&#23427;&#36827;&#34892;&#20462;&#25913;,&#37027;&#20040;&#22312;&#25972;&#20010;&#31243;&#24207;&#30340;&#20219;&#24847;&#22320;&#26041;&#33719;&#21462;&#23427;&#37117;&#33021;&#24471;&#21040; 1</span>

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">set-a</span> (v)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#20989;&#25968; `</span><span style="color: #BFEBBF;">set-a</span><span style="color: #7F9F7F;">' &#30340;&#20316;&#29992;&#22495;&#20063;&#26159;&#25972;&#20010;&#31243;&#24207;,&#21644;&#19978;&#38754;&#30340; `a' &#21516;&#32423;,</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#20294;&#26159; `v' &#30340;&#20316;&#29992;&#22495;&#21482;&#26377;&#20989;&#25968; `</span><span style="color: #BFEBBF;">set-a</span><span style="color: #7F9F7F;">' &#30340;&#20869;&#37096;,&#36825;&#20010;&#20316;&#29992;&#22495;&#27604; a = 1 &#30340;&#20316;&#29992;&#22495;&#20302;&#19968;&#32423;</span>
  (<span style="color: #F0DFAF; font-weight: bold;">setq</span> a v))

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">`</span><span style="color: #BFEBBF;">&#31354;&#30333;&#22788;</span><span style="color: #7F9F7F;">'</span>

(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((a 2))
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#36825;&#20010; `a' &#19981;&#26159;&#31532;&#19968;&#20010; `a', &#36825;&#20010; `a' &#30340;&#32465;&#23450;&#26159; a = 2,&#20316;&#29992;&#22495;&#21482;&#26377;&#35813; let &#34920;&#36798;&#24335;&#20869;&#37096;</span>
  a)  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25152;&#20197;&#35775;&#38382;&#21040;&#30340;&#36825;&#20010; `a' &#26159; a = 2 &#30340;&#36825;&#20010;&#32465;&#23450;,</span>

(<span style="color: #F0DFAF; font-weight: bold;">let</span> ()
 a)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#21516;&#26679;&#36825;&#20010; let &#34920;&#36798;&#24335;&#20869;&#37096;&#20063;&#26159;&#19968;&#20010;&#20316;&#29992;&#22495;,&#20294;&#26159;&#22312;&#36825;&#20010;&#20316;&#29992;&#22495;&#37324;&#27809;&#26377;&#25214;&#21040; `a' &#30340;&#30456;&#20851;&#32465;&#23450;,</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#22240;&#27492;&#24448;&#19978;&#19968;&#32423;&#20316;&#29992;&#22495;&#25214;,&#25214;&#21040; a = 1,&#25152;&#20197;&#35813; let &#34920;&#36798;&#24335;&#32467;&#26524;&#20026; 1,</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">a &#36825;&#31181;&#22312;&#20316;&#29992;&#22495;&#20869;&#27809;&#26377;&#25214;&#21040;&#32465;&#23450;&#30340;&#21464;&#37327;&#21483;&#20570; `</span><span style="color: #BFEBBF;">&#33258;&#30001;&#21464;&#37327;</span><span style="color: #7F9F7F;">' (free variables,&#22240;&#20026;&#27809;&#26377;&#32465;&#23450;&#25152;&#20197;&#33258;&#30001;),</span>

(prin1 a) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25171;&#21360;&#32467;&#26524;&#26159; 1,&#36825;&#37324;&#20063;&#23646;&#20110; a = 1 &#36825;&#20010;&#32465;&#23450;&#30340;&#20316;&#29992;&#22495;</span>
</pre>
</div>

<p>
ç„¶è€Œè¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®ç‚¹æ²¡æœ‰æåˆ°: å‡½æ•° <code>set-a</code> é‡Œé¢çš„è‡ªç”±å˜é‡ <code>a</code> å‘¢?å®ƒå¼•ç”¨çš„æ˜¯ \(a = 1\) è¿™ä¸ªç»‘å®šå—?
</p>

<p>
è¿™é‡Œçš„å›ç­”ä¸ºæ˜¯å’Œå¦éƒ½å¯ä»¥,å–å†³äºæ¥ä¸‹æ¥è¯­è¨€é‡‡ç”¨çš„ä½œç”¨åŸŸè§„åˆ™,åˆ†ä¸¤ç§:
</p>

<p>
åŠ¨æ€ä½œç”¨åŸŸ(dynamic scope)å’Œè¯æ³•ä½œç”¨åŸŸ(lexical scope),å…¶ä¸­è¯æ³•ä½œç”¨åŸŸåˆå«åšé™æ€ä½œç”¨åŸŸ(static scope).
</p>

<p>
ç›®å‰å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€é‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸçš„è®¾è®¡, <code>Emacs Lisp</code> é‡‡ç”¨çš„è®¾è®¡åˆ™æ˜¯:é»˜è®¤åŠ¨æ€ä½œç”¨åŸŸ,å¯é€‰å¼€å¯è¯æ³•ä½œç”¨åŸŸ.
</p>

<p>
ä¸¤è€…çš„å·®åˆ«ä½“ç°åœ¨å¯¹è‡ªç”±å˜é‡çš„å¼•ç”¨ä¸Š,
</p>

<p>
<b>åœ¨åŠ¨æ€ä½œç”¨åŸŸä¸‹</b>, <code>set-a</code> çš„ <code>a</code> å¼•ç”¨çš„æ˜¯æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„ <code>a</code> ç»‘å®š,ä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ç”±è°ƒç”¨ <code>set-a</code> çš„æ—¶æœºå†³å®šçš„,
</p>

<p>
å¦‚æœåœ¨ç©ºç™½å¤„åé¢åŠ ä¸Šä»£ç  <code>A</code>:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(set-a 4)
</pre>
</div>

<p>
é‚£ä¹ˆç¨‹åºæœ€åçš„ <code>(prin1 a)</code> æ‰“å°ç»“æœæ¯«æ— ç–‘é—®æ˜¯4,å› ä¸ºä»£ç  <code>A</code> è®¿é—®åˆ°çš„æ˜¯ \(a = 1\) ç»‘å®šçš„ <code>a</code>,
</p>

<p>
å¦‚æœåœ¨ç©ºç™½å¤„åé¢åŠ ä¸Šçš„æ˜¯ä»£ç  <code>B</code>:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((a 3))
  (set-a 4))
</pre>
</div>

<p>
é‚£ä¹ˆç¨‹åºæœ€åçš„ <code>(prin1 a)</code> æ‰“å°ç»“æœæ˜¯1,å› ä¸ºè®¡ç®— <code>(set-a 4)</code> æ—¶, <code>set-a</code> é‡Œé¢çš„ <code>a</code> æ˜¯ \(a = 3\) ç»‘å®šçš„ <code>a</code>,
</p>

<p>
å› æ­¤è¢«æ”¹å˜ç»‘å®šä¹Ÿæ˜¯è¿™ä¸ª;
</p>

<p>
<b>åœ¨è¯æ³•ä½œç”¨åŸŸä¸‹</b>, <code>set-a</code> é‡Œé¢çš„ <code>a</code> å¼•ç”¨åˆ°çš„æ˜¯ \(a = 1\), å°±æ˜¯å¼•ç”¨åˆ°çš„ç»‘å®šå¤„äºåœ¨ <b>æ–‡æœ¬ä¸Š</b> ç»‘å®šåˆ›å»ºçš„èŒƒå›´å†…,
</p>

<p>
é€šä¿—ç‚¹å°±æ˜¯, <code>set-a</code> é‡Œé¢çš„è‡ªç”±å˜é‡ <code>a</code> æ˜¯å¼•ç”¨ <code>set-a</code> å®šä¹‰é™„è¿‘çš„ç»‘å®š,æ‰€ä»¥å°±æ˜¯ <code>(setq a 1)</code>,
</p>

<p>
æŠŠ <code>(setq a 1)</code> ç§»åŠ¨åˆ° <code>set-a</code> å®šä¹‰åä¸€å¥çš„ä½ç½®ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ç»“æœ.
</p>

<p>
å…³äºå¦‚ä½•åœ¨ <code>Emacs</code> é‡Œé¢å¼€å¯è¯æ³•ä½œç”¨åŸŸå¯ä»¥çœ‹æ–‡æ¡£: <code>M-: (info "(elisp)Using Lexical Binding")</code>.
</p>


<p>
å¤§éƒ¨åˆ†è¯­è¨€é‡‡å–è¯æ³•ä½œç”¨åŸŸçš„åŸå› åº”è¯¥èƒ½å¤Ÿçœ‹å‡ºæ¥äº†: åŠ¨æ€ä½œç”¨åŸŸå®¹æ˜“å¾—åˆ°æ„æ–™ä¹‹å¤–çš„ç»“æœ.
</p>

<p>
å°±å¥½æ¯”ä¸Šé¢åŠ¨æ€ä½œç”¨åŸŸä¸‹çš„ <code>set-a</code> åœ¨ä»£ç  <code>B</code> çš„æƒ…å†µä¸‹ä¿®æ”¹åˆ°çš„å±…ç„¶æ˜¯åŒåçš„å±€éƒ¨å˜é‡ <code>a</code>,
</p>

<p>
è¿™ç‚¹å¯¹äºå¼€å‘æ¨¡å—è€Œè¨€æ˜¯å¾ˆç³Ÿç³•çš„,æ²¡åŠæ³•ä¿è¯æ¨¡å—èƒ½å¤Ÿåœ¨ä»»ä½•ä¸Šä¸‹æ–‡ä¸­éƒ½èƒ½å¤Ÿè¾¾åˆ°æœŸå¾…çš„ç»“æœ.
</p>


<p>
<code>Emacs</code> çš„å˜é‡é™¤äº†ä½œç”¨åŸŸä»¥å¤–,è¿˜æœ‰ä¸€äº›åœ°æ–¹å’Œå…¶å®ƒè¯­è¨€çš„å˜é‡ä¸åŒ.
</p>

<p>
åœ¨å¸¸é‡æ–¹é¢, <code>Emacs Lisp</code> çš„å¸¸é‡åˆ†ä¸¤ç§,åˆ†åˆ«å«ä¹‰æ˜¯: <b>å€¼ä¸èƒ½å‘ç”Ÿæ”¹å˜çš„å˜é‡</b> ä»¥åŠ <b>å€¼ä¸åº”è¯¥å‘ç”Ÿæ”¹å˜çš„å˜é‡</b>.
</p>

<p>
å‰è€…åªæœ‰ <code>nil</code>, <code>t</code> ä»¥åŠå…³é”®å­—(keyword)ç±»å‹(å°±æ˜¯ä»¥ <code>:</code> å¼€å¤´çš„ <code>symbols</code>)è¿™ä¸‰ç§,ä¸€æ—¦è¯•å›¾ç»™å®ƒä»¬èµ‹å€¼å°±ä¼šå¼•å‘ <code>setting-constant</code> å¼‚å¸¸,è¿™ç§æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¸¸é‡,
</p>

<p>
å…·ä½“çœ‹ <code>M-: (info "(elisp)Constant Variables")</code>.
</p>

<p>
åè€…åˆ™åªæ˜¯è­¦å‘Šç”¨æˆ·ä¸åº”è¯¥æ”¹å˜çš„å˜é‡,å…·ä½“çœ‹ <code>M-: (info "(elisp)Defining Variables")</code> ä¸­å¯¹ <code>defconst</code> çš„è¯´æ˜.
</p>

<p>
åœ¨å˜é‡æ–¹é¢, <code>Emacs Lisp</code> é™¤äº†å…¨å±€å˜é‡ä»¥åŠå±€éƒ¨å˜é‡ä»¥å¤–è¿˜æ”¯æŒ <code>buffer-local</code> å˜é‡,ä¹Ÿå°±æ˜¯é’ˆå¯¹ç‰¹å®šç¼“å†²åŒºçš„å˜é‡,
</p>

<p>
ç”¨äºåˆ›å»º <code>buffer-local</code> å˜é‡çš„åŸºç¡€ä¸Šè¿˜æœ‰ <code>file-local</code> å˜é‡, <code>directory-local</code> å˜é‡ä»¥åŠ <code>connection-local</code> å˜é‡,
</p>

<p>
<code>file-local</code> å˜é‡æ˜¯ç”±æ–‡ä»¶(åªèƒ½æ˜¯ <code>Emacs Lisp</code> ä»£ç æ–‡ä»¶)æœ¬èº«å®šä¹‰çš„,ç”¨æ¥ç»™æ–‡ä»¶å…³è”çš„ç¼“å†²åŒºåˆ›å»º <code>buffer-local</code> å˜é‡;
</p>

<p>
<code>directory-local</code> å˜é‡ç”±ç›®å½•(å…¶å®æ˜¯ç›®å½•ä¸‹ç‰¹åˆ«çš„æ–‡ä»¶æŒ‡å®š: <code>M-: (info "(elisp)Directory Local Variables")</code>)æŒ‡å®š,
</p>

<p>
ä½œä¸ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ <code>file-local</code> å˜é‡,å¹¶ä¸”æ–‡ä»¶æœ¬èº«å°±æœ‰çš„ <code>file-local</code> å˜é‡ä¹Ÿä¼šè¢«è¦†ç›–æ‰,å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æ¥è®©æ–‡ä»¶æœ¬èº«çš„ <code>file-local</code> å˜é‡ä¼˜å…ˆäº <code>directory-local</code> å˜é‡;
</p>

<p>
<code>connection-local</code> å˜é‡åˆ™æ˜¯é’ˆå¯¹å’Œè¿œç¨‹è¿æ¥å…³è”çš„ç¼“å†²åŒºå®šä¹‰çš„,å…·ä½“å°±çœ‹ <code>M-: (info "(elisp)Connection Local Variables")</code>.
</p>

<p>
å…³äºå˜é‡æ–¹é¢çš„ç»†èŠ‚å°±ä¸å±•å¼€è¯´äº†,åŸºæœ¬æ¯”è¾ƒé‡è¦çš„å†…å®¹(åŒ…æ‹¬äº† <code>Emacs Lisp</code> å˜é‡ä¸åŒçš„æ€»ç»“)éƒ½åœ¨ä¸Šé¢äº†.
</p>
</div>
</div>


<div id="outline-container-orga203809" class="outline-3">
<h3 id="orga203809">å‡½æ•° (Functions)</h3>
<div class="outline-text-3" id="text-orga203809">
</div>
<div id="outline-container-org7cfeb47" class="outline-4">
<h4 id="org7cfeb47">ä»€ä¹ˆæ˜¯å‡½æ•° (What is a Function)</h4>
<div class="outline-text-4" id="text-org7cfeb47">
<p>
å¹¿è€Œè¨€ä¹‹(In a general sense),å‡½æ•°å°±æ˜¯ä¸€å¥—è®¡ç®—è§„åˆ™: ç»™å‡ºä¸€äº›åä¸ºå‚æ•°(arguments)çš„å€¼ä½œä¸ºè¾“å…¥,ç„¶åè¿›è¡Œè®¡ç®—,è®¡ç®—æœ€ç»ˆç»“æœå«åšå‡½æ•°çš„å€¼(value)æˆ–è€…è¿”å›å€¼(return value),
</p>

<p>
è®¡ç®—å¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨(side effects),æ¯”å¦‚å¯¹å˜é‡æˆ–è€…æ•°æ®ç»“æ„çš„å†…å®¹äº§ç”ŸæŒä¹…æ”¹å˜(lasting changes),å‚è§çš„ <code>print</code> è¯­å¥ä¹Ÿæ˜¯ä¸€ç§;
</p>

<p>
æœ‰çš„å‡½æ•°åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¸ä¼šäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨,å¹¶ä¸”ä¸ç®¡å¤„äºä½•ç§å¤–éƒ¨å› ç´ ä¸‹(æ¯”å¦‚æœºå™¨ç±»å‹,ç³»ç»ŸçŠ¶æ€),æ¯æ¬¡è¾“å…¥åŒæ ·å‚æ•°æ€»èƒ½äº§ç”Ÿä¸€æ ·çš„è®¡ç®—ç»“æœ,è¿™ç§å‡½æ•°å«åšçº¯å‡½æ•°(pure function).
</p>


<p>
å¤§éƒ¨åˆ†çš„ç¼–ç¨‹è¯­è¨€çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„åå­—,ä¸è¿‡ <code>Lisp</code> çš„å‡½æ•°åœ¨ä¸¥æ ¼æ„ä¹‰ä¸Šæ˜¯æ²¡æœ‰åå­—(function name)çš„,å®ƒåªæ˜¯ä¸€ä¸ªå¯ä»¥å’Œ <code>symbol</code> å…³è”çš„å¯¹è±¡(function object),
</p>

<p>
ä¸€æ—¦å…³è”ä¸Š,æˆ‘ä»¬å°±æŠŠå…³è”çš„ <code>symbol</code> ç§°ä½œ(refer to &#x2026; as)å‡½æ•°,è¯è™½å¦‚æ­¤,æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æŠŠ <b>å‡½æ•°åå­—</b> å’Œ <b>å‡½æ•°å¯¹è±¡</b> çš„åŒºåˆ«é“­è®°äºå¿ƒ.
</p>


<p>
<code>Emacs Lisp</code> æœ‰ç±»å‡½æ•°(<code>function-like</code>)çš„å¯¹è±¡,å’Œå‡½æ•°ä¸€æ ·éƒ½èƒ½å¤Ÿæ‰§è¡Œè®¡ç®—,ä½†å¹¶ä¸è¢«è®¤ä¸ºæ˜¯å‡½æ•°,å› æ­¤åœ¨ä½¿ç”¨ <code>Emacs Lisp</code> è¿›è¡Œç¼–ç¨‹çš„æ—¶å€™è¦åˆ†æ¸…æ¥šä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µ:
</p>

<ul class="org-ul">
<li><b><code>Lambda Expression</code></b>: å‡½æ•°å¯¹è±¡,å¸¸è¯´çš„åŒ¿åå‡½æ•°;</li>

<li><b><code>Primitive</code></b>: ç”¨ <code>C</code> è¯­è¨€ç¼–å†™å¹¶ä¸”èƒ½å¤Ÿè¢« <code>Emacs Lisp</code> è°ƒç”¨çš„å‡½æ•°,ä¹Ÿå« <code>built-in function</code> æˆ–è€… <code>subrs</code>,è¯·å‚è€ƒ <code>(info "Writing Emacs Primitives")</code>;</li>

<li><p>
<b><code>Special Form</code></b>: å±äº <code>primitive</code>,å’Œå‡½æ•°ä¸€æ ·å¯ä»¥æ‰§è¡Œè®¡ç®—,ä½†æ˜¯ä¸åƒå‡½æ•°ä¸€æ ·æŒ‰ç…§å®šä¹‰é¡ºåºè¿ç®—æ‰€æœ‰å‚æ•°,
</p>

<p>
å®ƒå¯ä»¥åªè¿è¡Œéƒ¨åˆ†å‚æ•°,ä¹Ÿå¯ä»¥ä¸æŒ‰ç…§å®šä¹‰é¡ºåºå¯¹å‚æ•°è¿›è¡Œè¿ç®—,è¿˜å¯ä»¥æ§åˆ¶è¿ç®—å‚æ•°çš„æ¬¡æ•°,åœ¨åˆ«çš„è¯­è¨€é‡Œé¢å®ƒè¢«å«åšç»“æ„æ§åˆ¶è¯­å¥.
</p></li>

<li><b><code>Macro</code></b>: å’Œå‡½æ•°ä¸€æ ·å¯ä»¥è°ƒç”¨,ä¸åŒçš„æ˜¯ <code>macro</code> æŠŠ <code>Emacs Lisp</code> è¡¨è¾¾å¼ç¿»è¯‘æˆå¦å¤–ä¸€ä¸ªè¡¨è¾¾å¼,è¡¨è¾¾å¼å†è¢«æ‰§è¡Œ,å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å®ƒæ¥åšåˆ° <code>special form</code> èƒ½å¤Ÿåšåˆ°çš„äº‹æƒ…;</li>

<li><p>
<b><code>Command</code></b>: å¯ä»¥é€šè¿‡ <code>command-execute</code> <code>primitive</code> æ¿€æ´»çš„å¯¹è±¡å«åš <code>command</code>,å®šä¹‰å‡½æ•°çš„æ—¶å€™å¯ä»¥é€šè¿‡æ·»åŠ  <code>interactive form</code> æŠŠå‡½æ•°å˜æˆ <code>command</code>,
</p>

<p>
æ­¤å¤–ä¸æ˜¯å‡½æ•°çš„é”®ç›˜å®(<code>Keyboard macros</code>,æœ¬è´¨æ˜¯å­—ç¬¦ä¸²å’Œå‘é‡)ä¹Ÿæ˜¯ <code>commands</code>.
</p></li>

<li><b><code>Closure</code></b>: ç±»ä¼¼ <code>Lambda Expression</code>,é™¤äº†å®ƒè¿˜é—­åˆäº†ä¸€ä¸ªåŒ…å«è¯æ³•å˜é‡ç»‘å®šçš„ç¯å¢ƒ;</li>

<li><b><code>Byte-code Function</code></b>: è¢«å­—èŠ‚ç ç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„å‡½æ•°;</li>

<li><b><code>Autoload Object</code></b>: å‡½æ•°çš„å ä½ç¬¦(place-holder). <code>Emacs</code> ä¸€æ—¦è°ƒç”¨ <code>autoload object</code> å°±ä¼šåŠ è½½åŒ…å«å‡½æ•°å®šä¹‰çš„æ–‡ä»¶ç„¶åè°ƒç”¨çœŸæ­£çš„å‡½æ•°.</li>
</ul>
</div>
</div>


<div id="outline-container-org72844e8" class="outline-4">
<h4 id="org72844e8">Lambdaè¡¨è¾¾å¼ (Lambda Expressions)</h4>
<div class="outline-text-4" id="text-org72844e8">
</div>
<ul class="org-ul">
<li><a id="org64e8d2c"></a>Lambdaçš„ç»„ä»¶ (Lambda Components)<br>
<div class="outline-text-5" id="text-org64e8d2c">
<p>
ä¸€ä¸ª <code>lambda</code> è¡¨è¾¾å¼å°±æ˜¯ä»¥ä¸‹å½¢å¼çš„ä¸€ä¸ªåˆ—è¡¨.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (ARG-VARIABLES...)
  [DOCUMENTATION-STRING]
  [INTERACTIVE-DECLARATION]
  BODY-FORMS...)
</pre>
</div>

<p>
ç¬¬ä¸€ä¸ªå…ƒç´  <code>lambda</code> æ˜¯å¿…å®šè¦æœ‰çš„,ç›®çš„æ˜¯ä¸ºäº†ä¸å…¶ä»–åˆ—è¡¨è¿›è¡ŒåŒºåˆ†,ä»¥åŠå‘Šè¯‰ <code>Emacs</code> è¿™ä¸ªåˆ—è¡¨æ˜¯ä¸€ä¸ªå‡½æ•°.
</p>

<p>
ç¬¬äºŒä¸ªå…ƒç´  <code>(ARG-VARIABLES...)</code> å°±æ˜¯ä¸€ä¸ª <code>symbol list</code>,è¿™äº› <code>symbols</code> éƒ½æ˜¯å‚æ•°(<code>arguments</code>)çš„åå­—.
</p>

<p>
åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™,å‚æ•°çš„å€¼å°±ä¼šæ ¹æ®è¯¥åˆ—è¡¨æ¥è¿›è¡ŒåŒ¹é…,å½¢æˆ <code>local bindings</code>.
</p>

<p>
ç¬¬ä¸‰ä¸ªå…ƒç´  <code>DOCUMENTATION-STRING</code> æ˜¯å¯é€‰çš„,æ˜¯ä¸€ä¸ª <code>string</code> å¯¹è±¡,ç”¨æ¥æè¿°è¯¥å‡½æ•°.
</p>

<p>
ç¬¬å››ä¸ªå…ƒç´  <code>INTERACTIVE-DECLARATION</code> ä¹Ÿæ˜¯å¯é€‰çš„,æ˜¯ä¸€ä¸ªå½¢å¼ä¸º <code>(interactive CODE-STRING)</code> çš„åˆ—è¡¨.
</p>

<p>
è¿™æ˜¯ç”¨æ¥å£°æ˜åœ¨å‡½æ•°æˆä¸ºå‘½ä»¤æ—¶å€™æä¾›å‚æ•°çš„æ–¹å¼,æˆä¸ºå‘½ä»¤çš„å‡½æ•°å¯ä»¥é€šè¿‡ <code>M-x</code> æ¥è°ƒç”¨æˆ–è€…è¢«ç»‘å®šåˆ°ä¸€ä¸ªæŒ‰é”®ä¸Š.
</p>

<p>
å‰©ä¸‹éƒ¨åˆ†å°±æ˜¯å‡½æ•°ä½“,åœ¨ <code>Lisp</code> ä¸‹æˆ‘ä»¬å«åš <code>a list of Lisp forms to evaluate</code>,å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯ <code>BODY-FORMS</code> é‡Œçš„æœ€åä¸€ä¸ª <code>form</code>.
</p>
</div>
</li>


<li><a id="orga3aad6f"></a>å‚æ•°åˆ—è¡¨ (Argument List)<br>
<div class="outline-text-5" id="text-orga3aad6f">
<p>
å‚æ•°åˆ—è¡¨çš„å®Œæ•´è¯­æ³•å¦‚ä¸‹,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(REQUIRED-VARS...
 [<span style="color: #7CB8BB;">&amp;optional</span> [OPTIONAL-VARS...]]
 [<span style="color: #7CB8BB;">&amp;rest</span> [REST-VAR]])
</pre>
</div>

<p>
<code>REQUIRED-VARS...</code> æ˜¯å¿…è¦å‚æ•°åˆ—è¡¨,åœ¨å…¶ä»–è¯­è¨€å¯èƒ½å«åš <code>POSITION ARGUMENTS</code>.
</p>

<p>
å®šä¹‰å‡½æ•°çš„æ—¶å€™æœ‰å¤šå°‘ä¸ª <code>REQUIRED-VAR</code>,è°ƒç”¨çš„æ—¶å€™å°±éœ€è¦ä¼ å…¥å¤šå°‘ä¸ªå®é™…å‚æ•°(<code>actual argument</code>),å¦åˆ™ä¼šæœ‰ <code>wrong-number-of-arguments</code> é”™è¯¯.
</p>

<p>
<code>&amp;optional</code> åé¢çš„ <code>OPTIONAL-VARS...</code> æ˜¯å¯é€‰å‚æ•°,è°ƒç”¨æ—¶å€™çš„å‚æ•°æ•°é‡ä¸èƒ½è¶…è¿‡å®šä¹‰æ—¶å€™çš„æ•°é‡,å¹¶ä¸”ä¼ å…¥çš„å‚æ•°åºå·ä¸€å®šè¦å’Œå®šä¹‰çš„åŒ¹é….
</p>

<p>
<code>&amp;rest</code> åé¢è·Ÿç€åªæœ‰ä¸€ä¸ª <code>REST-VAR</code>,è°ƒç”¨æ—¶ä¼ å…¥çš„å®é™…å‚æ•°æ•°é‡ä¸ºå¤§äºç­‰äº0.
</p>

<p>
ç»“åˆä¸Šé¢çš„æè¿°ä½ ä¼šå‘ç° <code>&amp;optional</code> ä»¥åŠ <code>&amp;rest</code> çš„å‚æ•°åœ¨è°ƒç”¨æ—¶æ˜¯å¯ä»¥ä¸ä¼ å…¥çš„,ä¸ä¼ å…¥çš„æƒ…å†µä¸‹é»˜è®¤å€¼æ˜¯ <code>nil</code>.
</p>

<p>
å‡½æ•°æ²¡æœ‰åŠæ³•åŒºåˆ†æ˜¾ç¤ºä¼ å…¥ <code>nil</code> ä»¥åŠé»˜è®¤ <code>nil</code>.
</p>

<p>
æ¯”å¦‚æœ‰ä¸€ä¸ªè¿™æ ·çš„å‚æ•°åˆ—è¡¨:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(a b <span style="color: #7CB8BB;">&amp;optional</span> c d <span style="color: #7CB8BB;">&amp;rest</span> e)
</pre>
</div>

<p>
è°ƒç”¨æ—¶å€™çš„å‚æ•°æ•°é‡:
</p>

<ul class="org-ul">
<li><code>2ä¸ª</code>: <code>a</code> å’Œ <code>b</code> åˆ†åˆ«ç»‘å®š, <code>c,d,e</code> éƒ½ä¸º <code>nil</code>;</li>

<li><code>3ä¸ª</code>: <code>a</code>, <code>b</code> å’Œ <code>c</code> åˆ†åˆ«ç»‘å®š, <code>d,e</code> ä¸º <code>nil</code>;</li>

<li><code>å¤§äºç­‰äº5ä¸ª</code>: <code>a,b,c,d</code> åˆ†åˆ«ç»‘å®šä¼ å…¥çš„å‰å››ä¸ªå‚æ•°,å‰©ä¸‹çš„å‚æ•°éƒ½è¢«æ‰“åŒ…æˆä¸€ä¸ªåˆ—è¡¨å’Œ <code>e</code> è¿›è¡Œç»‘å®š.</li>
</ul>

<p>
å’Œ <code>Python</code> è¿™äº›è¯­è¨€ä¸ä¸€æ ·, <code>Emacs Lisp</code> ä¸èƒ½åœ¨ä¸ä¼ å…¥ <code>c, d</code> çš„æƒ…å†µä¸‹ç›´æ¥ç»™ <code>e</code> ä¼ å…¥å‚æ•°,å¿…é¡»ç»™ <code>c,d</code> ä¼ å…¥ <code>nil</code>.
</p>

<p>
å’Œ <code>Common Lisp</code> ä¸åŒ, <code>Emacs Lisp</code> çš„å‡½æ•°ä¸æ”¯æŒç”¨æˆ·ç»™å¯é€‰å‚æ•°è®¾å®šé»˜è®¤å€¼,ä¹Ÿä¸æ”¯æŒåŸç”Ÿå®šä¹‰å…³é”®å­—å‚æ•°(keyword arguments),
</p>

<p>
å…¶å® <code>Emacs Lisp</code> é‡Œé¢ä¹Ÿæ˜¯æœ‰ä½¿ç”¨äº†å…³é”®å­—å‚æ•°çš„å‡½æ•°,æ¯”å¦‚ <code>make-hash-table</code>,
</p>

<p>
<code>EmacsWiki</code> ä¸Šæœ‰å¦‚ä½•è‡ªå·±å®ç° <code>Keyword Arguments</code> çš„<a href="https://emacswiki.org/emacs/KeywordArguments">è¯é¢˜</a>: æŠŠ <code>&amp;rest</code> å½“ä½œ <code>plist</code> å¤„ç†æ¥å®ç°ç±»ä¼¼ä¸ <code>Common Lisp</code> çš„å…³é”®å­—å‚æ•°.
</p>

<p>
æ¯”å¦‚è¿™ä¸‹é¢ä½¿ç”¨ <code>Emacs</code> çš„å…³é”®å­—(keyword)ç±»å‹ä½œä¸ºå‚æ•°åˆ—è¡¨ä¸­çš„å…³é”®å­—,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">keyword-support-func</span> (<span style="color: #7CB8BB;">&amp;rest</span> keywords)
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((key1 (plist-get keywords <span style="color: #DCDCCC; font-weight: bold;">:key1</span>))
        (key2 (plist-get keywords <span style="color: #DCDCCC; font-weight: bold;">:key2</span>)))
    (+ key1 key2)))

(keyword-support-func <span style="color: #DCDCCC; font-weight: bold;">:key2</span> 2 <span style="color: #DCDCCC; font-weight: bold;">:key1</span> 1)
</pre>
</div>

<p>
ä¹Ÿä¸ä¸€å®šè¦ç”¨å…³é”®å­—ç±»å‹çš„,èƒ½å¤Ÿæ­£ç¡®è®¿é—®å°±å¯ä»¥,æ¯”å¦‚ä¸‹é¢ç”¨æ™®é€š <code>symbol</code> ä½œä¸ºå…³é”®å­—,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">keyword-support-func</span> (<span style="color: #7CB8BB;">&amp;rest</span> keywords)
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((key1 (plist-get keywords 'key1))
        (key2 (plist-get keywords 'key2)))
    (+ key1 key2)))

(keyword-support-func 'key2 2 'key1 1)
</pre>
</div>

<p>
ä¸è¿‡è¿™æ ·ä¸ç¬¦åˆ(<code>Common Lisp</code> çš„)"è§„èŒƒ",å› æ­¤åœ¨å®é™…ä¸­çœ‹åˆ°çš„éƒ½æ˜¯ç¬¬ä¸€ç§.
</p>

<p>
é™¤æ­¤ä»¥å¤–å¯ä»¥é€šè¿‡ <code>cl-lib</code> çš„ <code>cl-defun</code> å®æ¥ä½¿ç”¨ <code>Common Lisp</code> é‚£æ ·çš„å‡½æ•°å®šä¹‰æ–¹å¼.
</p>
</div>
</li>


<li><a id="org5b9ed91"></a>å‡½æ•°æ–‡æ¡£ (Function Documentation)<br>
<div class="outline-text-5" id="text-org5b9ed91">
<p>
<code>lambda</code> è¡¨è¾¾å¼æœ‰ä¸€ä¸ªå¯é€‰çš„æ–‡æ¡£å­—ç¬¦ä¸²,è¯¥å­—ç¬¦ä¸²ä¸å½±å“å‡½æ•°æ‰§è¡Œ,å°±æ˜¯ä¸€ä¸ªæ³¨é‡Š,å®ƒä¼šè¢« <code>Emacs</code> é‡Œé¢çš„å¸®åŠ©æ–‡æ¡£åŠŸèƒ½é€‚ç”¨,æ¯”å¦‚ <code>apropos</code> ä¼šæ˜¾ç¤ºæ–‡æ¡£å­—ç¬¦ä¸²çš„ç¬¬ä¸€è¡Œ,
</p>

<p>
æ‰€ä»¥ç¬¬ä¸€è¡Œæ–‡æ¡£å­—ç¬¦ä¸²åº”è¯¥ç”¨ä¸€ä¸¤å¥è¯æ¥æ€»ç»“å‡½æ•°çš„æ„å›¾.å†™æ–‡æ¡£å­—ç¬¦ä¸²çš„æ—¶å€™éœ€è¦æ³¨æ„å‡ ç‚¹:
</p>

<ol class="org-ol">
<li>æ–‡æ¡£å­—ç¬¦ä¸²çš„ç¬¬ä¸€è¡Œæ€»æ˜¯ä¼šè‡ªåŠ¨ç¼©è¿›,æ¯”å¦‚ä¸‹é¢è¿™æ ·,</li>
</ol>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fn-example</span> (arg)
  <span style="color: #9FC59F;">"This is an examnple only to show the indetation of</span>
<span style="color: #9FC59F;">the documentation string."</span>
  )
</pre>
</div>

<p>
è¿™æ ·æ˜¯æ­£ç¡®çš„,ä½†æ˜¯æœ‰äººä¼šè¿™ä¹ˆåš,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fn-example</span> (arg)
  <span style="color: #9FC59F;">"This is an examnple only to show the indetation of</span>
<span style="color: #9FC59F;">   the documentation string."</span>
  )
</pre>
</div>

<p>
è¿™æ˜¯é”™è¯¯çš„,è™½ç„¶åœ¨æºä»£ç ä¸­çœ‹èµ·æ¥ä¸é”™,ä½†è¿™åœ¨å¸®åŠ©åŠŸèƒ½çš„æ˜¾ç¤ºä¸‹ä¼šååˆ†éš¾çœ‹.
</p>

<ol class="org-ol">
<li>æœ€åä¸€è¡Œå¯ä»¥æŒ‡å®šè°ƒç”¨è§„èŒƒ,æ¯”å¦‚</li>
</ol>
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fn-example</span> (arg)
  <span style="color: #9FC59F;">"This is the example only to show how document looks like.</span>

<span style="color: #9FC59F;">\(fn-example ARG)"</span>
  )
</pre>
</div>

<p>
<code>\</code> çš„ä½¿ç”¨æ˜¯ä¸ºäº†é¿å…å’Œ <code>Emacs</code> çš„åŠ¨ä½œå‘½ä»¤(<code>motion commands</code>)ææ··.
</p>
</div>
</li>
</ul>
</div>





<div id="outline-container-orge3eea85" class="outline-4">
<h4 id="orge3eea85">å‡½æ•°åå­— (Function Names)</h4>
<div class="outline-text-4" id="text-orge3eea85">
<p>
å½“ <code>symbol</code> çš„ <code>function cell</code> åŒ…å«äº†ä¸€ä¸ªå‡½æ•°å¯¹è±¡,å®ƒå°±æ˜¯å‡½æ•°çš„åå­—,å®ƒä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡.
</p>

<p>
<code>function cell</code> çš„å†…å®¹è¢«ç§°ä¸º <code>symbol</code> çš„å‡½æ•°å®šä¹‰,å¦‚æœ <code>function cell</code> æ˜¯å¦å¤–ä¸€ä¸ª <code>symbol</code>,
</p>

<p>
é‚£ä¹ˆå°±ä¼šç”¨å¦å¤–çš„è¿™ä¸ª <code>symbol</code> çš„å‡½æ•°å®šä¹‰æ¥æ›¿ä»£åŸæ¥ <code>symbol</code> çš„ <code>function cell</code>,è¿™å«åšå‡½æ•°é—´æ¥è°ƒç”¨.
</p>

<p>
å®é™…ä¸­å‡ ä¹æ‰€æœ‰å‡½æ•°éƒ½æœ‰åå­—,é€šå¸¸éƒ½æ˜¯é€šè¿‡å®ƒä»¬çš„åå­—æ¥è°ƒç”¨,ä½ å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ª <code>lambda</code> è¡¨è¾¾å¼å†æŠŠå®ƒæ”¾åˆ° <code>function cell</code> é‡Œé¢çš„æ–¹å¼æ¥å®šä¹‰å‡½æ•°,
</p>

<p>
å½“ç„¶æœ€å¸¸è§çš„æ–¹æ³•å°±æ˜¯ç”¨ <code>defun</code>. ç»™å‡½æ•°åå­—æ˜¯å› ä¸ºå¯ä»¥é€šè¿‡åå­—æ¥å¼•ç”¨,ç‰¹åˆ«æ˜¯å¯¹äºé€’å½’å‡½æ•°æ¥è¯´å‡½æ•°åå­—æ˜¯å¿…é¡»çš„.
</p>

<p>
è¿˜æœ‰å°±æ˜¯åŸå‡½æ•°(<code>primitive function</code>)åªèƒ½é€šè¿‡åå­—å¼•ç”¨,å› ä¸ºåŸå‡½æ•°æ²¡æœ‰è¯»å–è¯­æ³•.
</p>

<p>
å‡½æ•°ä¸éœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—,é€šå¸¸ä¸€ä¸ªå‡½æ•°å¯¹è±¡åªä¼šå‡ºç°åœ¨ä¸€ä¸ª <code>symbol</code> çš„ <code>function cell</code> é‡Œé¢,
</p>

<p>
å®é™…ä¸Šç”¨ <code>fset</code> èƒ½å¤ŸæŠŠä¸€ä¸ªå‡½æ•°å¯¹è±¡å‚¨å­˜åˆ°å‡ ä¸ª <code>symbols</code> ä¸Š,è¿™æ ·è¿™å‡ ä¸ª <code>symbols</code> éƒ½æ˜¯ä¸åŒåå­—çš„åŒä¸€ä¸ªå‡½æ•°.
</p>

<p>
<code>Emacs Lisp</code> çš„ <code>symbol</code> å¯ä»¥åŒæ—¶ä½œä¸ºå˜é‡ä»¥åŠå‡½æ•°,å˜é‡å’Œå‡½æ•°æœ‰ä¸åŒçš„å‘½åç©ºé—´,è¿™å«åš <code>Lisp-2</code>,è€Œ <code>Scheme/Racket</code> è¿™ç§å°±ä¸æ˜¯,å«åš <code>Lisp-1</code>.
</p>

<p>
åœ¨ <code>Emacs Lisp</code> ä¸­,å‡½æ•°åå­—ä¸­æœ‰ <code>--</code> åˆ†éš”å·çš„å‡½æ•°æ˜¯ç”¨äºå†…éƒ¨ä½¿ç”¨çš„,è€Œ <code>C</code> è¯­è¨€å®ç°çš„å‡½æ•°çš„åå­—ä¸€èˆ¬éƒ½æ˜¯ä»¥ <code>-internal</code> ç»“å°¾æ¥è¡¨ç¤ºå†…éƒ¨ä½¿ç”¨.
</p>
</div>
</div>



<div id="outline-container-org98f4c91" class="outline-4">
<h4 id="org98f4c91">å®šä¹‰å‡½æ•° (Defining Functions)</h4>
<div class="outline-text-4" id="text-org98f4c91">
<p>
<code>Emacs Lisp</code> å®šä¹‰å‡½æ•°æœ‰å‡ ç§æ–¹å¼,
</p>

<ul class="org-ul">
<li><code>defun</code> (é‡æ–°)å®šä¹‰å‡½æ•°(ç”šè‡³æ˜¯åŸå‡½æ•°);</li>

<li><p>
<code>defalias</code> ç»™å‡½æ•°ä¸€ä¸ªåˆ«å,ä¸€èˆ¬åœ¨å†…éƒ¨å®ƒç”¨äº† <code>fset</code> æ¥è®¾å®šå‡½æ•°å®šä¹‰,
</p>

<p>
å¦‚æœè¯¥åˆ«åæœ‰ä¸€ä¸ª <code>defalias-fset-function</code> å±æ€§,è¯¥å±æ€§å…³è”çš„å€¼é…’ä¼šåšä¸ºå‡½æ•°æ¥ä½¿ç”¨,æ›¿ä»£ <code>fset</code>.
</p>

<p>
<code>defalias</code> åƒ <code>defun</code> è®°å½•å‡½æ•°å®šä¹‰çš„ä½ç½®ä¸€æ ·æ¥è®°å½•èµ‹äºˆåˆ«åçš„æ—¶å€™çš„ä½ç½®.
</p></li>

<li><p>
<code>define-inline</code> å®å®šä¹‰å†…è”å‡½æ•°,æ¯”èµ·åŒæ ·ä½œç”¨çš„ <code>defsubst</code>, <code>define-inline</code> å¯ä»¥ä½œä¸º <code>mapcar</code> çš„å‚æ•°,
</p>

<p>
å¹¶ä¸”æ›´åŠ æœ‰æ•ˆç‡,è¿˜èƒ½ä½œä¸º <code>place forms</code> å‚¨å­˜å€¼.è¿˜æœ‰ä¸€äº›åº”è¯¥ç”¨åœ¨ <code>define-inline</code> å†…éƒ¨çš„å®,å…·ä½“çœ‹æ–‡æ¡£.
</p></li>
</ul>
</div>
</div>



<div id="outline-container-org3d28a03" class="outline-4">
<h4 id="org3d28a03">è°ƒç”¨å‡½æ•° (Calling Functions)</h4>
<div class="outline-text-4" id="text-org3d28a03">
<p>
è°ƒç”¨(call/invocation)å‡½æ•°å°±æ˜¯è¿è¡Œå‡½æ•°.è°ƒç”¨å‡½æ•°åˆ†ä¸¤ç§æƒ…å†µ,ç¡¬ç¼–ç è°ƒç”¨ä»¥åŠè¿è¡Œæ—¶è°ƒç”¨.
</p>

<p>
ç¡¬ç¼–ç è°ƒç”¨ä¸€èˆ¬å°±æ˜¯ç¡®å®šå’Œé™å®šç¨‹åºè¦è°ƒç”¨ä»€ä¹ˆå‡½æ•°ä»¥åŠéœ€è¦å¤šå°‘å‚æ•°,è¿™ç§æƒ…å†µå¯ä»¥ç”¨ <code>function call</code> çš„ <code>list form</code> æ¥è°ƒç”¨å‡½æ•°.
</p>

<p>
è¿è¡Œæ—¶è°ƒç”¨å°±æ˜¯ä¸ç¡®å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ä»¥åŠä¼ å…¥å¤šå°‘å‚æ•°,éƒ½æ˜¯ç”±è¿è¡Œæ—¶å†³å®šçš„,è¿™ç§æƒ…å†µå¯ä»¥ç”¨ <code>funcall</code> æˆ–è€… <code>apply</code> æ ¹æ®æƒ…å†µæ¥è¿›è¡Œè°ƒç”¨.
</p>

<p>
<code>funcall</code> å’Œ <code>apply</code> çš„åŒºåˆ«åœ¨äº <code>apply</code> çš„æœ€åä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸ª <code>list</code>,å¦‚æœæƒ³è®© <code>funcall</code> æƒ³ä½¿ç”¨å‘½ä»¤é‚£æ ·è°ƒç”¨ä¸€ä¸ªå‘½ä»¤,é‚£ä¹ˆè¯·ä½¿ç”¨ <code>funcall-interactively</code>.
</p>

<p>
æœ‰æ—¶å€™å¯èƒ½å› ä¸ºæŸäº›åŸå› ä¸æƒ³æ¯æ¬¡è°ƒç”¨å‚æ•°çš„æ—¶å€™ä¼ å…¥ç›¸åŒçš„å‚æ•°,éœ€è¦å›ºå®šå‡½æ•°çš„ä¸€éƒ¨åˆ†å‚æ•°çš„å€¼,è¿™ç§å«åšåå‡½æ•° (<code>partial application</code>),ç»“æœæ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°,
</p>

<p>
å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">example</span> (a b c)
  (+ a b c))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">partial-example</span> (c)
  (+ 1 2 c))
</pre>
</div>

<p>
åå‡½æ•°å’ŒæŸ¯é‡ŒåŒ–(<code>Currying</code>)ç›¸ä¼¼ä¹Ÿæœ‰å…³,ä½†ä¸¤è€…ä¸ä¸€æ ·,è€Œä¸”ç›®çš„ä¹Ÿä¸ä¸€æ ·,åœ¨ç¼–ç¨‹è¯­ä¹‰å­¦ä¸­,æŸ¯é‡ŒåŒ–æ˜¯ç”±äº <code>lambda</code> è¡¨è¾¾å¼åªèƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°,ä½†æƒ³è¦å®ç°æ¥æ”¶å¤šä¸ªå‚æ•°çš„ä¸€ç§æŠ€æœ¯.
</p>

<p>
è¿™ä¸ªæ˜¯ <code>Racket</code> ä»£ç ,ä¸‹é¢çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå¦‚ä½•åˆ©ç”¨æŸ¯é‡ŒåŒ–å®ç°ä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªå‚æ•°çš„å’Œçš„ <code>lambda</code> è¡¨è¾¾å¼.
</p>

<div class="org-src-container">
<pre class="src src-racket">(((lambda (x)
    (lambda (y)
      (+ x y))) 1) 2)
</pre>
</div>

<p>
<code>Emacs Lisp</code> å› ä¸º <code>Lisp-2</code> çš„åŸå› è¦è¿™ä¹ˆå†™
</p>

<div class="org-src-container">
<pre class="src src-elisp">(funcall
 ((<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (y)
    (<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (x) (+ y x)))
  2)
 1)
</pre>
</div>

<p>
åœ¨ <code>Emacs Lisp</code> ä¸­æœ‰ä¸“é—¨çš„ <code>apply-partial</code> æ¥å®ç°åå‡½æ•°.è¿˜æœ‰å¯ä»¥ç”¨ <code>call-interactively</code> è°ƒç”¨ä¸€äº›èº«ä¸ºå‘½ä»¤çš„å‡½æ•°.
</p>
</div>
</div>




<div id="outline-container-org0e1d013" class="outline-4">
<h4 id="org0e1d013">Mappingå‡½æ•° (Mapping Functions)</h4>
<div class="outline-text-4" id="text-org0e1d013">
<p>
<code>mapping</code> å‡½æ•°å°±æ˜¯æŠŠä¸€ä¸ªå‡½æ•°ä¾æ¬¡åº”ç”¨åˆ°ä¸€ä¸ª <code>list</code> æˆ–è€…å…¶ä»–é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ çš„å‡½æ•°.
</p>

<p>
<code>mapcar</code> æŠŠ <code>FUNCTION</code> ä¾æ¬¡åº”ç”¨åˆ° <code>SEQUENCE</code> çš„æ¯ä¸€ä¸ªå…ƒç´ ,æœ€åæŒ‰ç…§é¡ºåºæŠŠç»“æœæ”¶é›†åˆ°ä¸€ä¸ª <code>list</code> ä¸­å¹¶ä¸”è¿”å›.
</p>

<p>
<code>mapcan</code> ç±»ä¼¼ <code>mapcar</code>,ä½†æ˜¯ <code>FUNCTION</code> çš„è¿”å›ç»“æœä¸€å®šè¦æ˜¯ <code>list</code>, <code>mapcan</code> è¿”å›çš„åˆ—è¡¨å°±æ˜¯ç”¨ <code>nconc</code> æ¥å¯¹è¿™äº›ç»“æœé‡æ–°æ’åˆ—çš„ç»“æœ.
</p>

<p>
<code>mapc</code> ç±»ä¼¼ <code>mapcar</code> ä½†æ˜¯åªè¿”å› <code>SEQUENCE</code>,è¿™ä¸ªåªé€‚åˆç”¨ä¸å‰¯ä½œç”¨(<code>side-effect</code>).
</p>

<p>
<code>mapconcat</code> æŠŠ <code>FUNCTION</code> ä¾æ¬¡åº”ç”¨åˆ° <code>SEQUENCE</code> çš„æ¯ä¸€ä¸ªå…ƒç´ ,ä½†æ˜¯æœ€åç»“æœä¸€å®šæ˜¯ä¸€ä¸ªå­—ç¬¦åºåˆ—(string/vector/list), <code>FUNCTION</code> å¿…é¡»è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°å¹¶ä¸”è¿”å›ä¸€ä¸ªå­—ç¬¦åºåˆ—.
</p>

<p>
è¿˜æœ‰å…¶å®ƒä¸€äº›åˆ«çš„ <code>mapping</code> å‡½æ•°,æ¯”å¦‚ <code>mapatoms</code> å°±æ˜¯ç”¨äº <code>obarray</code> ä¸Šçš„, <code>maphash</code> å°±æ˜¯ç”¨äº <code>hash table</code> ä¸Š.
</p>

<p>
å¯¹äº <code>char table</code> æœ‰ <code>map-char-table</code>.
</p>
</div>
</div>



<div id="outline-container-org568c571" class="outline-4">
<h4 id="org568c571">åŒ¿åå‡½æ•° (Anonymous Functions)</h4>
<div class="outline-text-4" id="text-org568c571">
<p>
åŒ¿åå‡½æ•°å°±æ˜¯æ²¡æœ‰åå­—çš„å‡½æ•°,æœ‰ä¸‰ç§æ„å»ºåŒ¿åå‡½æ•°, <code>lambda</code> å®, <code>function</code> <code>special form</code> ä»¥åŠ <code>#'</code> è¯»å–è¯­æ³•.
</p>

<p>
<code>lambda</code> éƒ½å¾ˆç†Ÿæ‚‰,å…·ä½“ä¸è¯´äº†, <code>function</code> æ¥æ”¶ä¸€ä¸ªå‡½æ•°å¯¹è±¡,åœ¨æ²¡æœ‰è¿ç®—çš„æƒ…å†µä¸‹è¿”å›ä¸€ä¸ªå‡½æ•°å¯¹è±¡,è¯»å–è¯­æ³• <code>#'</code> å°±æ˜¯å®ƒçš„ç®€å†™(short-hand).
</p>

<p>
å½“ <code>function</code> æ¥æ”¶çš„ <code>FUNCTION-OBJECT</code> æ˜¯ä¸€ä¸ªåˆæ³•çš„ <code>lambda</code> è¡¨è¾¾å¼,æœ‰ä¸¤ç§æ•ˆæœ:
</p>

<ul class="org-ul">
<li>å½“ä»£ç è¢«ç¼–è¯‘çš„æ—¶å€™, <code>FUNCTION-OBJECT</code> å°±ä¼šè¢«ç¼–è¯‘æˆå­—èŠ‚ç å‡½æ•°(<code>byte-code function</code>);</li>
<li>å½“å¯ç”¨äº†è¯æ³•ç»‘å®š, <code>FUNCTION-OBJECT</code> ä¼šè½¬æ¢æˆä¸€ä¸ªé—­åŒ…å¯¹è±¡.</li>
</ul>

<p>
å¦‚æœ <code>FUNCTION-OBJECT</code> æ˜¯ä¸€ä¸ª <code>symbol</code> å¹¶ä¸”ä»£ç è¢«ç¼–è¯‘,é‚£ä¹ˆå­—èŠ‚ç¼–è¯‘å™¨(<code>byte-compiler</code>)ä¼šå› ä¸ºå‡½æ•°æ²¡æœ‰è¢«å®šä¹‰,æˆ–è€…ç¼–è¯‘å™¨ä¸çŸ¥é“å®šä¹‰çš„æƒ…å†µä¸‹è¿›è¡Œè­¦å‘Š.
</p>

<p>
å°±ä¸ªäººç›®å‰ä½¿ç”¨ <code>Emacs</code> çš„ç»å†æ¥çœ‹,åä¸€ç§æƒ…å†µæ¯”è¾ƒå¤š.
</p>
</div>
</div>



<div id="outline-container-org261feba" class="outline-4">
<h4 id="org261feba">é€šç”¨å‡½æ•° (Generic Functions)</h4>
<div class="outline-text-4" id="text-org261feba">
<p>
ä¸€èˆ¬å‡½æ•°éƒ½æ˜¯ç¡¬ç¼–ç (<code>hard-coded</code>)çš„,ä¹Ÿå°±æ˜¯å‡å®šäº†å‡½æ•°çš„ç±»å‹ä»¥åŠé¢„æœŸçš„å‚æ•°å€¼(é¢„æœŸçš„å‚æ•°ç±»å‹),è°ƒç”¨çš„æ—¶å€™åªèƒ½ä¼ å…¥ç‰¹å®šçš„å‚æ•°ä»¥åŠæ ¹æ®è¿”å›å€¼ç±»å‹æ¥ä½¿ç”¨è¿”å›å€¼.
</p>

<p>
ç›¸å,é¢å‘å¯¹è±¡ç¨‹åº(<code>object-oriented programs</code>)èƒ½å¤Ÿä½¿ç”¨å¤šæ€å‡½æ•°(<code>polymorphic functions</code>)è§£å†³è¿™ä¸ªé—®é¢˜,
</p>

<p>
å¤šæ€å‡½æ•°: å°±æ˜¯ä¸€ä¸ªæœ‰ç›¸åŒåå­—çš„å‡½æ•°é›†åˆ,æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„å‚æ•°ç±»å‹é›†åˆ,å¤šæ€å‡½æ•°ä¼šæ ¹æ®è¿è¡Œæ—¶ä¼ å…¥çš„å‚æ•°ç±»å‹å†³å®šè°ƒç”¨é›†åˆé‡Œé¢çš„æŸä¸ªå‡½æ•°.
</p>

<p>
<code>Emacs</code> æä¾›äº†åƒå…¶ä»– <code>Lisp</code> æ–¹è¨€çš„å¤šæ€æ”¯æŒ,ç‰¹åˆ«åƒ <code>Common Lisp</code> ä»¥åŠå®ƒçš„ <code>Common Lisp Object System</code> (<code>CLOS</code>), <code>Emacs</code> çš„é€šç”¨å‡½æ•°å°±ç±»ä¼¼å¤šæ€å‡½æ•°,
</p>

<p>
<code>Emacs</code> çš„å¤šæ€æ”¯æŒå°±æ˜¯æ¨¡ä»¿ <code>CLOS</code>.ä¸€ä¸ªé€šç”¨å‡½æ•°å°±æ˜¯ä¸€ä¸ªæŠ½è±¡,å®šä¹‰å‡½æ•°åå­—ä»¥åŠå‚æ•°,é€šå¸¸æ˜¯æ²¡æœ‰å‡½æ•°çš„å®ç°.
</p>

<p>
å®é™…çš„å®ç°ä¼šæ ¹æ®ç‰¹å®šå‚æ•°ç±»å‹æ¥ç”±å¯¹åº”çš„"æ–¹æ³•"æä¾›,æ¯ä¸ªæ–¹æ³•å®ç°ä¸€ä¸ªä¸é€šç”¨å‡½æ•°åŒåçš„å‡½æ•°,ä½†è¦æŒ‡å®šå®ƒæ¥å—çš„å‚æ•°ç±»å‹,è¿™å°±æ˜¯ä¸“åŒ–(specializing)å‚æ•°,è¿™äº›å‚æ•°ç±»å‹å«åšå‚æ•°ä¸“åŒ–å™¨(<code>argument specializers</code>).
</p>

<p>
å‚æ•°çš„ä¸“åŒ–ç¨‹åº¦å¯ä»¥æˆ–å¤šæˆ–å°‘,æ¯”å¦‚ <code>string</code> æ¯” <code>sequence</code> æ›´åŠ ç‰¹å®š/ä¸“æœ‰åŒ–.
</p>

<p>
ä¸åƒåŸºäºæ¶ˆæ¯ä¼ é€’çš„é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€(<code>message-based OO languages</code>),æ¯”å¦‚, <code>C++</code> å’Œ <code>Simula</code>, <code>Emacs Lisp</code> å®ç°é€šç”¨å‡½æ•°çš„æ–¹æ³•ä¸å±äºç±»,
</p>

<p>
å®ƒä»¬å±äºå®ƒä»¬å®ç°çš„é€šç”¨å‡½æ•°,æ‰€ä»¥æ‰è¯´é€šç”¨å‡½æ•°å°±æ˜¯ä¸€ä¸ªæŠ½è±¡.å½“è°ƒç”¨ä¸€ä¸ªé€šç”¨å‡½æ•°çš„æ—¶å€™,å®ƒä¼šé€šè¿‡æ¯”å¯¹å®é™…ä¼ å…¥çš„å‚æ•°ä»¥åŠæ–¹æ³•çš„å‚æ•°ä¸“åŒ–å™¨æ¥é€‰æ‹©åˆé€‚çš„æ–¹æ³•(applicable methods).
</p>

<p>
ä¸ºåŒä¸€ä¸ªé€šç”¨å‡½æ•°æä¾›å®ç°çš„æ–¹æ³•çš„å‚æ•°æ•°é‡å¿…é¡»è¦ä¸€æ ·,é€šè¿‡å‚æ•°ç±»å‹æ¥åŒºåˆ†,ä¼šå‡ºç°æœ‰å¤šäº1ä¸ªåˆé€‚æ–¹æ³•çš„æƒ…å†µ,è¿™ç§æƒ…å†µä¸‹è¿™äº›åˆé€‚çš„æ–¹æ³•ä¼šæ ¹æ®ç‰¹å®šè§„åˆ™ç»„åˆåœ¨ä¸€èµ·.
</p>

<p>
æ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">cl-defgeneric</span> <span style="color: #93E0E3;">genericFunc</span> (a)
  <span style="color: #9FC59F;">"Example for generaic"</span> nil
  (message <span style="color: #CC9393;">"Body as default method"</span>))

(genericFunc 0) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#22914;&#26524;&#27809;&#26377;&#25552;&#20379;&#26041;&#27861;,&#37027;&#20040;&#23601;&#35843;&#29992;&#25552;&#20379;&#30340;&#20989;&#25968;&#20307;,&#20316;&#20026;&#40664;&#35748;&#26041;&#27861;</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25552;&#20379;&#26041;&#27861;,&#26041;&#27861;&#30340;&#21442;&#25968;&#21487;&#20197;&#21644;&#36890;&#29992;&#20989;&#25968;&#23450;&#20041;&#30340;&#19981;&#19968;&#26679;,&#22240;&#20026;&#30446;&#21069;&#32780;&#35328;&#23450;&#20041;&#36890;&#29992;&#20989;&#25968;&#26102;&#30340;&#21442;&#25968;&#19981;&#20250;&#34987;&#22788;&#29702;&#30340;</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25552;&#20379;&#20027;&#35201;&#23454;&#29616;, primary implementation</span>

(<span style="color: #F0DFAF; font-weight: bold;">cl-defmethod</span> <span style="color: #93E0E3;">genericFunc</span> ((a (eql 1))) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">(eql 1) &#34920;&#31034;&#21028;&#26029;&#23454;&#38469;&#21442;&#25968;a&#26159;&#21542;&#31561;&#20110;1</span>
  1)

(<span style="color: #F0DFAF; font-weight: bold;">cl-defmethod</span> <span style="color: #93E0E3;">genericFunc</span> ((c (eql 2)))
  2)

(genericFunc 1) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; 1</span>
(genericFunc 2) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; 2</span>


<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#25552;&#20379;&#36741;&#21161;&#23454;&#29616;, auxiliary method</span>

(<span style="color: #F0DFAF; font-weight: bold;">cl-defmethod</span> <span style="color: #93E0E3;">genericFunc</span> <span style="color: #DCDCCC; font-weight: bold;">:before</span> ((c (eql 3)))
  3)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#20351;&#29992;&#36741;&#21161;&#23454;&#29616;&#35201;&#27714;&#36890;&#29992;&#20989;&#25968;&#25552;&#20379;&#20989;&#25968;&#20307;,&#21542;&#21017;&#20250;&#26377; No primary method &#25253;&#38169;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#36741;&#21161;&#20989;&#25968;&#23545;&#36890;&#29992;&#20989;&#25968;&#26377;&#19968;&#20010;&#35201;&#27714;: &#36890;&#29992;&#20989;&#25968;&#30340;&#21442;&#25968;&#25968;&#37327;&#35201;&#21644;&#36741;&#21161;&#26041;&#27861;&#30340;&#21442;&#25968;&#25968;&#37327;&#19968;&#26679;,&#22240;&#20026;&#36741;&#21161;&#26041;&#27861;&#30340;&#21442;&#25968;&#20250;&#20256;&#20837;&#21040;&#36890;&#29992;&#20989;&#25968;&#37324;&#38754;,&#36825;&#20010;&#26102;&#20505;&#38656;&#35201;&#21442;&#25968;&#25968;&#37327;&#19968;&#33268;.</span>

</pre>
</div>
</div>
</div>



<div id="outline-container-org014cfe3" class="outline-4">
<h4 id="org014cfe3">Function Cells</h4>
<div class="outline-text-4" id="text-org014cfe3">
<p>
<code>symbol</code> çš„å‡½æ•°å®šä¹‰å°±æ˜¯ä¸€ä¸ªå‚¨å­˜åœ¨ <code>symbol</code> çš„ <code>function cell</code> çš„å‡½æ•°å®šä¹‰.è¿™ä¸ªç« èŠ‚æè¿°äº†å¦‚ä½•è®¿é—® <code>function cell</code>,
</p>

<p>
ä»¥åŠå¦‚ä½•æ“ä½œ <code>function cell</code>,åŒ…æ‹¬è®¾ç½® <code>function cell</code> (<code>fset</code>),åˆ¤æ–­ <code>symbol</code> çš„ <code>function cell</code> æ˜¯å¦ä¸º <code>void</code> (<code>fboundp</code>),ä»¥åŠç§»é™¤ <code>function cell</code> çš„å†…å®¹(<code>fmakunbound)</code>.
</p>
</div>
</div>




<div id="outline-container-org6edc4eb" class="outline-4">
<h4 id="org6edc4eb">é—­åŒ… (Closures)</h4>
<div class="outline-text-4" id="text-org6edc4eb">
<p>
åœ¨ <code>Emacs</code> å¯ç”¨äº†è¯æ³•ç»‘å®šçš„æƒ…å†µä¸‹,ä»»ä½•æœ‰åå­—çš„å‡½æ•°ä»¥åŠç”¨ <code>lambda/function</code> æˆ–è€… <code>#'</code> è¯»å–è¯­æ³•æ„å»ºçš„åŒ¿åå‡½æ•°,éƒ½ä¼šè¢«è‡ªåŠ¨è½¬åŒ–æˆé—­åŒ…å¯¹è±¡(<code>closure</code>).
</p>

<p>
é—­åŒ…å°±æ˜¯ä¸€ä¸ªåŒ…å«äº†å®šä¹‰å‘ç”Ÿæ—¶çš„è¯æ³•ç¯å¢ƒ(<code>lexical environment</code>)è®°å½•çš„å‡½æ•°,åœ¨è°ƒç”¨çš„æ—¶å€™,ä»»ä½•è‡ªç”±/è¯æ³•å˜é‡éƒ½ä¼šä»è¿™ä¸ªè®°å½•é‡Œé¢æ‰¾å€¼.
</p>

<p>
æ‰€è°“è‡ªç”±å˜é‡å°±æ˜¯ä¸æ˜¯åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ä½†å´åœ¨å†…éƒ¨è¢«å¼•ç”¨çš„çš„å˜é‡. <code>Emacs</code> ä¸­çš„é—­åŒ…æ˜¯æš´éœ²çš„,æ˜¯ä¸€ä¸ªé¦–ä¸ªå…ƒç´ ä¸º <code>symbol</code> <code>closure</code> çš„åˆ—è¡¨,å¯ä»¥æ‰‹åŠ¨æ„å»º.
</p>

<div class="org-src-container">
<pre class="src src-elisp">#'(closure (t) (x) (* x x)) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; &#30456;&#24403;&#20110; (lambda (x) (* x x))</span>
(funcall #'(closure (t) (x) (* x x)) 2) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; &#30456;&#24403;&#20110; ((lambda (x) (* x x)) 2)</span>
</pre>
</div>

<p>
è¿™é‡Œçš„ç¬¬äºŒä¸ªå…ƒç´  <code>(t)</code> è¡¨ç¤ºè¯æ³•ç¯å¢ƒ, <code>(x)</code> å°±æ˜¯è¿™ä¸ªé—­åŒ…å‡½æ•°æ¥å—çš„å‚æ•°, <code>(* x x)</code> æ¯«æ— ç–‘é—®å°±æ˜¯å‡½æ•°ä½“äº†.
</p>
</div>
</div>



<div id="outline-container-org132882d" class="outline-4">
<h4 id="org132882d">Advising Functions</h4>
<div class="outline-text-4" id="text-org132882d">
<p>
å½“éœ€è¦ä¿®æ”¹å®šä¹‰åœ¨åˆ«çš„åº“çš„å‡½æ•°,æˆ–è€…éœ€è¦ä¿®æ”¹ä¸€ä¸ª <code>hook</code>,ä¸€ä¸ªè¿›ç¨‹è¿‡æ»¤å™¨,æˆ–è€…æŒæœ‰å‡½æ•°å€¼çš„ä»»æ„å˜é‡æˆ–è€…å¯¹è±¡å­—æ®µ,ä½ å¯ä»¥æ˜¯ç”¨æ°å½“çš„ <code>setter</code> æ¥ä¿®æ”¹å®šä¹‰,
</p>

<p>
å¯¹äºå‘½åå‡½æ•°å¯ä»¥ç”¨ <code>fset</code> æˆ–è€… <code>defun</code>, å¯¹äº <code>hook</code> å¯ä»¥ç”¨ <code>setq</code>, å¯¹äºè¿›ç¨‹è¿‡æ»¤å™¨å¯ä»¥ç”¨ <code>set-process-filter</code>,ä½†æ˜¯è¿™äº›ä¼šå®Œå…¨è¦†ç›–æ—§çš„å®šä¹‰.
</p>

<p>
<code>Emacs Lisp</code> æä¾› <code>advice</code> ç‰¹æ€§è®©ä½ åœ¨ä¸è¦†ç›–åŸæœ‰å®šä¹‰çš„æƒ…å†µä¸‹å¯¹åŸæœ‰å®šä¹‰è¿›è¡Œæ‹“å±•. <code>Emacs</code> çš„ <code>advice</code> ç³»ç»Ÿæä¾›ä¸¤ç±»åŸæ“ä½œ,
</p>

<p>
é’ˆå¯¹å˜é‡å’Œå¯¹è±¡å­—æ®µ(variable and object fields)æœ‰ <code>add-function</code> å’Œ <code>remove-function</code>,é’ˆå¯¹å‘½åå‡½æ•°æœ‰ <code>advice-add</code> å’Œ <code>advice-remove</code>.
</p>


<ul class="org-ul">
<li><p>
advising å·²ç»å­˜åœ¨çš„å‡½æ•°,å°±æ˜¯ç»„åˆå‡½æ•°,æƒ³æƒ³é’©å­(hooks)
</p>

<p>
<code>defadvice</code> å’Œ <code>advice-add</code>
</p>

<p>
æ¯”å¦‚,åœ¨display-bufferå‘½ä»¤æ‰§è¡Œä¹‹åæç¤ºbufferçš„åå­—,ç”¨display-bufferåšå®éªŒæ˜¯å› ä¸ºä¸€æ—¦å‡ºé”™äº† <code>minibuffer</code> éƒ½ç”¨ä¸äº†,åé¦ˆå¿«é€Ÿ.
</p>

<ul class="org-ul">
<li><p>
è€é£æ ¼ <code>defadvice</code>
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defadvice</span> <span style="color: #93E0E3;">display-buffer</span> (after after-display-buffer
                                 (buffer-or-name <span style="color: #7CB8BB;">&amp;optional</span> action frame)
                                 activate)
  (message <span style="color: #CC9393;">"buffer is named %S"</span> (<span style="color: #F0DFAF; font-weight: bold;">if</span> (bufferp buffer-or-name)
                                    (buffer-name buffer-or-name)
                                  buffer-or-name)))
(ad-deactivate #'display-buffer)
</pre>
</div>

<p>
å¯ä»¥ä»¥ <code>:around</code> æ¥æ‰§è¡Œ,ä¸è¿‡å†™æ³•ç¨å¾®æœ‰ç‚¹ä¸å¤ªä¸€æ ·,aroundæ˜¯ç›´æ¥æŠŠadvisedå‡½æ•°ç»™åŒ…è£¹èµ·æ¥
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defadvice</span> <span style="color: #93E0E3;">display-buffer</span> (around around-display-buffer
                                  (buffer-or-name <span style="color: #7CB8BB;">&amp;optional</span> action frame)
                                  activate)
  (<span style="color: #F0DFAF; font-weight: bold;">interactive</span> (list (read-buffer <span style="color: #CC9393;">"Display buffer: "</span> (other-buffer))
                     (<span style="color: #F0DFAF; font-weight: bold;">if</span> current-prefix-arg t)))
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (called-interactively-p)
      (<span style="color: #F0DFAF; font-weight: bold;">progn</span>
        (message <span style="color: #CC9393;">"buffer is named %S"</span> (<span style="color: #F0DFAF; font-weight: bold;">if</span> (bufferp buffer-or-name)
                                          (buffer-name buffer-or-name)
                                        buffer-or-name))
        (funcall-interactively (ad-get-orig-definition 'display-buffer)
                               buffer-or-name action frame))
    (<span style="color: #F0DFAF; font-weight: bold;">progn</span>
      (funcall-interactively (ad-get-orig-definition 'display-buffer)
                             buffer-or-name action frame)
      (funcall (ad-get-orig-definition 'display-buffer) buffer-or-name action frame))))
</pre>
</div></li>

<li><p>
æ–°å†™æ³• <code>advice-add</code> å’Œ <code>advice-remove</code>
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">after-display-buffer</span> (buffer-or-name <span style="color: #7CB8BB;">&amp;optional</span> action frame)
  (message <span style="color: #CC9393;">"buffer is named %S"</span> (<span style="color: #F0DFAF; font-weight: bold;">if</span> (bufferp buffer-or-name)
                                    (buffer-name buffer-or-name)
                                  (buffer-or-name))))
(advice-add 'display-buffer <span style="color: #DCDCCC; font-weight: bold;">:after</span> #'after-display-buffer)
(advice-remove 'display-buffer #'after-display-buffer)
</pre>
</div>

<p>
å¯¹äº <code>:around</code> ä½ç½®å¯ä»¥è¿™ä¹ˆå†™
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">around-display-buffer</span> (orig-fun buffer-or-name <span style="color: #7CB8BB;">&amp;optional</span> action frame)
  (<span style="color: #F0DFAF; font-weight: bold;">interactive</span> (list (read-buffer <span style="color: #CC9393;">"Display buffer: "</span> (other-buffer))
                     (<span style="color: #F0DFAF; font-weight: bold;">if</span> current-prefix-arg t)))
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (called-interactively-p)
      (<span style="color: #F0DFAF; font-weight: bold;">progn</span>
        (message <span style="color: #CC9393;">"buffer is named %S"</span> (<span style="color: #F0DFAF; font-weight: bold;">if</span> (bufferp buffer-or-name)
                                          (buffer-name buffer-or-name)
                                        buffer-or-name))
        (funcall-interactively orig-fun buffer-or-name action frame))
    (<span style="color: #F0DFAF; font-weight: bold;">progn</span>
      (message <span style="color: #CC9393;">"buffer is named %S"</span> (<span style="color: #F0DFAF; font-weight: bold;">if</span> (bufferp buffer-or-name)
                                        (buffer-name buffer-or-name)
                                      buffer-or-name))
      (funcall orig-fun buffer-or-name action frame))))
(advice-add 'display-buffer <span style="color: #DCDCCC; font-weight: bold;">:around</span> #'around-display-buffer)
</pre>
</div>

<p>
æ³¨æ„åˆ° <code>around-display-buffer</code> è·Ÿ <code>after-display-buffer</code> ç›¸æ¯”å¤šäº†ä¸€ä¸ª <code>orig-fun</code> äº†å—?
</p>

<p>
å®ƒè¡¨ç¤ºadvisedå‡½æ•°,æœ€åè¿˜è¦æ³¨æ„å‰©ä¸‹çš„å‚æ•°è¦ä¸advisedå‡½æ•°çš„å‚æ•°å…¼å®¹.
</p>

<p>
å…¶å®ƒä½ç½® <code>:before</code>, <code>:after</code> ,advisingå‡½æ•°çš„å‚æ•°æ ¼å¼ä¸èƒ½è¿™ä¹ˆå®šä¹‰,è¦æŠŠè¡¨ç¤ºadvisedå‡½æ•°çš„ <code>orig-fun</code> å»æ‰,å¦åˆ™å‚æ•°ä¼šé”™ä½.
</p>

<p>
<b>ä¸Šé¢çš„ä¾‹å­,ç‰¹åˆ«æ˜¯around-display-buffer,æœ€å¥½ä¸è¦ç”¨,å› ä¸ºä¸€æ—¦Emacsçš„display-bufferå‘ç”Ÿäº†æ”¹å˜å°±å¾ˆå¯èƒ½æŠ¥é”™äº†,æ€»çš„æ¥è¯´defadviceæ˜¯æŒºå±é™©çš„,ä¸å¤ªæ¨èä½¿ç”¨</b>
</p></li>
</ul></li>

<li>advisingé‚£äº›æŒæœ‰å‡½æ•°å€¼(function value)çš„è¿›ç¨‹(process filters)/å˜é‡(variables)/å¯¹è±¡(objects)

<ul class="org-ul">
<li><p>
<code>add-function</code> å’Œ <code>remove-function-</code>
</p>

<p>
æ¯”å¦‚å®šä¹‰ä¸€ä¸ªèµ‹å€¼äº†å‡½æ•°çš„å˜é‡ <code>my-func-var</code>,ç°åœ¨ç”¨ <code>my-tracing-function</code> åŒ…è£¹å®ƒ
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> my-func-var
      (<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (arg)
        (1+ arg)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">my-tracing-function</span> (orig-variable arg)
  (message (format <span style="color: #CC9393;">"Result is %S"</span> (funcall orig-variable arg))))

(<span style="color: #F0DFAF; font-weight: bold;">add-function</span> <span style="color: #DCDCCC; font-weight: bold;">:around</span> my-func-var #'my-tracing-function)
(funcall my-func-var 1)
(<span style="color: #F0DFAF; font-weight: bold;">remove-function</span> my-func-var #'my-tracing-function)
</pre>
</div>

<p>
å…¶ä»–ä½ç½®ä¹Ÿå¯ä»¥æ˜¯ä¸€æ ·çš„å‚æ•°æ ¼å¼, <code>:around</code> ä½ç½®æ˜¯å¿…é¡»è¿™ç§å‚æ•°æ ¼å¼,
</p>

<p>
å¦‚æœadvisedå˜é‡çš„æŒæœ‰å‡½æ•°éœ€è¦ä¸€ä¸ªå‚æ•°,é‚£ä¹ˆadvisingå‡½æ•°å°±è¦æœ‰ä¸¤ä¸ªå‚æ•°,
</p>

<p>
ç¬¬ä¸€ä¸ªè¡¨ç¤ºadvisedå˜é‡,å‰©ä¸‹çš„è¡¨ç¤ºadvisedå˜é‡çš„æŒæœ‰å‡½æ•°æ‰€éœ€è¦çš„å‚æ•°.
</p>

<p>
å…¶å®ƒä½ç½®å¦‚ <code>:before</code>, <code>:after</code> å¯ä»¥ä¸æŒ‰ç…§è¿™ç§å‚æ•°æ ¼å¼,åŒºåˆ«å°±æ˜¯æŠŠè¡¨ç¤ºadvisedå˜é‡çš„å‚æ•°å»æ‰å°±å¥½,
</p>

<p>
advisingå‡½æ•°çš„å‚æ•°è·Ÿadvisedå˜é‡çš„æŒæœ‰å‡½æ•°è¦æ±‚çš„å‚æ•°ä¸€æ ·å°±å¯ä»¥.
</p></li>
</ul></li>
</ul>
</div>
</div>



<div id="outline-container-org9813429" class="outline-4">
<h4 id="org9813429">åºŸå¼ƒå‡½æ•° (Obsolete Functions)</h4>
<div class="outline-text-4" id="text-org9813429">
<p>
å¯ä»¥æŠŠä¸€ä¸ªæœ‰åå­—çš„å‡½æ•°æ ‡è®°ä¸ºåºŸå¼ƒ(<code>obsolete</code>),è¡¨ç¤ºè¯¥å‡½æ•°å¯èƒ½ä¼šåœ¨å°†æ¥è¢«ç§»é™¤.å½“ç¼–è¯‘çš„ä»£ç åŒ…å«ä¸€ä¸ªåºŸå¼ƒçš„å‡½æ•°æ—¶å€™, <code>Emacs</code> ä¼šè­¦å‘Šè¯´è¯¥å‡½æ•°æ˜¯åºŸå¼ƒçš„.
</p>

<p>
é™¤æ­¤ä»¥å¤–åºŸå¼ƒå‡½æ•°ä¸ä¸€èˆ¬å‡½æ•°æ²¡æœ‰è¡Œä¸ºä¸Šçš„å·®åˆ«.
</p>

<p>
æŠŠä¸€ä¸ªå‡½æ•°æ ‡è®°ä¸ºåºŸå¼ƒçš„æœ€ç®€å•åšæ³•å°±æ˜¯åœ¨ä½¿ç”¨ <code>defun</code> å®šä¹‰å‡½æ•°çš„æ—¶å€™ä½¿ç”¨ <code>(declare obsolete ...)</code> <code>form</code>,è¿˜å¯ä»¥ä½¿ç”¨ <code>make-obsolete</code> å‡½æ•°æ¥è¿›è¡Œè®¾å®š.
</p>

<p>
è¿™é‡Œæœ‰ä¸€ä¸ª <code>set-advertised-calling-convention</code> çš„å‡½æ•°,å¯ä»¥ç»™å‡½æ•°æŒ‡å®š <code>signature</code>,ç›¸å½“äºæŒ‡å®šå‡½æ•°è°ƒç”¨æ—¶å€™éœ€è¦çš„å‚æ•°ç±»å‹,æœ‰ç‚¹åƒ <code>Racket</code> çš„ <code>Contract</code>.
</p>
</div>
</div>



<div id="outline-container-org1d7d84e" class="outline-4">
<h4 id="org1d7d84e">å†…è”å‡½æ•° (Inline Functions)</h4>
<div class="outline-text-4" id="text-org1d7d84e">
<p>
å†…è”å‡½æ•°çš„è¡Œä¸ºå’Œæ™®é€šå‡½æ•°ä¸€æ ·,å·®åˆ«åœ¨äºç¼–è¯‘æ—¶å€™è°ƒç”¨å‡½æ•°ä¼šä¸ä¸€æ ·,å†…è”å‡½æ•°ä¼šåƒå®ä¸€æ ·è¢«ç¼–è¯‘å™¨å¼ å¼€,é€šä¿—ç‚¹å°±æ˜¯å‡ºç°è°ƒç”¨å†…è”å‡½æ•°çš„åœ°æ–¹å°±ç”¨å†…è”å‡½æ•°çš„å®šä¹‰æ›¿æ¢, <code>defsubst</code> å¯ä»¥å®šä¹‰å†…è”å‡½æ•°,
</p>

<p>
å…§è”å‡½æ•°åœ¨ç¼–è¯‘æ—¶å€™è¢«è°ƒç”¨å‘ç”Ÿçš„äº‹æƒ…å¯ä»¥è¿™ä¹ˆç†è§£,
</p>


<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fake-inline-func</span> () (message <span style="color: #CC9393;">"hello"</span>)) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#36825;&#19981;&#26159;&#20869;&#32852;&#20989;&#25968;,&#21482;&#26159;&#29992;&#26469;&#28436;&#31034;,&#30495;&#27491;&#30340;&#20869;&#32852;&#20989;&#25968;&#35831;&#29992; =defsubst= &#25110;&#32773; =define-inline=</span>

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">caller</span> ()
  (fake-inline-func))

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#34987;&#32534;&#35793;&#21518;,&#19978;&#38754;&#30340;&#37096;&#20998;&#31561;&#20110;&#20197;&#19979;</span>

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">caller</span> ()
  (message <span style="color: #CC9393;">"hello"</span>))
</pre>
</div>

<p>
æ—¢æœ‰ä¼˜ç‚¹,ä¹Ÿæœ‰ç¼ºç‚¹,å‡å°‘è°ƒç”¨æ¬¡æ•°,æé«˜ç¨‹åºæ€§èƒ½,ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜æ˜¾,ç”±äºå±•å¼€æ˜¯å‘ç”Ÿåœ¨ç¼–è¯‘çš„,æ‰€ä»¥ä¸€æ—¦ç¼–è¯‘,ä¹‹åæ¯æ¬¡ä¿®æ”¹ç¨‹åºåéƒ½éœ€è¦é‡æ–°ç¼–è¯‘,å…¶æ¬¡å…§è”å‡½æ•°ä¸èƒ½æ˜¯ç”¨é€’å½’;
</p>

<p>
è¿˜æœ‰å°±æ˜¯å…§è”å‡½æ•°åªé€‚åˆå°è§„æ¨¡åŠŸèƒ½çš„å®ç°,å¦åˆ™å¤§é‡æ˜¯ç”¨å†…è”å‡½æ•°ä¼šå¤§ç¨‹åº¦åœ°ç¼–è¯‘æ–‡ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šå’Œå†…å­˜ä¸Šæ‰€éœ€è¦çš„ç©ºé—´,æœ€åä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ä¸æ–¹ä¾¿è°ƒè¯•.
</p>
</div>
</div>




<div id="outline-container-orgcac4fdb" class="outline-4">
<h4 id="orgcac4fdb">Declare Form</h4>
<div class="outline-text-4" id="text-orgcac4fdb">
<p>
åœ¨å‡½æ•°/å®çš„å®šä¹‰ä¸­(<code>defun/defsubst/defmacro</code>)ä½¿ç”¨,ç»™å‡½æ•°/å®è®¾å®šå…ƒå±æ€§. <code>declare</code> å®,å¦‚æœç”¨åœ¨å‡½æ•°å’Œå®ä¹‹å¤–,é‚£ä¹ˆå°±æ— è§†è‡ªå·±çš„å‡½æ•°å¹¶ä¸”è¿”å› <code>nil</code>,ä¸å½±å“è¿è¡Œæ—¶.
</p>

<p>
åªæœ‰ç”¨åœ¨å‡½æ•°/å®çš„å®šä¹‰ä¸­æ‰èƒ½å¤Ÿè®¾å®šå…ƒå±æ€§.
</p>
</div>
</div>




<div id="outline-container-org9844b9c" class="outline-4">
<h4 id="org9844b9c">å£°æ˜å‡½æ•° (Declaring Functions)</h4>
<div class="outline-text-4" id="text-org9844b9c">
<p>
ç¼–è¯‘ä¸€ä¸ªæ–‡ä»¶ç»å¸¸ä¼šäº§ç”Ÿä¸€äº›è­¦æŠ¥:ç¼–è¯‘å™¨ä¸çŸ¥åˆ°å‡½æ•°çš„å®šä¹‰.æœ‰æ—¶å€™ç¡®å®æœ‰è¿™ä¸ªé—®é¢˜,ä½†é€šå¸¸ä¸æ˜¯é—®é¢˜,è¿™ä¸ªä¸æ˜¯é—®é¢˜çš„è­¦å‘Šæ˜¯ç”±äºè¿è¡Œæ—¶æ‰ä¼šåŠ è½½çš„åœ¨åˆ«çš„æ–‡ä»¶ä¸­å®šä¹‰çš„å‡½æ•°.
</p>

<p>
æ¯”å¦‚ç¼–è¯‘ä¾èµ–äº† <code>shell-mode</code> çš„ <code>simple.el</code> æ—¶å€™, <code>shell-mode</code> åªèƒ½åœ¨æ‰§è¡Œ <code>(require 'shell)</code> ä¹‹åæ‰èƒ½è¢«è°ƒç”¨,æ‰€ä»¥ <code>shell-mode</code> ä¼šåœ¨è¿è¡Œæ—¶è¢«æ­£ç¡®å®šä¹‰,è¿™æ˜æ˜¾ä¸æ˜¯ä¸€ä¸ªé—®é¢˜.
</p>

<p>
æˆ‘ä»¬å¯ä»¥è®©ç¼–è¯‘å™¨ä¸å†è­¦å‘Šè¿™ä¸ªé—®é¢˜,åœ¨ç¬¬ä¸€æ¬¡æ˜¯ç”¨ <code>shell-mode</code> ä¹‹å‰æ‰§è¡Œä»¥ä¸‹ <code>form</code>,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">declare-function</span> shell-mode <span style="color: #CC9393;">"shell"</span> ()) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">or shell.,el for 2nd argument</span>
</pre>
</div>

<p>
è¿™æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ <code>shell-mode</code> è¢«å®šä¹‰åœ¨ <code>shell.el</code> ä¸­.ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ <code>shell-mode</code> çš„å‚æ•°åˆ—è¡¨,å¦‚æœæä¾›äº†è¯¥å‚æ•°,ç¼–è¯‘å™¨å°±ä¼šæ ¹æ®å‚æ•°åˆ—è¡¨æ£€æŸ¥ <code>shell-mode</code> çš„è°ƒç”¨ï¼›å¦‚æœæ˜¯ <code>t</code>,
</p>

<p>
é‚£ä¹ˆå°±æ˜¯æŒ‡ä¸æä¾›å‚æ•°åˆ—è¡¨,è€Œä¸æ˜¯ <code>nil</code>.
</p>

<p>
åœ¨å£°æ˜å,å¯ä»¥ç”¨ <code>check-declare-file</code> æˆ–è€… <code>check-declare-function</code> æ¥æ£€æµ‹ç‰¹å®šæ–‡ä»¶å’Œæ–‡ä»¶ç›®å½•ä¸­æ‰€æœ‰çš„ <code>declare-function</code> è¡¨è¾¾å¼,ç”¨æ­¤æ¥åˆ¤æ–­å‡½æ•°æ˜¯å¦çœŸçš„è¢«å®šä¹‰.
</p>

<p>
è¿™äº›å‘½ä»¤å®é™…ä¸Šéƒ½ç”¨äº† <code>locate-library</code> æ¥åšåˆ¤æ–­.
</p>
</div>
</div>



<div id="outline-container-orga0fa5d1" class="outline-4">
<h4 id="orga0fa5d1">å‡½æ•°å®‰å…¨ (Function Safety)</h4>
<div class="outline-text-4" id="text-orga0fa5d1">
<p>
æœ‰äº›å‡½æ•°å¯èƒ½ä¼šå®šä¹‰åœ¨ä¸€äº›ä¸å€¼å¾—ä¿¡ä»»/æ¥å†ä¸æ˜çš„æ–‡ä»¶ä¸­,ç›´æ¥è°ƒç”¨è¿™äº›å‡½æ•°å¯èƒ½ä¼šæœ‰é£é™©, <code>unsafep</code> ä¼šç®€å•åˆ†æ <code>form</code> æ˜¯å¦å®‰å…¨,
</p>

<p>
å¦‚æœå®‰å…¨å°±è¿”å› <code>nil</code>.
</p>
</div>
</div>



<div id="outline-container-org1a00a0b" class="outline-4">
<h4 id="org1a00a0b">ç›¸å…³è¯é¢˜ (Related Topics)</h4>
<div class="outline-text-4" id="text-org1a00a0b">
<p>
å’Œå‡½æ•°ç›¸å…³çš„ä¸€äº›æ–‡æ¡£,è‡ªå·±é˜…è¯».
</p>
</div>
</div>
</div>


<div id="outline-container-org89c85bb" class="outline-3">
<h3 id="org89c85bb">å® (Macros)</h3>
<div class="outline-text-3" id="text-org89c85bb">
<p>
åœ¨è¯­æ³•ä¸Šæ¥çœ‹å®å’Œå‡½æ•°çš„è°ƒç”¨æ˜¯ä¸€æ ·çš„, <b>å‡½æ•°çš„æœ¬è´¨æ˜¯ä¸€å¥—è®¡ç®—è§„åˆ™</b>,è°ƒç”¨å‡½æ•°å°±ä¼šæ ¹æ®å®šä¹‰è¿›è¡Œè®¡ç®—å¹¶ä¸”å¾—åˆ°ç»“æœ;
</p>

<p>
è€Œå®ä¸æ˜¯, <b>å®æ˜¯ä¸€ç§èƒ½å¤Ÿç”Ÿæˆä»£ç çš„åŠŸèƒ½</b>, è°ƒç”¨å®ä¼šå…ˆæ ¹æ®å®šä¹‰ç”Ÿæˆä»£ç ,ä¹Ÿå°±æ˜¯ <code>form</code>,ç”Ÿæˆçš„ä»£ç  <b>åœ¨ä¹‹å</b> ä¼šè¢«ç›´è¯‘å™¨æ‰§è¡Œå¾—åˆ°ç»“æœ.
</p>

<p>
å®è®¡ç®—å¹¶ä¸”ç”Ÿæˆä»£ç è¿™ä¸ªè¿‡ç¨‹å«åšå±•å¼€(expanding),ç”Ÿæˆçš„ä»£ç å«åšå±•å¼€å¼(expansion).
</p>

<p>
ä»£ç ç”Ÿæˆå®é™…ä¸Šå°±æ˜¯ç¼–è¯‘,ç¼–è¯‘å‘ç”Ÿçš„è¿‡ç¨‹å«åšç¼–è¯‘æ—¶(compile time),æ‰§è¡Œä»£ç çš„è¿‡ç¨‹å«åšè¿è¡Œæ—¶(runtime),
</p>

<p>
å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€çš„å®ç°éƒ½æ˜¯ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶æ˜¯ä¸¥æ ¼åˆ†å¼€çš„,ç¼–è¯‘å‹å®ç°éƒ½æ˜¯å…ˆç¼–è¯‘å®Œç„¶åå†æ ¹æ®ç¼–è¯‘ç»“æœæ‰§è¡Œ,
</p>

<p>
ä¸èƒ½ç¼–è¯‘åˆ°ä¸€åŠè¿›å…¥æ‰§è¡Œé˜¶æ®µæˆ–è€…è¿è¡Œåˆ°ä¸€åŠè¿›å…¥ç¼–è¯‘é˜¶æ®µ,ç”šè‡³æœ‰ä¸æ”¯æŒç¼–è¯‘çš„çº¯ç›´è¯‘å‹å®ç°.
</p>

<p>
æœ‰éƒ¨åˆ†è¯­è¨€ä¼šæ”¯æŒå®,æœ€å¸¸è§çš„å°±æ˜¯ <code>C/C++</code>,ä½†æ˜¯å’Œ <code>Lisp</code> çš„å®ä¸ä¸€æ ·,é€šå¸¸ <code>C/C++</code> éƒ½æ˜¯ç¼–è¯‘å‹å®ç°,å®ƒä»¬çš„å®åªèƒ½åœ¨ç¼–è¯‘æ—¶å±•å¼€,
</p>

<p>
è€Œ <code>Lisp</code> çš„å®å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«å±•å¼€,è¿™æ˜¯å› ä¸º <code>Lisp</code> çš„å®è¿™æ˜¯è¯­è¨€å±‚é¢ä¸Šå®šä¹‰çš„, <code>C/C++</code> è¯­è¨€å®šä¹‰ä¸­å°±æ²¡æœ‰å®è¿™ä¸œè¥¿,éƒ½æ˜¯ç¼–è¯‘å™¨æä¾›çš„.
</p>

<p>
å› æ­¤ <code>Lisp</code> çš„ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶å¯ä»¥äº¤é”™: åœ¨è¿è¡Œæ—¶ä¸­ç¼–è¯‘ä»£ç ,ç¼–è¯‘åå›åˆ°è¿è¡Œæ—¶æ‰§è¡Œä»£ç ,
</p>

<p>
å“ªæ€• <code>Lisp</code> çš„å®ç°ä¸æ˜¯ç¼–è¯‘å‹, <code>Lisp</code> ä¹Ÿèƒ½å¤Ÿæ”¯æŒç¼–è¯‘,å¹¶ä¸”è¿˜èƒ½åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ä¹‹é—´éšæ„åˆ‡æ¢.
</p>

<p>
ä¸è¿‡æ€»çš„æ¥è¯´,ä¸ç®¡æ˜¯ <code>Lisp</code> è¿˜æ˜¯ <code>C/C++</code> çš„å®,å®ƒä»¬éƒ½èƒ½å¤Ÿåšåˆ°å‡½æ•°åšä¸äº†çš„äº‹æƒ…: ä¸€å®šç¨‹åº¦ä¸Šå®šä¹‰æ–°è¯­æ³•.
</p>

<p>
ç»å¸¸æ‹¿æ¥å’Œå®æ¯”è¾ƒçš„æ¦‚å¿µéå†…è”å‡½æ•°è«å±äº†, <code>Emacs Lisp</code> æ”¯æŒç¼–è¯‘å’Œç›´è¯‘ä¸¤ç§æ¨¡å¼,ä¹Ÿæ”¯æŒå†…è”å‡½æ•°,
</p>

<p>
åœ¨ç¼–è¯‘æ¨¡å¼ä¸‹å†…è”å‡½æ•°å’Œå®çš„ä½œç”¨éå¸¸ç›¸ä¼¼çš„: ç”¨äºç”Ÿæˆä»£ç ;ä¸è¿‡å®ƒä»¬çš„å‡ºå‘ç‚¹æ˜¯ä¸ä¸€æ ·çš„,å› æ­¤å®ƒä»¬çœ‹ç€ç›¸ä¼¼å®é™…å·®äº†ä¸å°‘.
</p>

<p>
å®å¯ä»¥æ ¹æ®æƒ…å†µç”Ÿæˆä»£ç ,æ¯”å¦‚æ ¹æ®å˜é‡æ¥åˆ¤æ–­ç”Ÿæˆæ€ä¹ˆæ ·çš„ä»£ç ,å¹¶ä¸”ä¸ä¼šå¯¹å‚æ•°è¿›è¡Œè¿ç®—,è¿™äº›éƒ½æ˜¯å†…è”å‡½æ•°åšä¸åˆ°çš„,
</p>

<p>
å†…è”å‡½æ•°è®¾è®¡å‡ºæ¥ç›®çš„æ˜¯é€šè¿‡æŠŠå‡½æ•°çš„ä»£ç ç¼–è¯‘åˆ°éœ€è¦è°ƒç”¨å®ƒçš„ä»£ç ä¸­,å…å»äº†è¿è¡Œå‡½æ•°å‰å…ˆå¯»æ‰¾å‡½æ•°åœ°å€çš„è¿™ä¸ªè¿‡ç¨‹,
</p>

<p>
ä»è€Œæé«˜è°ƒç”¨å‡½æ•°çš„æ•ˆç‡,ä½†æ˜¯ç›¸åº”å¢åŠ äº†ç¼–è¯‘å·¥ä½œé‡,ä¸ºäº†ä¸è¦å¯¹ç¼–è¯‘é€ æˆå¤ªå¤§çš„å½±å“,å†…è”å‡½æ•°å› æ­¤åªé€‚åˆç”¨äºç®€å•çš„å‡½æ•°.
</p>
</div>


<div id="outline-container-orgcd4f6b1" class="outline-4">
<h4 id="orgcd4f6b1">å®ä¾‹å­ (Defining Macros)</h4>
<div class="outline-text-4" id="text-orgcd4f6b1">
<p>
<code>Lisp</code> æ˜¯æ”¯æŒåŒ¿åå®çš„,ä½†æ˜¯ <code>Emacs Lisp</code> å¹¶æ²¡æœ‰æ”¯æŒ,åªèƒ½ç”¨ <code>defmacro</code> å®å»å®šä¹‰å®: <code>(defmacro NAME ARGS [DOC] [DECLARE] BODY ...)</code>.
</p>

<p>
<code>Emacs Lisp</code> çš„å®å¯¹è±¡æ˜¯ä¸€ä¸ª <code>list</code>: <code>(macro lambda ARGS . BODY)</code>, è¿™ä¸ª <code>list</code> çš„ <code>CDR</code> æ˜¯ä¸€ä¸ª <code>lambda</code> è¡¨è¾¾å¼,
</p>

<p>
ä¹Ÿå°±æ˜¯è¯´å®å¯¹è±¡å‚¨å­˜åœ¨ <code>NAME</code> çš„ <code>function cell</code> é‡Œé¢,è¿™æ„å‘³ç€å®å¯¹è±¡çš„ <code>ARGS</code> æ˜¯å’Œå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€æ ·çš„.
</p>

<p>
(ç›¸æ¯”å…¶ä»– <code>Lisp</code> æ–¹è¨€ <code>Emacs Lisp</code> çš„å®å¯ä»¥è¯´æ˜¯éå¸¸ç®€å•äº†).
</p>

<p>
<br>
</p>

<p>
è¿™é‡Œå†™ä¸€ä¸ªè‡ªå·±çš„ <code>if</code>,å…·ä½“æ€è·¯å°±æ˜¯æŠŠ <code>myif</code> çš„è°ƒç”¨å±•å¼€æˆ <code>if</code> è¡¨è¾¾å¼,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">myif</span> (cond-expr if-branch else-branch)
  (list 'if cond-expr
        if-branch
        else-branch))
</pre>
</div>

<p>
å¦‚æœä½ æŠŠ <code>defmacro</code> æ¢æˆ <code>defun</code>,é‚£ä¹ˆä¸ç®¡æ˜¯ <code>if-branch</code> è¿˜æ˜¯ <code>else-branch</code> éƒ½ä¼šåœ¨ä¼ å…¥å‚æ•°çš„æ—¶å€™å¯¹å‚æ•°è¿›è¡Œè¿ç®—,
</p>

<p>
ä¸éœ€è¦é€šè¿‡ <code>cond-expr</code> çš„åˆ¤æ–­,è¿™ä¹ˆä¸€æ¥å°±ä¸æ˜¯å’Œ <code>if</code> åšä¸€æ ·çš„äº‹æƒ…äº†.
</p>

<p>
è¿˜å¯ä»¥ç”¨  æ¥å†™,ç›¸æ¯”ä¸Šé¢ç”¨ <code>list</code> æ„é€  <code>form</code>, ç”¨ <code>backquote</code> æ„é€  <code>form</code> ä¼šæ›´åŠ ç®€æ´,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">myif</span> (cond-expr if-branch else-branch)
  `(<span style="color: #F0DFAF; font-weight: bold;">if</span> ,cond-expr
       ,if-branch
     ,else-branch))
</pre>
</div>

<p>
å…·ä½“å…³äº <code>backquote</code> çš„å†…å®¹å¯ä»¥æŸ¥çœ‹ <code>M-: (info "(elisp) Backquote")</code>,
</p>

<p>
æœ€åå†æ¥å®šä¹‰ä¸€ä¸ªæ¥å—ä»»æ„å‚æ•°çš„å®,è¿™ç§å®çœ‹èµ·æ¥å°±åƒ <code>progn</code> çš„ç”¨æ³•ä¸€æ ·,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">test-macro</span> (<span style="color: #7CB8BB;">&amp;rest</span> body)
  `(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((a 1)
         (b 2))
     ,@body))

(test-macro
 (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((c (+ a b))
       (d (- b a)))
   (+ c d))))       <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; 4</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org5ff31ab" class="outline-4">
<h4 id="org5ff31ab">å®çš„å±•å¼€å¼ (Expansion)</h4>
<div class="outline-text-4" id="text-org5ff31ab">
<p>
å®çš„è°ƒç”¨å½¢å¼å’Œå‡½æ•°çš„è°ƒç”¨å½¢å¼éƒ½æ˜¯ä¸€ä¸ª <code>(NAME ARGS ...)</code> å½¢å¼çš„åˆ—è¡¨.
</p>

<p>
å› ä¸ºå±•å¼€å¼æ˜¯ä»¥æ­£å¸¸æ–¹å¼çš„è¿ç®—çš„,å¹¶ä¸”å±•å¼€å¼ <b>å¯èƒ½</b> ä¼šåŒ…å«å…¶å®ƒçš„å®è°ƒç”¨,æ‰€ä»¥å®ä¹Ÿæ˜¯å’Œå‡½æ•°ä¸€æ ·æ”¯æŒé€’å½’çš„.
</p>

<p>
<code>Emacs</code> åœ¨åŠ è½½æœªç¼–è¯‘çš„ <code>Lisp</code> æ–‡ä»¶ä¼šå…ˆå°è¯•å±•å¼€é‡Œé¢çš„å®,å¦‚æœæˆåŠŸ,é‚£ä¹ˆå°±å¯ä»¥æé«˜åç»­çš„æ‰§è¡Œé€Ÿåº¦.
</p>

<p>
å’Œå¤§éƒ¨ä»½ <code>Lisp</code> æ–¹è¨€ä¸€æ ·, <code>Emacs Lisp</code> ä¹Ÿæä¾›æ£€æŸ¥å®å±•å¼€å¼çš„å‡½æ•°: <code>macroexpand</code>, <code>macroexpand-all</code> ä»¥åŠ <code>macroexpand-1</code>.
</p>

<p>
æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">prefixed-setq</span> (name value)
  `(set (intern (format <span style="color: #CC9393;">"prefixed-%s"</span> (symbol-name (<span style="color: #F0DFAF; font-weight: bold;">quote</span> ,name)))) ,value))

(prefixed-setq var 1)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(macroexpand-1 '(prefixed-setq var 1)) =&gt; (set (intern (format "prefixed-%s" (symbol-name (quote var)))) 1)</span>
(+ prefixed-var 1)
</pre>
</div>
</div>
</div>


<div id="outline-container-org3d3e0ec" class="outline-4">
<h4 id="org3d3e0ec">å®å’Œç¼–è¯‘ (Compiling Macros)</h4>
<div class="outline-text-4" id="text-org3d3e0ec">
<p>
å½“å®è°ƒç”¨å‡ºç°åœ¨ç¼–è¯‘æ—¶ä¸­, <code>Lisp</code> ç¼–è¯‘å™¨ä¼šåƒ <code>Lisp</code> è§£æå™¨é‚£æ ·è°ƒç”¨å®,ç„¶åå¾—åˆ°ä¸€ä¸ªå±•å¼€å¼.
</p>

<p>
ç”±äºå®è°ƒç”¨æ˜¯å‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µ,å±•å¼€å¼åå¹¶ä¸ä¼šè¢«æ‰§è¡Œ,å› ä¸ºè¿™æ˜¯ç›´è¯‘å™¨çš„å·¥ä½œ.
</p>

<p>
ç¼–è¯‘å™¨æŠŠå±•å¼€å¼ç¼–è¯‘åˆ°ç¨‹åºä¸­,å°±å¥½åƒæ˜¯ç›´æ¥åµŒå…¥åˆ°ç¨‹åºé‡Œé¢ä¸€æ ·.
</p>

<p>
å®å±•å¼€çš„æ—¶å€™ä¼šè¿›è¡Œä¸€å®šç¨‹åº¦çš„è¿ç®—,è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šäº§ç”Ÿè¿ç®—çš„å€¼ä»¥åŠå‰¯ä½œç”¨,
</p>

<p>
ç„¶è€Œè¿™äº›äº§ç”Ÿçš„ç»“æœå¹¶ä¸ä¼šå‡ºç°åœ¨è¿è¡Œæ—¶ä¸­,åªä¼šåœ¨å‡ºç°åœ¨ç¼–è¯‘é˜¶æ®µ,å› ä¸ºè¿™äº›ä¸œè¥¿æ²¡æœ‰è¢«ç¼–è¯‘è¿›å».
</p>

<p>
å¯¹äºé‚£äº›æœ¬ä»¥äº§ç”Ÿå‰¯ä½œç”¨ä¸ºç›®çš„çš„å®æ¥è¯´å¹¶ä¸æ˜¯ä»€ä¹ˆå¥½äº‹,æ¯”å¦‚
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">myif</span> (cond-expr if-branch else-branch)
  (message <span style="color: #CC9393;">"Some imporant side effects just like me"</span>)
  (list 'if cond-expr
        if-branch
        else-branch))
</pre>
</div>

<p>
ç¼–è¯‘åå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">if</span> cond-expr if-branch else-branch)
</pre>
</div>

<p>
å®é™…ä¸Šé€šå¸¸å‰¯ä½œç”¨éƒ½æ˜¯ç”¨äºæ§åˆ¶å®çš„å±•å¼€è¡Œä¸ºçš„,æ¯”å¦‚ä¸‹é¢è¿™ä¸ªåœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šè¿›è¡Œä¸åŒçš„å±•å¼€,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">myif-mod</span> (cond-expr if-branch else-branch)
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (eq system-type 'windows-nt)
      (list 'or (list 'and cond-expr if-branch)
            else-branch)
    (list 'if cond-expr
          if-branch
          else-branch)))
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#22312; Windows &#19978;&#32534;&#35793;&#24471;&#21040; form &#21482;&#20250;&#20026;: (or (and cond-expr if-branch) else-branch),</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#22312;&#20854;&#23427;&#31995;&#32479;&#19978;&#32534;&#35793;&#24471;&#21040;&#30340; form &#21482;&#20250;&#20026;: (if cond-expr if-branch else-branch)</span>
</pre>
</div>

<p>
<br>
</p>

<p>
ä¸ºäº†ä¿è¯å®è°ƒç”¨é€šè¿‡ç¼–è¯‘,ç¼–è¯‘å™¨è¦æ±‚ <code>macro</code> åœ¨è°ƒç”¨å‰å®šä¹‰å¥½.å¯¹äºè¿™ä¸ªé—®é¢˜,ç¼–è¯‘å™¨æœ‰ä¸€ä¸ªç‰¹æ€§åšå‡ºè¿™æ ·çš„å¤„ç†:
</p>

<p>
å¦‚æœåœ¨ç¼–è¯‘æ–‡ä»¶æ—¶å€™å‘ç°äº† <code>defmacro form</code>,é‚£ä¹ˆå®å°±ä¼šè¢«è¿›è¡Œä¸´æ—¶å®šä¹‰,åœ¨å¯¹æ–‡ä»¶çš„å‰©ä½™éƒ¨åˆ†è¿›è¡Œç¼–è¯‘çš„è¿‡ç¨‹ä¸­éƒ½èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªå®çš„å®šä¹‰.
</p>

<p>
ç¼–è¯‘æ–‡ä»¶æ—¶ä¼šåœ¨æ–‡ä»¶çš„ <code>top-level</code> æ‰§è¡Œä»»ä½•æ¬¡æ•°çš„ <code>require</code> è°ƒç”¨,ä¹Ÿå¯ä»¥ç”¨è¿™æ¥ç¡®ä¿æ‰€éœ€çš„å®å®šä¹‰åœ¨ç¼–è¯‘æ—¶å€™å¯ç”¨.
</p>

<p>
è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜, <code>require</code> è°ƒç”¨ä¹Ÿä¼šè¢«ç¼–è¯‘åˆ°ç”Ÿæˆçš„ä»£ç ä¸­,åœ¨è¿è¡Œç”Ÿæˆçš„ä»£ç æ—¶ä¼šåŠ è½½å®çš„å®šä¹‰,
</p>

<p>
ç„¶è€Œå¯¹äºç¼–è¯‘å¾—åˆ°çš„ç¨‹åºæ¥è¯´æ˜¯æ²¡å¿…è¦çš„, <code>Emacs Lisp</code> æä¾› <code>eval-when-compile</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">eval-when-compile</span>
  (<span style="color: #F0DFAF; font-weight: bold;">require</span> '<span style="color: #BFEBBF;">macro-definition</span>))
</pre>
</div>

<p>
è¿™æ · <code>require</code> è°ƒç”¨å°±èƒ½æ—¢å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œ,ä¹Ÿå¯ä»¥åœ¨ç›´è¯‘é˜¶æ®µä¸‹è¿è¡Œ,å¹¶ä¸”åœ¨ç¼–è¯‘é˜¶æ®µä¸­ä¸ä¼šè¢«ç¼–è¯‘è¿›ç”Ÿæˆä»£ç ä¸­.
</p>
</div>
</div>

<div id="outline-container-org70bd379" class="outline-4">
<h4 id="org70bd379">å®çš„é—®é¢˜ (Problems With Macros)</h4>
<div class="outline-text-4" id="text-org70bd379">
<p>
<code>Lisp</code> çš„å®ç®—æ˜¯è¯­è¨€ç‰¹è‰²äº†,è™½ç„¶è¯´ <code>C</code> ä¹Ÿæ”¯æŒå®,ä½†åè€…åœ¨èƒ½åŠ›ä¸Šèµ· <code>Lisp</code> çš„ç›¸å·®å¤ªè¿œ,åŒæ—¶ <code>Lisp</code> çš„å®ä¹Ÿæ›´å¤æ‚.
</p>

<p>
æ‰€ä»¥ä¸€ä¸ªä¸ç•™ç¥å°±å®¹æ˜“å‡ºç°ä¸€äº›é—®é¢˜.
</p>
</div>

<ul class="org-ul">
<li><a id="orga5180a9"></a>æ—¶æœºé”™è¯¯ (Wrong Time)<br>
<div class="outline-text-5" id="text-orga5180a9">
<p>
è¿™æ˜¯æœ€å¸¸è§çš„é—®é¢˜ä¹‹ä¸€: åœ¨å±•å¼€å®çš„æ—¶å€™å¤„ç†æƒ³è¦å®Œæˆäº‹æƒ…,è€Œä¸æ˜¯åœ¨å±•å¼€å¼æœ¬èº«è¿›è¡Œå¤„ç†.
</p>

<p>
å‡è®¾æœ‰ä¸€ä¸ªå®æƒ³è¦è®¾ç½®ç¼“å†²åŒºä¸º <code>multibyte</code> ç¼“å†²åŒº,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">my-set-buffer-multibyte</span> (arg)
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (fboundp 'set-buffer-multibyte)
      (set-buffer-multibyte arg)))
</pre>
</div>

<p>
åœ¨ç›´è¯‘æ¨¡å¼ä¸‹è¿™ä¸ªå®æ˜¯èƒ½å¤Ÿæ­£ç¡®å®Œæˆä»»åŠ¡çš„,ç„¶ååœ¨ç¼–è¯‘åæ˜¯ä¸è¡Œçš„,ç†ç”±å¯ä»¥å‚è€ƒä¸Šé¢çš„ <b>å®å’Œç¼–è¯‘</b>.
</p>

<p>
æ­£ç¡®çš„åšæ³•æ˜¯,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">my-set-buffer-multibyte</span> (arg)
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (fboundp 'set-buffer-multibyte)
      `(set-buffer-multibyte ,arg)))
</pre>
</div>
</div>
</li>


<li><a id="orgc6d4223"></a>é‡å¤è¿ç®—å®çš„å‚æ•° (Argument Evaluation)<br>
<div class="outline-text-5" id="text-orgc6d4223">
<p>
å®šä¹‰å®çš„æ—¶å€™éœ€è¦æ³¨æ„è¿è¡Œå±•å¼€å¼çš„æ—¶å€™å‚æ•°çš„è¿ç®—æ¬¡æ•°.
</p>

<p>
æ¯”å¦‚å®šä¹‰ä¸€ä¸ª <code>for</code> å¾ªç¯ç»“æ„,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">for</span> (var from init to final do <span style="color: #7CB8BB;">&amp;rest</span> body)
  <span style="color: #9FC59F;">"Execute a simple \"for\" loop.</span>
<span style="color: #9FC59F;">     For example, (for i from 1 to 10 do (print i))."</span>
  (list 'let (list (list var init))
        (cons 'while
              (cons (list '&lt;= var final)
                    (append body (list (list 'setq var (list '1+ var)))))))))
</pre>
</div>

<p>
å®ƒçš„ <code>backquote</code> ç‰ˆæœ¬å¦‚ä¸‹,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">for</span> (var from init to final do <span style="color: #7CB8BB;">&amp;rest</span> body)
  `(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((,var ,init))
     (<span style="color: #F0DFAF; font-weight: bold;">while</span> (&lt;= ,var ,final)
       ,@body
       (<span style="color: #F0DFAF; font-weight: bold;">setq</span> ,var (1+ ,var)))))
</pre>
</div>

<p>
ä¸‹é¢æ˜¯å®ƒçš„ä¸€ä¸ªè°ƒç”¨çš„å±•å¼€å¼,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(for i from 1 to 3 do
     (<span style="color: #F0DFAF; font-weight: bold;">setq</span> square (* i i))
     (princ (format <span style="color: #CC9393;">"\n%d %d"</span> i square)))
&#8614;
(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((i 1))
  (<span style="color: #F0DFAF; font-weight: bold;">while</span> (&lt;= i 3)
    (<span style="color: #F0DFAF; font-weight: bold;">setq</span> square (* i i))
    (princ (format <span style="color: #CC9393;">"\n%d %d"</span> i square))
    (<span style="color: #F0DFAF; font-weight: bold;">setq</span> var (1+ var))))

&#8867;1       1
&#8867;2       4
&#8867;3       9
&#8658; nil
</pre>
</div>

<p>
<code>from</code>, <code>to</code> ä»¥åŠ <code>do</code> å°±æ˜¯è¯­æ³•ç³–(<code>syntactic sugar</code>),å¯ä»¥æ— è§†å®ƒä»¬.
</p>

<p>
è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜,åœ¨æ¯ä¸€è½®è¿­ä»£ä¸­,å‚æ•° <code>final</code> éƒ½ä¼šè¿›è¡Œè¿ç®—,
</p>

<p>
å¦‚æœ <code>final</code> æ˜¯å¸¸é‡çš„è¯æ²¡æœ‰é—®é¢˜;
</p>

<p>
å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„ <code>form</code>, æ¯”å¦‚ä¸€ä¸ªè€—æ—¶çš„å‡½æ•°è°ƒç”¨,é‚£ä¹ˆè¿™ä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜,
</p>

<p>
å¹¶ä¸”å¦‚æœ <code>final</code> å­˜åœ¨å‰¯ä½œç”¨,å¤šæ¬¡æ‰§è¡Œå¯èƒ½ç…§æˆä¸€äº›æ„æƒ³ä¸åˆ°çš„ç»“æœ.
</p>

<p>
æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯æŠŠ <code>final</code> çš„è®¡ç®—æ”¾åˆ°å¾ªç¯ä¹‹å¤–,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">for</span> (var from init to final do <span style="color: #7CB8BB;">&amp;rest</span> body)
  `(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((,var ,init)
         (max ,final))
     (<span style="color: #F0DFAF; font-weight: bold;">while</span> (&lt;= ,var max)
       ,@body
       (<span style="color: #F0DFAF; font-weight: bold;">setq</span> ,var (1+ ,var)))))
</pre>
</div>

<p>
ä¸è¿‡è¿™æ ·ä¼šå¼•å…¥å¦å¤–ä¸€ä¸ªé—®é¢˜,ä¸‹ä¸ªå°èŠ‚æ¥ç€è®¨è®ºå®ƒ.
</p>
</div>
</li>


<li><a id="orgbca455d"></a>å±•å¼€å¼çš„å±€éƒ¨å˜é‡è¦†ç›–ç”¨æˆ·å®šä¹‰çš„å˜é‡ (Surprising Local Vars)<br>
<div class="outline-text-5" id="text-orgbca455d">
<p>
ä¸Šä¸€ä¸ªç« èŠ‚è¯´çš„å¼•å…¥çš„é—®é¢˜æ˜¯å¼•å…¥äº†æ–°çš„å˜é‡ <code>max</code>,å¦‚æœä½¿ç”¨è¯¥å®çš„æ—¶å€™ç”¨æˆ·ä¹Ÿå®šä¹‰äº†ä¸€ä¸ª <code>max</code> çš„å˜é‡,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((max 0))
  (for x from 0 to 10 do
       (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((this (frob x)))
         (<span style="color: #F0DFAF; font-weight: bold;">if</span> (&lt; max this)
             (<span style="color: #F0DFAF; font-weight: bold;">setq</span> max this)))))
</pre>
</div>

<p>
é€šè¿‡è§‚å¯Ÿè¿™ä¸ª <code>form</code> çš„å±•å¼€å¼å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„ <code>max</code> è¢« <code>for</code> å®é‡Œé¢çš„ <code>max</code> é®æ©äº†,å› æ­¤ç”¨æˆ·å®šä¹‰çš„ <code>max</code> å°±æ²¡ç”¨äº†.
</p>

<p>
è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒåœ¨äºå¦‚ä½•é¿å…ä¸´æ—¶å®çš„å˜é‡ <code>max</code> ä¸ä¼šå’Œç”¨æˆ·çš„å˜é‡å‘ç”Ÿå†²çª,æ­£å¥½ <code>Lisp</code> æœ‰ <code>uninterned symbol</code>,
</p>

<p>
è¿™ç§ <code>symbol</code> å¯ä»¥è¢«ç»‘å®šä»¥åŠè¢«å¼•ç”¨,å¹¶ä¸”ä¸ä¼šå’Œä»»ä½•å…¶å®ƒçš„ <code>symbol</code> å‘ç”Ÿå†²çª,å“ªæ€•æ˜¯åŒåçš„ <code>symbol</code>,
</p>

<p>
å¦‚æœä¸è¿›è¡Œç»‘å®šçš„è¯,è¿™ç§ <code>symbol</code> å°±æ²¡æ³•å¼•ç”¨äº†.
</p>

<p>
å¯ä»¥åˆ©ç”¨è¿™ç‰¹æ€§æ¥è§£å†³ä¸Šé¢çš„é—®é¢˜,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">for</span> (var from init to final do <span style="color: #7CB8BB;">&amp;rest</span> body)
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((tempvar (make-symbol <span style="color: #CC9393;">"max"</span>)))
    `(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((,var ,init)
           (,tempvar ,final))
       (<span style="color: #F0DFAF; font-weight: bold;">while</span> (&lt;= ,var ,tempvar)
         ,@body
         (<span style="color: #F0DFAF; font-weight: bold;">setq</span> ,var (1+ ,var))))))
</pre>
</div>

<p>
<code>uninterned symbol</code> <code>max</code> (make-symbol ç”Ÿæˆçš„ <code>max</code>) ä¸ä¼šå’Œ <code>interned symbol</code> <code>max</code> (ç”¨æˆ·å®šä¹‰çš„ <code>max</code>) å‘ç”Ÿå†²çª.
</p>
</div>
</li>


<li><a id="org8421da0"></a>å±•å¼€æ—¶è¿ç®—å‚æ•° (Eval During Expansion)<br>
<div class="outline-text-5" id="text-org8421da0">
<p>
<b>PS: æ ‡é¢˜æ˜¯ "Eval During Expansion", During è¯´æ˜äº† Expansion</b>
</p>

<p>
å¦å¤–ä¸€ä¸ªé—®é¢˜,å°±æ˜¯ä¸è¦åœ¨å±•å¼€æ—¶é€šè¿‡è°ƒç”¨ <code>eval</code> è¿™æ ·çš„æ–¹å¼å»å¯¹å‚æ•°(arguments)è¿›è¡Œè¿ç®—,
</p>

<p>
å› ä¸ºä¸€æ—¦ç”¨æˆ·ä¼ å…¥çš„å˜é‡åå­—å’Œå‚æ•°åå­—ä¸€æ ·å°±ä¼šå‡ºç°é—®é¢˜,
</p>

<p>
æ¯”å¦‚ä¸‹é¢è¦å¼•ç”¨ <b>ç”¨æˆ·ä¼ å…¥çš„å˜é‡</b> æ‰€æŒ‡å‘çš„ <b>å˜é‡</b>,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">foo</span> (a)
  (list 'setq (eval a) t))

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> x 'b)

(foo x)  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-&gt; (setq b t)</span>

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> a 'c)

(foo a) <span style="color: #5F7F5F;">;;</span><span style="color: #7F9F7F;">-&gt; (setq a t), &#36825;&#26159;&#22240;&#20026;&#29992;&#25143;&#20256;&#20837;&#30340;&#21442;&#25968;&#21644;&#23439;&#23450;&#20041;&#30340;&#21442;&#25968;&#21457;&#29983;&#20914;&#31361;&#20102;</span>
</pre>
</div>

<p>
å› æ­¤å®šä¹‰çš„å®æœ€å¥½ <b>åˆ«</b> åœ¨å±•å¼€è¿‡ç¨‹ä¸­è¿ç®—å‚æ•°.
</p>
</div>
</li>


<li><a id="org0412e37"></a>é‡å¤å±•å¼€ (Repeated Expansion)<br>
<div class="outline-text-5" id="text-org0412e37">
<p>
å¦‚æœåœ¨ç›´è¯‘å‡½æ•°é‡Œé¢æ‰§è¡Œå®è°ƒç”¨,é‚£ä¹ˆæ¯æ¬¡è°ƒç”¨éƒ½ä¼šå±•å¼€;å¯¹äºç¼–è¯‘å‡½æ•°,é‚£ä¹ˆå®è°ƒç”¨åªä¼šåœ¨ç¼–è¯‘æ—¶å±•å¼€ä¸€æ¬¡,ä¹‹åç¼–è¯‘å‡½æ•°åªä¼šè°ƒç”¨ç¼–è¯‘å¥½çš„å±•å¼€å¼.
</p>

<p>
å› ä¸ºè¿™ä¸ªåŸå› ,å¦‚æœå®çš„å®šä¹‰æœ‰å‰¯ä½œç”¨,é‚£ä¹ˆå®è°ƒç”¨çš„æ¬¡æ•°ä¸åŒå°±æœ‰å¯èƒ½ä¼šäº§ç”Ÿä¸åŒç»“æœ,ç›´è¯‘å‡½æ•°æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨,è€Œç¼–è¯‘å‡½æ•°åªæœ‰ç¼–è¯‘çš„æ—¶å€™æ‰ä¼šäº§ç”Ÿå‰¯ä½œç”¨.
</p>

<p>
å› æ­¤å°½é‡ä¸è¦åœ¨å®å±•å¼€çš„æ—¶å€™ä½¿ç”¨å‰¯ä½œç”¨(å¯ä»¥åœ¨å±•å¼€å¼ä¸­ä½¿ç”¨),æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">my-message</span> (msg)
  `(message msg))

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">NOT THIS</span>
(<span style="color: #F0DFAF; font-weight: bold;">defmacro</span> <span style="color: #93E0E3;">wrong-message</span> (msg)
  (message msg))
</pre>
</div>

<p>
åªæœ‰ä¸€ç§å‰¯ä½œç”¨ä¸èƒ½é¿å…: æ„å»º <code>Lisp</code> å¯¹è±¡.è¿™æ˜¯å¤§éƒ¨ä»½å®çš„é‡ç‚¹,è¿™æ˜¯æ²¡é—®é¢˜çš„,åªæœ‰ä¸€ç§æƒ…å†µéœ€è¦æ³¨æ„:
</p>

<p>
æ„å»ºçš„å¯¹è±¡æ˜¯å®å±•å¼€å¼çš„ä¸€ä¸ªè¢«å¼•ç”¨å¸¸é‡(<code>quoted constant</code>)çš„ä¸€éƒ¨åˆ†.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-orgc669422" class="outline-4">
<h4 id="orgc669422">ç¼©è¿›å® (Indenting Macros)</h4>
<div class="outline-text-4" id="text-orgc669422">
<p>
åœ¨å®çš„å®šä¹‰ä¸­,å¯ä»¥ä½¿ç”¨ <code>declare</code> æŒ‡å®šå®ä½¿ç”¨å¤šå°‘ä¸ª <code>&lt;TAB&gt;</code>: <code>(declare (indent INDENT-SPEC))</code>.
</p>
</div>
</div>
</div>


<div id="outline-container-org19f06ca" class="outline-3">
<h3 id="org19f06ca">ä¸ªæ€§åŒ– (Customization)</h3>
<div class="outline-text-3" id="text-org19f06ca">
<p>
<code>Emacs</code> ç”¨æˆ·å¯ä»¥åœ¨ä¸ç¼–å†™ <code>Lisp</code> ä»£ç çš„æƒ…å†µä¸‹é€šè¿‡è‡ªå®šä¹‰ç•Œé¢æ¥è‡ªå®šä¹‰å˜é‡å’Œå¤–è§‚(<code>face</code>),è¯¦æƒ…é˜…è¯» <code>M-: (info "(Emacs)Easy Customization")</code>
</p>

<p>
å¯è‡ªå®šä¹‰çš„é¡¹åŒ…æ‹¬å¯è‡ªå®šä¹‰å˜é‡(ä½¿ç”¨ <code>defcustom</code> å®å®šä¹‰);å¯è‡ªå®šä¹‰å¤–è§‚(ä½¿ç”¨ <code>defface</code> å®šä¹‰)å’Œå¯è‡ªå®šä¹‰ç»„(ç”¨ <code>defgroup</code> å®šä¹‰å¾—åˆ°ä¸€ç»„ç›¸å…³çš„å¯è‡ªå®šä¹‰é¡¹).
</p>
</div>
</div>


<div id="outline-container-org024056f" class="outline-3">
<h3 id="org024056f">åŠ è½½ (Loading)</h3>
<div class="outline-text-3" id="text-org024056f">
<p>
åŠ è½½ <code>Lisp</code> ä»£ç æ–‡ä»¶æ„å‘³ç€æŠŠæ–‡ä»¶å†…å®¹ä»¥ <code>Lisp</code> å¯¹è±¡çš„å½¢å¼å¸¦å…¥åˆ° <code>Lisp</code> ç¯å¢ƒä¸­.
</p>

<p>
<code>Emacs</code> æŸ¥æ‰¾å¹¶ä¸”æ‰“å¼€æ–‡ä»¶,è¯»å–æ–‡æœ¬ç„¶åè¿ç®—æ¯ä¸ª <code>form</code>,æœ€åå…³é—­æ–‡ä»¶,è¿™ä¸ªæ–‡ä»¶ä¹Ÿå¯ä»¥ç§°ä½œä¸€ä¸ª <code>Lisp</code> åº“.
</p>

<p>
åŠ è½½æ–‡ä»¶çš„å‡½æ•°ä¼šè¿ç®—æ–‡ä»¶ä¸­æ‰€æœ‰çš„è¡¨è¾¾å¼,å°±åƒ <code>eval-buffer</code> è¿ç®— <code>buffer</code> é‡Œé¢çš„æ‰€æœ‰è¡¨è¾¾å¼ä¸€æ ·.
</p>

<p>
è¢«åŠ è½½çš„æ–‡ä»¶å¿…é¡»åŒ…å« <code>Lisp</code> è¡¨è¾¾å¼,ä¸ç®¡æ–‡ä»¶æ˜¯æºä»£ç è¿˜æ˜¯å­—èŠ‚ç å½¢å¼.æ–‡ä»¶ä¸­æ¯ä¸ª <code>form</code> è¢«å«ä½œä¸€ä¸ª <code>top-level form</code>.
</p>

<p>
å·²ç»åŠ è½½æ–‡ä»¶çš„ <code>forms</code> å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ ¼å¼,ä»»ä½• <code>forms</code> éƒ½å¯ä»¥ç›´æ¥è¾“å…¥åˆ° ç¼“å†²åŒº ä¸­å¹¶ä¸”è¿è¡Œå®ƒä»¬.
</p>

<p>
<code>Emacs</code> ä¹Ÿå¯ä»¥åŠ è½½å·²ç»ç¼–è¯‘å¥½çš„åŠ¨æ€æ¨¡å—:å…±äº«åº“(shared libraries),é€šå¸¸ç”± <code>C/C++</code> ç¼–å†™,åœ¨åŠ¨æ€æ¨¡å—è¢«åŠ è½½æ—¶,
</p>

<p>
<code>Emacs</code> ä¼šè°ƒç”¨ä¸€ä¸ªç‰¹åˆ«å‘½åçš„åˆå§‹åŒ–å‡½æ•°,è¿™ä¸ªå‡½æ•°éœ€è¦æ¨¡å—è‡ªå·±å®ç°,è¯¥å‡½æ•°çš„å·¥ä½œå°±æ˜¯æŠŠå‡½æ•°ä»¥åŠå˜é‡æš´éœ²ç»™ <code>Emacs Lisp</code> ç¨‹åº.
</p>

<p>
å…³äºç¼–å†™åŠ¨æ€æ¨¡å—å¯ä»¥é˜…è¯»è¿™é‡Œ: <code>(info "(elisp) Writing Dynamic Modules")</code>.
</p>
</div>

<div id="outline-container-org2a8d42e" class="outline-4">
<h4 id="org2a8d42e">ç¨‹åºçš„åŠ è½½è¿‡ç¨‹ (How Programs Do Loading)</h4>
<div class="outline-text-4" id="text-org2a8d42e">
<p>
<code>Emacs Lisp</code> æœ‰å‡ ä¸ªç”¨äºåŠ è½½çš„æ¥å£,ä¸è¿‡æ‰€æœ‰æ¥å£æœ€åéƒ½æ˜¯è°ƒç”¨ <code>load</code> å‡½æ•°æ¥åŠ è½½æ–‡ä»¶,å› æ­¤,è¿™é‡Œåªäº†è§£ <code>load</code> å°±å¯ä»¥.
</p>

<p>
å‡è®¾ç°åœ¨æ‰§è¡Œä¸€ä¸ªè¡¨è¾¾å¼ <code>(load "FILENAME")</code>,é‚£ä¹ˆå°±ä¼šæŒ‰ç…§ä»¥ä¸‹ç¨‹åºæ‰§è¡Œ:
</p>

<ol class="org-ol">
<li><p>
å…ˆæŸ¥æ‰¾ <code>FILENAME.elc</code>, <code>.elc</code> æ–‡ä»¶æ ¼å¼æ˜¯ <code>.el</code> æ–‡ä»¶çš„å­—èŠ‚ç ç¼–è¯‘æ ¼å¼,
</p>

<p>
å¦‚æœæ‰¾åˆ°å°±æ‰“å¼€å¹¶ä¸”è¯»å–æ–‡ä»¶å†…å®¹,ç„¶åè¿ç®—,æœ€åå…³é—­æ–‡ä»¶,ç„¶åè¿”å› <code>t</code> è¡¨ç¤ºåŠ è½½å®Œæ¯•,
</p>

<p>
å¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥;
</p></li>

<li>å¦‚æœç¼–è¯‘æ–‡ä»¶ä¸å­˜åœ¨å°±å°è¯•æŸ¥æ‰¾ <code>FIELNAME.el</code>,å¦‚æœæ‰¾åˆ°å°±åŠ è½½,å¦è€…è¿›è¡Œä¸‹ä¸€æ­¥;</li>

<li><p>
å¦‚æœç¼–è¯‘çš„ <code>Emacs</code> æ”¯æŒåŠ è½½åŠ¨æ€æ¨¡å°±å°è¯•æŸ¥æ‰¾ <code>FILENAME.EXT</code>, <code>EXT</code> è¡¨ç¤ºåŠ¨æ€æ¨¡å—çš„åç¼€,ä¸åŒçš„ç³»ç»Ÿåç¼€ä¸ä¸€æ ·.
</p>

<p>
å¦‚æœæ‰¾åˆ°åå°±åŠ è½½,å¦‚æœæ²¡æœ‰æ‰¾åˆ°æˆ–è€… <code>Emacs</code> ä¸æ”¯æŒåŠ è½½åŠ¨æ€æ¨¡å—,é‚£ä¹ˆå°±è¿›è¡Œä¸‹ä¸€æ­¥;
</p></li>

<li><p>
å…¶å®å‰ 3 æ­¥æ˜¯ç”± <code>load-suffixes</code> å˜é‡å†³å®šçš„, <code>load-suffixes</code> è®°å½•äº†æ–‡ä»¶åç¼€,å‰é¢çš„æŸ¥æ‰¾é¡ºåºå°±æ ¹æ®è¿™ä¸ªæ‰§è¡Œçš„.
</p>

<p>
ä¸€æ—¦å‰ 3 ä¸ªæ­¥éª¤éƒ½æ²¡æ‰¾åˆ°æ–‡ä»¶,é‚£ä¹ˆå°±å°è¯•æŸ¥æ‰¾ <code>FILENAME</code>,å¦‚æœæ‰¾åˆ°å°±åŠ è½½,å¦è€…è¿›è¡Œä¸‹ä¸€æ­¥;
</p></li>

<li><p>
å¦‚æœå¯ç”¨äº† <code>Auto Compression mode</code>,å°±å°è¯•æŸ¥æ‰¾å‹ç¼©ç‰ˆæœ¬,é»˜è®¤æ˜¯ <code>FILENAME.gz</code>,
</p>

<p>
<code>Emacs</code> æ˜¯é€šè¿‡æ–‡ä»¶åç¼€åˆ¤æ–­æ–‡ä»¶æ˜¯å¦è¢«å‹ç¼©, <code>jka-compr-load-suffixes</code> è®°å½•äº†è‹¥å¹²ä¸ªå‹ç¼©æ–‡ä»¶åç¼€,é»˜è®¤å€¼æ˜¯ <code>(.gz)</code>.
</p>

<p>
ä¼šæŒ‰ç…§ <code>("FILENAME.elc.gz" "FILENAME.el.gz" "FILENAME.gz")</code> é¡ºåºæŸ¥æ‰¾(è¿™ä¸ªè¯´æ³•å¯èƒ½æœ‰è¯¯,ä¸è¿‡ç»è¿‡éªŒè¯çš„ç¡®æ˜¯ä¼šåŠ è½½è¿™ä¸‰ä¸ªå…¶ä¸­ä¸€ä¸ª,æœ‰æ—¶é—´çš„è¯ç”¨ä¸‰ä¸ªç±»ä¼¼åå­—ä½†ä»£ç ä¸åŒçš„åŒ…åšéªŒè¯),
</p>

<p>
æ‰¾åˆ°ååœ¨å…¶ä¸­å°è¯•æŸ¥æ‰¾ <code>FILENAME</code> æ–‡ä»¶: <code>(load "FILENAME")</code>,æ‰¾åˆ°åè¿›è¡Œè§£å‹åŠ è½½,è¿™æ˜¯ä¸€ä¸ªé€’å½’è¿‡ç¨‹.
</p></li>

<li>å¦‚æœéƒ½æ²¡æ‰¾åˆ°,é»˜è®¤å¼•å‘ <code>file-error</code> é”™è¯¯,å¯ä»¥åœ¨å‚æ•° <code>missing-ok</code> ä½ç½®ä¼ å…¥ <code>non-nil</code> è®©å®ƒä¸æŠ¥é”™å¹¶ä¸”è¿”å› <code>nil</code>.</li>
</ol>
</div>
</div>


<div id="outline-container-orgff36548" class="outline-4">
<h4 id="orgff36548">åŠ è½½åç¼€ (Load Suffixes)</h4>
<div class="outline-text-4" id="text-orgff36548">
<p>
äº‹å®ä¸Š, <code>load</code> å‡½æ•°çš„æŸ¥æ‰¾æ–‡ä»¶è¿‡ç¨‹æ˜¯ç”±å˜é‡ <code>load-suffixes</code> å†³å®šçš„,è¯¥å˜é‡çš„æ ‡å‡†å€¼æ˜¯ <code>(".elc" ".el")</code>,
</p>

<p>
å¦‚æœ <code>Emacs</code> æ”¯æŒåŠ è½½åŠ¨æ€æ¨¡å— <code>.EXT</code>,é‚£ä¹ˆå€¼æ˜¯ <code>(".elc" ".el" ".EXT")</code>. <code>load</code> å‡½æ•°æœ‰ <code>nosuffix</code> å‚æ•°,
</p>

<p>
å¦‚æœè¯¥å‚æ•°ä¸º <code>t</code> å°±æ— è§† <code>load-suffixes</code> çš„è®¾å®š,æŠŠ <code>load-suffixes</code> çœ‹åš <code>nil</code>.
</p>

<p>
<code>load-file-rep-suffixes</code> æŒ‡å®šäº†åŒä¸€ä¸ªæ–‡ä»¶çš„å„ä¸ªè¡¨ç¤º(representations),é»˜è®¤æ˜¯ <code>("")</code>,è¿™ä¸ªä¹Ÿå°±æ˜¯æ–‡ä»¶åçš„åç¼€,
</p>

<p>
è¯¥å˜é‡ä¼šæŠŠ <code>jka-compr-load-suffixes</code> çš„å€¼ <code>(".gz")</code> æ·»åŠ åˆ°è¯¥å˜é‡ä¸­å¾—åˆ° <code>("" ".gz")</code>,è¡¨ç¤ºå¯ç”¨äº† <code>Auto Compression mode</code>.
</p>
</div>
</div>


<div id="outline-container-org02b15c5" class="outline-4">
<h4 id="org02b15c5">åº“çš„æŸ¥æ‰¾ (Library Search)</h4>
</div>

<div id="outline-container-orga118c4f" class="outline-4">
<h4 id="orga118c4f">åŠ è½½é ASCII å­—ç¬¦ (Loading Non-ASCII)</h4>
</div>

<div id="outline-container-orgc80a821" class="outline-4">
<h4 id="orgc80a821">è‡ªåŠ¨åŠ è½½ (Autoload)</h4>
<div class="outline-text-4" id="text-orgc80a821">
<p>
è‡ªåŠ¨åŠ è½½åŠŸèƒ½å…è®¸å…ˆæ³¨å†Œå‡½æ•°æˆ–è€…å®,ä½†æ˜¯æ²¡æœ‰åŠ è½½å®šä¹‰äº†å‡½æ•°æˆ–è€…å®çš„æ–‡ä»¶æœ¬èº«,ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°æˆ–è€…å®çš„æ—¶å€™å…ˆè‡ªåŠ¨åŠ è½½å¯¹åº”çš„æ–‡ä»¶/åº“,
</p>

<p>
è¿™æ˜¯ä¸ºäº†å®‰è£…çœŸæ­£çš„å®šä¹‰ä»¥åŠå…¶ä»–ç›¸å…³çš„ä»£ç ,ç„¶åè¿è¡ŒçœŸæ­£çš„å®šä¹‰.è‡ªåŠ¨åŠ è½½ä¹Ÿå¯ä»¥åœ¨æŸ¥æ‰¾å‡½æ•°å’Œå®çš„æ–‡æ¡£æ—¶/è¡¥å…¨å˜é‡åå­—ä»¥åŠå‡½æ•°åå­—æ—¶è§¦å‘.
</p>

<p>
è¯´çš„ç®€å•ç‚¹,è‡ªåŠ¨åŠ è½½å°±æ˜¯æŒ‰éœ€åŠ è½½/æ‡’åŠ è½½,é˜²æ­¢æ— ç”¨åŠ è½½å‡å°‘æ—¶é—´.
</p>

<p>
æœ‰ä¸¤ç§æ–¹æ³•ä½¿ç”¨è‡ªåŠ¨åŠ è½½: è°ƒç”¨ <code>autoload</code> å‡½æ•°,ä»¥åŠåœ¨æºæ–‡ä»¶é‡Œçš„å‡½æ•°/å®å®šä¹‰å‰é¢åŠ ä¸Š"é­”æ³•"æ³¨é‡Š("magic" comment).
</p>

<p>
åè€…å®é™…ä¸Šæ˜¯åŸºäºå‰è€…å®ç°çš„.
</p>

<p>
æ¯”å¦‚ <code>(autoload 'fn-to-call "/path/to/source.el")</code>, è¿™é‡Œçš„æƒ…å†µæ˜¯å‡½æ•° <code>fn-to-call</code> å®šä¹‰åœ¨ <code>/path/to/source.el</code> ä¸­,
</p>

<p>
è¿™æ ·å°±æœ‰ä¸€ä¸ªåå« <code>fn-to-call</code> çš„å ä½ç¬¦,é€šè¿‡ <code>(symbol-function 'fn-to-call)</code> å¯ä»¥è·å¾—è·å–åˆ°ä¸€ä¸ª <code>autoload</code> å¯¹è±¡,
</p>

<p>
ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>fn-to-call</code> çš„æ—¶å€™å…ˆåˆ¤æ–­å®ƒçš„å®šä¹‰æ˜¯å¦å­˜åœ¨,å¦‚æœä¸å­˜åœ¨å°±è§¦å‘è‡ªåŠ¨åŠ è½½:é€šè¿‡ <code>load</code> å‡½æ•°åŠ è½½ <code>/path/to/source.el</code> æ–‡ä»¶,
</p>

<p>
å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–è€…åŠ è½½æ–‡ä»¶åæ²¡æœ‰ <code>fn-to-call</code> è¿™ä¸ªå®šä¹‰å°±ä¼šæŠ¥é”™.é™¤äº†å‡½æ•°,ä¹Ÿå¯ä»¥å®šä¹‰å®/æŒ‰é”®æ˜ å°„(keymap)ä½œä¸ºå‡½æ•°æ¥è‡ªåŠ¨åŠ è½½.
</p>

<p>
è‡³äº"é­”æ³•"æ³¨é‡Šåˆ™æ˜¯è¿™ä¹ˆä½¿ç”¨,
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">source.el</span>

<span style="color: #5F7F5F;">;;;</span><span style="color: #7F9F7F;">###</span><span style="color: #D0BF8F; font-weight: bold;">autoload</span>
(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fn-to-call</span> () (message <span style="color: #CC9393;">"Hello"</span>))

(<span style="color: #F0DFAF; font-weight: bold;">provide</span> '<span style="color: #BFEBBF;">source</span>)
</pre>
</div>

<p>
å…¶ä¸­ <code>;;;###autoload</code> å°±æ˜¯"é­”æ³•"æ³¨é‡Š,å•ç‹¬ä¸€è¡Œ,ä¸€ä¸ª"é­”æ³•"æ³¨é‡Šé€šå¸¸è¢«ç§°ä¸ºä¸€ä¸ª <code>autoload cookie</code>.
</p>

<p>
å®é™…ä¸Šè¿™ä¸ªæ³¨é‡Šæœ¬èº«æ²¡ä»€ä¹ˆåŠ¨ä½œ,å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªæ ‡è®°æ¥æœåŠ¡ <code>update-file-autoloads</code> æˆ–è€… <code>update-directory-autoloads</code> å‘½ä»¤çš„,
</p>

<p>
å½“ä½¿ç”¨è¿™ä¸¤ä¸ªå‘½ä»¤å…¶ä¸­ä¸€ä¸ªçš„æ—¶å€™, <code>Emacs</code> ä¼šæŠŠè¿™ä¸ªæ³¨é‡Šåé¢çš„å®šä¹‰å†™æˆå¯¹åº”çš„ <code>autoload</code> å¯¹è±¡åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­,åŠ è½½è¿™ä¸ªæ–‡ä»¶å¯ä»¥åœ¨ä»¥åçš„è°ƒç”¨ä¸­è§¦å‘è‡ªåŠ¨åŠ è½½,
</p>

<p>
å…¸å‹çš„ä¾‹å­ <code>lisp/loaddefs.el</code>, å¯ä»¥é€šè¿‡ <code>(find-library "loaddefs")</code> æŸ¥æ‰¾åˆ°é‡Œé¢çš„å†…å®¹.
</p>
</div>
</div>
</div>


<div id="outline-container-org80073e7" class="outline-3">
<h3 id="org80073e7">å­—èŠ‚ç¼–ç  (Byte Compilation)</h3>
<div class="outline-text-3" id="text-org80073e7">
<p>
<code>Emacs</code> æ‹¥æœ‰ä¸¤ä¸ªç›´è¯‘å™¨å’Œä¸€ä¸ªç¼–è¯‘å™¨,ç¼–è¯‘å™¨å¯ä»¥æŠŠ <code>Emacs Lisp</code> ä»£ç ç¼–è¯‘æˆå­—èŠ‚ç (byte-code),
</p>

<p>
ç„¶åç”± <code>Emacs</code> çš„å­—èŠ‚ç›´è¯‘å™¨(byte-code interpreter)è¿è¡Œ.å­—èŠ‚ç ç›´è¯‘å™¨å’Œå¹³å¸¸çš„ <code>Emacs Lisp</code> ç›´è¯‘å™¨ä¸æ˜¯åŒä¸€ä¸ªç›´è¯‘å™¨.
</p>

<p>
ç”±äºå­—èŠ‚ç ä¸æ˜¯ç”±çœŸæ­£çš„ç¡¬ä»¶è¿ç®—,æ‰€ä»¥ä¸å¯èƒ½åƒçœŸæ­£çš„å­—èŠ‚ç ä¸€æ ·å¿«,æ­£æ˜¯å› ä¸ºè¿™æ ·,å­—èŠ‚ç å¯ä»¥åœ¨æ— éœ€é‡æ–°ç¼–è¯‘çš„æƒ…å†µä¸‹åœ¨è½¬ç§»äºä¸åŒæœºå™¨ä¹‹é—´.
</p>

<p>
ä»»ä½•ç‰ˆæœ¬çš„ <code>Emacs</code> å¯ä»¥è¿è¡Œæ—§ç‰ˆæœ¬ <code>Emacs</code> äº§ç”Ÿçš„å­—èŠ‚ç ,ä½†æ˜¯åè¿‡æ¥ä¸è¡Œ.
</p>

<p>
å¯ä»¥é€šè¿‡è®¾å®šæ–‡ä»¶å˜é‡(file-local variable)æ¥è®©é˜»æ­¢ <code>Lisp</code> æ–‡ä»¶ç¼–è¯‘.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-*-no-byte-compile: t; -*-</span>
</pre>
</div>
</div>

<div id="outline-container-org7923fe3" class="outline-4">
<h4 id="org7923fe3">ç¼–è¯‘å­—èŠ‚å‡½æ•° (Compilation Functions)</h4>
<div class="outline-text-4" id="text-org7923fe3">
<p>
å¯ä»¥é’ˆå¯¹å‡½æ•°(byte-compile-function),æ–‡ä»¶(byte-compile-file)å’Œç›®å½•(byte-compile-file)3ä¸ªç­‰çº§è¿›è¡Œç¼–è¯‘.
</p>
</div>
</div>




<div id="outline-container-org463b4f2" class="outline-4">
<h4 id="org463b4f2">æ–‡æ¡£å­—ç¬¦ä¸²å’Œç¼–è¯‘ (Docs and Compilation)</h4>
<div class="outline-text-4" id="text-org463b4f2">
<p>
åŠ è½½ç¼–è¯‘åçš„æ–‡ä»¶æ˜¯ä¸ä¼šæŠŠå‡½æ•°å’Œå˜é‡çš„æ–‡æ¡£åŠ è½½è¿›å†…å­˜çš„,ç›®çš„æ˜¯ä¸ºèŠ‚çœå†…å­˜ä»¥åŠåŠ å¿«åŠ è½½é€Ÿåº¦,åªæœ‰åœ¨æœ‰éœ€è¦çš„æ—¶å€™æ‰ä¼šåŠ è½½.
</p>

<p>
è¿™å«åšåŠ¨æ€åŠ è½½(dynamical loading)/æƒ°æ€§åŠ è½½(lazy loading),ä¸è¿‡æœ‰ä¸€ä¸ªåå¤„,å¦‚æœç¼–è¯‘æ–‡ä»¶è¢«åˆ é™¤/ç§»åŠ¨/ä¿®æ”¹(æ¯”å¦‚é‡æ–°ç¼–è¯‘)äº†å°±ä¸èƒ½è®¿é—®ä¹‹å‰åŠ è½½å‡½æ•°/å˜é‡çš„æ–‡æ¡£äº†.
</p>

<p>
æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³,ä¸€æ˜¯ç¼–è¯‘æ—¶å€™æŠŠ <code>byte-compile-dynamic-docstrings</code> å˜é‡è®¾ç½®ä¸º <code>nil</code>,äºŒæ˜¯é‡æ–°ç¼–è¯‘æ–‡ä»¶.
</p>
</div>
</div>



<div id="outline-container-org175f752" class="outline-4">
<h4 id="org175f752">åŠ¨æ€åŠ è½½ä¸ªåˆ«å‡½æ•° (Dynamic Loading)</h4>
<div class="outline-text-4" id="text-org175f752">
<p>
å…¶å®å‡½æ•°ä¹Ÿå¯ä»¥åŠ¨æ€åŠ è½½çš„,åŠ è½½æ–‡ä»¶çš„æ—¶å€™ä¼šç»™å‡½æ•°çš„å®šä¹‰ç•™ä¸‹ä¸€ä¸ª <code>place-holder</code>,è¿™ä¸ª <code>place-holder</code> å¼•ç”¨å®šä¹‰å®ƒçš„(ç¼–è¯‘)æ–‡ä»¶,åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™æ‰è¯»å–å‡½æ•°çš„å®šä¹‰å¹¶ä¸”æ›¿æ¢æ‰ <code>place-holder</code>.
</p>

<p>
å®ƒçš„ä¼˜ç¼ºç‚¹å’Œä¸Šé¢æ•°çš„åŠ¨æ€åŠ è½½æ–‡æ¡£ä¸€æ ·,è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç›¸ä¼¼,ä¸€æ˜¯ç¼–è¯‘æ—¶å€™è®¾å®š <code>byte-compile-dynamic</code> ä¸º <code>nil</code>,è€Œæ˜¯é‡æ–°ç¼–è¯‘.
</p>
</div>
</div>



<div id="outline-container-orgfa98400" class="outline-4">
<h4 id="orgfa98400">åœ¨ç¼–è¯‘æœŸé—´è¿è¡Œ (Eval During Compile)</h4>
<div class="outline-text-4" id="text-orgfa98400">
<p>
è¦æ¸…æ¥šç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶æ˜¯ä¸åŒçš„ä¸¤ä¸ªé˜¶æ®µ, <code>Emacs</code> æä¾›äº†ä¸¤ä¸ª <code>forms</code> æ¥å…è®¸ä»£ç åœ¨è¿è¡Œæ—¶å€™æ‰§è¡Œ: <code>eval-and-compile</code> å’Œ <code>eval-when-compile</code>.
</p>

<p>
é€šä¿—ç‚¹è®²,å¦‚æœä½ æƒ³è®©ä»£ç  <code>body</code> åœ¨ç¼–è¯‘æ—¶ä»¥åŠåœ¨ä½¿ç”¨ç¼–è¯‘å¾—åˆ°çš„ä»£ç æ—¶è¿è¡Œ,é‚£ä¹ˆç”¨ <code>eval-and-compile</code>;
</p>

<p>
å¦‚æœä¸€æ®µä»£ç  <code>body</code> åªæ˜¯é’ˆå¯¹ç¼–è¯‘æ—¶,å¯¹åœ¨æ‰§è¡Œç¼–è¯‘å¾—åˆ°çš„ä»£ç æ—¶æ²¡æ‰€è°“,é‚£ä¹ˆç”¨ <code>eval-when-compile</code>.
</p>

<p>
æœ€åè¦æ³¨æ„,è¿™ä¸¤ä¸ª <code>forms</code> çš„ <code>body</code> åœ¨ç›´è¯‘æ—¶ä¹Ÿæ˜¯ä¼šè¢«è¿è¡Œçš„.
</p>
</div>
</div>



<div id="outline-container-org16f4bf7" class="outline-4">
<h4 id="org16f4bf7">ç¼–è¯‘å™¨é”™è¯¯ (Compiler Errors)</h4>
<div class="outline-text-4" id="text-org16f4bf7">
<p>
ç¼–è¯‘æ—¶å€™äº§ç”Ÿçš„é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯ä¼šè¾“å‡ºåˆ° <code>*Compile-Log*</code> ç¼“å†²åŒºä¸Šé¢,è¿™äº›ä¿¡æ¯åŒ…æ‹¬æ–‡ä»¶åå­—å’Œé—®é¢˜å‘ç”Ÿä½ç½®çš„è¡Œæ•°.
</p>

<p>
å½“å¼•å‘è¯­æ³•é”™è¯¯,å­—èŠ‚ç¼–è¯‘å™¨å¯èƒ½ä¼šä¸çŸ¥é“é”™è¯¯çš„å®é™…ä½ç½®,è¿™ä¸ªæ—¶å€™å¯ä»¥åˆ° <code>" *Compiler Input*"</code> ç¼“å†²åŒºæŸ¥çœ‹(æ³¨æ„æœ‰ä¸ªç©ºæ ¼).
</p>

<p>
è¿™ä¸ªç¼“å†²åŒºåŒ…å«ç¼–è¯‘åçš„ç¨‹åºå¹¶ä¸”æŒ‡å‡ºå­—èŠ‚ç¼–è¯‘å™¨èƒ½å¤Ÿè¯»å–åˆ°å¤šè¿œ,é—®é¢˜å¯èƒ½å°±åœ¨é™„è¿‘.
</p>

<p>
ä¸€ä¸ªå¸¸è§çš„è­¦å‘Šç±»å‹æ˜¯ä½¿ç”¨çš„å‡½æ•°å’Œå˜é‡æ²¡æœ‰å®šä¹‰,è¿™äº›è­¦å‘Šä¼šæŠ¥å‘Šæ–‡ä»¶æœ€åçš„è¡Œå·,ä¸æ˜¯ä½¿ç”¨çš„å‡½æ•°æˆ–è€…å˜é‡ä¸¢å¤±çš„ä½ç½®,åªèƒ½æ‰‹åŠ¨æœç´¢æ–‡æ¡£.
</p>

<p>
å¦‚æœè¦æ¶ˆé™¤è¿™äº›è­¦å‘Š,æœ‰ä»¥ä¸‹æ‰‹æ®µ:
</p>

<ol class="org-ol">
<li>é€šè¿‡ <code>fboundp/boundp</code> åˆ¤æ–­ <code>å‡½æ•°/å˜é‡</code> ç¡®å®å®šä¹‰åæ‰ä½¿ç”¨;</li>

<li>åœ¨å®šä¹‰é¢å¯ä»¥é€šè¿‡ <code>declare-functionå£°æ˜å‡½æ•°/defvarå®šä¹‰æ²¡æœ‰åˆå§‹å€¼çš„å˜é‡</code> å‘Šè¯‰å­—èŠ‚ç¼–è¯‘å™¨å®ƒä»¬å·²ç»å®šä¹‰;</li>

<li>æŠŠä¸æƒ³æç¤ºé”™è¯¯å’Œè­¦å‘Šè¡¨è¾¾å¼æ”¾åˆ° <code>with-no-warnings</code> é‡Œé¢;</li>

<li>é€šè¿‡è®¾ç½® <code>byte-compile-warnings</code> åšæ›´ç²¾ç¡®çš„æ§åˆ¶.</li>
</ol>
</div>
</div>


<div id="outline-container-org24682d3" class="outline-4">
<h4 id="org24682d3">å­—èŠ‚ç å‡½æ•°å¯¹è±¡ (Byte-Code Objects)</h4>
<div class="outline-text-4" id="text-org24682d3">
<p>
ç¼–è¯‘å™¨å‡½æ•°åä¼šäº§ç”Ÿä¸€ä¸ª <code>byte-code function object</code>,çœ‹èµ·æ¥å°±åƒä¸€ä¸ªä»¥ <code>#[</code> å¼€å¤´çš„ <code>vector</code>,åªè¦æœ‰4ä¸ªå…ƒç´ ,æ²¡æœ‰æœ€å¤§ä¸ªæ•°,
</p>

<p>
åªæœ‰å‰é¢6ä¸ªæ˜¯æœ‰æ­£å¸¸ä½œç”¨çš„:
</p>

<ul class="org-ul">
<li><p>
ARGDESC
</p>

<p>
å‚æ•°çš„æè¿°ç¬¦(descriptor),å¯ä»¥æ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨(argument list)æˆ–è€…ä¸€ä¸ªè¡¨ç¤ºå‚æ•°ä¸ªæ•°çš„æ•´æ•°.
</p>

<p>
åè€…çš„å€¼çš„0åˆ°6ä½æŒ‡å®šå‚æ•°çš„æœ€å°ä¸ªæ•°,8åˆ°14ä½æŒ‡å®šå‡½æ•°çš„æœ€å¤§ä¸ªæ•°,å¦‚æœå‚æ•°ä¸­æœ‰ <code>&amp;rest</code> ,é‚£ä¹ˆå°±ä¼šè®¾å®šç¬¬7ä½.
</p>

<p>
å¦‚æœ <code>ARGDESC</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨,é‚£ä¹ˆåœ¨æ‰§è¡Œå­—èŠ‚ç ä¹‹å‰åŠ¨æ€ç»‘å®šå‚æ•°;å¦‚æœæ˜¯æ•´æ•°,åœ¨æ‰§è¡Œç›´æ¥ç ä¹‹å‰,å‚æ•°å°±ä¼šè¢«å‹åˆ°å­—èŠ‚ç ç›´è¯‘å™¨çš„ <code>stack</code> ä¸­.
</p></li>

<li><p>
BYTE-CODE
</p>

<p>
åŒ…å«å­—èŠ‚ç æŒ‡ä»¤(byte-code instructions)çš„å­—ç¬¦ä¸².
</p></li>

<li><p>
CONSTANTS
</p>

<p>
å­—èŠ‚ç å¼•ç”¨çš„å¯¹è±¡çš„ <code>Vector</code>,åŒ…å«ç”¨äºå‡½æ•°å’Œå˜é‡å¯¹åº”çš„ <code>symbols</code>.
</p></li>

<li><p>
STACKSIZE
</p>

<p>
å‡½æ•°éœ€è¦çš„æœ€å¤§ <code>stack</code> å¤§å°.
</p></li>

<li><p>
DOCSTRING
</p>

<p>
å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²(å¦‚æœæœ‰çš„è¯),å¦åˆ™ä¸ºç©º.å¦‚æœæœ‰æ–‡æ¡£å­—ç¬¦ä¸²,é‚£ä¹ˆå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—æˆ–è€…åˆ—è¡¨.
</p>

<p>
å¯ä»¥é€šè¿‡ <code>documentation</code> å‡½æ•°è·å–çœŸæ­£çš„å­—ç¬¦ä¸².
</p></li>

<li><p>
INTERACTIVE
</p>

<p>
äº¤äº’é…ç½®(interactive spec)(å¦‚æœæœ‰çš„è¯).å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ª <code>Lisp</code> è¡¨è¾¾å¼.
</p></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">backward-sexp &#30340;&#23383;&#33410;&#30721;</span>

#[256                                   <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">ARGDESC</span>
  <span style="color: #CC9393;">"\211\204^G^@\300\262^A\301^A[!\207"</span>  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">BYTE-CODE</span>
  [1 forward-sexp]                      <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">CONSTANTS</span>
  3                                     <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">STACKSIZE</span>
  1793299                               <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">DOCSTRING</span>
  <span style="color: #CC9393;">"^p"</span>]                                 <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">INTERACTIVE</span>
</pre>
</div>

<p>
å¯ä»¥é€šè¿‡ <code>make-byte-code</code> åˆ›å»ºä¸€ä¸ªå­—èŠ‚ç å¯¹è±¡,ä¸è¿‡æˆ‘ä»¬ä¸åº”è¯¥æ‰‹åŠ¨ç¼–å†™å­—èŠ‚ç ,å› ä¸ºå¾ˆå®¹æ˜“ä¼šä¸ä¸€è‡´è€Œå¯¼è‡´ç¨‹åºå´©æºƒ.
</p>

<p>
ä¸è¿‡æ€»æœ‰äººæƒ³èµ°ä¸åŒçš„è·¯,è¿™é‡Œæœ‰ä¸€ç¯‡å¾ˆä¸é”™çš„<a href="https://nullprogram.com/blog/2014/01/04/">æ–‡ç« </a>æ•™ä½ æ‰‹å†™å­—èŠ‚ç .
</p>
</div>
</div>


<div id="outline-container-orgfb0943b" class="outline-4">
<h4 id="orgfb0943b">åæ±‡ç¼–å­—èŠ‚ç (Disassembly)</h4>
<div class="outline-text-4" id="text-orgfb0943b">
<p>
å­—èŠ‚ç ç¼–è¯‘å™¨æ˜¯ä¸€ä¸ªç®€å•çš„ <code>stack machine</code>.å®ƒæ˜¯è¿™ä¹ˆå·¥ä½œçš„:
</p>

<ol class="org-ol">
<li>æŠŠå€¼/å¼•ç”¨å‹è¿›(push) <code>stack</code> ä¸­;</li>

<li>åœ¨è°ƒç”¨å‡½æ•°æ—¶,å¼¹å‡º(pop)ç›¸åº”çš„å€¼(æ ˆé¡¶çš„å‡ ä¸ª)ä½œä¸ºå‚æ•°è¿›è¡Œè®¡ç®—,æŠŠå‡½æ•°ç»“æœå‹è¿› <code>stack</code> ä¸­.</li>
</ol>

<p>
ä½ è¿˜å¯ä»¥é€šè¿‡ <code>Calc</code> çš„ <code>RPN</code> æ¨¡å¼æ¥æ„Ÿå—ä¸€ä¸‹å®ƒçš„å·¥ä½œæ–¹å¼: <code>C-x * t</code>.
</p>

<p>
æ–‡æ¡£é€šè¿‡ä¾‹å­å¾ˆå¥½åœ°å‘Šè¯‰ä½ æ€ä¹ˆçœ‹æ±‡ç¼–äº†,å¯ä»¥ç›´æ¥çœ‹ <code>M-: (info "(elisp) Disassembly")</code>.
</p>

<p>
å¦‚æœæ²¡æœ‰çœ‹æ‡‚çš„,é‚£ä¹ˆå°±éœ€è¦å»å­¦ä¹ ä¸€ä¸‹æ±‡ç¼–äº†,æ¨è "ASSEMBLY LANGUAGE STEP BY STEP PROGRAMMING WITH LINUX".
</p>
</div>
</div>
</div>


<div id="outline-container-org46aa24f" class="outline-3">
<h3 id="org46aa24f">è°ƒè¯• (Debugging)</h3>
<div class="outline-text-3" id="text-org46aa24f">
<p>
<code>Emacs Lisp</code> æœ‰å‡ ç§è°ƒè¯•æ‰‹æ®µæ’æŸ¥é—®é¢˜,ä¸åŒæ‰‹æ®µé’ˆå¯¹ä¸åŒæƒ…å†µä¸‹çš„é—®é¢˜:
</p>

<ul class="org-ul">
<li>å¦‚æœåœ¨ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿé”™è¯¯, <code>Emacs Lisp</code> å†…ç½®çš„è°ƒè¯•å™¨ä¼šæŒ‚èµ·æ‰§è¡Œä¸­çš„ç¨‹åº, å¯ä»¥åœ¨è¿™ä¸ªæ—¶å€™æ£€æŸ¥/ä¿®æ”¹è¿è¡Œæ—¶çš„çŠ¶æ€.</li>

<li>å¦‚æœçŸ¥é“æºä»£ç çš„å®šä¹‰åœ¨å“ªé‡Œ,å¯ä»¥ä½¿ç”¨ <code>Edebug</code> è¿™ä¸ªæºç å±‚çº§çš„è°ƒè¯•å™¨,è¿™åŠŸèƒ½å¯ä»¥ç”¨æ¥é«˜æ•ˆäº†è§£æºç .</li>

<li>å¦‚æœæ˜¯æƒ³è¦è·Ÿè¸ªå‡½æ•°çš„æ‰§è¡Œ,æˆ–è€…è·Ÿè¸ªå˜é‡çš„å˜åŒ–,å¯ä»¥ä½¿ç”¨ <code>trace.el</code>.</li>

<li>å¦‚æœæ˜¯è¯­æ³•é—®é¢˜,åªéœ€è¦ä½¿ç”¨ <code>Emacs Lisp</code> çš„ç¼–è¾‘å‘½ä»¤å°±å¥½äº†.</li>

<li>å¦‚æœæ˜¯ç¼–è¯‘æ—¶äº§ç”Ÿçš„é”™è¯¯æˆ–è€…è­¦å‘Š,é‚£ä¹ˆåªè¦é€šè¿‡æŸ¥çœ‹é”™è¯¯/è­¦å‘Šå†…å®¹å°±å¯ä»¥äº†.</li>

<li>å¦‚æœæ˜¯æƒ³åšå›å½’æµ‹è¯•,å¯ä»¥ä½¿ç”¨ <code>ERT</code> åŒ….</li>

<li>å¦‚æœæ˜¯ä¼˜åŒ–ç¨‹åº,é‚£ä¹ˆå¯ä»¥æŸ¥çœ‹æ–‡æ¡£è¿™é‡Œ: <code>M-: (info "(elisp)Profiling")</code>.</li>
</ul>
</div>


<div id="outline-container-orgb39ee7c" class="outline-4">
<h4 id="orgb39ee7c">Debugger</h4>
<div class="outline-text-4" id="text-orgb39ee7c">
<p>
<code>Debugger</code> æä¾›æŒ‚èµ· <code>form</code> æ‰§è¡Œçš„èƒ½åŠ›,æŒ‚èµ·(suspended)é€šå¸¸ä¹Ÿè¢«å«åšä¸­æ–­(break),
</p>

<p>
è¿™ä¸ªçŠ¶æ€å®é™…ä¸Šå°±æ˜¯ <code>Emacs</code> çš„ä¸€ä¸ªé€’å½’ç¼–è¾‘(recursive edit)
</p>

<p>
å¯ä»¥åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹æ£€æŸ¥è¿è¡Œæ—¶æ ˆ(run time stack),æ£€æŸ¥å±€éƒ¨æˆ–è€…å…¨å±€å˜é‡,ç”šè‡³è¿˜èƒ½æ”¹å˜è¿™äº›å˜é‡.
</p>



<p>
å½“æ‰§è¡Œä¸­çš„ä¸€ä¸ªæŒ‚èµ·(suspended,æˆ–è€…å«ä¸­æ–­,break)å®é™…æ˜¯ä¸€ä¸ªé€’å½’ç¼–è¾‘(recursive edit),
</p>

<p>
åœ¨æŒ‚èµ·çš„æ—¶å€™å¯ä»¥æ‰§è¡Œæ™®é€šçš„ç¼–è¾‘,æ¯”å¦‚æ£€æŸ¥è¿è¡Œæ—¶çš„æ ˆ,å˜é‡çš„å€¼æˆ–è€…æ”¹å˜è¿™äº›å€¼ç­‰ç­‰.å…³äº <code>Recursive Editing</code> å¯ä»¥æŸ¥çœ‹ <code>M-: (info "(elisp) Recursive Editing")</code>.
</p>

<p>
å…³äºå¦‚ä½•é˜…è¯» <code>Emacs Lisp Debugger</code> çš„ <code>backtrace</code>,å®ƒæ˜¯ä»¥æ ˆçš„é¡ºåºåŠ¨æ€æ˜¾ç¤ºçš„,ä¹Ÿå°±æ˜¯è¯´,æœ€åº•ä¸‹åº•è¯­å¥æ˜¯ç¬¬ä¸€å¥,é¡¶å±‚è¯­å¥æ˜¯ç›®å‰æ‰§è¡Œçš„è¯­å¥,ä¹Ÿå°±æ˜¯å½“å‰æ‰§è¡Œç‚¹.
</p>
</div>

<ul class="org-ul">
<li><a id="org091334e"></a>é”™è¯¯è°ƒè¯• (Error Debugging)<br>
<div class="outline-text-5" id="text-org091334e">
<p>
è®¾å®šè°ƒè¯•çš„å…¥å£,ä¹Ÿå°±æ˜¯ä»€ä¹ˆæ—¶å€™æ‰å”¤é†’è°ƒè¯•å™¨.
</p>

<ul class="org-ul">
<li><p>
debug-on-error
</p>

<p>
è®¾å®šè¯¥å˜é‡ä¸º <code>t</code> ,å¯ä»¥åœ¨ <code>debug-ignored-errors</code> ä»¥å¤–çš„é”™è¯¯å‘ç”Ÿæ—¶è¿›å…¥è°ƒè¯•, <code>debug-ignored-errors</code> å‘Šè¯‰è°ƒè¯•å™¨æ— è§†å“ªäº›é”™è¯¯.
</p>

<p>
å¦‚æœå€¼æ˜¯ä¸€ä¸ªé”™è¯¯æ¡ä»¶çš„åˆ—è¡¨,é‚£ä¹ˆåªæœ‰å¼•å‘åˆ—è¡¨ä¸­çš„é”™è¯¯æ‰ä¼šè¿›å…¥è°ƒè¯•.
</p>

<p>
å½“è¿™ä¸ªå˜é‡çš„å€¼ä¸º <code>non-nil</code> çš„æ—¶å€™, <code>Emacs</code> æ˜¯ä¸ä¼šä¸ºè¿›ç¨‹è¿‡æ»¤å‡½æ•°å’Œå“¨å…µ (<code>process filter functions and sentinels</code>)åˆ›å»ºé”™è¯¯å¤„ç†å™¨,ä¹Ÿå°±æ˜¯å®ƒä»¬ä¸€æ—¦æœ‰é”™è¯¯å°±ä¼šè¿›å…¥è°ƒè¯•.
</p></li>

<li><p>
eval-expression-debug-on-error
</p>

<p>
å¦‚æœè¯¥å˜é‡ä¸º <code>t</code>, é‚£ä¹ˆåœ¨æ‰§è¡Œ <code>eval-expression</code> å‘½ä»¤,é»˜è®¤ <code>M-:</code>,çš„æ—¶å€™åŠ¨æ€ç»‘å®š <code>debug-on-error</code> ä¸º <code>t</code>,å…¶å®ƒæ—¶å€™ <code>debug-on-error</code> çš„å€¼è¿˜æ˜¯åŸæ¥çš„å€¼.
</p>

<p>
ä¹Ÿå°±æ˜¯é’ˆå¯¹æ‰§è¡Œ <code>eval-expression</code> å‘ç”Ÿçš„é”™è¯¯è¿›è¡Œè°ƒè¯•.
</p></li>

<li><p>
debug-on-signal
</p>

<p>
æ­£å¸¸æ¥è¯´, <code>condition-case</code> æ•æ‰åˆ°çš„é”™è¯¯æ˜¯ä¸ä¼šå”¤é†’è°ƒè¯•å™¨çš„,å› ä¸º <code>condition-case</code> åœ¨è°ƒè¯•å™¨ä¹‹å‰å¤„ç†äº†é”™è¯¯.
</p>

<p>
å‡å¦‚ <code>debug-on-signal</code> è¿™ä¸ªå˜é‡è®¾å®šä¸º <code>non-nil</code>,é‚£ä¹ˆè°ƒè¯•å™¨å°±å¯ä»¥æ— è§† <code>condition-case</code> åœ¨ç¬¬ä¸€æ—¶é—´å¤„ç†é”™è¯¯.
</p>

<p>
è¿™ä¸ªå˜é‡å¯ä»¥åœ¨ <code>Emacs</code> çš„ <code>--eval</code> é€‰é¡¹è¿›è¡Œè®¾å®š,å¦‚æœè¿è¡Œæ—¶å€™å‘ç”Ÿäº†é”™è¯¯,é‚£ä¹ˆ <code>Emacs</code> å°±ä¼šå¼¹å‡ºä¸€ä¸ª <code>backtrace</code>.
</p>

<p>
<b>æœ€å¥½ä¸è¦åœ¨ç¼–ç ä¸­è®¾å®šè¿™ä¸ªå˜é‡,å› ä¸ºä¼šå¯¼è‡´æ‰€æœ‰ condition-case è¯­å¥å¤±å»å¤„ç†é”™è¯¯çš„æœºä¼š,åŒ…æ‹¬ä½ è®¡åˆ’å¤–çš„éƒ¨åˆ†.</b>
</p>

<p>
å¦‚æœéœ€è¦è°ƒè¯• <code>condition-case</code> é‡Œé¢çš„ä»£ç ,å¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>condition-case-unless-debug</code>.
</p></li>

<li><p>
debug-on-event
</p>

<p>
å¦‚æœç»™è¯¥å˜é‡è®¾å®šä¸€ä¸ªç‰¹åˆ«äº‹ä»¶(special event),é‚£ä¹ˆ <code>Emacs</code> å°±ä¼šåœ¨æ¥å—åˆ°äº‹ä»¶çš„ç¬¬ä¸€æ—¶é—´ç»•è¿‡ <code>special-event-map</code> è¿›å…¥è°ƒè¯•å™¨.
</p>

<p>
ç›®å‰å€¼æ”¯æŒå¯¹åº” <code>SIGUSER1</code> å’Œ <code>SIGUSER2</code> çš„å€¼,å½“è®¾å®šå¥½ <code>inhibit-quit</code> å¹¶ä¸”åœ¨ <code>Emacs</code> æ²¡æœ‰å“åº”æ—¶å€™è¿™ä¸ªå˜é‡ååˆ†æœ‰ç”¨.
</p></li>

<li><p>
debug-on-message
</p>

<p>
ç»™è¯¥å˜é‡è®¾å®šç”¨æ¥åŒ¹é…å›æ˜¾åŒºåŸŸ(echo area)çš„æ¶ˆæ¯(message)çš„æ­£åˆ™è¡¨è¾¾å¼(regular expression),å¦‚æœåŒ¹é…å°±ä¼šè¿›å…¥è°ƒè¯•.ç”¨æ¥æŸ¥æ‰¾é€ æˆè¯¥æ¶ˆæ¯çš„åŸå› å°±å¾ˆæœ‰ç”¨.
</p>

<p>
æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> debug-on-message
      <span style="color: #CC9393;">".*\"q\".*"</span>)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">test</span> ()
  (message <span style="color: #CC9393;">"\"q\""</span>))

(test)
</pre>
</div></li>
</ul>
</div>
</li>


<li><a id="org4819a69"></a>æ— é™å¾ªç¯ (Infinite Loops)<br>
<div class="outline-text-5" id="text-org4819a69">
<p>
å½“ç¨‹åºæ­»å¾ªç¯çš„æ—¶å€™,å¯ä»¥é€šè¿‡ <code>C-g</code>,ä¹Ÿå°±æ˜¯è°ƒç”¨ <code>keyboard-quit</code> æ¥ç»ˆæ­¢ç¨‹åº.è¿™æ ·ç›´æ¥åœæ­¢çš„è¯æ˜¯è·å–ä¸äº†æ­»å¾ªç¯çš„ä¿¡æ¯,å¯ä»¥è®¾ç½® <code>debug-on-quit</code> ä¸º <code>non-nil</code> æ¥åœ¨ <code>C-g</code> çš„æ—¶å€™è¿›å…¥è°ƒè¯•.
</p>
</div>
</li>


<li><a id="org7903d10"></a>å‡½æ•°è°ƒè¯•å™¨ (Function Debugging)<br>
<div class="outline-text-5" id="text-org7903d10">
<p>
å¦‚æœæƒ³åœ¨è°ƒç”¨ç‰¹å®šå‡½æ•°çš„æ—¶å€™è¿›å…¥è°ƒè¯•,å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>debug-on-entry</code> å‡½æ•°æ·»åŠ æƒ³è¦çš„è°ƒè¯•çš„å‡½æ•°,æ¯”å¦‚ <code>(debug-on-entry 'example)</code>.
</p>

<p>
æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯, <code>debug-on-entry</code> ä¸èƒ½ç›´æ¥æ·»åŠ  <code>C</code> è¯­è¨€å®ç°çš„åŸå‡½æ•°å’Œ <code>Special Forms</code>,é—´æ¥æ˜¯å¯ä»¥çš„,ä¹Ÿå°±æ˜¯ <code>Lisp</code> å‡½æ•°ç”¨å®ƒä»¬ä½œä¸º <code>subroutine</code>.
</p>

<p>
å¦‚æœè¦å–æ¶ˆå¯¹æŸä¸ªå‚æ•°çš„è°ƒè¯•,å¯ä»¥é€šè¿‡ <code>cancel-debug-on-entry</code> æ¥å–æ¶ˆ,æ¯”å¦‚ <code>(cancel-debug-on-entry 'example)</code>.
</p>
</div>
</li>


<li><a id="org83fbe28"></a>ç›´æ¥è°ƒè¯• (Explicit Debug)<br>
<div class="outline-text-5" id="text-org83fbe28">
<p>
å¯ä»¥åœ¨æºä»£ç ä¸­æƒ³è¦è°ƒè¯•çš„ä½ç½®æ·»åŠ  <code>(debug)</code> æ¥ä½œä¸º <code>breakpoint</code>,ç„¶åå¯ä»¥é€šè¿‡ <code>eval-defun</code> ç­‰æ–¹å¼è¿è¡Œè°ƒè¯•.
</p>
</div>
</li>


<li><a id="orgd4b7800"></a>ä½¿ç”¨è°ƒè¯•å™¨ (Using Debugger)<br>
<div class="outline-text-5" id="text-orgd4b7800">
<p>
è¿›å…¥ <code>Emacs</code> è°ƒè¯•å™¨çš„æ—¶å€™ä¼šæ‰“å¼€ä¸€ä¸ª <code>*Backtrace*</code> ç¼“å†²åŒº,å®ƒæ˜¯ä¸€ä¸ªä½¿ç”¨äº†ç‰¹åˆ« <code>major mode</code> çš„åªè¯»(read-only)ç¼“å†²åŒº.
</p>

<p>
è¿™ä¸ª <code>major mode</code> æ˜¯ <code>Debugger mode</code>,æŠŠå­—æ¯å®šä¹‰æˆè°ƒè¯•å‘½ä»¤.åœ¨è¯¥ <code>mode</code> ä¸‹ä¾ç„¶å¯ä»¥åšå…¶å®ƒæ­£å¸¸çš„ <code>Emacs</code> æ“ä½œ,ä¸è¿‡åšè¿™äº›æ“ä½œä¹‹å‰æœ€å¥½ç”¨ <code>q</code> å‘½ä»¤é€€å‡ºè°ƒè¯•.
</p>

<p>
<code>q</code> å‘½ä»¤å¯ä»¥ <code>*Backtrace*</code> ç¼“å†²åŒº å¹¶ä¸”é€€å‡ºè°ƒè¯•.é»˜è®¤æƒ…å†µä¸‹,é€€å‡ºåªæ˜¯éšè— <code>*Backtrace*</code> ç¼“å†²åŒº,ä¹Ÿå°±æ˜¯è¯¥ç¼“å†²åŒºæ²¡æœ‰è¢«æ€æ‰.
</p>

<p>
è¦æ€æ‰çš„è¯å°±è®¾å®š <code>debugger-bury-or-kill</code> ä¸º <code>'kill</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">and</span>
 (<span style="color: #F0DFAF; font-weight: bold;">require</span> '<span style="color: #BFEBBF;">debug</span>)
 (<span style="color: #F0DFAF; font-weight: bold;">setq</span> debugger-bury-or-kill 'kill))
</pre>
</div>

<p>
åœ¨è¿›å…¥è°ƒè¯•çš„æ—¶å€™ä¼šæ ¹æ® <code>eval-expression-debug-on-error</code> ä¸´æ—¶è®¾ç½® <code>debug-on-error</code> å˜é‡,å¦‚æœå‰è€…ä¸º <code>non-nil</code>,é‚£ä¹ˆ <code>debug-on-error</code> å°±ä¼šä¸º <code>t</code>.
</p>

<p>
è¿™æ„å‘³å¦‚æœåœ¨è°ƒè¯•çš„æ—¶å€™å‡ºç°äº†æ›´å¤šé”™è¯¯, <code>Emacs</code> å°†ä¼šè§¦å‘å¦å¤–çš„ <code>backtraces</code>,å¦‚æœä¸æƒ³è¿™æ ·çš„è¯å¯ä»¥åœ¨ <code>debugger-mode-hook</code> é‡Œé¢æŠŠ <code>eval-expression-debug-on-error</code> è®¾ç½®ä¸º <code>nil</code> æˆ–è€…æŠŠ <code>debug-on-error</code> è®¾ç½®ä¸º <code>nil</code>.
</p>

<p>
<b>å…³äºå¦‚ä½•æŸ¥çœ‹è°ƒè¯•å™¨</b>
</p>

<p>
<code>Backtrace</code> ç¼“å†²åŒº å±•ç¤ºè¿è¡Œä¸­çš„å‡½æ•°ä»¥åŠå®ƒä»¬çš„å‚æ•°å€¼,å¯ä»¥è¯¥ç¼“å†²åŒºåœ¨ä¸Šé¢é€šè¿‡ç§»åŠ¨ <code>Emacs</code> æŒ‡é’ˆåˆ°å¯¹åº”çš„è¡Œæ¥é€‰æ‹©ä¸€ä¸ªæ ˆå¸§(stack frame),æ ˆå¸§æ˜¯æŒ‡ <code>Lisp</code> ç›´è¯‘å™¨å‚¨å­˜ç‰¹å®šå‡½æ•°çš„è°ƒç”¨ä¿¡æ¯(information about a particular invocation of a function)çš„ä½ç½®.
</p>

<p>
æ­£åœ¨å·¥ä½œçš„æ ˆå¸§è¢«è®¤ä¸ºæ˜¯å½“å‰å¸§(æˆ‘ä¹Ÿä¸å¤ªçŸ¥é“æ€ä¹ˆç¿»è¯‘å’Œç†è§£,åŸæ–‡: The frame whose line point is on is considered the â€œcurrent frameâ€.),åªæœ‰ä¸€äº›è°ƒè¯•å‘½ä»¤å¯ä»¥æ“ä½œå½“å‰æ ˆå¸§.
</p>

<p>
<code>Backtrace</code> çš„æ ˆå¸§æ˜¯å€’ç€çš„,ä¹Ÿå°±æ˜¯è¦ä»åº•å¾€ä¸Šè¯»(read from bottom up)æ‰æ˜¯æ­£ç¡®çš„æ‰§è¡Œé¡ºåº,ä¹Ÿå°±æ˜¯æ­£åºç¬¬ä¸€è¡Œå°±æ˜¯å½“å‰æ ˆå¸§.
</p>

<p>
æŸäº›è¡Œçš„å‰é¢ä¼šæœ‰æ˜Ÿå·,ä¸€ä¸ªæ˜Ÿå·è¡¨ç¤ºä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å‡ºå£,è¯¥æ ˆå¸§ä¼šåœ¨è¿™ä¸ªå‡ºå£å†æ¬¡è°ƒç”¨è°ƒè¯•å™¨,æ²¡é”™,è°ƒè¯•å™¨æ˜¯ä¸€ä¸ªé€’å½’ç¼–è¾‘,æ¯æ¬¡è¿›å…¥ä¸€ä¸ªæ ˆå¸§å°±æ˜¯è¿›å…¥ä¸€ä¸ªå­è°ƒè¯•å™¨,ç®€å•ç‚¹å°±æ˜¯è°ƒè¯•å™¨ä¼šåœ¨å¸¦æ˜Ÿå·çš„æ ˆå¸§åœä¸‹è¿›è¡Œè°ƒè¯•.
</p>

<p>
æœ‰ä¸€äº›å‡½æ•°åå­—ä¼šæœ‰ä¸‹åˆ’çº¿,è¿™æ„å‘³ç€è°ƒè¯•å™¨çŸ¥é“å®ƒä»¬çš„æºä»£ç ä½ç½®,å¯ä»¥é€šè¿‡é¼ æ ‡ç‚¹å‡»æˆ–è€…æŒ‡é’ˆåŠ  <code>&lt;RET&gt;</code> æ¥æµè§ˆæºä»£ç .
</p>

<p>
å…¶ä¸­æ˜¯æ²¡æœ‰å‘ç”ŸæŠ¥é”™å’Œå› ä¸ºæŠ¥é”™è€Œè¿›å…¥è°ƒè¯•æ¨¡å¼,ä¸¤ç§çš„é¡¶è¡Œæ˜¾ç¤ºæ˜¯ä¸ä¸€æ ·çš„.
</p>



<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> debug-on-error t)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">raise-error</span> (a)
  (+ a nil))

(raise-error (raise-error 1))
</pre>
</div>


<div id="org97fbc6e" class="figure">
<p><img src="../../../files/raise-error.png" alt="raise-error.png">
</p>
<p><span class="figure-number">Figure 1: </span>æŠ¥é”™çš„æ—¶å€™</p>
</div>

<p>
ä¸Šé¢å¯ä»¥çœ‹åˆ°ä¸€äº›è¡Œçš„å‰é¢æœ‰äº›"å•è¯"ä¼šç”»ä¸Šä¸‹åˆ’çº¿,é‚£äº›éƒ½æ˜¯ <code>Lisp</code> å®šä¹‰çš„å‡½æ•°æˆ–è€…å®,ä¹Ÿæ˜¯æ‰§è¡Œæ—¶å€™æ‰€è°ƒç”¨çš„å†…å®¹,ä»ä¸‹å¾€ä¸Šçœ‹å°±æ˜¯è°ƒç”¨é¡ºåº.
</p>

<p>
è°ƒè¯•çš„æ—¶å€™å¯ä»¥æ ¹æ®è¿™ä¸ª"å¤§çº²"æ¥å¿«é€Ÿå®šä½é—®é¢˜å‘ç”Ÿçš„ä½ç½®.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">no-error</span> (a)
  (+ a 1))

(debug-on-entry 'no-error)

(no-error (no-error 1))
</pre>
</div>



<div id="orgc74d0f7" class="figure">
<p><img src="../../../files/no-error.png" alt="no-error.png">
</p>
<p><span class="figure-number">Figure 2: </span>æ²¡æœ‰é”™è¯¯çš„æ—¶å€™</p>
</div>

<p>
ä¸¤è€…çš„æç¤ºæ˜¯ä¸ä¸€æ ·çš„,é™¤æ­¤ä»¥å¤–,æœ‰ä¸€äº›å‘½ä»¤åœ¨æŠ¥é”™çš„æ—¶å€™æ˜¯ä¸å¯ä»¥æ‰§è¡Œçš„.æ¯”å¦‚ <code>r</code> å‘½ä»¤å°±ä¸å¯ä»¥,å› ä¸ºé”™è¯¯æ˜¯ä¸èƒ½è¿”å›çš„.
</p>

<p>
è°ƒè¯•å™¨æœ¬èº«ä¸€å®šè¦ç»è¿‡ç¼–è¯‘è¿è¡Œ,å› ä¸ºéœ€è¦å‡è®¾è°ƒè¯•å™¨è‡ªèº«éœ€è¦ä½¿ç”¨å¤šå°‘ä¸ªæ ˆå¸§.å¦‚æœæ˜¯ç›´è¯‘è¿è¡Œè°ƒè¯•å™¨,å‡è®¾å°±ä¼šå¤±è´¥.
</p>
</div>
</li>


<li><a id="orge87f0ed"></a>è°ƒè¯•å™¨å‘½ä»¤ (Debugger Commands)<br>
<div class="outline-text-5" id="text-orge87f0ed">
<p>
å¦‚æœèƒ½ç†è§£ <b>Emacs Lispçš„è°ƒè¯•å™¨æ˜¯ä¸€ä¸ªé€’å½’ç¼–è¾‘,æ¯ä¸€ä¸ªè¿›å…¥æ ˆå¸§éƒ½æ˜¯è¿›å…¥ä¸€ä¸ªå­è°ƒè¯•å™¨</b>,æ–‡æ¡£ä¸Šçš„è¯´æ˜å°±å¾ˆå¥½ç†è§£.å°½ç®¡å¦‚æ­¤æˆ‘è¿˜æ˜¯è¦ç”¨è‡ªå·±çš„è¯æ€»ç»“ä¸€ä¸‹(æˆ‘æ²¡æœ‰äº†è§£ä»¥å‰å¯æ˜¯ä¸€å¤´é›¾æ°´).
</p>

<ul class="org-ul">
<li>c: æ‰§è¡Œå¹¶ä¸”é€€å‡ºå½“å‰æ ˆå¸§çš„è°ƒè¯•,åœ¨ä¸‹ä¸€ä¸ªæ˜Ÿå·æ ‡è®°çš„æ ˆå¸§å¤„åœæ­¢.</li>
<li>d: è¿›å…¥å½“å‰æ ˆå¸§å¹¶ä¸”ç»™è¯¥æ ˆå¸§æ·»åŠ æ˜Ÿå·, <code>debug-on-entry</code> å®é™…ä¸Šå°±æ˜¯ç»™æŒ‡å®šçš„å‡½æ•°æ·»åŠ æ˜Ÿå·.è¿›å…¥åå¯ä»¥é€šè¿‡cå‘½ä»¤è·³å‡º.</li>
<li>b: ç»™å½“å‰æ ˆå¸§æ·»åŠ æ˜Ÿå·.</li>
<li>u: å–æ¶ˆå½“å‰æ ˆå¸§çš„æ˜Ÿå·.</li>
<li>j: ç»™å½“å‰æ ˆå¸§æ·»åŠ æ˜Ÿå·ç„¶åå’Œcå‘½ä»¤ä¸€æ ·æ‰§è¡Œ,ä¸è¿‡ä¼šæ— è§† <code>debug-on-entry</code> è®¾å®šçš„æ˜Ÿå·(æˆ–è€…è¯´ä¸´æ—¶ç¦æ­¢æ‰€æœ‰å‡½æ•°çš„break-on-entry). <code>c</code> å’Œ <code>j</code> çš„åŒºåˆ«å¯ä»¥é€šè¿‡è°ƒè¯•ä¸Šé¢æ²¡æœ‰é”™è¯¯çš„ä¾‹å­æ¥äº†è§£ä¸€ä¸‹.</li>
<li>e: åœ¨ <code>minibuffer</code> è¯»å– <code>Lisp</code> è¡¨è¾¾å¼å¹¶ä¸”(å¦‚æœå¯ä»¥çš„åˆ’åœ¨å½“å‰è¯æ³•ç¯å¢ƒ)è¿›è¡Œè¿ç®—ä»¥åŠåœ¨å›æ˜¾åŒºåŸŸ(area echo)æ‰“å°ç»“æœ.è°ƒè¯•å™¨ä¼šåœ¨å¤–éƒ¨ä¸´æ—¶å‚¨å­˜å’Œæ¢å¤è¿è¡Œæ—¶å˜é‡å€¼,æ‰€ä»¥å¯ä»¥éšæ„æ£€æŸ¥å’Œæ›´æ”¹è¿è¡Œæ—¶çš„å€¼.</li>
<li>R: å’Œeå‘½ä»¤ä¸€æ ·,ä¸åŒçš„æ˜¯Rå‘½ä»¤ä¼šå‚¨å­˜è®¡ç®—ç»“æœåˆ° <code>*Debugger-record*</code>.</li>
<li>q: ç»ˆæ­¢è°ƒè¯•å™¨(æœ€å¼€å§‹çš„è°ƒè¯•å™¨),è¿”å› <code>Emacs</code> çš„ <code>top-level</code>.</li>
<li>r: åœ¨å¸¦æ˜Ÿå·çš„æ ˆå¸§è¿”å›æ—¶æŒ‡å®šå®ƒçš„è¿”å›å€¼,ç”¨äº <code>mock</code>.</li>
<li>l: æ˜¾ç¤ºä¸€ä¸ªå‡½æ•°åˆ—è¡¨,è¿™äº›å‡½æ•°éƒ½æ˜¯ä¼šå”¤é†’è°ƒè¯•å™¨çš„.</li>
<li>v: åˆ‡æ¢æ˜¾ç¤ºå½“å‰æ ˆå¸§çš„æœ¬åœ°å˜é‡.</li>
</ul>
</div>
</li>


<li><a id="org0880947"></a>å”¤é†’è°ƒè¯•å™¨ (Invoking the Debugger)<br>
<div class="outline-text-5" id="text-org0880947">
<p>
å…³äº <code>debug</code> å‡½æ•°çš„ç»†èŠ‚.è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ç”¨æ¥æ”¹å˜ <code>*Backtrace*</code> é¡¶éƒ¨çš„æç¤ºä¿¡æ¯ "Debugger entered&#x2013;XXX".å…·ä½“çœ‹æ–‡æ¡£å°±å¥½.
</p>
</div>
</li>


<li><a id="org29430af"></a>è°ƒè¯•å™¨å†…éƒ¨ (Internals of Debugger)<br>
<div class="outline-text-5" id="text-org29430af">
<p>
å…³äºè°ƒè¯•å™¨å†…éƒ¨ä½¿ç”¨çš„å‡½æ•°å’Œå˜é‡.
</p>

<ul class="org-ul">
<li><code>debugger</code> å˜é‡: ç”¨æ¥æŒ‡å®šè°ƒç”¨ <code>debug</code> å‡½æ•°æ—¶å€™ä½¿ç”¨çš„å‚æ•°,é»˜è®¤æ˜¯ <code>debug</code>,å‚è€ƒ <code>debug</code> å‡½æ•°çš„ç»†èŠ‚, <code>M-: (info "(elisp) Internals of Debugger")</code>.</li>
<li><code>backtrace</code> å‡½æ•°: <code>debug</code> å‡½æ•°ä½¿ç”¨è¯¥å‡½æ•°ç»™ <code>*Backtrace*</code> ç¼“å†²åŒºå¡«å……,å®ƒæ˜¯ç”¨Cè¯­è¨€å†™çš„,å› ä¸ºå¿…é¡»è¦è®¿é—®æ ˆæ¥åˆ¤æ–­å‡½æ•°è°ƒç”¨æ˜¯å¦ <code>active</code>,è¿”å›å€¼æ€»æ˜¯ <code>nil</code>,è¯¥å‡½æ•°çš„è¾“å‡ºé»˜è®¤åˆ° <code>standard-output</code> çš„.</li>
<li><code>debug-on-next-call</code> å˜é‡: <code>non-nil</code> è¡¨ç¤ºåœ¨ä¸‹ä¸€ä¸ª <code>eval, apply æˆ–è€… funcall</code> ä¹‹å‰è°ƒç”¨è°ƒè¯•å™¨,è¿›å…¥è°ƒè¯•å™¨åæŠŠå®ƒè®¾ç½®ä¸º <code>nil</code>.è°ƒè¯•å™¨çš„då‘½ä»¤å°±æ˜¯é€šè¿‡è®¾ç½®è¿™ä¸ªå˜é‡æ¥å·¥ä½œ.å¦‚æœç›´æ¥æ‰‹åŠ¨è®¾ç½®è¯¥å˜é‡ä¼šè¿›å…¥è°ƒè¯•å™¨,å¯ä»¥è¯•è¯•.</li>
<li><code>backtrace-debug</code> å‡½æ•°: è®¾ç½® <code>LEVEL</code> çº§åˆ«çš„æ ˆå¸§çš„ <code>debug-on-exit flag</code> ä¸º <code>FLAG</code>, <code>LEVEL</code> å’Œ <code>FLAG</code> æ˜¯å‡½æ•°çš„å‚æ•°. <code>FLAG</code> ä¸º <code>non-nil</code> åˆ™æ˜¯è¯´åœ¨å½“å‰æ ˆå¸§ç»“æŸåè¿›å…¥è°ƒè¯•å™¨.</li>
<li><code>command-debug-status</code> å˜é‡: è®°å½•å½“å‰äº¤äº’å‘½ä»¤çš„è°ƒè¯•çŠ¶æ€,æ¯ä¸€æ¬¡äº¤äº’å¼è°ƒç”¨å‘½ä»¤å°±ä¼šæŠŠè¿™ä¸ªå˜é‡ç»‘å®šä¸º <code>nil</code>.è°ƒè¯•å™¨å¯ä»¥è®¾ç½®è¿™ä¸ªå˜é‡æ¥ç»™åœ¨è°ƒè¯•æ—¶å¼•å‘çš„æ–°è°ƒè¯•å™¨è°ƒç”¨(debugger invocation)ç•™ä¸‹ä¿¡æ¯.</li>
<li><code>backtrace-frame</code> å‡½æ•°: è¿”å›ç¬¬ <code>FRAME-NUMBER</code> å±‚çº§æ ˆå¸§çš„ä¿¡æ¯.</li>
</ul>
</div>
</li>
</ul>
</div>


<div id="outline-container-org1c48640" class="outline-4">
<h4 id="org1c48640">Edebug</h4>
<div class="outline-text-4" id="text-org1c48640">
<p>
<code>Emacs Lisp</code> çš„ä»£ç çº§è°ƒè¯•(source-level debugger),æ¯” <code>Debugger</code> å¼ºå¤§å¥½å¤š.
</p>
</div>

<ul class="org-ul">
<li><a id="orgd4a9ea0"></a>ä½¿ç”¨Edebug (Using Edebug)<br>
<div class="outline-text-5" id="text-orgd4a9ea0">
<p>
ä½¿ç”¨ <code>Edebug</code> è°ƒè¯•éœ€è¦å…ˆ <code>instrument</code> <code>Lisp</code> ä»£ç ,æœ€ç®€å•çš„åšæ³•å°±æ˜¯æŠŠæŒ‡é’ˆç§»åŠ¨åˆ°å‡½æ•°æˆ–è€…å®çš„å®šä¹‰ç„¶åæ‰§è¡Œ <code>C-u C-M-x</code> ,ä¹Ÿå°±æ˜¯å¸¦å‰ç¼€å‚æ•°çš„ <code>eval-defun</code> å‘½ä»¤.
</p>

<p>
ä¸€æ—¦å®Œæˆ,ä»»ä½•è¯¥å‡½æ•°/å®çš„è°ƒç”¨å°±ä¼šæ¿€æ´» <code>Edebug</code>,å®šä¹‰çš„æºä»£ç çš„ç¼“å†²åŒºå°±ä¼šä¸´æ—¶å˜æˆ <code>read-only</code>,å½“è¡Œçš„å·¦è¾¹ä¼šæœ‰ä¸€ä¸ªç®­å¤´è¡¨ç¤ºå½“å‰æ‰§è¡Œçš„è¡Œ,ç„¶åå°±å¯ä»¥åœ¨ä¸Šé¢æ‰§è¡Œè°ƒè¯•å‘½ä»¤.
</p>

<p>
å’Œ <code>Debugger</code> ä¸€æ ·,æ¯ä¸€ä¸ª <code>list</code> è¡¨è¾¾å¼çš„å‰é¢å’Œåé¢éƒ½æ˜¯ç‚¹,å’Œå˜é‡å¼•ç”¨çš„åé¢ä¹Ÿæ˜¯ç‚¹, <code>Edebug</code> å¯ä»¥åœ¨è¿™äº›ç‚¹ä¸Šé¢åœæ­¢æ‰§è¡Œ,å«åšåœæ­¢ç‚¹(stop points).
</p>

<p>
å¯ä»¥é€šè¿‡ <code>&lt;SPC&gt;</code> æ¥æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªåœæ­¢ç‚¹,å½“ <code>Edebug</code> åœ¨ä¸€ä¸ªè¡¨è¾¾å¼åé¢åœæ­¢æ‰§è¡Œ,å°±ä¼šåœ¨å›æ˜¾åŒºåŸŸé‡Œé¢æ˜¾ç¤ºè¡¨è¾¾å¼çš„å€¼.
</p>

<p>
å…¶å®ƒå¸¸ç”¨å‘½ä»¤æœ‰:
</p>

<ul class="org-ul">
<li>b: åœ¨åœæ­¢ç‚¹è®¾ç½® <code>breakpoint</code></li>
<li>g: æ‰§è¡Œç›´åˆ°åˆ°è¾¾ä¸€ä¸ª <code>breakpoint</code></li>
<li>q: é€€å‡º <code>Edebug</code></li>
<li>?: <code>Edebug</code> çš„å¸®åŠ©å‘½ä»¤</li>
</ul>
</div>
</li>


<li><a id="org6c3b3c8"></a>Instrumenting<br>
<div class="outline-text-5" id="text-org6c3b3c8">
<p>
<code>Instrumenting</code> ä»£ç å…¶å®å°±æ˜¯ç»™æºä»£ç æ’å…¥é¢å¤–çš„ä»£ç (å½“ç„¶å¹¶æ²¡æœ‰ä¿®æ”¹æºä»£ç ),ç”¨æ¥åœ¨åˆé€‚çš„åœ°æ–¹å”¤é†’ <code>Edebug</code>.
</p>

<p>
å¦‚æœè¦ç§»é™¤ä»£ç çš„ <code>instrumentation</code>,åªè¦ä»¥ä¸æ·»åŠ  <code>instrumentation</code> çš„æ–¹å¼é‡æ–°è¿è¡Œä¸€éå°±å¥½äº†.(åœ¨ <code>instrumenting</code> ä¹‹åä¿®æ”¹æºä»£ç ä¼šå¯¼è‡´ <code>instrumentation</code> å¤±æ•ˆ).
</p>

<p>
å¦‚æœæ¥ç§»é™¤å•ä¸ªå®šä¹‰çš„ <code>instrumentation</code>,å¯ä»¥åœ¨å®šä¹‰ä¸Šé¢æ‰§è¡Œ <code>C-M-x</code>,ä¹Ÿå°±æ˜¯ <code>eval-defun</code> å‘½ä»¤.
</p>

<p>
å¯ä»¥é€šè¿‡ <code>M-x edebug-all-defs</code> æ¥åˆ‡æ¢ <code>edebug-all-defs</code> å˜é‡,è¯¥å˜é‡å¯ä»¥æ§åˆ¶ <code>eval-defun</code> æ˜¯å¦ä½¿ç”¨å‰ç¼€å‚æ•°æ¥ <code>instrument</code> å®šä¹‰, <code>nil</code> è¡¨ç¤ºéœ€è¦.
</p>

<p>
å¦‚æœ <code>edebug-all-defs</code> ä¸º <code>non-nil</code>,é‚£ä¹ˆç›´æ¥ç§»é™¤å•ä¸ªå®šä¹‰çš„ <code>instrumentation</code> å°±éœ€è¦ <code>C-u C-M-x</code>,ä¸º <code>non-nil</code> æ—¶å€™è¿˜å¯ä»¥é…åˆ <code>eval-region, eval-current-buffer å’Œ eval-buffers</code> å‘½ä»¤æ¥æ‰¹é‡ <code>instrument</code>,
</p>

<p>
å¦‚æœè¦æ‰¹é‡ç§»é™¤ <code>instrumentations</code> å…ˆæŠŠ <code>edebug-all-defs</code> åˆ‡æ¢å›å»å†æ¬¡è¿è¡Œå‘½ä»¤å°±å¯ä»¥äº†(å¯ä»¥ç”¨ <code>eval-buffer</code> ä½“éªŒä¸€ä¸‹).
</p>

<p>
è¿˜æœ‰ä¸€ä¸ªç‰¹å®šç”¨æ¥æ§åˆ¶ <code>eval-region</code> æ˜¯å¦ <code>instrument</code> çš„ <code>edebug-all-forms</code>.
</p>

<p>
<code>M-x edebug-eval-top-level-form</code> ä¼šæ— è§† <code>edebug-all-defs</code> å’Œ <code>edebug-all-forms</code> çš„å€¼æ¥è¿›è¡Œ <code>instrumenting</code>. <code>edebug-defun</code> æ˜¯å®ƒçš„åˆ«å.
</p>

<p>
å½“ <code>Edebug</code> æ¿€æ´»çš„æ—¶å€™,å‘½ä»¤I (<code>edebug-instrument-callee</code>) å¯ä»¥æ ¹æ®è°ƒç”¨æ¥ <code>instrument</code> å®šä¹‰(å½“ç„¶åªèƒ½æ˜¯æ²¡æœ‰æ·»åŠ instrumentationçš„æƒ…å†µä¸‹).
</p>

<p>
æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fac</span> (n)
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (&lt; 0 n)
      (* n (fac (1- n)))
    (return-res 1)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">return-res</span> (n)
  (+ n 0))

(fac 3)
</pre>
</div>

<p>
å¦‚æœ <code>edebug</code> æ¿€æ´»äº†,ä¸Šé¢ <code>instrument fac</code> åªä¼šç»™ <code>fac</code> æ·»åŠ  <code>instrumentation</code>,è°ƒè¯•çš„æ—¶å€™å¯ä»¥æŠŠæŒ‡é’ˆç§»åŠ¨åˆ° <code>(return-res 1)</code> çš„å‰é¢ä½¿ç”¨Iå‘½ä»¤,
</p>

<p>
è¿™æ ·åœ¨ <code>fac</code> è°ƒç”¨ <code>(return-res 1)</code> çš„æ—¶å€™å°±ä¼šè¿›å…¥ <code>return-res</code> .å½“ç„¶åªèƒ½åœ¨ <code>Edebug</code> çŸ¥é“å®šä¹‰æºä»£ç ä½ç½®çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨è¿™å‘½ä»¤.
</p>

<p>
å¦‚æœæƒ³ç›´æ¥è·³è¿› <code>return-res</code>,å¯ä»¥ç›´æ¥ä½¿ç”¨iå‘½ä»¤,å®ƒä¼šå…ˆæ˜¯ <code>instrument</code> å®šä¹‰å¹¶ä¸”ç›´æ¥è·³è½¬.
</p>

<p>
Edebug çŸ¥é“å¦‚ä½• <code>instrument</code> æ‰€æœ‰æ ‡å‡† <code>special forms</code>,ä½†æ˜¯ä¸èƒ½é å®ƒè‡ªå·±åˆ¤æ–­ç”¨æˆ·å®šä¹‰å®(user-defined macro)çš„å‚æ•°ä¿¡æ¯.
</p>

<p>
å› æ­¤å”¯ä¸€é€šè¿‡ä½¿ç”¨ <code>Edebug specifications</code> æ¥æä¾›ä¿¡æ¯.å½“ <code>Edebug</code> ç¬¬ä¸€æ¬¡ <code>instrument</code> ä»£ç ,å®ƒä¼šè¿è¡Œ <code>edebug-setup-hook</code> é’©å­ç„¶åæŠŠè¿™ä¸ªé’©å­è®¾ç½®ä¸º <code>nil</code>,å¯ä»¥ä½¿ç”¨è¿™ä¸ªé’©å­æä¾› <code>Edebug specification</code>.
</p>
</div>
</li>


<li><a id="orgc57771b"></a>Edebugæ‰§è¡Œæ¨¡å¼ (Edebug Execution Modes)<br>
<div class="outline-text-5" id="text-orgc57771b">
<p>
<code>Edebug</code> æœ‰å¾ˆå¤šä¸ªæ‰§è¡Œæ¨¡å¼,æ¯”å¦‚å¯ä»¥æ‰‹åŠ¨é€æ­¥æ‰§è¡Œ,å¯ä»¥è‡ªåŠ¨é€æ­¥æ‰§è¡Œ,å¯ä»¥æ‰‹åŠ¨é€ä¸ªæ–­ç‚¹æ‰§è¡Œ,å½“ç„¶ä¹Ÿå¯ä»¥è‡ªåŠ¨é€ä¸ªæ–­ç‚¹æ‰§è¡Œ,ç”šè‡³å¯ä»¥æ— è§†æ–­ç‚¹æ‰§è¡Œ.
</p>

<p>
åœ¨ä¸¤ç§æƒ…å†µä¸‹å¯ä»¥è®¾å®šæ¨¡å¼,åˆ†åˆ«æ˜¯ä½¿ç”¨å¯¹åº”æ¨¡å¼çš„å‘½ä»¤æ¥è®¾å®šè°ƒè¯•æ—¶çš„æ¨¡å¼å’Œè®¾å®šè°ƒè¯•å¼€å§‹æ—¶çš„æ¨¡å¼.
</p>

<p>
æ–‡æ¡£æ²¡æœ‰æ˜è¯´, <code>Edebug</code> å’Œ <code>Debugger</code> ä¸€æ ·éƒ½æ˜¯é€’å½’ç¼–è¾‘,æ¯è¿ç®—ä¸€æ¬¡è¡¨è¾¾å¼éƒ½æ˜¯è¿›å…¥ <code>Edebug</code>,è‡ªå·±è¦æ¸…æ¥šè¿™ä¸€ç‚¹.
</p>

<p>
ä¸‹é¢æ˜¯å‘½ä»¤,
</p>

<ul class="org-ul">
<li>S: Stop,ä¸å†æ‰§è¡Œè°ƒè¯•,ç­‰å¾…è°ƒè¯•å‘½ä»¤.</li>
<li><code>&lt;SPC&gt;</code>: Step,åœ¨ä¸‹ä¸€ä¸ªåœæ­¢ç‚¹å¤„åœæ­¢.</li>
<li>n: Next,åœ¨ä¸‹ä¸€ä¸ªè¡¨è¾¾å¼çš„åé¢çš„åœæ­¢ç‚¹å¤„åœæ­¢.</li>
<li>t: Trace,é»˜è®¤æ¯ä¸€ç§’åè¿è¡Œåˆ°ä¸‹ä¸€ä¸ªåœæ­¢ç‚¹,å°±æ˜¯ <code>&lt;SPC&gt;</code> çš„è‡ªåŠ¨æ¨¡å¼.</li>
<li>T: Rapid trace, <code>t</code> çš„å¿«é€Ÿæ‰§è¡Œæ¨¡å¼,ä¸­é—´æ²¡æœ‰åœé¡¿.</li>
<li>g: Go,è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹.</li>
<li>c: Continue,åœ¨æ¯ä¸ªæ–­ç‚¹å¤„åœç•™ä¸€ç§’,ç„¶åç»§ç»­,å°±æ˜¯ <code>g</code> çš„è‡ªåŠ¨æ¨¡å¼.</li>
<li>C: Rapid continue: <code>c</code> çš„å¿«é€Ÿæ‰§è¡Œæ¨¡å¼,ä¸­é—´æ²¡æœ‰åœé¡¿.</li>
<li>G: Go non-stop,æ— è§†æ–­ç‚¹æ‰§è¡Œ,å¯ä»¥é€šè¿‡ <code>S</code> åœæ­¢.</li>
</ul>

<p>
å¯ä»¥é€šè¿‡ <code>edebug-set-initial-mode</code> å‘½ä»¤è®¾ç½® <code>edebug-initial-mode</code> æ¥è®¾å®š <code>Edebug</code> çš„åˆå§‹æ¨¡å¼.
</p>

<p>
å¯¹äºè‡ªåŠ¨æ¨¡å¼çš„åœé¡¿æ—¶é—´,å¯ä»¥é€šè¿‡è®¾ç½® <code>edebug-sit-for-seconds</code> å˜é‡æ¥ä¿®æ”¹.
</p>
</div>
</li>


<li><a id="orgbabd379"></a>è·³è½¬ (Jumping)<br>
<div class="outline-text-5" id="text-orgbabd379">
<p>
è·³è½¬å°±æ˜¯æŒ‡æ‰§è¡Œåˆ°å“ªä¸ªåœæ­¢ç‚¹.å‘½ä»¤å¦‚ä¸‹,
</p>

<ul class="org-ul">
<li>h: æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹.</li>
<li>f: æ‰§è¡Œå®Œä¸€ä¸ªè¡¨è¾¾å¼.</li>
<li>o: æ‰§è¡Œå®Œä¸€ä¸ª <code>containing sexp</code>,ä¹Ÿå°±æ˜¯è·³å‡º(step out).</li>
<li>i: è·³è¿›ä¸€ä¸ªåœå­—ç‚¹åé¢å‡½æ•°æˆ–è€…å®(step in).</li>
</ul>

<p>
å…·ä½“è¯´æ˜è¿˜æ˜¯çœ‹æ–‡æ¡£å§.
</p>
</div>
</li>


<li><a id="org06b47f6"></a>Edebug çš„æ‚é¡¹å‘½ä»¤ (Edebug Misc)<br>
<div class="outline-text-5" id="text-org06b47f6">
<ul class="org-ul">
<li>?: å¸®åŠ©å‘½ä»¤.</li>
<li>C-]: ç»ˆæ­¢(abort)ä¸€ä¸ª <code>level</code> è¿”å›åˆ°ä¸Šä¸€ä¸ª <code>command level</code>.</li>
<li>q: è¿”å›åˆ° <code>top level</code>,ä¹Ÿå°±æ˜¯åœæ­¢ <code>edebug</code> è°ƒè¯•å™¨.ç„¶è€Œ,è¢« <code>unwind-protect</code> æˆ–è€… <code>condition-case</code> ä¿æŠ¤çš„ <code>instrumented code</code> ä¼šæ¢å¤ <code>edebug</code>.</li>
<li>Q: åƒ <code>q</code> ä¸€æ ·,ä¸è¿‡æ— è§†è¢«ä¿æŠ¤çš„ä»£ç .</li>
<li>r: é‡æ–°æ˜¾ç¤ºæœ€è¿‘çš„è¡¨è¾¾å¼çš„ç»“æœ.</li>
<li>d: æ˜¾ç¤º <code>backtrace</code>,è¿™ä¸ª <code>backtrace</code> ä¸åƒæ ‡å‡†çš„ <code>Debugger</code> é‚£æ ·æ‰§è¡Œå‘½ä»¤.ç»§ç»­æ‰§è¡Œçš„æ—¶å€™ä¼šè‡ªåŠ¨å…³é—­ <code>backtrace</code>.</li>
</ul>
</div>
</li>


<li><a id="org6afa966"></a>ä¸­æ–­ (Breaks)<br>
<div class="outline-text-5" id="text-org6afa966">
<p>
ä¸€æ—¦ <code>Edebug</code> å¼€å§‹,é™¤äº† <code>step mode</code> å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªåœæ­¢ç‚¹åœæ­¢æ‰§è¡Œ,è¿˜æœ‰å…¶å®ƒä¸‰ç§æ–¹æ³•å¯ä»¥åœæ­¢æ‰§è¡Œ.
</p>
</div>

<ul class="org-ul">
<li><a id="orgb7b2661"></a>æ–­ç‚¹ (Breakpoints)<br>
<div class="outline-text-6" id="text-orgb7b2661">
<p>
å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªåœæ­¢ç‚¹è®¾ç½®æ–­ç‚¹.å…³äºæ–­ç‚¹çš„å‘½ä»¤å¦‚ä¸‹:
</p>

<ul class="org-ul">
<li>b: åœ¨åœæ­¢ç‚¹è®¾ç½®æ–­ç‚¹.å¦‚æœä½¿ç”¨äº†å‰ç¼€å‚æ•°,æ–­ç‚¹å°±æ˜¯ä¸´æ—¶çš„,åœæ­¢è°ƒè¯•åæ–­ç‚¹å°±å¤±æ•ˆäº†.</li>
<li>u: å–æ¶ˆæ–­ç‚¹.</li>
<li><code>x CONDITION &lt;RET&gt;</code>: æ¡ä»¶æ–­ç‚¹,åªæœ‰ <code>CONDITION</code> ç»“æœä¸º <code>non-nil</code> æ‰ä¼šåœæ­¢.åŒæ ·,å¦‚æœä½¿ç”¨äº†å‰ç¼€å‚æ•°çš„è¯å°±æ˜¯ä¸´æ—¶çš„.</li>
<li>B: ç§»åŠ¨åˆ°å½“å‰å®šä¹‰çš„ä¸‹ä¸€ä¸ªæ–­ç‚¹.</li>
</ul>
</div>
</li>

<li><a id="orge250350"></a>å…¨å±€ä¸­æ–­æ¡ä»¶ (Global Break Condition)<br>
<div class="outline-text-6" id="text-orge250350">
<p>
å…¨å±€ä¸­æ–­æ¡ä»¶ä¸ç®¡åœ¨å“ªé‡Œ,åªè¦æ¡ä»¶ç¬¦åˆå°±åœæ­¢è°ƒè¯•çš„æ‰§è¡Œ. <code>Edebug</code> ä¼šåœ¨æ¯ä¸ªåœæ­¢ç‚¹è¿ç®—å…¨å±€ä¸­æ–­æ¡ä»¶çš„å€¼,å¦‚æœç»“æœä¸º <code>non-nil</code> å°±åœæ­¢æˆ–è€…æš‚åœæ‰§è¡Œ,å’Œæ–­ç‚¹ä¸€æ ·.ç„¶è€Œå¦‚æœè¿è¡Œæ¡ä»¶çš„æ—¶å€™æŠ¥é”™æ˜¯ä¸ä¼šåœæ­¢.
</p>

<p>
æ¡ä»¶è¡¨è¾¾å¼å‚¨å­˜åœ¨ <code>edebug-global-break-condition</code> å˜é‡é‡Œé¢.å¯ä»¥åœ¨å·²ç»æ¿€æ´»äº† <code>Edebug</code> çš„æºä»£ç ç¼“å†²åŒºä¸­ä½¿ç”¨Xå‘½ä»¤æ¥æ·»åŠ æ¡ä»¶è¡¨è¾¾å¼,ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>C-x X X</code> æŒ‰é”®(ç»‘å®š <code>edebug-set-global-break-condition</code>)åœ¨ä»»ä½•ç¼“å†²åŒºä¸­æ·»åŠ æ¡ä»¶è¡¨è¾¾å¼.
</p>

<p>
å…¨å±€ä¸­æ–­æ¡ä»¶å¾ˆå®¹æ˜“è®©è°ƒè¯•å˜æ…¢,å¦‚æœä¸ä½¿ç”¨çš„è¯è¦æŠŠ <code>edebug-global-break-condition</code> è®¾ç½®ä¸º <code>nil</code>.
</p>
</div>
</li>

<li><a id="orgce9afb1"></a>æºç æ–­ç‚¹ (Source Breakpoints)<br>
<div class="outline-text-6" id="text-orgce9afb1">
<p>
ä¸Šé¢é€šè¿‡bå‘½ä»¤è®¾ç½®çš„æ–­ç‚¹ä¼šåœ¨ <code>reinstrument</code> å®šä¹‰åè¢«é—å¿˜(é™¤äº†Emacs,äººä¹Ÿå¯èƒ½ä¼šå¿˜è®°),è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨"æºç æ–­ç‚¹"(å’Œ <code>Debugger</code> çš„ <code>(debug)</code> çš„ç”¨æ³•ä¸€æ ·).
</p>

<p>
åœ¨æƒ³è¦æ–­ç‚¹çš„åœ°æ–¹æ’å…¥ <code>(edebug)</code> è¡¨è¾¾å¼,å¦‚æœå®šä¹‰æ²¡æœ‰è¢« <code>instrument</code>,é‚£ä¹ˆé‡åˆ° <code>(edebug)</code> å°±ä¼šè½¬è€Œè°ƒç”¨ <code>debug</code> å‡½æ•°.å¯ä»¥ä½¿ç”¨gå‘½ä»¤è·³è½¬åˆ°è¿™ç§æ–­ç‚¹èº«ä¸Š.
</p>
</div>
</li>
</ul>
</li>


<li><a id="org56c9046"></a>æ•æ‰é”™è¯¯ (Trapping Errors)<br>
<div class="outline-text-5" id="text-org56c9046">
<p>
è®¾ç½® <code>edebug-on-error</code> æˆ–è€… <code>edebug-on-quit</code> å¯ä»¥å¿«é€Ÿå®šä½æ²¡æœ‰è¢«å¤„ç†é”™è¯¯(unhandled errors),å°±æ‹¿ <code>edebug-on-error</code> æ¥è¯´,å®ƒå’Œ <code>debug-on-error</code> çš„è®¾ç½®ç±»ä¼¼,ç”¨ä¸‹é¢çš„ä¾‹å­æ¥æ¼”ç¤º.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> edebug-on-error t)

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#24403;&#28982;&#35201;&#20808; instrument fac &#30340;&#23450;&#20041;,&#36825;&#26159;&#24517;&#39035;&#30340;</span>
(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fac</span> (n)
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (&lt; 0 n)
      (* n (fac (1- n)))
    (return-res nil))) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">&#38169;&#35823;&#22312;&#36825;&#37324;,&#20250;&#22312; (return-res nil)&#21069;&#38754;&#30340;&#20572;&#27490;&#28857;&#20572;&#19979;</span>

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">return-res</span> (n)
  (+ n 0))

(fac 3)
</pre>
</div>

<p>
åœ¨è¿™ä¸ªä¾‹å­ä¸­å¯ä»¥ä½¿ç”¨ <code>Rapid Trace</code> æ¨¡å¼æ¥ç›´æ¥è¿è¡Œåˆ°é”™è¯¯å‘ç”Ÿçš„åœ°æ–¹,ä¼šå‘ç”Ÿå’Œæ³¨é‡Šä¸€æ ·çš„ç»“æœ.å¦‚æœæŠŠ <code>edebug-on-error</code> è®¾ç½®ä¸º <code>nil</code>,æ˜¯ä¸ä¼šåœæ­¢åˆ°é”™è¯¯å‘ç”Ÿçš„åœ°æ–¹,è€Œæ˜¯ç›´æ¥åœ¨å›æ˜¾åŒºåŸŸæ˜¾ç¤ºä¿¡æ¯.
</p>
</div>
</li>


<li><a id="org23b94fe"></a>Edebug Views<br>
<div class="outline-text-5" id="text-org23b94fe">
<p>
ä¸€äº›ç”¨æ¥æµè§ˆå·²ç»æ¿€æ´» <code>Edebug</code> çš„ç¼“å†²åŒºå’Œçª—å£çŠ¶æ€çš„å„ä¸ªæ–¹é¢.
</p>

<p>
å¤–éƒ¨çª—å£é…ç½®(outside window configuration) é›†åˆäº†çª—å£(windows)å’Œåœ¨ <code>Edebug</code> å¤–éƒ¨æœ‰æ•ˆ(in effect)çš„å†…å®¹(ä¸ªäººè®¤ä¸ºåƒæ˜¯å‘ç”Ÿè°ƒç”¨çš„åœ°æ–¹).
</p>

<ul class="org-ul">
<li>v: åˆ‡æ¢åˆ°å¤–éƒ¨çª—å£é…ç½®ä¸­.</li>
<li>p: ä¸´æ—¶åˆ‡æ¢åˆ°ç­‰å¾… <code>N</code> ç§’(å¯ä»¥é€šè¿‡ <code>C-u N p</code> è®¾å®šæš‚åœæ—¶é—´)åè¿”å› <code>Edebug</code> ä¸­.</li>
<li>w: æŠŠç‚¹(point)è¿”å›åˆ°åˆ°æºç ç¼“å†²åŒºå½“å‰çš„åœæ­¢ç‚¹ä¸Š.</li>
<li>W: åˆ‡æ¢æ˜¯å¦ä¿å­˜å’Œæ¢å¤å¤–éƒ¨çª—å£é…ç½®,æœ‰å‰ç¼€å‚æ•°çš„è¯å°±è¡¨æ˜åªæ˜¯å¯¹è¢«é€‰æ‹©çª—å£åˆ‡æ¢æ˜¯å¦ä¿å­˜å’Œæ¢å¤.</li>
</ul>
</div>
</li>


<li><a id="orgc5d98ab"></a>è¿ç®— (Edebug Eval)<br>
<div class="outline-text-5" id="text-orgc5d98ab">
<p>
å½“ <code>Edebug</code> å¯ç”¨çš„æ—¶å€™,ä½ å¯ä»¥åƒåœ¨æ²¡æœ‰è¿è¡Œ <code>Edebug</code> çš„æƒ…å†µä¸‹è¿ç®—è¡¨è¾¾å¼.
</p>

<ul class="org-ul">
<li><code>e EXP &lt;RET&gt;</code>,åœ¨ <code>Edebug</code> å¤–éƒ¨çš„ä¸Šä¸‹æ–‡è¿ç®—è¡¨è¾¾å¼ <code>EXP</code>.è¿™æ · <code>Edebug</code> å¯ä»¥å‡å°‘å®ƒå’Œè¿ç®—ä¹‹é—´çš„å†²çª/å¹²æ‰°(interference).</li>

<li><code>M-: EXP &lt;RET&gt;</code>,åœ¨ <code>Edebug</code> çš„ä¸Šä¸‹æ–‡ä¸­è¿ç®—è¡¨è¾¾å¼ <code>EXP</code>.</li>

<li><code>C-x C-e</code>,åœ¨ <code>Edebug</code> å¤–é¢è¿ç®—ç‚¹ä¹‹å‰è¡¨è¾¾å¼.</li>
</ul>

<p>
<code>Edebug</code> æ”¯æŒè¿ç®—å¼•ç”¨ç”± <code>cl.el</code> é‡Œé¢ <code>lexical-let, macrolet</code> å’Œ <code>symbol-macrolet</code> è¯æ³•ç»‘å®šçš„ <code>symbols</code> çš„è¡¨è¾¾å¼.
</p>
</div>
</li>


<li><a id="orgbaa8b4a"></a>è¿ç®—åˆ—è¡¨ç¼“å†²åŒº (Eval List)<br>
<div class="outline-text-5" id="text-orgbaa8b4a">
<p>
å¯ä»¥ä½¿ç”¨è¿ç®—åˆ—è¡¨ç¼“å†²åŒº(evaluation list buffer),å«åš <code>*edebug*</code> çš„ç¼“å†²åŒº,æ¥äº¤äº’è¿ç®—è¡¨è¾¾å¼.ä¹Ÿå¯ä»¥è®¾ç½®è¡¨è¾¾å¼çš„è¿ç®—åˆ—è¡¨(evaluation list),è¿™æ ·å®ƒä»¬åœ¨æ¯æ¬¡ <code>Edebug</code> æ›´æ–°æ˜¾ç¤ºçš„æ—¶å€™éƒ½ä¼šæ›´æ–°.
</p>

<p>
åœ¨ <code>Edebug</code> æ¿€æ´»ä¹‹åä½¿ç”¨ <code>E</code> å‘½ä»¤åˆ‡æ¢åˆ°è¿ç®—åˆ—è¡¨ç¼“å†²åŒº &#x2013; <code>*edebug*</code>,ç„¶ååœ¨é‡Œé¢æ·»åŠ å…ƒç´ è¡¨è¾¾å¼ç»„(evaluation list groups).ä¸€ä¸ªè¿ç®—è¡¨è¾¾å¼ç»„åŒ…å«ä¸€åˆ°å¤šæ¡è¡¨è¾¾å¼,ç”¨æ³¨é‡Šè¡Œ(comment lines)åˆ†ç»„,å¦‚ä¸‹
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(point)
                                        <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">whatever comment you like, but the ';' must be without any prefix.</span>
this-command
                                        <span style="color: #5F7F5F;">;</span>
undefined
                                        <span style="color: #5F7F5F;">;</span>
</pre>
</div>

<p>
å†ä½¿ç”¨ <code>C-c C-u</code> æ ¹æ® <code>*edebug*</code> ç¼“å†²åŒºçš„å†…å®¹å»ºç«‹æ–°çš„è¿ç®—åˆ—è¡¨(evaluation list),ç»“æœå¦‚ä¸‹
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(point)
264
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">------------------------------------------------------------------------------------------------------</span>
this-command
eval-last-sexp
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">------------------------------------------------------------------------------------------------------</span>
undefined
<span style="color: #CC9393;">"Symbol's value as variable is void: undefined"</span>
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">------------------------------------------------------------------------------------------------------</span>
</pre>
</div>

<p>
ä½¿ç”¨ <code>C-c C-u</code> è¿ç®—çš„è¯,åªæœ‰æ¯ä¸ªç»„çš„ç¬¬ä¸€æ¡è¡¨è¾¾å¼ä¼šæ‰§è¡Œ,ç»“æœä¼šæ˜¾ç¤ºåœ¨ç¬¬äºŒè¡Œ,å…¶å®ƒè¡Œä¼šè¢«åˆ é™¤.å¦‚æœè¿ç®—æ—¶å€™å‘ç”Ÿé”™è¯¯,é‚£ä¹ˆé”™è¯¯ä¿¡æ¯å°±ä¼šä½œä¸ºç»“æœ.
</p>

<p>
è¿˜å¯ä»¥æŠŠæŒ‡é’ˆç§»åŠ¨åˆ°ç»„å†…ç„¶åä½¿ç”¨ <code>C-c C-d</code> åˆ é™¤åˆ†ç»„.
</p>

<p>
é™¤äº† <code>C-c C-u</code>,è¿˜æœ‰å…¶å®ƒè¿è¡Œæ¨¡å¼,çœ‹æ–‡æ¡£å°±å¥½.
</p>
</div>
</li>


<li><a id="org1aa4abe"></a>Edebug çš„æ‰“å° (Printing in Edebug)<br>
<div class="outline-text-5" id="text-org1aa4abe">
<p>
å¦‚æœå°è¯•åœ¨ <code>Edebug</code> ä¸­æ‰“å°ä¸€ä¸ªåŒ…å«å¾ªç¯åˆ—è¡¨ç»“æ„çš„å€¼,é‚£ä¹ˆå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯.
</p>

<p>
å…‹æœ(cope with)å¾ªç¯ç»“æ„çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯æŠŠ <code>print-length</code> æˆ–è€… <code>print-level</code> æ¥åˆ†æ–­æ˜¾ç¤º. <code>Edebug</code> å·²ç»å¸®ä½ åšå¥½äº†.
</p>

<p>
å®ƒæŠŠè¿™ä¸¤ä¸ªå˜é‡åˆ†åˆ«ç»‘å®šåˆ° <code>edebug-print-length</code> å’Œ <code>edebug-print-level</code>,é»˜è®¤å€¼éƒ½æ˜¯50.
</p>

<p>
ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® <code>print-circle</code> ä¸º <code>non-nil</code> æ¥æ‰“å°é‚£ç§æœ‰ç€å…±äº«å…ƒç´ çš„å¾ªç¯ç»“æ„ä½“.
</p>

<p>
æ¯”å¦‚
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> a '(x y))
(setcar a a)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#26174;&#31034;&#20026; #1=(#1# y), #1= &#34920;&#31034;&#29992;1&#26631;&#35760;&#32467;&#26500;,#1#&#34920;&#31034;&#24341;&#29992;&#21069;&#19968;&#20010;&#34987;&#26631;&#35760;&#30340;&#32467;&#26500;.&#36825;&#20010;&#26631;&#35760;&#21487;&#20197;&#29992;&#22312;&#20219;&#20309;&#21015;&#34920;&#25110;&#32773;&#21521;&#37327;&#30340;&#20849;&#20139;&#20803;&#32032;&#19978;.</span>
</pre>
</div>

<p>
ç›¸åº”çš„ <code>Edebug</code> æœ‰ <code>edebug-print-circle</code>,ä¼šæŠŠè¿™ä¸ªå˜é‡çš„å€¼ç»‘å®šç»™ <code>print-circle</code>.
</p>
</div>
</li>


<li><a id="org9c1e07e"></a>è¿è¡Œæ­¥éª¤ç¼“å†²åŒº (Trace Buffer)<br>
<div class="outline-text-5" id="text-org9c1e07e">
<p>
<code>Edebug</code> å¯ä»¥æŠŠæ‰§è¡Œæ­¥éª¤è®°å½•åœ¨å«åš <code>*edebug-trace*</code> çš„ç¼“å†²åŒºä¸­,ä¸€ä¸ªå‡½æ•°è°ƒç”¨å’Œè¿”å›çš„æ—¥å¿—,æ˜¾ç¤ºå‡½æ•°çš„åå­—å’Œå®ƒä»¬çš„å‚æ•°å’Œå€¼.åªè¦æŠŠ <code>edebug-trace</code> è®¾ç½®ä¸º <code>non-nil</code> å°±å¯ä»¥å¯ç”¨è¯¥åŠŸèƒ½.
</p>

<p>
æ¯”å¦‚ä¸Šé¢ <code>fac</code> çš„è®°å½•ä¼šæ˜¯è¿™æ ·,
</p>

<pre class="example" id="orgb8bb8aa">
{ fac args: (3)
:{ fac args: (2)
::{ fac args: (1)
:::{ fac args: (0)
:::} fac result: 1
::} fac result: 1
:} fac result: 2
} fac result: 6
</pre>

<p>
<code>{</code> å’Œ <code>}</code> åˆ†åˆ«è¡¨ç¤ºå‡½æ•°çš„å…¥å£å’Œå‡ºå£, <code>:</code> è¡¨ç¤ºé€’å½’æ·±åº¦,åŒä¸€æ·±åº¦çš„ <code>{</code> å¯¹åº”åŒæ ·æ·±åº¦çš„ <code>}</code>.å¯ä»¥é€šè¿‡é‡æ–°å®šä¹‰ <code>edebug-print-trace-before</code> å’Œ <code>edebug-print-trace-after</code> å‡½æ•°æ¥è‡ªå®šä¹‰è®°å½•å‡½æ•°å…¥å£å’Œå‡ºå£æ˜¾ç¤ºçš„æ¡ç›®.
</p>

<p>
<code>edebug-tracing</code> å’Œ <code>edebug-trace</code> å‡½æ•°åœ¨ <code>*edebug*</code> ä¸­æ’å…¥è¡Œ,ä¸ç®¡æ˜¯å¦å¯ç”¨ <code>Edebug</code>.æ’å…¥è¡Œä¹Ÿä¼šè‡ªåŠ¨æ»šåŠ¨çª—å£æ¥æ˜¾ç¤ºæœ€æ–°è¡Œ.
</p>
</div>
</li>


<li><a id="org30e4bac"></a>è¦†ç›–æµ‹è¯• (Coverage Testing)<br>
<div class="outline-text-5" id="text-org30e4bac">
<p>
<code>Edebug</code> è¿˜æä¾›ä¸å®Œå…¨çš„è¦†ç›–å‚æ•°å’Œæ‰§è¡Œé¢‘æ¬¡(execution frequency)çš„æ˜¾ç¤º.
</p>

<p>
<b>è¦†ç›–å‚æ•°çš„åŸç†å°±æ˜¯æ¯”è¾ƒæ¯ä¸ªè¡¨è¾¾å¼çš„å½“å‰ç»“æœå’Œä¸Šä¸€æ¬¡ç»“æœ,å¦‚æœè¿”å›çš„ä¸¤ä¸ªç»“æœä¸ä¸€æ ·,è¿™ä¸ªè¡¨è¾¾å¼è¢«è¦†ç›–äº†</b>.
</p>

<p>
è¦†ç›–å‚æ•°å°±æ˜¯éœ€è¦åœ¨å¤§é‡çš„å„ç§ä¸åŒæ¡ä»¶ä¸‹æ‰§è¡Œç¨‹åº,å¹¶ä¸”è§‚å¯Ÿç¨‹åºæ˜¯å¦ç¬¦åˆé¢„æœŸ, <code>Edebug</code> ä¼šåœ¨è¶³å¤Ÿçš„å°è¯•åå‘Šè¯‰å¼€å‘äººå‘˜æ˜¯å¦æ¯ä¸ª <code>form</code> è¿”å›ä¸¤ä¸ªä¸åŒç»“æœ.
</p>

<p>
è¦†ç›–æµ‹è¯•ä¼šè®©æ‰§è¡Œå˜æ…¢, <code>edebug-test-coverage</code> ä¸º <code>non-nil</code> çš„æ—¶å€™æµ‹è¯•æ‰€æœ‰è¢«è°ƒè¯•çš„è¡¨è¾¾å¼.
</p>

<p>
ä¸ç®¡æ˜¯å¦å¯ç”¨äº†è¦†ç›–æµ‹è¯•æˆ–è€…æ˜¯å¦ <code>Go-nonstop</code> æ‰§è¡Œæ¨¡å¼, <code>instrumented function</code> çš„æ‰€æœ‰æ‰§è¡Œéƒ½ä¼šä¼´éšé¢‘æ¬¡è®¡æ•°(frequency counting)çš„æ‰§è¡Œ.
</p>

<p>
"C-x X =" (edebug-display-freq-count) å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªå®šä¹‰çš„è¦†ç›–ä¿¡æ¯å’Œé¢‘æ¬¡è®¡æ•°. å•çº¯ = (edebug-temp-display-freq-count) ä¼šä¸´æ—¶æ˜¾ç¤ºåŒæ ·çš„ä¿¡æ¯,çŸ¥é“è¾“å…¥äº†å¦å¤–ä¸€ä¸ªæŒ‰é”®.
</p>

<p>
è¿˜æ˜¯ç”¨é‚£ä¸ªè€ä¾‹å­è¯´æ˜,å½“ç„¶è¿˜æœ‰å…ˆ <code>instrument fac</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> edebug-test-coverage t)

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">1. instrument</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">3. move cursor on definition and execute edebug-display-freq-count command</span>
(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fac</span> (n)
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (&lt; 0 n)
      (* n (fac (1- n)))
    (return-res 1)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">return-res</span> (n)
  (+ n 0))

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">2. then execute, can use Rapid Trace mode for a quick travel</span>
(fac 5)
</pre>
</div>

<p>
<code>edebug-display-freq-count</code> çš„ç”¨æ³•: å…ˆè°ƒè¯•è¿è¡Œä¸€é(å¦åˆ™å…¨éƒ¨æ•°æ®ä¸º0),ç„¶åæŠŠæŒ‡é’ˆç§»åŠ¨åˆ° <code>instrumentd</code> å®šä¹‰ä¸­,ç„¶åæ‰§è¡Œè¯¥å‘½ä»¤æ˜¾ç¤ºè¦†ç›–ä¿¡æ¯å’Œæ‰§è¡Œé¢‘æ¬¡.
</p>

<p>
ç»“æœå¦‚ä¸‹,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> edebug-test-coverage t)

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">1. instrument</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">3. move cursor on definition and execute edebug-display-freq-count command</span>
(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fac</span> (n)
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (&lt; 0 n)
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">#6</span>
      (* n (fac (1- n)))
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">#    5</span>
    (return-res 1)))
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">#  1            = 6</span>

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">return-res</span> (n)
  (+ n 0))

(fac 5)
</pre>
</div>

<p>
æ‰§è¡Œé¢‘æ¬¡ä¼šå‡ºç°åœ¨è¡¨è¾¾å¼å‰é¢çš„ <code>(</code> ,åé¢çš„ <code>)</code> æˆ–è€…æ˜¯å˜é‡æœ€åä¸€ä¸ªå­—æ¯çš„åº•ä¸‹.ä¸ºäº†ç®€åŒ–æ˜¾ç¤º,å¦‚æœè¡¨è¾¾å¼çš„é¢‘æ¬¡è®¡æ•°ç­‰äºåŒä¸€è¡Œä¸­å‰ä¸€ä¸ªè¡¨è¾¾å¼çš„é¢‘æ¬¡,é‚£ä¹ˆè¿™ä¸ªé¢‘æ¬¡å°±ä¸æ˜¾ç¤º.
</p>

<p>
è·Ÿåœ¨é¢‘æ¬¡è®¡æ•°åé¢çš„ "=" å·è¡¨ç¤ºè¡¨è¾¾å¼æ¯æ¬¡æ‰§è¡Œç»“æœéƒ½æ˜¯ä¸€æ ·,ä¹Ÿå°±æ˜¯è¯¥è¡¨è¾¾å¼æ²¡æœ‰è¢«è¦†ç›–.
</p>

<p>
å†ä»¥æ–‡æ¡£ä¸Šçš„ä¾‹å­æ¥åšè¯´æ˜,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">fac</span> (n)
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(edebug) &#21482;&#26159;&#36820;&#22238;&#20102;&#19968;&#27425;,&#19981;&#31639;&#35206;&#30422;.</span>
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(if (= n 0) ... &#25191;&#34892;&#20102;6&#27425;,&#27599;&#27425;&#32467;&#26524;&#37117;&#26159; =nil=.</span>
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">= &#21644;&#39057;&#27425;&#35745;&#25968;&#26159;&#27809;&#26377;&#20851;&#31995;&#30340;,&#20999;&#35760;.</span>
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (= n 0) (edebug))
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">#6           1      = =6</span>
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(&lt; 0 n) &#21644; (if (&lt; 0 n) ... &#30340;&#25191;&#34892;&#39057;&#27425;&#37117;&#26159;&#19968;&#26679;,&#25152;&#20197; (&lt; 0 n) &#27809;&#26377;&#26174;&#31034;&#39057;&#27425;</span>
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(&lt; 0 n) &#27599;&#27425;&#30340;&#32467;&#26524;&#37117;&#20026; t,</span>
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (&lt; 0 n)
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">#6</span>
      <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(* n (fac ...  &#20197;&#21450;&#23427;&#30340;&#23376;&#34920;&#36798;&#24335;&#30340;&#25191;&#34892;&#39057;&#27425;&#37117;&#26159;&#19968;&#26679;&#30340;(&#24182;&#19988;&#37117;&#22312;&#21516;&#19968;&#34892;),&#25152;&#20197;&#31616;&#21270;&#26174;&#31034;&#21482;&#26174;&#31034;&#20102;&#31532;&#19968;&#20010;&#34920;&#36798;&#24335;&#30340;&#25191;&#34892;&#39057;&#27425;.</span>
      (* n (fac (1- n)))
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">#    5</span>
    1))
                                        <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">#   6</span>

(fac 5)
</pre>
</div>

<p>
è¿˜å¯ä»¥åœ¨ <code>Edebug</code> è°ƒè¯•ä¸­çš„æ—¶å€™ä½¿ç”¨ = å‘½ä»¤ä¸´æ—¶æ˜¾ç¤ºè¦†ç›–ä¿¡æ¯å’Œé¢‘æ¬¡è®¡æ•°.
</p>
</div>
</li>


<li><a id="orga9ee4e9"></a>å¤–éƒ¨ä¸Šä¸‹æ–‡ (The Outside Context)<br>
<div class="outline-text-5" id="text-orga9ee4e9">
<p>
å¯¹äºè°ƒè¯•ä¸­çš„ç¨‹åºæ¥è¯´, <code>Edebug</code> å°è¯•å˜å¾—é€æ˜,ç„¶è€Œæ²¡å®Œå…¨æˆåŠŸ.ä¹Ÿå°è¯•è¿‡åœ¨æˆ‘ä»¬è¿è¡Œeå‘½ä»¤æˆ–è€…ä½¿ç”¨è¿ç®—åˆ—è¡¨ç¼“å†²åŒºçš„æ—¶å€™é€šè¿‡ä¸´æ—¶æ¢å¤å¤–éƒ¨ä¸Šä¸‹æ–‡æ¥å˜å¾—é€æ˜.
</p>

<p>
è¿™ä¸ªç« èŠ‚ä¸»è¦ä»‹ç» <code>Edebug</code> å‚¨å­˜ä»€ä¹ˆä¸Šä¸‹æ–‡å¹¶ä¸”ä¸ºä»€ä¹ˆå®Œå…¨é€æ˜.
</p>
</div>

<ul class="org-ul">
<li><a id="org7087ad7"></a>æ£€æŸ¥æ˜¯å¦åœæ­¢ (Checking Whether to Stop)<br>
<div class="outline-text-6" id="text-org7087ad7">
<p>
å½“è¿›å…¥ <code>Edebug</code> çš„æ—¶å€™,å®ƒåœ¨å†³å®šæ˜¯å¦äº§ç”Ÿæ‰§è¡Œä¿¡æ¯(trace information)æˆ–è€…åœæ­¢ç¨‹åºä¹‹å‰å°±éœ€è¦å‚¨å­˜å’Œæ¢å¤ä¸€å®šçš„æ•°æ®.
</p>

<ul class="org-ul">
<li>å¢åŠ  <code>max-lisp-eval-depth</code> å’Œ <code>max-specpdl-size</code> éƒ½å¯ä»¥å‡å°‘ <code>Edebug</code> å¯¹æ ˆçš„å½±å“.ä¸è¿‡è¿™æ ·å¾ˆå®¹æ˜“ç”¨å®Œæ ˆçš„ç©ºé—´.</li>

<li>é”®ç›˜å®çš„æ‰§è¡ŒçŠ¶æ€å›è¢«ä¿å­˜å’Œæ¢å¤.å½“ <code>Edebug</code> æ¿€æ´»çš„æ—¶å€™, <code>executing-kbd-macro</code> ä¼šè®¾ç½®ä¸º <code>nil</code>, é™¤é <code>edebug-continue-kbd-macro</code> ä¸º <code>non-nil</code>.</li>
</ul>
</div>
</li>

<li><a id="orgf028ad6"></a>Edebugæ˜¾ç¤ºæ›´æ–° (Edebug Display Update)<br>
<div class="outline-text-6" id="text-orgf028ad6">
<p>
å½“ <code>Edebug</code> éœ€è¦æ˜¾ç¤ºä¸€äº›ä¿¡æ¯çš„æ—¶å€™,å®ƒä¼šå‚¨å­˜ <code>Edebug</code> å¤–éƒ¨çš„å½“å‰çª—å£é…ç½®.å½“é€€å‡º <code>Edebug</code> çš„æ—¶å€™å®ƒå°±ä¼šæ¢å¤ä¹‹å‰çš„çª—å£é…ç½®.
</p>

<p>
åªæœ‰åœ¨ <code>Edebug</code> æš‚åœçš„æ—¶å€™ <code>Emacs</code> æ‰ä¼šé‡æ–°æ˜¾ç¤º(<code>redisplay</code>).é€šå¸¸,å½“ç»§ç»­æ‰§è¡Œçš„æ—¶å€™,ç¨‹åºä¼šåœ¨æ–­ç‚¹å¤„æˆ–è€…å•æ­¥æ‰§è¡Œ(stepping)åé‡æ–°è¿›å…¥(re-enter) <code>Edebug</code>,ä¸­é—´æ²¡æœ‰ä»»ä½•åœé¡¿æˆ–è€…è¾“å…¥è¯»å–.
</p>

<p>
åœ¨è¿™å†™ä¾‹å­ä¸­, <code>Emacs</code> æ²¡æœ‰ä»»ä½•æœºä¼šé‡æ–°æ˜¾ç¤ºå¤–éƒ¨é…ç½®.å› æ­¤,ä½ æ‰€çœ‹è§çš„å°±æ˜¯å’Œæœ€åä¸€æ¬¡æ¿€æ´» <code>Edebug</code> æ—¶çš„åŒä¸€ä¸ªçª—å£é…ç½®,æ²¡æœ‰ä»»ä½•ä¸­æ–­(interruption).
</p>

<p>
ç”¨äºæ˜¾ç¤ºä¿¡æ¯çš„ <code>Edebug</code> å…¥å£ä¹Ÿä¼šå‚¨å­˜å’Œæ¢å¤ä»¥ä¸‹æ•°æ®(å°½ç®¡å®ƒä»¬ä¸­çš„ä¸€äº›ä¼šå› ä¸º <code>error and quit signal</code> çš„å‘ç”Ÿè€Œæœ‰æ„ä¸å‚¨å­˜).
</p>

<ul class="org-ul">
<li>å½“å‰çš„ç¼“å†²åŒº,ç‚¹çš„ä½ç½®(point positions),markså’Œå·²ç»è¢«å‚¨å­˜çš„å’Œæ¢å¤çš„æ•°æ®.</li>

<li><p>
å¦‚æœ <code>edebug-save-windows</code> æ˜¯ <code>non-nil</code>,é‚£ä¹ˆå¤–éƒ¨çª—å£é…ç½®å°±ä¼šè¢«å‚¨å­˜å’Œæ¢å¤.ä¸ä¼šåœ¨ <code>error</code> æˆ–è€… <code>quit</code> çš„æ—¶å€™æ¢å¤,ä¸è¿‡å³ä½¿ <code>save-excursion</code> æ¿€æ´»æ—¶å€™å‡ºç°äº† <code>error</code> æˆ–è€… <code>quit</code>,å¤–éƒ¨è¢«é€‰ä¸­çš„çª—å£è¿˜æ˜¯ä¼šè¢«é‡æ–°é€‰æ‹©.
</p>

<p>
å¦‚æœ <code>edebug-save-windows</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨,åªæœ‰è¢«åˆ—å‡ºçš„çª—å£ä¼šè¢«å‚¨å­˜å’Œæ¢å¤.çª—å£å¼€å§‹ä»¥æºä»£ç ç¼“å†²åŒºçš„æ°´å¹³æ»šåŠ¨ä½ç½®æ˜¯ä¸ä¼šå‚¨å­˜çš„.ç„¶è€Œ,å®ƒä»¬ä»ç„¶ä¼šè¢«ä¿ç•™å¹¶ä¸”æ˜¾ç¤ºåœ¨ <code>Edebug</code> ä¸­.
</p></li>

<li>å¦‚æœ <code>edebug-save-displayed-buffer-points</code> ä¸º <code>non-nil</code>,é‚£ä¹ˆæ¯ä¸ªæ˜¾ç¤ºçš„ç¼“å†²åŒºçš„ç‚¹éƒ½ä¼šè¢«ä¿ç•™å’Œæ¢å¤.</li>

<li><code>overlay-arrow-position</code> å’Œ <code>overlay-arrow-string</code> ä¼šè¢«å‚¨å­˜å’Œæ¢å¤,å› æ­¤å¯ä»¥å®‰å…¨åœ°ä»åœ¨åŒä¸€ä¸ªç¼“å†²åŒºä¸­ä»»ä½•åœ°æ–¹çš„é€’å½’ç¼–è¾‘(recursive edit)å”¤é†’ <code>Edebug</code>.</li>

<li><code>cursor-in-echo-area</code> å±€éƒ¨ç»‘å®š <code>nil</code>,è¿™æ ·æŒ‡é’ˆ(cursor)ä¼šæ˜¾ç¤ºåˆ°çª—å£ä¸Š.</li>
</ul>
</div>
</li>

<li><a id="orga6f10ea"></a>Edebug Recursive Edit<br>
<div class="outline-text-6" id="text-orga6f10ea">
<p>
å½“è¿›å…¥ <code>Edebug</code> å¹¶ä¸”è¯»å–å‘½ä»¤æ—¶,ä¼šå‚¨å­˜å’Œä¹‹åæ¢å¤ä»¥ä¸‹é¢å¤–çš„æ•°æ®.
</p>

<ul class="org-ul">
<li>å½“å‰çš„åŒ¹é…æ•°æ®(Match Data)</li>

<li><p>
<code>last-command, this-command, last-command-event, last-input-event, last-event-frame, last-nonmenu-event and trace-mouse</code>. <code>Edebug</code> çš„å‘½ä»¤ä¸ä¼šåœ¨ <code>Edebug</code> ä¹‹å¤–å½±å“å®ƒä»¬.
</p>

<p>
<code>Edebug</code> çš„æ‰§è¡Œå‘½ä»¤å¯ä»¥æ”¹å˜ <code>this-command-keys</code> è¿”å› <code>key sequence</code>,å¹¶ä¸”æ²¡æœ‰åŠæ³•ä» <code>Lisp</code> ä¸­é‡ç½®.ä¸èƒ½å‚¨å­˜å’Œæ¢å¤ <code>unread-command-events</code> çš„å€¼.
</p></li>

<li><code>command-history</code> è®°å½•ç€ <code>Edebug</code> ä¸­æ‰§è¡Œçš„å‘½ä»¤,åœ¨åŒ—å°‘æ•°æƒ…å†µä¸‹è¿™ä¸ªå¯ä»¥ä¿®æ”¹æ‰§è¡Œ(execution).</li>

<li><code>Edebug</code> ä¸­çš„é€’å½’æ·±åº¦æ¯”å¤–éƒ¨çš„é€’å½’æ·±åº¦è¦æ·±,å½“æ—¶å¯¹äºè‡ªåŠ¨æ›´æ–°çš„è¿ç®—åˆ—è¡¨çª—å£æ¥è¯´æ˜¯é”™çš„.</li>

<li><code>standard-output</code> å’Œ <code>standard-input</code> ä¼šè¢« <code>recursive-edit</code> å‘½ä»¤ç»‘å®šä¸º <code>nil</code>,ä¸è¿‡ <code>Edebug</code> ä¼šåœ¨è¿ç®—ä¸­ä¸´æ—¶æ¢å¤å®ƒä»¬.</li>

<li>é”®ç›˜å®çš„å®šä¹‰çš„çŠ¶æ€ä¼šè¢«ä¿å­˜å’Œæ¢å¤.å½“æ¿€æ´» <code>Edebug</code> æ—¶, <code>defining-kbd-macro</code> ä¼šç»‘å®šåˆ° <code>edebug-continue-kbd-macro</code>.</li>
</ul>
</div>
</li>
</ul>
</li>


<li><a id="orgc48454e"></a>Edebug and Macros<br>
<ul class="org-ul">
<li><a id="org468a42c"></a>Instrumenting Macro Calls<br>
<div class="outline-text-6" id="text-org468a42c">
<p>
å½“ <code>Edebug</code> <code>instrument</code> ä¸€ä¸ªè°ƒç”¨ <code>Lisp</code> å®çš„è¡¨è¾¾å¼,å®ƒéœ€è¦é¢å¤–çš„å®ä¿¡æ¯æ¥ä¿è¯æ­£ç¡®å·¥ä½œ.
</p>

<p>
é‚£æ˜¯å› ä¸ºæ²¡æœ‰ä¸€ä¸ªå…ˆéªŒ (<code>a-priori</code>)çš„æ–¹æ³•æ¥åˆ¤æ–­ä¼šè¿ç®—å®è°ƒç”¨çš„å“ªäº›å­è¡¨è¾¾å¼(å®ä½“å¯èƒ½ä¼šå‘ç”Ÿè¿ç®—,æˆ–è€…æ‹“å±•æ—¶å€™å‘ç”Ÿè¿ç®—,åˆæˆ–è€…ä¹‹åä»»ä½•æ—¶åˆ»).
</p>

<p>
å› æ­¤å¿…é¡»ä¸ºæ¯ä¸€ä¸ª <code>Edebug</code> ä¼šé‡åˆ°çš„å®å®šä¹‰ <code>Edebug specification</code> æ¥è§£é‡Šå®çš„è°ƒç”¨æ ¼å¼.åšæ³•æ˜¯ç»™å®å®šä¹‰æ·»åŠ ä¸€ä¸ª <code>debug</code> å£°æ˜.
</p>

<p>
<code>Edebug specification</code> å‘Šè¯‰ <code>Edebug</code> å®çš„å“ªäº›éƒ¨åˆ†éœ€è¦è¿ç®—.å…³äºå¦‚ä½•ä¸ºå®å®šä¹‰ <code>Edebug specification</code>,çœ‹è¿™é‡Œ <code>M-: (info "(elisp) Defining Macros")</code>.
</p>

<p>
å½“ <code>instrument</code> ä»£ç çš„æ—¶å€™è¦ä¿è¯ <code>Edebug</code> çŸ¥é“ <code>specification</code>.å¦‚æœ <code>instrument</code> ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‡½æ•°,å¹¶ä¸”è¿™ä¸ªå‡½æ•°å¼•ç”¨äº†ä½¿ç”¨ <code>eval-when-compile</code> å¯¼å…¥å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„å®å®šä¹‰,é‚£ä¹ˆå°±éœ€è¦ <code>load</code> ä¸€éé‚£ä¸ªæ–‡ä»¶.
</p>

<p>
é™¤äº†ä¸Šé¢çš„æ–¹æ³•å¤–,è¿˜å¯ä»¥ä½¿ç”¨ <code>def-edebug-spec</code> ä¸ºå®å®šä¹‰ <code>Edebug specification</code>.æ·»åŠ  <code>debug</code> æ›´å—æ¬¢è¿ä»¥åŠæ›´æ–¹ä¾¿.ä¸è¿‡ <code>def-edebug-spec</code> å¯ä»¥ä¸º <code>C</code> å®ç°çš„ <code>special forms</code> å®šä¹‰ <code>Edebug specifications</code>.
</p>

<p>
å¦‚æœä¸€ä¸ªå®æ²¡æœ‰ <code>Edebug specification</code>, <code>edebug-eval-macro-args</code> å°±ä¼šå‚ä¸è¿›æ¥,å¦‚æœè¯¥å˜é‡ä¸º <code>nil</code> (é»˜è®¤),è¿ç®—çš„æ—¶å€™ä¸ä¼šä¸ºä»»ä½•ä¸€ä¸ªå‚æ•° <code>instrument</code>;å¦åˆ™å…¨å‘˜ <code>instrumented</code>.
</p>
</div>
</li>

<li><a id="org66b8917"></a>Specification List<br>
<div class="outline-text-6" id="text-org66b8917">
<p>
è‡ªå·±çœ‹æ–‡æ¡£
</p>
</div>
</li>

<li><a id="org3d09648"></a>Backtracking<br>
<div class="outline-text-6" id="text-org3d09648">
<p>
è‡ªå·±çœ‹æ–‡æ¡£
</p>
</div>
</li>

<li><a id="orgbe6665e"></a>Specification Examples<br>
<div class="outline-text-6" id="text-orgbe6665e">
<p>
è‡ªå·±çœ‹æ–‡æ¡£
</p>
</div>
</li>
</ul>
</li>


<li><a id="orgeee8df8"></a>Edebug Options<br>
<div class="outline-text-5" id="text-orgeee8df8">
<p>
å¤§éƒ¨ä»½ä¸Šé¢éƒ½æè¿‡,è‡ªå·±çœ‹æ–‡æ¡£
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-org77e1fbb" class="outline-4">
<h4 id="org77e1fbb">è¯­æ³•é”™è¯¯ (Syntax Errors)</h4>
<div class="outline-text-4" id="text-org77e1fbb">
<p>
<code>Lisp reader</code> ä¼šæç¤ºéæ³•è¯­æ³•,ä¸è¿‡ä¸ä¼šæç¤ºé—®é¢˜å‘ç”Ÿçš„åœ°æ–¹.å¯¹äº <code>Lisp</code> æ¥è¯´,æœ€å¸¸è§çš„è¯­æ³•é”™è¯¯å°±æ˜¯æ‹¬å·ä¸åŒ¹é….
</p>
</div>

<ul class="org-ul">
<li><a id="orga66656f"></a>å¤šä½™çš„å¼€æ‹¬å· (Excess Open)<br>
<div class="outline-text-5" id="text-orga66656f">
<p>
å¤šä½™å¼€æ‹¬å·çš„é”™è¯¯æç¤ºæ˜¯ <code>End of file during parsing</code>.
</p>

<ol class="org-ol">
<li>ç§»åŠ¨æŒ‡é’ˆåˆ°å‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶çš„æœ€åæ‰§è¡Œ <code>C-u C-M-u</code>,ä»¥æ­¤æ‰¾åˆ°é”™è¯¯çš„å‡½æ•°.</li>

<li>ç ”ç©¶é”™è¯¯çš„å‡½æ•°,å¯ä»¥æ ¹æ®ç°æœ‰çš„ç¼©è¿›æ¥åˆ¤æ–­.</li>

<li>ä¿è¯å‡½æ•°çš„å®šä¹‰æœ‰è¶³å¤Ÿçš„é—­æ‹¬å·(ä¸€èˆ¬éƒ½æ˜¯å…ˆç§»åŠ¨åˆ°å‡½æ•°çš„ç»“å°¾æ’å…¥ä¸€ä¸ªé—­æ‹¬å·,ä¸è¦ä½¿ç”¨ <code>C-M-e</code> ç§»åŠ¨,æ‹¬å·ä¸å¹³è¡¡æ—¶ä¼šæŠ¥é”™),å¦åˆ™ <code>C-M-q</code> ä¼šæŠ¥é”™æˆ–è€…é‡æ–°ç¼©è¿›åˆ°æ–‡ä»¶æœ€å.</li>

<li>ç§»åŠ¨åˆ°å‡½æ•°å®šä¹‰çš„å¼€å§‹å¤„ä½¿ç”¨ <code>C-M-q</code> æ¥é‡æ–°ç¼©è¿›å¹¶ä¸”è¿‡ç¨‹å“ªéƒ¨åˆ†å‘ç”Ÿå³åŠ¨,é€šå¸¸å‘ç”Ÿå³åç§»çš„èµ·ç‚¹çš„å‰ä¸€ä¸ªç‚¹çš„é™„è¿‘å°±æ˜¯å°‘äº†é—­æ‹¬å·æˆ–è€…å¤šäº†å¼€æ‹¬å·çš„åœ°æ–¹(å½“ç„¶è¿™ä¸ä¸€å®šæ˜¯å¯¹çš„).ä¸€å®šè¦ç»†è¯»ä»£ç .</li>

<li>ä¸€æ—¦æ‰¾åˆ°äº†å°±ç”¨ <code>C-_</code> æ’¤é”€(undo) <code>C-M-q</code>,æ¢å¤åˆ°æ—§çš„ç¼©è¿›.</li>

<li>å†æ¬¡ç§»åŠ¨åˆ°å‡½æ•°å®šä¹‰çš„èµ·ç‚¹æ‰§è¡Œ <code>C-M-q</code> æ¥æ£€æŸ¥ç¼©è¿›æ˜¯å¦æ­£å¸¸,å¦‚æœç¼©è¿›æ²¡æœ‰å‘ç”Ÿæ”¹å˜å°±è¯æ˜æ‹¬å·åŒ¹é…äº†.</li>
</ol>
</div>
</li>


<li><a id="org49163da"></a>å¤šä½™çš„é—­æ‹¬å· (Excess Close)<br>
<div class="outline-text-5" id="text-org49163da">
<p>
å¤šä½™é—­æ‹¬å·çš„é”™è¯¯æç¤ºæ˜¯ <code>Invalid read syntax: ")"</code>.
</p>

<ol class="org-ol">
<li>ç§»åŠ¨æŒ‡é’ˆåˆ°å‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶çš„èµ·ç‚¹æ‰§è¡Œ <code>C-u -1 C-M-u</code> æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ‹¬å·ä¸å¹³è¡¡çš„å‡½æ•°.</li>

<li>åœ¨å‡½æ•°å®šä¹‰çš„èµ·ç‚¹ä½¿ç”¨ <code>C-M-f</code> æ¥åŒ¹é…é—­æ‹¬å·,æ‰§è¡Œè®©æŒ‡é’ˆç§»åŠ¨åˆ°å®šä¹‰åº”è¯¥ç»“æŸçš„åœ°æ–¹.å¾ˆæœ‰å¯èƒ½å°±æ‰¾åˆ°å¤šä½™çš„é—­æ‹¬å·.</li>

<li>å¦‚æœä¸Šé¢è¿˜æ²¡æœ‰æ‰¾åˆ°é—®é¢˜,é‚£ä¹ˆå°±åœ¨å‡½æ•°çš„å®šä¹‰èµ·ç‚¹æ‰§è¡Œ <code>C-M-q</code> è¿›è¡Œç¼©è¿›å¹¶ä¸”è§‚å¯Ÿå“ªéƒ¨åˆ†ç§»åŠ¨,é€šå¸¸å‘ç”Ÿå·¦åç§»çš„èµ·ç‚¹çš„å‰é¢ä¸€ä¸ªç‚¹çš„é™„è¿‘å°±æ˜¯å¤šäº†é—­æ‹¬å·æˆ–è€…å°‘äº†å¼€æ‹¬å·çš„åœ°æ–¹(å½“ç„¶è¿™ä¸ä¸€å®šæ˜¯å¯¹çš„).ä¸€å®šè¦ç»†è¯»ä»£ç .</li>

<li>ä¸€æ—¦æ‰¾åˆ°äº†å°±ç”¨ <code>C-_</code> æ’¤é”€ <code>C-M-q</code>,æ¢å¤åˆ°æ—§ç¼©è¿›.</li>

<li>å†æ¬¡ç§»åŠ¨åˆ°å‡½æ•°å®šä¹‰çš„èµ·ç‚¹æ‰§è¡Œ <code>C-M-q</code> æ¥æ£€æŸ¥ç¼©è¿›æ˜¯å¦æ­£å¸¸,å¦‚æœç¼©è¿›æ²¡æœ‰å‘ç”Ÿæ”¹å˜å°±è¯æ˜æ‹¬å·åŒ¹é…äº†.</li>
</ol>
</div>
</li>
</ul>
</div>


<div id="outline-container-orga1a0e29" class="outline-4">
<h4 id="orga1a0e29">è¦†ç›–å‚æ•° (Test Coverage)</h4>
<div class="outline-text-4" id="text-orga1a0e29">
<p>
é™¤äº† <code>Edebug</code> å¯ä»¥åšè¦†ç›–å‚æ•°,è¿˜å¯ä»¥ä½¿ç”¨ <code>testcover</code> åº“æ¥åš.
</p>

<ol class="org-ol">
<li><code>M-x testcover-start &lt;RET&gt; FILE &lt;RET&gt;</code> å¯¹æ•´ä¸ªæ–‡ä»¶è¿›è¡Œ <code>instrument</code>.</li>

<li>è°ƒç”¨ä¸€åˆ°å¤šæ¬¡æ¥æµ‹è¯•ä»£ç .</li>

<li><code>M-x testcover-mark-all</code> é«˜äº®è¦†ç›–ç‡ä½çš„ä»£ç .</li>

<li><code>M-x testcover-next-mark</code> ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªé«˜äº®ç‚¹(next highlighted spot).</li>
</ol>

<p>
å…³äºé«˜äº®çš„è¯´æ˜,
</p>

<ul class="org-ul">
<li>çº¢è‰²(red)é«˜äº®ç‚¹æ˜¯æŒ‡ <code>form</code> å®Œå…¨æ²¡è¢«æ‰§è¡Œè¿‡.å¦‚æœ <code>forms</code> ä¸èƒ½å®Œæˆè¿è¡Œå°±ä¼šè·³è¿‡çº¢è‰²é«˜äº®,æ¯”å¦‚ <code>error</code>.</li>

<li>æ£•è‰²(brown)é«˜äº®ç‚¹æ˜¯æŒ‡ <code>form</code> æ€»æ˜¯è¿è¡Œå¾—åˆ°ç›¸åŒç»“æœ.å¦‚æœ <code>forms</code> æ˜¯æœ¬æ¥å°±æ˜¯é¢„æœŸå¾—åˆ°ç›¸åŒçš„å€¼å°±è·³è¿‡æ£•è‰²é«˜äº®,æ¯”å¦‚ <code>(setq x 14)</code>.</li>
</ul>

<p>
<code>testcover</code> åº“è¿˜å¯ä»¥æä¾› <code>1value</code> å’Œ <code>noreturn</code> <code>form</code> æ¥åœ¨ç‰¹å®šæƒ…å†µä¸‹ä½¿ç”¨.
</p>
</div>
</div>


<div id="outline-container-orgde578a6" class="outline-4">
<h4 id="orgde578a6">æ€§èƒ½æµ‹è¯• (Profiling)</h4>
<div class="outline-text-4" id="text-orgde578a6">
<p>
é’ˆå¯¹ä¸åŒæƒ…å†µæœ‰ä»¥ä¸‹4ç§æ–¹æ³•å¯ä»¥æµ‹è¯•æ€§èƒ½,
</p>

<ol class="org-ol">
<li><code>Emacs</code> çš„å†…ç½®æ”¯æŒ

<ul class="org-ul">
<li>æ­¥éª¤

<ol class="org-ol">
<li><code>M-x profiler-start</code> å¼€å§‹æµ‹è¯•,å¯ä»¥é€‰æ‹©æµ‹è¯•çš„æŒ‡æ ‡ <code>(cpu, mem, cpu+mem)</code>.</li>

<li>åšæƒ³è¦æµ‹è¯•çš„åŠ¨ä½œ.</li>

<li><code>M-x profiler-report</code> æ˜¾ç¤ºæµ‹è¯•ç»“æœ.</li>

<li>ç»“æŸåå…³é—­æµ‹è¯• <code>M-x profiler-stop</code>.</li>
</ol></li>

<li><p>
å¦‚ä½•è¯»æ‡‚ç»“æœ
</p>


<div id="orgf421281" class="figure">
<p><img src="../../../files/cpu-mem.png" alt="cpu-mem.png">
</p>
<p><span class="figure-number">Figure 3: </span>cpu+mem usage</p>
</div>

<p>
ä¸Šé¢çš„å›¾é‡Œåˆ†åˆ«æ˜¯å†…å­˜å’Œcpuçš„ä½¿ç”¨ç‡.
</p>

<p>
æ¯ä¸€è¡Œçš„å†…å®¹é¡¹åˆ†åˆ«ä¸º <b>è°ƒç”¨çš„å‡½æ•°åå­—</b>, <b>å‡½æ•°çš„èµ„æºä½¿ç”¨</b> ä»¥åŠ <b>å‡½æ•°æ‰§è¡Œæ—¶é—´å æ€»æµ‹è¯•æ—¶é—´çš„ç™¾åˆ†æ¯”</b>.
</p>

<p>
å¦‚æœè¡Œçš„å·¦è¾¹æœ‰ <code>+</code> å·,é‚£ä¹ˆå¯ä»¥å¯¹ç€è¡Œè¾“å…¥ <code>&lt;RET&gt;</code> è¿›è¡Œå±•å¼€,é‡Œé¢æœ‰è¿™ä¸€è¡Œå‡½æ•°è°ƒç”¨çš„ <code>subroutines</code>.å¯ä»¥é€šè¿‡ <code>C-u &lt;RET&gt;</code> ä¸€æ¬¡å±•å¼€,å†æ¬¡ <code>&lt;RET&gt;</code> å¯ä»¥å†æ¬¡æŠ˜å .
</p>

<p>
å¯ä»¥ä½¿ç”¨ <code>j</code> æˆ–è€… <code>mouse-2</code> è·³è½¬åˆ°å‡½æ•°çš„å®šä¹‰.
</p>

<p>
ä½¿ç”¨ <code>d</code> æ˜¾ç¤ºå‡½æ•°çš„æ–‡æ¡£.
</p>

<p>
ä½¿ç”¨ <code>C-x C-w</code> ä¿å­˜æµ‹è¯•ç»“æœ.
</p>

<p>
ä½¿ç”¨ = å¯¹æ¯”ä¸¤ä»½æµ‹è¯•ç»“æœ.
</p></li>
</ul></li>

<li><p>
<code>elp</code> åº“
</p>

<p>
å¯ä»¥åšä¸º <code>profile</code> çš„æ›¿ä»£æ–¹æ¡ˆ.
</p></li>

<li><p>
<code>bechmark</code> åº“
</p>

<p>
ä½¿ç”¨ <code>benchmark-run</code> å’Œ <code>benchmark-run-compiled</code> å•ç‹¬æµ‹è¯• <code>Emacs Lisp forms</code>.
</p></li>

<li><p>
è°ƒè¯• <code>C</code> å®ç°çš„åŠŸèƒ½
</p>

<p>
éœ€è¦åœ¨ <code>Emacs</code> ç¼–è¯‘çš„æ—¶å€™å¯ç”¨ <code>configure</code> é€‰é¡¹çš„ <code>--enable-profiling</code>,
</p>

<p>
å®Œæˆåä¼šç”Ÿæˆä¸€ä»½ <code>gmon.out</code> æ–‡æ¡£,å¯ä»¥ä½¿ç”¨ <code>Linux</code> çš„ <code>gprof</code> å‘½ä»¤æ¥æ£€æµ‹.
</p>

<p>
è¯¥ç‰¹æ€§ä¸»è¦ç”¨æ¥è°ƒè¯• <code>Emacs</code> çš„,å¹¶ä¸”ä¼šåœæ­¢ä¸Šé¢æè¿°çš„ <code>Lisp-level</code> <code>M-x profiler-...</code> å‘½ä»¤.
</p></li>
</ol>
</div>
</div>



<div id="outline-container-orgf9d8b6c" class="outline-4">
<h4 id="orgf9d8b6c">ERT: Emacs Lisp Regression Testing</h4>
<div class="outline-text-4" id="text-orgf9d8b6c">
<p>
æ–‡æ¡£ä½äº <code>M-: (info "ert")</code>.
</p>

<p>
<code>ERT</code> æ˜¯ <code>Emacs Lisp</code> çš„ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•åº“.ä¸»è¦åŠŸèƒ½æœ‰æµ‹è¯•å®šä¹‰,è¿è¡Œæµ‹è¯•,è¾“å‡ºæµ‹è¯•ç»“æœä»¥åŠäº¤äº’è°ƒè¯•æµ‹è¯•é”™è¯¯(debugging for test failures).
</p>

<p>
<b>äº¤äº’è°ƒè¯•æµ‹è¯•é”™è¯¯è¿™ä¸ªçœŸçš„æ˜¯å¥½ä¸œè¥¿</b>.
</p>

<p>
äº‹å®ä¸Š <code>ERT</code> è¿˜é€‚ç”¨äºæµ‹è¯•é©±åŠ¨å¼€å‘(Test-driven development)æ¨¡å¼å’Œä¼ ç»Ÿè½¯ä»¶å¼€å‘æ¨¡å¼.
</p>
</div>

<ul class="org-ul">
<li><a id="org74b85a2"></a>ç®€ä»‹ (Introduction)<br>
<div class="outline-text-5" id="text-org74b85a2">
<p>
<code>ERT</code> å…è®¸ç»„åˆå‡½æ•°,å®,å˜é‡ä»¥åŠå…¶å®ƒ <code>Lisp</code> çš„ä¸œè¥¿(construct)æ¥å®šä¹‰æµ‹è¯•(tests).æµ‹è¯•åªä¸è¿‡æ˜¯è°ƒç”¨å…¶å®ƒçš„ä»£ç å¹¶ä¸”æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸æœŸæœ›çš„è¡Œä¸ºä¸€æ ·çš„ <code>Lisp</code> ä»£ç .
</p>

<p>
<code>ERT</code> ä¼šè·Ÿè¸ªå®šä¹‰çš„æµ‹è¯•å’Œæä¾›ä¸€äº›è¿è¡Œæµ‹è¯•çš„å‘½ä»¤,ç”¨äºæ£€æµ‹å®šä¹‰æ˜¯å¦é€šè¿‡æµ‹è¯•.
</p>

<p>
æ¯”å¦‚ <code>pp.el</code> çš„æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€äº›æµ‹è¯•ç”¨ä¾‹,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(pp-to-string '(quote quote))          ; expected: "'quote"</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(pp-to-string '((quote a) (quote b)))  ; expected: "('a 'b)\n"</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(pp-to-string '('a 'b))                ; same as above</span>
</pre>
</div>

<p>
ç”¨ <code>ERT</code> å†™å¯¹åº”ä¸Šé¢æµ‹è¯•å°±æ˜¯è¿™æ ·,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">pp-test-quote</span> ()
  <span style="color: #9FC59F;">"Tests the rendering of `</span><span style="color: #BFEBBF;">quote</span><span style="color: #9FC59F;">' symbols in `</span><span style="color: #BFEBBF;">pp-to-string</span><span style="color: #9FC59F;">'."</span>
  (should (equal (pp-to-string '(<span style="color: #F0DFAF; font-weight: bold;">quote</span> quote)) <span style="color: #CC9393;">"'quote"</span>))
  (should (equal (pp-to-string '((<span style="color: #F0DFAF; font-weight: bold;">quote</span> a) (<span style="color: #F0DFAF; font-weight: bold;">quote</span> b))) <span style="color: #CC9393;">"('a 'b)\n"</span>))
  (should (equal (pp-to-string '('a 'b)) <span style="color: #CC9393;">"('a 'b)\n"</span>)))
</pre>
</div>

<p>
<code>ert-deftest</code> å’Œ <code>defun</code> çš„ç”¨æ³•æ¯”è¾ƒåƒ,å®šä¹‰ä¸€ä¸ªåå­—å« <code>pp-test-quote</code> å•å…ƒæµ‹è¯•,åŠ è½½åå¯ä»¥ä½¿ç”¨ <code>M-x ert &lt;RET&gt; t &lt;RET&gt;</code> æ¥è¿è¡Œæµ‹è¯•.
</p>

<p>
å¦‚æœä¸‰ä¸ªè°ƒç”¨ç»“æœå…¨å‘˜ <code>non-nil</code> çš„è¯,æµ‹è¯•å°±é€šè¿‡.ä¸Šé¢çš„ <code>should</code> å®å°±æ˜¯ <code>ert</code> ç‰ˆæœ¬çš„æ–­è¨€è¯­å¥(assertion).
</p>

<p>
æ¯ä¸ªæµ‹è¯•åº”è¯¥æœ‰ä¸€ä¸ªç”¨æ¥æè¿°æµ‹è¯•åŠŸèƒ½çš„åå­—,æ¯”å¦‚ä¸Šé¢çš„ <code>pp-test-quote</code> å°±æ˜¯æµ‹è¯• <code>quote</code>,æµ‹è¯•çš„åå­—ä¸ä¼šå’Œå‡½æ•°å’Œå˜é‡æ”¾åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´,æ‰€ä»¥å¯ä»¥éšæ„é€‰æ‹©(è¿˜æ˜¯è¦ç¬¦åˆ <code>Emacs Lisp</code> çš„è§„èŒƒ,åŠ ä¸Šå‰ç¼€è¡¨æ˜å±äºå“ªä¸€ä¸ªåŒ…).
</p>

<p>
å½“æµ‹è¯•ä¸é€šè¿‡, <code>ERT</code> å°±ä¼šæ˜¾ç¤ºæµ‹è¯•çš„åå­—,è¿˜æœ‰æµ‹è¯•çš„æ—¶å€™å¯ä»¥æ ¹æ®åå­—é€‰æ‹©æµ‹è¯•.
</p>

<p>
ç¬¬ä¸€è¡Œçš„ <code>()</code> ç›®å‰æ²¡æœ‰ä»»ä½•æ„ä¹‰,ä»¥åå¯èƒ½ä¼šç”¨å®ƒæ¥åšæ‹“å±•,åŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†æ¥è¿‘ <code>defun</code> çš„å†™æ³•.
</p>

<p>
æ–‡æ¡£ (<code>docstring</code>) ç”¨æ¥æè¿°æ‰€æµ‹è¯•çš„åŠŸèƒ½ç‚¹(feature).åœ¨äº¤äº’æµ‹è¯•ä¸­,å¦‚æœæµ‹è¯•å¤±è´¥,æ–‡æ¡£çš„ç¬¬ä¸€è¡Œä¼šè¢«æ˜¾ç¤ºå‡ºæ¥,å½“ç„¶æ–‡æ¡£æ˜¯å¯é€‰çš„.
</p>

<p>
æµ‹è¯•ä½“,ä¹Ÿå°±æ˜¯é‡Œé¢é‚£ä¸‰ä¸ªè¡¨è¾¾å¼,å¯ä»¥æ˜¯ä»»ä½• <code>Lisp</code> ä»£ç ,å¯èƒ½çš„è¯å¯ä»¥æœ‰å‰¯ä½œç”¨,å¦‚æœæœ‰,ä¸è®ºæµ‹è¯•æ˜¯å¦é€šè¿‡,åº”è¯¥å®Œæˆåè¿›è¡Œæ¸…ç†,è¿˜åŸæˆæµ‹è¯•ä¹‹å‰çš„çŠ¶æ€.
</p>
</div>
</li>


<li><a id="orgadfd1ed"></a>å¦‚ä½•è¿è¡Œæµ‹è¯• (How to Run Tests)<br>
<div class="outline-text-5" id="text-orgadfd1ed">
<p>
æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼,ç¬¬ä¸€ç§æ˜¯åœ¨å¯åŠ¨ <code>Emacs</code> åäº¤äº’è¿è¡Œ,ä¹Ÿå°±æ˜¯ä¸Šé¢ç« èŠ‚æåˆ°çš„æ–¹æ³•;ç¬¬äºŒç§å°±æ˜¯åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ,ä¹Ÿå°±æ˜¯ <code>batch mode</code>.
</p>

<p>
å‰è€…æ¯”è¾ƒæ–¹ä¾¿,åè€…å¯ä»¥ä¸ç”¨æˆ·çš„è‡ªå®šä¹‰ç‹¬ç«‹å¼€;å¹¶ä¸”å…è®¸ä» <code>makefiles</code> ä¸­è¯»å–æµ‹è¯•å¹¶ä¸”è¿è¡Œ,èƒ½å¤Ÿæ ¹æ®ä¸åŒç‰ˆæœ¬çš„ <code>Emacs</code> ç¼–å†™æµ‹è¯•.
</p>
</div>

<ul class="org-ul">
<li><a id="org3d6b847"></a>äº¤äº’è¿è¡Œæµ‹è¯• (Running Tests Interactively)<br>
<div class="outline-text-6" id="text-org3d6b847">
<p>
ä½¿ç”¨ <code>M-x ert &lt;RET&gt; t &lt;RET&gt;</code> æ¥è¿è¡Œæ‰€æœ‰å·²ç»åŠ è½½äº†çš„æµ‹è¯•.å…¶ä¸­ <code>t</code> (ä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²)æ˜¯æµ‹è¯•é€‰æ‹©å™¨(test selectors),è¿˜æœ‰åˆ«çš„é€‰æ‹©å™¨å¯ä»¥é€‰.
</p>

<p>
å‡è®¾ç°æœ‰æµ‹è¯•å¦‚ä¸‹,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">pp-test-quote</span> ()
  <span style="color: #9FC59F;">"Tests the rendering of `</span><span style="color: #BFEBBF;">quote</span><span style="color: #9FC59F;">' symbols in `</span><span style="color: #BFEBBF;">pp-to-string</span><span style="color: #9FC59F;">'."</span>
  (should (equal (pp-to-string '(<span style="color: #F0DFAF; font-weight: bold;">quote</span> quote)) <span style="color: #CC9393;">"'quote"</span>))
  (should (equal (pp-to-string '((<span style="color: #F0DFAF; font-weight: bold;">quote</span> a) (<span style="color: #F0DFAF; font-weight: bold;">quote</span> b))) <span style="color: #CC9393;">"('a 'b)\n"</span>))
  (should (equal (pp-to-string '('a 'b)) <span style="color: #CC9393;">"('a 'b)\n"</span>)))

(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">addition-test</span> ()
  <span style="color: #9FC59F;">"Addition"</span>
  (should (equal (+ 1 2) 4)))
</pre>
</div>

<p>
å…¶ä¸­ <code>addition-test</code> æ˜¯æ³¨å®šæµ‹è¯•ä¸é€šè¿‡çš„,
</p>

<pre class="example" id="org1fecdd0">
Selector: t
Passed:  1
Failed:  1 (1 unexpected)
Skipped: 0
Total:   2/2

Started at:   2018-11-01 00:00:17+0800
Finished.
Finished at:  2018-11-01 00:00:17+0800

F.

F addition-test
    Addition
    (ert-test-failed
     ((should
       (equal
        (+ 1 2)
        4))
      :form
      (equal 3 4)
      :value nil :explanation
      (different-atoms
       (3 "#x3" "?")
       (4 "#x4" "?"))))
</pre>

<p>
ä¸Šé¢è¿è¡Œäº†ä¸¤ä¸ªæµ‹è¯•,å…¶ä¸­ <code>addition-test</code> å¤±è´¥äº†,å¦å¤–ä¸€ä¸ªæµ‹è¯•é€šè¿‡. <code>F</code> å’Œ <code>.</code> åˆ†åˆ«è¡¨ç¤ºä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•å’Œä¸€ä¸ªé€šè¿‡çš„æµ‹è¯•.
</p>

<p>
ä¸Šé¢çš„ <code>:form</code> æŒ‡çš„æ˜¯ <code>(equal (+ 1 2) 4)</code> åŒ–ç®€(reduced to)çš„ç»“æœ,ä¸º <code>(equal 3 4)</code>, <code>:value</code> æ˜¯ <code>(</code> 3 4)= çš„ç»“æœ.
</p>

<p>
å’Œä¸Šé¢æ˜¾ç¤ºçš„ä¸€æ ·,å¤±è´¥çš„æµ‹è¯•ä¼šæ˜¾ç¤ºå‡ºç»†èŠ‚,å…¶ä¸­ <code>:explanation</code> å«åšè§£é‡Š (Explanation). <code>M-: (info "(ert) Understanding Explanations")</code> æœ‰å…³äºå¦‚ä½•ç†è§£è§£é‡Š.
</p>

<p>
åœ¨æµ‹è¯•ç»“æœçš„ç¼“å†²åŒºä¸­,å¯ä»¥åšä»¥ä¸‹å‘½ä»¤,
</p>

<ul class="org-ul">
<li><code>TAB</code> å’Œ <code>S-TAB</code> åœ¨æŒ‰é’®ä¹‹é—´å¾ªç¯,å‡½æ•°å’Œå®å°±æ˜¯æŒ‰é’®.</li>

<li><code>RET</code> åœ¨æŒ‰é’®å¤„è·³è½¬åˆ°æŒ‰é’®çš„å®šä¹‰.</li>

<li><code>r</code> é‡æ–°è¿è¡ŒæŒ‡é’ˆé™„è¿‘çš„æµ‹è¯•.</li>

<li><code>d</code> ä½¿ç”¨è°ƒè¯•å™¨é‡æ–°è¿è¡Œ.</li>

<li><code>.</code> è·³è½¬åˆ°ç‚¹é™„è¿‘å‡½æ•°æˆ–è€…å®çš„å®šä¹‰,å’Œ <code>RET</code> å·®ä¸å¤š.</li>

<li><code>b</code> æ˜¾ç¤ºå¤±è´¥æµ‹è¯•çš„ <code>backtrace</code>.</li>

<li><code>l</code> æ˜¾ç¤ºæµ‹è¯•ä¸­çš„ <code>should</code> forms.</li>

<li><code>m</code> å‡å¦‚æµ‹è¯•ä¸­ä½¿ç”¨äº† <code>message</code> å‡½æ•°äº§ç”Ÿä¿¡æ¯,å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œæ˜¾ç¤º.</li>

<li><code>L</code> å¤±è´¥æµ‹è¯•çš„æ˜¾ç¤ºçš„è¡¨è¾¾å¼ä¼šæ ¹æ® <code>print-length</code> å’Œ <code>print-level</code> è¿›è¡Œç®€çŸ­åŒ–.è¯¥å‘½ä»¤å¯ä»¥å¢åŠ æ˜¾ç¤ºé™åˆ¶.</li>
</ul>
</div>
</li>


<li><a id="orgb1df4aa"></a>ä»¥ Batch Mode è¿è¡Œæµ‹è¯• (Running Tests in Batch Mode)<br>
<div class="outline-text-6" id="text-orgb1df4aa">
<p>
å¯ä»¥ä»å‘½ä»¤è¡Œæˆ–è€…è„šæœ¬,åˆæˆ–è€…æ˜¯ <code>makefiles</code> è‡ªåŠ¨è¿è¡Œæµ‹è¯•.æœ‰ä¸¤ä¸ªå‡½æ•°å¯ä»¥åšè¿™ä»¶äº‹æƒ…,åˆ†åˆ«æ˜¯ <code>ert-run-tests-batch</code> å’Œ <code>ert-run-tests-batch-and-exit</code>.
</p>

<p>
åœ¨å‘½ä»¤è¡Œä¸‹é¢å¯ä»¥è¿™ä¹ˆç”¨:
</p>

<div class="org-src-container">
<pre class="src src-sh">emacs -batch -l ert -l /path/to/tests.el -f ert-run-tests-batch-and-exit
</pre>
</div>

<p>
å¦‚æœæµ‹è¯•å…¨å‘˜é€šè¿‡å°±è¿”å› <code>0</code> çŠ¶æ€ç ,å¦åˆ™å°±æ˜¯é <code>0</code> çŠ¶æ€ç .
</p>

<p>
è¿˜å¯ä»¥å…ˆæŠŠè¿è¡Œç»“æœé‡å®šå‘åˆ°åˆ«çš„æ–‡ä»¶,æ¯”å¦‚ output.log,ç„¶åä½¿ç”¨ <code>ert-summarize-tests-batch-and-exit</code> äº§ç”Ÿæ€»ç»“ä¿¡æ¯,
</p>

<div class="org-src-container">
<pre class="src src-sh">emacs -batch -l ert -l tests.el -f ert-run-tests-batch-and-exit &gt;&amp; output.log
emacs -batch -l ert -f ert-summarize-tests-batch-and-exit output.log
</pre>
</div>

<p>
å¦‚æœ <code>Emacs</code> æ²¡æœ‰å’Œ <code>ERT</code> ä¸€èµ·åˆ†å‘,é‚£ä¹ˆéœ€è¦ <code>-L /path/to/ert</code> æ¥å…ˆåŠ è½½ <code>ert</code> åº“,å¯èƒ½è¿˜éœ€è¦ç”¨ <code>-L /path/to/tests.el</code> æ¥ç¡®ä¿æµ‹è¯•æ–‡ä»¶è¢«åŠ è½½.
</p>
</div>
</li>


<li><a id="orge236ec8"></a>æµ‹è¯•é€‰æ‹©å™¨ (Test Selectors)<br>
<div class="outline-text-6" id="text-orge236ec8">
<p>
è¿è¡Œ <code>ert</code> çš„æ—¶å€™éœ€è¦é€‰æ‹©æµ‹è¯•é€‰æ‹©å™¨,ä¹Ÿå°±æ˜¯è¿è¡Œç¬¦åˆæ¡ä»¶çš„æµ‹è¯•.
</p>

<ul class="org-ul">
<li><code>nil</code>,ä¸é€‰æ‹©ä»»ä½•æµ‹è¯•.</li>

<li><code>t</code>,é€‰æ‹©æ‰€æœ‰æµ‹è¯•.</li>

<li><code>:new</code>,é€‰æ‹©æ‰€æœ‰è¿˜æ²¡è¢«è¿è¡Œè¿‡æµ‹è¯•.</li>

<li><code>:failed</code> å’Œ <code>:passed</code>,åˆ†åˆ«é€‰æ‹©æœ€è¿‘çš„æµ‹è¯•ç»“æœä¸º <code>failed</code> å’Œ <code>passed</code> çš„æµ‹è¯•.</li>

<li><code>:expected</code> å’Œ <code>:unexpected</code>,åˆ†åˆ«é€‰æ‹©æœ€è¿‘æµ‹è¯•ç»“æœä¸º <code>expected</code> å’Œ <code>unexpected</code> çš„æµ‹è¯•.</li>

<li>æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²,åŒ¹é…æµ‹è¯•åå­—.</li>

<li>æµ‹è¯•,ä¹Ÿå°±æ˜¯ <code>ert-test</code> æ•°æ®ç±»å‹.</li>

<li><code>symbol</code> ,æ ¹æ®æµ‹è¯•åå­—çš„ <code>symbol</code> è¿›è¡Œé€‰æ‹©.</li>

<li><code>(member TESTS...)</code>,æ ¹æ®åˆ—è¡¨é‡Œé¢çš„æµ‹è¯•è¿›è¡Œé€‰æ‹©.</li>

<li><code>(eql TEST)</code>,æ ¹æ®æµ‹è¯•åå­—çš„ <code>symbol</code> é€‰æ‹©é€‰æ‹©.</li>

<li><code>(and SELECTORS... )</code>,é€‰æ‹©ç¬¦åˆæ‰€æœ‰ <code>SELECTORS</code> çš„æµ‹è¯•.</li>

<li><code>(or SELECTORS... )</code>,é€‰æ‹©ç¬¦åˆæ‰€æœ‰ <code>SELECTORS</code> å…¶ä¸­ä¹‹ä¸€çš„æµ‹è¯•.</li>

<li><code>(not SELECTORS... )</code>,é€‰æ‹©ä¸ç¬¦åˆæ‰€æœ‰ <code>SELECTORS</code> çš„æµ‹è¯•.</li>

<li><code>(tag TAG)</code>,é€‰æ‹©æ‰€æœ‰æ‹¥æœ‰ <code>TAG</code> çš„æµ‹è¯•. <code>Tags</code> å¯ä»¥åœ¨å®šä¹‰æµ‹è¯•çš„æ—¶å€™å®šä¹‰,æ˜¯å¯é€‰çš„.</li>

<li><code>(satisfies PREDICATE)</code>, é€‰æ‹©æ‰€æœ‰æ»¡è¶³ <code>PREDICATE</code> çš„æµ‹è¯•, <code>PREDICATE</code> æ˜¯ä¸€ä¸ªæ¥å—æµ‹è¯•åšä¸ºå‚æ•°å¹¶ä¸”è¿”å›å¸ƒå°”å€¼çš„å‡½æ•°,å¦‚æœç»“æœä¸º <code>non-nil</code> å°±é€‰æ‹©è¯¥æµ‹è¯•.</li>
</ul>
</div>
</li>
</ul>
</li>


<li><a id="org65f74e9"></a>å¦‚ä½•ç¼–å†™æµ‹è¯• (How to Write Tests)<br>
<div class="outline-text-5" id="text-org65f74e9">
<p>
åœ¨ç¼“å†²åŒºé€šè¿‡ <code>ert-deftest</code> å®šä¹‰æµ‹è¯•,å†ç”¨ <code>eval-defun</code> æˆ–è€… <code>compile-defun</code> è¿è¡Œæµ‹è¯•.
</p>

<p>
æˆ–è€…ä¿å­˜åˆ°æ–‡ä»¶ä¸­å¹¶ä¸”åŠ è½½,è¿˜å¯ä»¥å…ˆç¼–è¯‘.åŠ è½½åå¯ä»¥åƒ <code>find-function</code> æŸ¥æ‰¾å‡½æ•°é‚£æ ·æŸ¥æ‰¾æµ‹è¯•å®šä¹‰.
</p>
</div>


<ul class="org-ul">
<li><a id="org25871a6"></a>should å® (The should Macro)<br>
<div class="outline-text-6" id="text-org25871a6">
<p>
å’Œæ–­è¨€è¯­å¥å·®ä¸å¤š,å°±æ˜¯å¤šäº†å‚æ•°åˆ†æå’Œè®°å½• <code>ERT</code> ä¼šæ˜¾ç¤ºçš„ä¿¡æ¯.
</p>

<p>
ä¸Šé¢ç¨å¾®æåˆ°è¿‡ <code>should</code> çš„ç”¨æ³•,å°±ä¸å†è¯´äº†.é™¤äº† <code>should</code> è¿˜æœ‰ <code>should-not</code>, <code>should-error</code> ä¸¤ä¸ªå®.
</p>

<p>
åˆ†åˆ«ç”¨æ¥æ£€æŸ¥åˆ¤æ–­æ˜¯å¦è¿”å› <code>nil</code> å’Œæ˜¯å¦å¼•å‘å¯¹åº”çš„å¼‚å¸¸.ä¸‹é¢åˆ†åˆ«æ˜¯å…³äºå‡æ³•å’Œé™¤æ³•çš„æµ‹è¯•çš„ä¾‹å­,éƒ½æ˜¯å¯ä»¥é€šè¿‡çš„.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">subtraction-test</span> ()
  (should-not (equal (+ 1 2) 4)))

(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">divide-by-zero</span> ()
  (should-error (/ 1 0)
                <span style="color: #DCDCCC; font-weight: bold;">:type</span> 'arith-error))
</pre>
</div>

<p>
å…¶ä¸­ <code>should-error</code> çš„ <code>:type</code> å‚æ•°æ˜¯å¯é€‰çš„,å¦‚æœä¸å†™å°±æ„å‘³ç€æ¥å—æ‰€æœ‰ç±»å‹çš„é”™è¯¯.
</p>

<p>
<code>should-error</code> å¯ä»¥è¿”å›é”™è¯¯çš„æè¿°,ç”¨æ¥åšé¢å¤–çš„æ£€æŸ¥.é”™è¯¯æè¿°çš„å½¢å¼ä¸º <code>(ERROR-SYMBOL . DATA)</code>.
</p>
</div>
</li>


<li><a id="org8d36652"></a>é¢„æœŸçš„é”™è¯¯ (Expected Failures)<br>
<div class="outline-text-6" id="text-org8d36652">
<p>
æœ‰äº› <code>bugs</code> éš¾ä»¥ä¿®å¤æˆ–è€…æ˜¯ä¸å¤ªé‡è¦çš„,è¿™äº› <code>bugs</code> ä¼šè¢«ç•™ä¸‹æ¥,ç§°ä¹‹ä¸ºå·²çŸ¥ <code>bugs</code> (known bugs).
</p>

<p>
å¦‚æœæœ‰æµ‹è¯•ç”¨ä¾‹(test case)è§¦å‘äº† <code>bugs</code> å‘ç”ŸæŠ¥é”™, <code>ERT</code> å°±åœ¨ä½ æ¯æ¬¡è¿è¡Œæµ‹è¯•çš„æ—¶å€™è¿›è¡Œè­¦å‘Š.å¯¹äºå·²çŸ¥ <code>bugs</code> åˆ™ä¸ä¼š.
</p>

<p>
ç”¨æ–‡æ¡£ä¸Šé¢ä¾‹å­,å¦‚ä¸‹
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">future-bug</span> ()
  <span style="color: #9FC59F;">"Test `</span><span style="color: #BFEBBF;">time-forward</span><span style="color: #9FC59F;">' with negative arguments.</span>
<span style="color: #9FC59F;">     Since this functionality isn't implemented, the test is known to fail."</span>
  <span style="color: #DCDCCC; font-weight: bold;">:expected-result</span> <span style="color: #DCDCCC; font-weight: bold;">:failed</span>
  (time-forward -1))
</pre>
</div>

<p>
æµ‹è¯•ä¸Šé¢çš„ä¾‹å­çš„æ—¶å€™ä¼šæ˜¾ç¤º <code>f</code> è¡¨ç¤º <code>future-bug</code> æ˜¯ä¸€ä¸ªå·²çŸ¥ <code>bug</code>,ä»ç„¶æ˜¯ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•,ä¸è¿‡ä¸ä¼šæ˜¾ç¤ºå®ƒçš„é”™è¯¯ç»†èŠ‚.
</p>

<p>
å¦‚æœæ²¡æœ‰ä¿®å¤æŸä¸ª <code>bug</code> çš„æ„æ„¿,å¯ä»¥æŠŠå®ƒçš„æµ‹è¯•åˆ é™¤,æŠŠè¿™ä¸ª <code>bug</code> åšä¸ºä¸€ä¸ª <code>accepted feature</code>,è¿™ä¹Ÿæ˜¯æ ‡è®°å·² <code>bug</code> çš„ä¸€ç§æ‰‹æ®µ.
</p>

<p>
å¯¹äºæ„å¤–é€šè¿‡(<code>pass unexpectedly</code>) çš„æµ‹è¯•å’Œæ„å¤–é”™è¯¯(<code>unexpected failures</code>)æ¥è¯´, å®ƒä»¬çš„ <code>ERT</code> è­¦å‘Šéƒ½æ˜¯ä¸€æ ·.è¿™æ ·çš„è¯å°±ç®—æ— æ„ä¿®å¤äº† <code>bug</code>,ä¹Ÿä¼šçŸ¥é“è¦ç§»é™¤ <code>:expected-result</code> ä»å¥æ¥å…³é—­ç›¸åº”çš„é”™è¯¯æç¤º.
</p>

<p>
<code>:expected-result</code> æ˜¯åœ¨åŠ è½½æµ‹è¯•ä¹‹åè¿ç®—å®ƒçš„å‚æ•°çš„,æ‰€ä»¥å¯ä»¥åœ¨åšåˆ¤æ–­æ˜¯éœ€è¦æ ‡è®°ä¸ºå·²çŸ¥ <code>bug</code>.
</p>
</div>
</li>


<li><a id="orgd78f447"></a>æµ‹è¯•å’Œç¯å¢ƒ (Tests and Their Environment)<br>
<div class="outline-text-6" id="text-orgd78f447">
<p>
ä¸€äº›æµ‹è¯•éœ€è¦å…ˆå†³æ¡ä»¶(preconditions)æ‰å¯ä»¥è¿è¡Œ.æ¯”å¦‚éœ€è¦çš„ <code>Emacs feature</code> éœ€è¦ç¼–è¯‘æ‰æœ‰,å‚æ•°å‡½æ•°éœ€è¦ä¸€ä¸ªé¢å¤–çš„äºŒè¿›åˆ¶åŒ…å¹¶ä¸”å‚æ•°æœºå™¨ä¸Šæ²¡æœ‰è¿™åŒ…,ç­‰ç­‰.
</p>

<p>
è¿™ç§æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨ <code>skip-unless</code> å®æ ¹æ®æ¡ä»¶æ¥è·³è¿‡æµ‹è¯•.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">test-dbus</span> ()
  <span style="color: #9FC59F;">"A test that checks D-BUS functionality."</span>
  (skip-unless (<span style="color: #F0DFAF; font-weight: bold;">featurep</span> '<span style="color: #BFEBBF;">dbusbind</span>))
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">do the test)</span>
</pre>
</div>

<p>
æµ‹è¯•ç»“æœä¸åº”è¯¥å–å†³äºå½“å‰çš„ç¯å¢ƒçŠ¶æ€,å¹¶ä¸”æ¯ä¸ªæµ‹è¯•åº”è¯¥ä¿æŒç»“æŸæ—¶çš„ç¯å¢ƒå’Œå¼€å§‹æµ‹è¯•æ—¶çš„ç¯å¢ƒä¸€æ ·,ç‰¹åˆ«æ˜¯ä¸èƒ½å–å†³äº <code>=Emacs</code> çš„è‡ªå®šä¹‰å˜é‡å’Œé’©å­.
</p>

<p>
å¦‚æœå¿…é¡»è¦æ”¹å˜ <code>Emacs</code> çš„çŠ¶æ€æˆ–è€…å¤–éƒ¨çŠ¶æ€(æ¯”å¦‚æ–‡ä»¶),é‚£ä¹ˆåº”è¯¥åœ¨æµ‹è¯•ç»“æŸä¹‹å‰æ’¤é”€è¿™äº›æ›´æ”¹,ä¸ç®¡æ˜¯å¦é€šè¿‡.
</p>

<p>
è¿™ä¹ˆåšçš„ç›®çš„æ˜¯é˜²æ­¢å› ä¸ºç¯å¢ƒå˜åŠ¨å¯¼è‡´æµ‹è¯•å¤±æ•ˆ,æˆ–è€…å¯¼è‡´åœ¨ç‰¹å®šæ¡ä»¶ä¸‹(circumstances)å‘ç”Ÿé”™è¯¯å¹¶ä¸”éš¾ä»¥é‡ç°(reproduce).
</p>

<p>
å½“ç„¶ä¸æ˜¯è¯´ä¸èƒ½æœ‰å‰¯ä½œç”¨(side effect),æœ€å¥½ä½¿ç”¨ <code>let</code> ç»‘å®š,è¿™æ ·å‰¯ä½œç”¨çš„èŒƒå›´å°±åªèƒ½åœ¨æµ‹è¯•é˜¶æ®µä¸­äº†;ä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªæµ‹è¯•è®¾ç½®ä¸åŒçš„é…ç½®.
</p>

<p>
æ­£å¦‚ä¸Šé¢è¯´çš„,åœ¨æµ‹è¯•ä¹‹åæ’¤é”€å¯¹ç¯å¢ƒçš„æ›´æ”¹,å¯ä»¥è¿™ä¹ˆåš,
</p>

<ul class="org-ul">
<li>å¯¹ç¼“å†²åŒº(buffer)æˆ–è€…çª—å£é…ç½®(window confiugration)äº§ç”Ÿå‰¯ä½œç”¨,æµ‹è¯•çš„æ—¶å€™åº”è¯¥ç”¨ <code>with-temp-buffer</code> ä¸´æ—¶åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº,ç”¨ <code>save-window-excursion</code>.</li>

<li>å¯¹äºå…¶å®ƒæ–¹é¢çš„å¯ä»¥ä½¿ç”¨ <code>unwind-protect</code> ä¿è¯æµ‹è¯•ä¹‹åæ¸…ç†ç¯å¢ƒ.</li>

<li>å¯¹äº <code>*Message*</code> ç¼“å†²åŒº, <code>message</code> æˆ–è€…ç±»ä¼¼çš„å‡½æ•°ä¼šæ‰“ä¹±è¯¥ç¼“å†²åŒºçš„å‚¨å­˜,è¿™ä¸ªä¹Ÿéœ€è¦æ¢å¤åˆ°åŸæ¥çŠ¶æ€.</li>
</ul>

<p>
æ€»çš„æ¥è¯´å°±æ˜¯é¿å…ä½¿ç”¨ <code>find-file</code> è¿™ç§å¯ä»¥è‡ªå®šä¹‰çš„å‘½ä»¤(å½“ç„¶é™¤äº†ä½ æ˜¯çœŸçš„æƒ³æµ‹è¯•å®ƒ),å› ä¸ºè¿™ç§å‘½ä»¤å–å†³äºå¾ˆå¤šå…¶å®ƒè‡ªå®šä¹‰å˜é‡,ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ç¯å¢ƒ.
</p>

<p>
å¯ä»¥ä½¿ç”¨ <code>with-temp-buffer</code>, <code>insert</code> æˆ–è€… <code>insert-file-contents-literally</code> å¹¶ä¸”åœ¨é€šè¿‡ç›´æ¥è¿è¡Œå‡½æ•°æ¥æ¿€æ´»æƒ³è¦çš„ <code>mode</code> (è¦å…ˆè®¾å®šå¯¹åº” <code>mode</code> çš„é’©å­å˜é‡ä¸º nil) æ¥é¿å… <code>file-file</code> çš„é—®é¢˜.
</p>
</div>
</li>


<li><a id="org41d59aa"></a>ç¼–å†™æµ‹è¯•çš„æŠ€å·§ (Useful Techniques)<br>
<div class="outline-text-6" id="text-org41d59aa">
<p>
å¯¹äºæ²¡æœ‰å‰¯ä½œç”¨å’Œç¯å¢ƒä¾èµ–çš„å‡½æ•°,åŸºæœ¬å°±æ˜¯ <code>(should (eql EXPECTED ACTUAL))</code> å¯ä»¥å®Œäº‹,å½“ç„¶ä¹Ÿå¯ä»¥ <code>(should (eql ACTUAL EXPECTED))</code>,ä¸è¿‡å‰è€…æ›´å—æ¬¢è¿.
</p>

<p>
å¯¹äºå¤æ‚çš„æµ‹è¯•,æ¯”å¦‚æ–‡æ¡£çš„ä¾‹å­,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">ert-test-record-backtrace</span> ()
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((test (make-ert-test <span style="color: #DCDCCC; font-weight: bold;">:body</span> (<span style="color: #F0DFAF; font-weight: bold;">lambda</span> () (ert-fail <span style="color: #CC9393;">"foo"</span>)))))
    (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((result (ert-run-test test)))
      (should (ert-test-failed-p result))
      (<span style="color: #F0DFAF; font-weight: bold;">with-temp-buffer</span>
        (ert--print-backtrace (ert-test-failed-backtrace result))
        (goto-char (point-min))
        (end-of-line)
        (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((first-line (buffer-substring-no-properties
                           (point-min) (point))))
          (should (equal first-line
                         <span style="color: #CC9393;">"  signal(ert-test-failed (\"foo\"))"</span>)))))))
</pre>
</div>

<p>
å…ˆä»‹ç»ä¸€ä¸‹è¿™ä¸ªä¾‹å­çš„å‡ ä¸ª <code>forms</code>,
</p>

<ol class="org-ol">
<li><code>ert-fail</code> å¼•å‘æµ‹è¯•é”™è¯¯.</li>

<li><code>make-ert-test</code> æ¥å—ä¸€ä¸ªå‡½æ•°,è¿”å›ä¸€ä¸ªåŒ¿åæµ‹è¯•.</li>

<li><code>ert-run-test</code> æ¥å—ä¸€ä¸ªæµ‹è¯•å¹¶ä¸”è¿è¡Œå®ƒ,è¿”å›æµ‹è¯•ç»“æœ.</li>

<li><code>ert-test-failed-p</code> åˆ¤æ–­æµ‹è¯•ç»“æœæ˜¯å¦å¤±è´¥.</li>

<li><code>ert--print-backtrace</code> æ¥å—æµ‹è¯•ç»“æœ,æ˜¾ç¤ºå¤±è´¥æµ‹è¯•çš„ç»“æœ <code>backtrace</code>.</li>
</ol>

<p>
è¿™ä¸ªä¾‹å­å°±æ˜¯é€šè¿‡æ£€æŸ¥ <code>backtrace</code> çš„ç¬¬ä¸€è¡Œæ¥æµ‹è¯• <code>ert backtrace</code> çš„è®°å½•åŠŸèƒ½,åªæ£€æŸ¥ç¬¬ä¸€è¡Œæ˜¯å› ä¸ºæ˜¯ <code>backtrace</code> å‰©ä¸‹éƒ¨åˆ†éƒ½æ˜¯ä¾èµ–äº <code>ERT</code> çš„å†…éƒ¨.
</p>

<p>
é€šè¿‡æ£€æŸ¥ç¬¬ä¸€è¡Œå°±å¯ä»¥æ£€æŸ¥åˆ° <code>backtrace</code> æ˜¯å¦æ­£ç¡®æ•æ‰åˆ° <code>signal</code> çš„ç»“æœ,è€Œ <code>signal</code> çš„ç»“æœå°±æ˜¯ <code>ert-fail</code> çš„ç»“æœ.
</p>

<p>
è¿™ä¸ªä¾‹å­å‘Šè¯‰æˆ‘ä»¬,å…ˆåœ¨è„‘æµ·ä¸­æ„å»ºå‡ºæµ‹è¯•ç»“æ„,å†æ ¹æ®æµ‹è¯•ç»“æ„ç¼–å†™ä»£ç ,è¿™æ ·å†ä¸ºè¯¥ä»£ç å†™æµ‹è¯•(tests)å°±ä¼šå˜å¾—å¾ˆå®¹æ˜“.
</p>

<p>
å‡å¦‚æˆ‘ä»¬å¯ä»¥é‡å†™,è¿™é‡Œè¿˜æœ‰å‡ ä¸ªå¯ä»¥æä¸€ä¸‹,
</p>

<ul class="org-ul">
<li>å¦‚æœ <code>ert-run-test</code> åªæ˜¯æ¥å— <code>symbol</code> æ¥é€‰æ‹©æµ‹è¯•çš„è¯,å¯ä»¥ä½¿ç”¨ <code>make-symbol</code> æ¥ç”Ÿæˆä¸´æ—¶ç”¨çš„ <code>symbol</code> æ¥é¿å…å¯¹ <code>Emacs</code> é€ æˆä»»ä½•å‰¯ä½œç”¨.</li>

<li>è¿˜æœ‰ <code>ert--print-backtrace</code> ä¼šæŠŠ <code>backtrace</code> æ‰“å°åˆ°å¦å¤–ä¸€ä¸ªæœ‰å›ºå®šåå­—çš„ç¼“å†²åŒºä¸­,è¿™æ ·æ’¤é”€å‰¯ä½œç”¨ä¼šæ¯”è¾ƒå›°éš¾.å¦‚æœå¯ä»¥é€‰æ‹©ç¼“å†²åŒºåå­—å°±å¯ä»¥ä¸ç¯å¢ƒæˆ–æµ‹è¯•ç‹¬ç«‹å¼€,ä¸ç”¨æ‹…å¿ƒå‰¯ä½œç”¨é—®é¢˜.</li>
</ul>

<p>
ä»¥åä¼šåœ¨ <code>Emacs</code> ä¸­é‡åˆ°å¾ˆå¤šæ²¡æœ‰æ ¹æ®è„‘æµ·ä¸­æµ‹è¯•ç»“æ„å†™å‡ºæ¥çš„ä»£ç ,æœ‰æ—¶å€™å¯ä»¥é‡æ„ä»£ç æ¥æä¾›ä¸€ä¸ªæ–¹ä¾¿æµ‹è¯•çš„æ¥å£,è€Œä¸”è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯,é€šå¸¸è¿™ç§æ¥å£ä¹Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨.
</p>

<p>
è¿™ä¸€ç« èŠ‚çš„ç›®çš„å°±æ˜¯ <b>è®²å¦‚ä½•å†™å‡ºå¯æµ‹è¯•ä»£ç </b> ,ç½‘ä¸Šæœ‰ä¸å°‘å¥½çš„æ–‡ç« ,<a href="https://www.toptal.com/qa/how-to-write-testable-code-and-why-it-matters">è¿™ç¯‡</a>å†™å¾—ååˆ†å¥½.
</p>
</div>
</li>
</ul>
</li>


<li><a id="org8202e25"></a>å¦‚ä½•è°ƒè¯•æµ‹è¯• (How to Debug Tests)<br>
<ul class="org-ul">
<li><a id="org7b816fa"></a>ç†è§£è§£é‡Š (Understanding Explanations)<br>
<div class="outline-text-6" id="text-org7b816fa">
<p>
åœ¨ä¸Šé¢äº¤äº’è¿è¡Œæµ‹è¯•ä¸­å°±æåˆ°è¿‡ <code>:explanation</code>,å®é™…ä¸Š <code>ERT</code> åªä¼šç»™å·²ç»æ³¨å†Œäº† <code>explanation</code> å‡½æ•°çš„è°“è¯(predicates)æä¾› <code>explanations</code>.
</p>

<p>
æ¯”å¦‚ä¸Šé¢å†™åˆ°çš„ <code>addition-test</code> ä¸­çš„ <code>equal</code> å°±æ˜¯è¿™ä¸€ç±»è°“è¯,å¦‚æœæŠŠ <code>equal</code> æ¢æˆ "=" å·,é‚£ä¹ˆç»“æœå°±æ˜¯è¿™æ ·äº†,
</p>

<pre class="example" id="orgad1b744">
F addition-test
    Addition
    (ert-test-failed
     ((should
       (equal
        (+ 1 2)
        4))
      :form
      (equal 3 4)
      :value nil))
</pre>

<p>
é‡Œé¢çš„ <code>different-atoms</code> æ˜¯æ‰€è°“çš„è§£é‡Š,å½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶å®ƒç±»å‹çš„è§£é‡Š.
</p>

<p>
è¿˜æœ‰å°±æ˜¯å¯ä»¥è‡ªå®šä¹‰ <code>explanation</code> å‡½æ•°.
</p>
</div>
</li>


<li><a id="org2d42a8e"></a>äº¤äº’å¼è°ƒè¯• (Interactive Debugging)<br>
<div class="outline-text-6" id="text-org2d42a8e">
<p>
å…¶ä¸­ <code>r</code>, <code>.</code>, <code>l</code>, <code>b</code>, <code>m</code> å’Œ <code>d</code> å‘½ä»¤éƒ½åœ¨äº¤äº’è¿è¡Œæµ‹è¯•ä¸­æœ‰æè¿‡.è¿™é‡Œå†è¡¥å……ä¸¤ä¸ª,
</p>

<ul class="org-ul">
<li><code>D</code> å‘½ä»¤,è¯¥å‘½ä»¤å¯ä»¥é€‰æ‹©æµ‹è¯•è¿›è¡Œåˆ é™¤;</li>

<li>é€šè¿‡ <code>C-u C-M-x</code> <code>instrument</code> æµ‹è¯•çš„å®šä¹‰,ç„¶åå›åˆ° <code>ERT</code> ç¼“å†²åŒº é€šè¿‡ <code>r</code> æˆ–è€… <code>d</code> è°ƒè¯•è¿è¡Œ(è¿™é‡Œä½¿ç”¨çš„è°ƒè¯•å™¨æ˜¯ <code>Debugger</code>).</li>
</ul>
</div>
</li>
</ul>
</li>


<li><a id="org5457965"></a>æ‹“å±• ERT (Extending ERT)<br>
<ul class="org-ul">
<li><a id="org114dddb"></a>å®šä¹‰ Explanation å‡½æ•° (Defining Explanation Functions)<br>
<div class="outline-text-6" id="text-org114dddb">
<p>
<code>Explanation</code> å°±æ˜¯ä¸€ä¸ªæ¥å—å’Œè°“è¯­ä¸€æ ·å¤šå‚æ•°å¹¶ä¸”è¿”å›ä¸€ä¸ª <code>explanation</code> çš„å‡½æ•°.è¿”å›çš„ç»“æœåº”è¯¥è§£é‡Šä¸ºä»€ä¹ˆä¼šè¿”å›è¿™ä¸ªç»“æœ,
</p>

<p>
å¯ä»¥æ˜¯ä»»ä½•ç»“æœ,ä¸è¿‡ä¸€å®šè¦å¯ä»¥è¢«è¯¦ç»†æ‰“å°çš„ç»“æœ.å¯¹äºä¸éœ€è¦è§£é‡Šçš„è¾“å…¥åˆ™è¿”å› <code>nil</code>.
</p>

<p>
å¦‚ä½•å®šä¹‰å‘¢? <b>æ–‡æ¡£ä¸Šå¤§æ¦‚å°±æ˜¯,å…ˆæ‰¾ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºè°“è¯çš„ <code>symbol</code>,ç„¶åä¸ºå®ƒå®šä¹‰ä¸€ä¸ªå‡½æ•°,æœ€åæŠŠè¯¥å‡½æ•°è®¾ç½®ä¸º <code>symbol</code> çš„å±æ€§</b>.
</p>

<p>
åè¿‡æ¥æƒ³ä¸€ä¸‹,å¯ä»¥è·å– <code>equal</code> çš„ <code>ert-explainer</code> å±æ€§è§‚å¯Ÿä¸€ä¸‹,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(get 'equal 'ert-explainer) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; ert--explain-equal</span>
</pre>
</div>

<p>
å‚è€ƒ <code>equal</code> çš„ä»£ç å¦‚ä¸‹,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">ert--explain-equal</span> (a b)
  <span style="color: #9FC59F;">"Explainer function for `</span><span style="color: #BFEBBF;">equal</span><span style="color: #9FC59F;">'."</span>
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Do a quick comparison in C to avoid running our expensive</span>
  <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">comparison when possible.</span>
  (<span style="color: #F0DFAF; font-weight: bold;">if</span> (equal a b)
      nil
    (ert--explain-equal-rec a b)))
(put 'equal 'ert-explainer 'ert--explain-equal)
</pre>
</div>
</div>
</li>


<li><a id="org92553d2"></a>ERT çš„åº•å±‚ä»£ç  (Low-Level Functions for Working with Tests)<br>
<div class="outline-text-6" id="text-org92553d2">
<p>
<code>ert-run-tests-interactively</code> å’Œ <code>ert-run-tests-batch</code> éƒ½æ˜¯åŸºäºåœ¨ <code>ert.el</code> ä¸­æ ‡è®°ä¸º <code>â€œFacilities for running a whole set of testsâ€</code> éƒ¨åˆ†çš„ <code>lower-level</code> ä»£ç å®ç°çš„.
</p>

<p>
å¦‚æœæƒ³è¦ä½¿ç”¨ <code>ERT</code> çš„ä»£ç å®ç°ä¸€äº›åŠŸèƒ½,åº”è¯¥çœ‹ä¸€ä¸‹å®ƒçš„ <code>lower level</code> ä»£ç . <code>ert--</code> å¼€å¤´æ˜¯æŒ‡ <code>ERT</code> å†…éƒ¨ä½¿ç”¨, <code>ert-</code> å¼€å¤´æ˜¯æŒ‡å¯ä»¥è¢«å…¶å®ƒä»£ç ä½¿ç”¨.ç›®å‰æ²¡æœ‰å®Œå–„çš„ <code>API</code>.
</p>
</div>
</li>
</ul>
</li>


<li><a id="orgb074f9f"></a>å…¶å®ƒæµ‹è¯•æ¦‚å¿µ (Other Testing Concepts)<br>
<ul class="org-ul">
<li><a id="org727f8d8"></a>Mocks and Stubs<br>
<div class="outline-text-6" id="text-org727f8d8">
<p>
å¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>mock/stub</code> (å«æ³•ä¸ä¸€æ ·è€Œå·²),æœ€åå°±æ˜¯ <code>ERT</code> å®˜æ–¹æ²¡æœ‰æ”¯æŒ <code>mock/stub</code>,ä¸è¿‡ <code>el-mock</code> æä¾›äº†,è¿˜å¯ä»¥å’Œ <code>ERT</code> æ··åˆä½¿ç”¨(ä¸èƒ½æ··ç”¨æ‰å¥‡æ€ª).
</p>
</div>
</li>


<li><a id="org3defc6c"></a>Fixtures and Test Suites<br>
<div class="outline-text-6" id="text-org3defc6c">
<p>
<code>Fixtures</code> ä¸»è¦ç”¨æ¥ä¸ºæµ‹è¯•è®¾ç½®å’Œæ¸…ç†æµ‹è¯•ç¯å¢ƒçš„,åŒ…å« <code>set-up</code> å’Œ <code>tear-down</code> ä¸¤ç±»å‡½æ•°.
</p>

<p>
<code>Test suites</code> ä¸»è¦æŠŠç›¸å…³æµ‹è¯•åˆ†æˆä¸€ç»„,æ–¹ä¾¿è¿è¡Œçš„æ—¶å€™å¯ä»¥ä¸€èµ·è¿è¡Œ.
</p>

<p>
ç„¶è€Œ <code>ERT</code> éƒ½æ²¡æœ‰è¿™ä¸¤ä¸ªåŠŸèƒ½(å…¶å®ä¹Ÿæ²¡æœ‰å¿…è¦, <code>Lisp</code> çš„å¼ºå¤§å¯ä»¥è½»æ¾åœ°è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜).
</p>

<p>
å¯¹äº <code>fixtures</code>,å¯ä»¥åˆ©ç”¨ <code>unwind-protect</code> å®ä½œä¸º <code>subroutine</code> æ¥å®šä¹‰å‡½æ•°æˆ–è€…å®,ä½¿ç”¨è¿™ä¸ªå®šä¹‰æ¥å®ç° <code>fixture</code>,
</p>

<p>
æ–‡æ¡£ä¸Šæœ‰å‡½æ•°ç‰ˆæœ¬çš„ä¼ªä»£ç ,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">my-fixture</span> (body)
  (<span style="color: #F0DFAF; font-weight: bold;">unwind-protect</span>
      (<span style="color: #F0DFAF; font-weight: bold;">progn</span> [set up]
             (funcall body))
    [tear down]))

(<span style="color: #F0DFAF; font-weight: bold;">ert-deftest</span> <span style="color: #93E0E3;">my-test</span> ()
  (my-fixture
   (<span style="color: #F0DFAF; font-weight: bold;">lambda</span> ()
     [test code])))
</pre>
</div>

<p>
å®ç‰ˆæœ¬çš„å°±è‡ªå·±ç ”ç©¶äº†,éƒ½å·®ä¸å¤šçš„.
</p>

<p>
å¯¹äº <code>test suites</code>,ç»å¸¸ç”¨æ¥ä¸ºç‰¹å®šæ¨¡å—è¿è¡Œæµ‹è¯•æˆ–è€…æ ¹æ®æµ‹è¯•çš„æ—¶é—´é•¿åº¦æ¥å°‘è¿è¡Œæ…¢çš„æµ‹è¯•,å®šä¹‰æµ‹è¯•çš„æ—¶å€™æ‰€æœ‰ç›¸å…³æ¨¡å—çš„æ‰€æœ‰æµ‹è¯•ä½¿ç”¨ç›¸åŒå‰ç¼€,æˆ–è€…ä½¿ç”¨ <code>:tag</code>,ç„¶åé€šè¿‡æ­£åˆ™æµ‹è¯•é€‰æ‹©å™¨æˆ–è€… <code>tag</code> æµ‹è¯•é€‰æ‹©å™¨è¿è¡Œæ‰€æœ‰ç›¸å…³æµ‹è¯•.
</p>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>



<div id="outline-container-org8985f08" class="outline-3">
<h3 id="org8985f08">è¯»å–å’Œæ‰“å° (Read and Print)</h3>
<div class="outline-text-3" id="text-org8985f08">
<p>
æ‰“å°æ˜¯è½¬æ¢ <code>Lisp</code> å¯¹è±¡ä¸ºæ–‡æœ¬å½¢å¼çš„æ“ä½œ,è€Œè¯»å–å°±æ˜¯æŠŠæ–‡æœ¬è½¬æ¢ä¸º <code>Lisp</code> å¯¹è±¡.å®ƒä»¬ä¼šä½¿ç”¨ <code>M-: (info "(elisp) Lisp Data Types")</code> ä¸­æè¿°çš„æ‰“å°ä»¥åŠè¯»å–è¯­æ³•.
</p>
</div>

<div id="outline-container-org71b4421" class="outline-4">
<h4 id="org71b4421">è¯»å–å’Œæ‰“å°çš„ç®€ä»‹ (Streams Intro)</h4>
<div class="outline-text-4" id="text-org71b4421">
<p>
è¯»å–ä¸€ä¸ª <code>Lisp</code> å¯¹è±¡æ„å‘³ç€è§£ææ–‡æœ¬å½¢å¼çš„ <code>Lisp</code> è¡¨è¾¾å¼å¹¶ä¸”äº§ç”Ÿå¯¹åº”çš„ <code>Lisp</code> å¯¹è±¡.è¿™ä¹Ÿæ˜¯ <code>Lisp</code> ä»£ç æ–‡ä»¶æ€ä¹ˆè¢«è¯»å–è¿› <code>Lisp</code> ä¸Šå¹¶ä¸”è¿è¡Œçš„æ–¹å¼,è¿™ç§æ–‡æœ¬å«åšå¯¹è±¡çš„è¯»å–è¯­æ³• (<code>read syntax of the object</code>).
</p>

<p>
æ‰“å°ä¸€ä¸ª <code>Lisp</code> å¯¹è±¡æ„å‘³ç€äº§ç”Ÿä¸€ä¸ªè¡¨ç¤ºè¯¥å¯¹è±¡çš„æ–‡æœ¬,å°±æ˜¯æŠŠå¯¹è±¡è½¬æ¢æˆå®ƒæ‰“å°è¡¨ç¤º(<code>printed representation</code>).
</p>

<p>
è¯»å–å’Œæ‰“å°æ˜¯ä¸€å¯¹åæ“ä½œ:é€šå¸¸æ‰“å°è¯»å–æ–‡æœ¬æ‰€å¾—å¾—ç»“æœä¼šæ˜¯åŒä¸€æ®µæ–‡æœ¬,åè¿‡æ¥,è¯»å–ä¸€ä¸ªæ‰“å°å¯¹è±¡æ—¶æ‰€å¾—çš„ç»“æœé€šå¸¸ä¼šå¾—åˆ°ä¸€ä¸ªç±»ä¼¼çš„å¯¹è±¡.
</p>

<p>
ç„¶è€Œè¿™ä¸¤æ“ä½œæ˜¯ä¸èƒ½ç²¾ç¡®åœ°äº’é€†çš„,æœ‰è¿™ä¸‰ä¸ªæƒ…å†µ:
</p>

<ul class="org-ul">
<li>æ‰“å°å¯ä»¥å¾—åˆ°ä¸€äº›ä¸å¯è¢«è¯»å–çš„å¯¹è±¡,æ¯”å¦‚, <code>buffers, windows, frames. subprocesses, markers</code> è¿™äº›éƒ½ä¼šå¾—åˆ° <code>#</code> å¼€å¤´çš„æ–‡æœ¬;
å¦‚æœå°è¯•è¯»å–è¿™äº›æ–‡æœ¬ä¼šå¾—åˆ°é”™è¯¯,æ²¡æœ‰æ–¹æ³•è¯»å–è¿™äº›æ•°æ®.</li>
<li>ä¸€ä¸ªå¯¹è±¡æœ‰å¤šç§æ–‡æœ¬è¡¨ç¤º.æ¯”å¦‚, <code>1</code> å’Œ <code>01</code> è¡¨ç¤ºåŒä¸€ä¸ªæ•´æ•°, <code>(a b)</code> å’Œ <code>(a . (b))</code> è¡¨ç¤ºåŒæ ·çš„åˆ—è¡¨.ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥è¢«è¯»å–,ä½†æ˜¯æ‰“å°åªæœ‰ä¸€ç§å¯èƒ½.</li>
<li>æ³¨é‡Šå¯ä»¥å‡ºç°å†ä¸€ä¸ªå¯¹è±¡è¯»å–åºåˆ—ä¸­é—´çš„ä»»ä½•ä¸€ä¸ªç‚¹ä¸Š,ä¸ä¼šå½±å“è¯»å–çš„ç»“æœ,ä½†æ˜¯ä¼šå½±å“æ‰“å°çš„ç»“æœ.</li>
</ul>
</div>
</div>


<div id="outline-container-org7c30750" class="outline-4">
<h4 id="org7c30750">è¾“å…¥æµ (Input Streams)</h4>
<div class="outline-text-4" id="text-org7c30750">
<p>
å¤§éƒ¨ä»½ç”¨äºè¯»å–çš„ <code>Lisp</code> å‡½æ•°éƒ½ä¼šæ¥æ”¶ä¸€ä¸ª <code>input stream</code>,ä¹Ÿå°±æ˜¯å«åšè¾“å…¥æµçš„å¯¹è±¡åšä¸ºå‚æ•°.è¾“å…¥æµæŒ‡å®šäº†åœ¨å“ªä»¥åŠæ€ä¹ˆè¯»å–æ–‡æœ¬çš„å­—ç¬¦.è¾“å…¥æµæœ‰ä»¥ä¸‹å‡ ç§:
</p>

<ul class="org-ul">
<li><code>BUFFER</code>: ä»ç¼“å†²åŒºè¯»å–å­—ç¬¦,ä»ç‚¹(point)çš„åé¢,ä¹Ÿå°±æ˜¯æŒ‡é’ˆçš„åé¢å¼€å§‹è¯»å–.</li>
<li><code>MARKER</code>: åœ¨ <code>Marker</code> æ‰€åœ¨çš„ç¼“å†²åŒºè¯»å–å­—ç¬¦,ä» <code>Marker</code> çš„ä½ç½®åé¢å¼€å§‹è¯»å–,è¿™å¹¶ä¸ä¼šå½±å“ç¼“å†²åŒºä¸Šé¢ç‚¹çš„ä½ç½®.</li>
<li><code>STRING</code>: ä»å­—ç¬¦ä¸²è¯»å–å­—ç¬¦,åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦çš„å‰è¾¹å¼€å§‹è¯»å–.</li>
<li><code>FUNCTION</code>: ç”¨äºç”Ÿæˆå­—ç¬¦çš„å‡½æ•°,è¿™ç§å‡½æ•°éœ€è¦æ»¡è¶³æ»¡è¶³ä»¥ä¸‹ä¸¤ç§æ¡ä»¶è°ƒç”¨æ–¹å¼,
<ol class="org-ol">
<li>ä¸å¸¦å‚æ•°è°ƒç”¨,å¹¶ä¸”è¿”å›ä¸‹ä¸€ä¸ªå­—ç¬¦;</li>
<li>å¸¦ä¸€ä¸ªå‚æ•°è°ƒç”¨,è¿™å‚æ•°è¿˜ä¸€å®šæ˜¯ä¸ªå­—ç¬¦, <code>FUNCTION</code> åº”è¯¥ä¿å­˜å‚æ•°å¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™è¿”å›è¿™ä¸ªå‚æ•°.è¿™å«åš <code>"unreading" the character</code>;
è¿™ç§è°ƒç”¨å‘ç”Ÿåœ¨ <code>Lisp reader</code> è¯»å–ä¸€ä¸ªå­—ç¬¦å¤ªå¤šæ¬¡å¹¶ä¸”æƒ³æŠŠå®ƒæ”¾å›å®ƒæ‰€æ¥è‡ªçš„åœ°æ–¹.è¿™ç§æƒ…å†µä¸‹, <code>FUNCTION</code> è¿”å›çš„å€¼æ²¡æœ‰åŒºåˆ«.</li>
</ol></li>
<li><code>t</code>: è¡¨ç¤ºæµæ˜¯ <code>minibuffer</code>,ä¸€æ—¦ä» <code>minibuffer</code> è¯»å–å°±ä¼šé©¬ä¸Šå”¤é†’å¹¶ä¸”ç­‰å¾…ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸².å¦‚æœ <code>Emacs</code> æ˜¯ä»¥ <code>batch mode</code> ä¸‹è¿è¡Œ,é‚£ä¹ˆå°±ç”¨æ ‡å‡†è¾“å…¥(<code>standard input</code>)ä½œä¸ºè¾“å…¥æµ.</li>
<li><code>nil</code>: è¡¨ç¤ºç”¨æ ‡å‡†è¾“å…¥ <code>standard-input</code> ä½œä¸ºè¾“å…¥æµ.</li>
<li><code>SYMBOL</code>: <code>SYMBOL</code> çš„å‡½æ•°å®šä¹‰ä½œä¸ºè¾“å…¥æµ(å¦‚æœæœ‰å‡½æ•°å®šä¹‰çš„è¯).</li>
</ul>

<p>
è¿™ç« èŠ‚çš„æ–‡æ¡£è¿˜æœ‰é’ˆå¯¹ä¸Šé¢çš„æ¼”ç¤º,æ¯”å¦‚å¦‚ä½•å®šä¹‰ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„ <code>FUNCTION</code>.
</p>
</div>
</div>


<div id="outline-container-org0d9ec95" class="outline-4">
<h4 id="org0d9ec95">è¾“å…¥å‡½æ•° (Input Functions)</h4>
<div class="outline-text-4" id="text-org0d9ec95">
<p>
ä¸è¯»å–ç›¸å…³çš„å‡½æ•°ä»¥åŠå˜é‡.
</p>
</div>
</div>



<div id="outline-container-orge90bfad" class="outline-4">
<h4 id="orge90bfad">è¾“å‡ºæµ (Output Streams)</h4>
<div class="outline-text-4" id="text-orge90bfad">
<p>
è¾“å‡ºæµæŒ‡å®šäº†æ€ä¹ˆå¤„ç†æ‰“å°çš„å­—ç¬¦.è¾“å…¥æµæœ‰å¯èƒ½æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹:
</p>

<ul class="org-ul">
<li><code>BUFFER</code>: è¾“å‡ºçš„å­—ç¬¦è¢«æ’å…¥åˆ°ç¼“å†²åŒºé‡Œé¢çš„ç‚¹åé¢.</li>
<li><code>MARKER</code>: æŠŠè¾“å‡ºçš„å­—ç¬¦æ’å…¥åˆ° <code>Marker</code> æ‰€åœ¨çš„ç¼“å†²åŒºé‡Œé¢,åœ¨ <code>Marker</code> çš„ä½ç½®åé¢æ’å…¥,è¿™å¹¶ä¸ä¼šå½±å“ç¼“å†²åŒºä¸Šé¢ç‚¹çš„ä½ç½®.</li>
<li><code>FUNCTION</code>: è¾“å‡ºçš„å­—ç¬¦ä¼šè¢«ä¼ ç»™ <code>FUNCTION</code> è¿›è¡Œå‚¨å­˜,è¿™ä¸ªå‡½æ•°éœ€è¦æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä½œä¸ºå‚æ•°,è¾“å‡ºçš„å­—ç¬¦æœ‰å¤šå°‘ä¸ªå°±éœ€è¦ä¼ å…¥å¤šå°‘æ¬¡,å¹¶ä¸”èƒ½å¤Ÿåœ¨ä½ æƒ³è¦çš„æ—¶å€™è´Ÿè´£å‚¨å­˜å­—ç¬¦.</li>
<li><code>t</code>: æŠŠè¾“å‡ºå­—ç¬¦æ˜¾ç¤ºåœ¨å›æ˜¾åŒºåŸŸä¸­(echo area).</li>
<li><code>nil</code>: æŠŠè¾“å‡ºå­—ç¬¦è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º(<code>standard-out</code>)ä¸­.</li>
<li><code>SYMBOL</code>: <code>SYMBOL</code> çš„å‡½æ•°å®šä¹‰ä½œä¸ºè¾“å‡ºæµ(å¦‚æœæœ‰å‡½æ•°å®šä¹‰çš„è¯).</li>
</ul>

<p>
è¿™ç« èŠ‚çš„æ–‡æ¡£è¿˜æœ‰é’ˆå¯¹ä¸Šé¢çš„æ¼”ç¤º,æ¯”å¦‚å¦‚ä½•å®šä¹‰ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„ <code>FUNCTION</code>.
</p>
</div>
</div>


<div id="outline-container-org265e20a" class="outline-4">
<h4 id="org265e20a">è¾“å‡ºå‡½æ•° (Output Functions)</h4>
<div class="outline-text-4" id="text-org265e20a">
<p>
ä¸€äº›æ‰“å°å‡½æ•°ä¼šåœ¨å¿…è¦æ—¶å€™ç»™è¾“å‡ºæ·»åŠ ä¸€äº›å¼•ç”¨å­—ç¬¦ä¸²(quoting character)æ¥ä½¿è¿™äº›è¾“å‡ºèƒ½å¤Ÿè¢«æ­£å¸¸è¯»å–.å¼•ç”¨å­—ç¬¦æœ‰ <code>"</code> å’Œ <code>\</code>,å¯ä»¥åŒºåˆ† <code>string</code> å’Œ <code>symbol</code> ä»¥åŠé˜²æ­¢åœ¨è¯»å– <code>string</code> å’Œ <code>symbol</code> çš„æ—¶å€™æœ‰ä¸­æ–­(punctuation)çš„å‘ç”Ÿ.
</p>

<p>
<code>String</code> ç”¨ <code>"</code> <code>\</code> å¤§éƒ¨ä»½äººéƒ½å¾ˆç†Ÿæ‚‰,ä½†æ˜¯ <code>symbol</code> ç”¨ <code>\</code> å°±ä¸ä¸€å®šäº†,æ¯”å¦‚, <code>'What\ The\ Fuck\ !</code> æ˜¯ä¸€ä¸ªåˆæ³•çš„ <code>symbol</code>,æ˜¯çš„,å°±å« <code>What The Fuck !</code>. å®é™…ä¸Šå¯ä»¥è®¾å®šæ‰“å°å‡½æ•°æ˜¯å¦æ·»åŠ å¼•ç”¨å­—ç¬¦.
</p>

<p>
<code>Lisp</code> å¯¹è±¡å¯ä»¥å¼•ç”¨å®ƒä»¬è‡ªèº«,ä¹Ÿå°±æ˜¯æ‰€è°“çš„ç¯çŠ¶ç»“æ„,ç”¨æ­£å¸¸çš„æ–¹æ³•æ‰“å°è¿™ç§å¯¹è±¡ä¼šé™·å…¥æ— é™é€’å½’çš„, å½“ <code>Emacs</code> æ£€æµ‹åˆ°é€’å½’çš„æ—¶ä¼šæ‰“å° <code>#LEVEL</code> æ¥è¡¨ç¤ºå¯¹äºå½“å‰æ‰“å°æ“ä½œè€Œè¨€ä¸€ä¸ªåœ¨ <code>LEVEL</code> çº§ä¸Šçš„å¯¹è±¡çš„å¼•ç”¨,è€Œä¸æ˜¯é€’å½’æ‰“å°ä¸€ä¸ªå·²ç»æ‰“å°è¿‡çš„å¯¹è±¡.
</p>

<p>
æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> foo (list nil)) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (nil)</span>
(setcar foo foo) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (#0)</span>
</pre>
</div>

<p>
è¿™ç« èŠ‚çš„æ–‡æ¡£å‰©ä¸‹çš„éƒ¨åˆ†å°±æ˜¯ä¸€äº› <code>API</code> è¯´æ˜äº†.
</p>
</div>
</div>


<div id="outline-container-org7cfec89" class="outline-4">
<h4 id="org7cfec89">å½±å“è¾“å‡ºçš„å˜é‡ (Output Variables)</h4>
<div class="outline-text-4" id="text-org7cfec89">
<p>
è‡ªè¡ŒæŸ¥é˜….
</p>
</div>
</div>
</div>


<div id="outline-container-org718b898" class="outline-3">
<h3 id="org718b898">Minibuffers</h3>
<div class="outline-text-3" id="text-org718b898">
<p>
<code>minibuffer</code> å°±æ˜¯ä¸€ç§ç‰¹åˆ«çš„ç¼“å†²åŒº, <code>Emacs</code> å‘½ä»¤ä¼šç”¨å®ƒæ¥è¯»å–æ¯”æ•°å­—å‰ç¼€å‚æ•°(numeric prefix argument)æ›´åŠ å¤æ‚çš„å‚æ•°.
</p>

<p>
è¿™äº›å‚æ•°åŒ…æ‹¬æ–‡ä»¶åå­—,ç¼“å†²åŒºåå­—å’Œå‘½ä»¤åå­—. <code>minibuffer</code> ä¼šæ˜¾ç¤ºåœ¨ <code>frame</code> çš„åº•éƒ¨,å’Œå›æ˜¾åŒºåŸŸ(<code>echo area</code>)çš„ä½ç½®ä¸€æ ·,åŒºåˆ«åœ¨äº <code>minibuffer</code> ç”¨æ¥è¯»å–, <code>echo area</code> ç”¨äºæ‰“å°.
</p>
</div>

<div id="outline-container-org9f7c445" class="outline-4">
<h4 id="org9f7c445">å…¥é—¨Minibuffers (Intro to Minibuffers)</h4>
<div class="outline-text-4" id="text-org9f7c445">
<p>
å¤§éƒ¨ä»½æƒ…å†µä¸‹, <code>minibuffers</code> å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ <code>Emacs</code> ç¼“å†²åŒº.åœ¨ç¼“å†²åŒºé‡Œé¢,å¤§éƒ¨ä»½æ“ä½œ,æ¯”å¦‚ç¼–è¾‘å‘½ä»¤éƒ½èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ.
</p>

<p>
ç„¶è€Œ,è®¸å¤šç®¡ç†ç¼“å†²åŒºçš„æ“ä½œéƒ½ä¸ä¼šåº”ç”¨åˆ° <code>minibuffers</code> ä¸Š. <code>Minibuffer</code> çš„åå­—å¿…å®šæ˜¯ <code>' *Minibuf-NUMBER*'</code> è¿™ç§å½¢å¼å¹¶ä¸”ä¸ä¼šè¢«æ”¹å˜.
</p>

<p>
<code>Minibuffers</code> åªä¼šæ˜¾ç¤ºåœ¨ç”¨äºæ˜¾ç¤º <code>minibuffers</code> çš„çª—å£ä¸­,è¿™äº›çª—å£ä¸€å®šæ˜¯æ˜¾ç¤ºåœ¨ <code>frame</code> çš„åº•éƒ¨.
</p>

<p>
æœ‰æ—¶å€™frameæ˜¯æ²¡æœ‰ <code>minibuffer</code> çª—å£çš„,è¿˜æœ‰ç§ç‰¹åˆ«çš„frameæ˜¯åªåŒ…å«ä¸€ä¸ª <code>minibuffer</code> çª—å£ çš„.
</p>

<p>
<code>Minibuffer</code> é‡Œé¢çš„æ–‡æœ¬å¿…å®šæ˜¯ä»¥æç¤ºå­—ç¬¦ä¸²å¼€å¤´(prompt string)çš„, <code>prompt string</code> å¯ä»¥è¢«è°ƒç”¨ <code>minibuffer</code> çš„ç¨‹åºæŒ‡å®š,ç”¨æ¥å‘Šè¯‰ç”¨æˆ·åº”è¯¥è¾“å…¥ä»€ä¹ˆ.
</p>

<p>
æç¤ºå­—ç¬¦ä¸²æ˜¯ <code>read-only</code> çš„,æ‰€ä»¥ä¸ä¼šæœ‰æ„å¤–åˆ é™¤æˆ–è€…æ”¹å˜å®ƒçš„æƒ…å†µå‘ç”Ÿ.å®ƒè¿˜è¢«æ ‡è¯†ä¸ºä¸€ä¸ª <code>field</code>,ä¸€äº›åŠ¨ä½œå‡½æ•°(motion functions)åŒ…æ‹¬ <code>beginning-of-line</code>,
</p>

<p>
<code>forward-word</code>, <code>forward-sentence</code> å’Œ <code>forward-paragraph</code>,ä¼šåœ¨æç¤ºæ–‡æœ¬å’Œå®é™…æ–‡æœ¬ä¹‹é—´çš„è¾¹ç•Œåœæ­¢.
</p>

<p>
<code>Minibuffer</code> çš„çª—å£ä¸€èˆ¬å°±æ˜¯å•è¡Œ,å®ƒä¼šåœ¨å†…å®¹éœ€è¦æ›´å¤šç©ºé—´çš„æƒ…å†µä¸‹è‡ªåŠ¨å¢é•¿.åœ¨ <code>minibuffer</code> æ¿€æ´»çš„åŒæ—¶,å¯ä»¥é€šè¿‡æ”¹å˜çª—å£å¤§å°çš„å‘½ä»¤ä¸´æ—¶æ”¹å˜ <code>minibuffer</code> çš„çª—å£å¤§å°,
</p>

<p>
åœ¨ <code>minibuffer</code> é€€å‡ºçš„æ—¶å€™ä¼šè¿˜åŸå›å».åœ¨ <code>minibuffer</code> æ²¡æœ‰æ¿€æ´»çš„æ—¶å€™å¯ä»¥åœ¨åŒä¸€ä¸ªframeé‡Œå…¶ä»–çª—å£ä½¿ç”¨æ›´æ”¹å¤§å°çš„å‘½ä»¤æˆ–è€…é€šè¿‡é¼ æ ‡æ‹–åŠ¨ <code>mode line</code> æ¥æ°¸è¿œæ”¹å˜å®ƒ <code>minibuffer</code> çš„å¤§å°.
</p>

<p>
ç”±äºç›®å‰ç‰ˆæœ¬ <code>27.0.50</code> çš„å®ç°ç»†èŠ‚,åªæœ‰æŠŠ <code>resize-mini-window</code> è®¾ç½®ä¸º <code>nil</code> æ‰èƒ½æˆåŠŸ.
</p>

<p>
å¯¹äºåªæœ‰ <code>minibuffer</code> çš„frame,åªè¦æ”¹å˜frameçš„å¤§å°å°±å¯ä»¥äº†.
</p>

<p>
<code>minibuffer</code> çš„ç”¨é€”å°±æ˜¯ç”¨äºè¯»å–è¾“å…¥äº‹ä»¶ä»¥åŠä¿®æ”¹ç±»ä¼¼ <code>this-command</code> å’Œ <code>last-command</code> è¿™æ ·å˜é‡çš„å€¼.
</p>

<p>
å¦‚æœä½ çš„ç¨‹åºä¸æƒ³æ”¹å˜è¿™äº›å˜é‡çš„å€¼,é‚£ä¹ˆåº”è¯¥åœ¨ <code>minibuffer</code> çš„å¤–å±‚ä½œç”¨åŸŸç»‘å®šè¿™äº›å˜é‡.
</p>

<p>
åœ¨ä¸€äº›æƒ…å†µä¸‹,ä¸€ä¸ªå‘½ä»¤å¯ä»¥åœ¨å³ä½¿å·²ç»å­˜åœ¨ä¸€ä¸ªå·²æ¿€æ´»çš„ <code>minibuffer</code> çš„æƒ…å†µä¸‹å†ä½¿ç”¨ä¸€ä¸ª <code>minibuffer</code>,è¿™ä¸ªæ–°çš„ <code>minibuffer</code> å«åšé€’å½’ <code>minibuffer</code> (<code>recursive minibuffer</code>).
</p>

<p>
ç¬¬ä¸€ä¸ª <code>mimibuffer</code> è¢«å‘½åä¸º <code>' *Minibuf-1*'</code> .é€’å½’ <code>minibuffer</code> å°±æ˜¯é€šè¿‡å¢åŠ åé¢çš„æ•°å­—æ¥å‘½å.
</p>

<p>
(åå­—å‰é¢æ˜¯æœ‰ä¸ªç©ºæ ¼çš„,å› ä¸ºè¿™æ ·å°±ä¸ä¼šæ˜¾ç¤ºåœ¨æ­£å¸¸çš„ç¼“å†²åŒºåˆ—è¡¨ä¸­).åœ¨æ‰€æœ‰çš„é€’å½’ <code>minibuffer</code> é‡Œé¢,åªæœ‰æœ€å†…å±‚çš„é‚£ä¸ªæ˜¯æ¿€æ´»çš„,é€šå¸¸è¿™ä¸ªæ‰è¢«å«åš <code>minibuffer</code>.
</p>

<p>
å¯ä»¥é€šè¿‡è®¾ç½® <code>enable-recursive-minibuffers</code> è¿™ä¸ªå˜é‡æ¥å…è®¸æˆ–è€…ç¦æ­¢é€’å½’ <code>minibuffer</code>,åˆæˆ–è€…ç»™å‘½ä»¤å¯¹åº”çš„ <code>symbol</code> è®¾ç½® <code>enable-recursive-minibuffers</code> å±æ€§æ¥è¾¾åˆ°å±€éƒ¨æ§åˆ¶.
</p>

<p>
å’Œå…¶ä»–ç¼“å†²åŒºä¸€æ ·, <code>minibuffer</code> ä¹Ÿæœ‰ <code>local keymap</code>.æ¿€æ´» <code>minibuffer</code> çš„åŒæ—¶ä¹Ÿä¼šæ ¹æ®è¢«å®Œæˆçš„å·¥ä½œæ¥è®¾ç½®å®ƒçš„ <code>local map</code>.
</p>

<p>
æœ‰é’ˆå¯¹äºæ— è¡¥å…¨çš„ <code>minibuffer</code> (<code>non-completion minibuffer</code>) çš„ <code>local map</code>,è¿˜æœ‰é’ˆå¯¹å¸¦æœ‰è¡¥å…¨åŠŸèƒ½çš„ <code>minibuffer</code> çš„ <code>local map</code>.
</p>

<p>
å½“ <code>minibuffer</code> æ˜¯æœªæ¿€æ´»çŠ¶æ€,å®ƒçš„ä¸»è¦æ¨¡å¼å°±æ˜¯ <code>minibuffer-inactive-mode</code>, å¯¹åº”çš„ <code>keymap</code> å°±æ˜¯ <code>minibuffer-inactive-mode-map</code>.
</p>

<p>
å½“ <code>Emacs</code> æ˜¯ä»¥ <code>batch mode</code> çš„å½¢å¼è¿è¡Œ,ä» <code>minibuffer</code> è¯»å–å®é™…ä¸Šå°±æ˜¯ä»æ ‡å‡†è¾“å…¥æè¿°ç¬¦ (standard input descriptor) è¯»å–, <code>batch mode</code> ä¸‹æ˜¯ä¸æ”¯æŒåŒ…æ‹¬ <code>history, completion</code> ç­‰ç‰¹è‰² <code>minibuffer</code> ç‰¹æ€§.
</p>
</div>
</div>



<div id="outline-container-orgac46b65" class="outline-4">
<h4 id="orgac46b65">ä»Minibufferä¸­è¯»å–æ–‡æœ¬ (Text from MInibuffer)</h4>
<div class="outline-text-4" id="text-orgac46b65">
<p>
é’ˆå¯¹ <code>minibuffer</code> çš„è¾“å…¥è€Œè¨€æœ€åŸå§‹çš„æ“ä½œå°±æ˜¯ <code>read-from-minibuffer</code>,å¯ä»¥è¯»å–ä¸€ä¸ª <code>string</code> æˆ–è€…ä¸€ä¸ªæ–‡æœ¬å½¢å¼çš„ <code>Lisp</code> å¯¹è±¡.
</p>

<p>
<code>read-regexp</code> ç”¨æ¥è¯»å–æ­£åˆ™è¡¨è¾¾å¼.è¿˜æœ‰å„ç§å„æ ·ç”¨äºå…¶å®ƒç”¨é€”çš„å‡½æ•°.å¤§éƒ¨ä»½æƒ…å†µä¸‹ä¸åº”è¯¥ç›´æ¥è°ƒç”¨è¿™äº›å‡½æ•°,å¦‚æœåªæ˜¯ç”¨äºè¯»å–è¾“å…¥,å¯ä»¥ç”¨ <code>interactive</code>.
</p>

<p>
æœ¬ç« èŠ‚åŸºæœ¬éƒ½æ˜¯å…³äº <code>minibuffer</code> è¯»å–æ–‡æœ¬çš„ <code>api</code>,å…¶ä¸­ä¸ªäººæ¯”è¾ƒå…³æ³¨çš„æ˜¯å®ƒ <code>minibuffer-local-map</code> ä»¥åŠ <code>minibuffer-local-ns-map</code> ä¸¤ä¸ªå˜é‡,å¯ä»¥äº†è§£åˆ° <code>minibuffer</code> çš„æŒ‰é”®ç»‘å®š.
</p>
</div>
</div>


<div id="outline-container-org678551b" class="outline-4">
<h4 id="org678551b">ä»Minibufferä¸­è¯»å–å¯¹è±¡ (Object from Minibuffer)</h4>
<div class="outline-text-4" id="text-org678551b">
<p>
å°±æ˜¯å…³äºè¯»å–å¯¹è±¡çš„ <code>API</code>.
</p>
</div>
</div>


<div id="outline-container-org654ef46" class="outline-4">
<h4 id="org654ef46">Minibufferå†å² (Minibuffer History)</h4>
<div class="outline-text-4" id="text-org654ef46">
<p>
<code>Minibuffer history list</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨,ç”¨äºè®°å½•ç”¨æˆ·è¾“å…¥çš„ä¸Šä¸€ä¸ªå‘½ä»¤,è¿™æ ·ç”¨æˆ·å°±å¯ä»¥æ–¹ä¾¿åœ°é‡æ–°è°ƒç”¨å‘½ä»¤.
</p>

<p>
å…¶å®æœ‰å¾ˆå¤šä¸ªä¸åŒçš„ <code>minibuffer history list</code> ç”¨ä¸ä¸åŒç§ç±»çš„è¾“å…¥,å¯ä»¥é€šè¿‡è®¾å®š <code>read-from-minibuffer</code> æˆ–è€… <code>completing-read</code> çš„ <code>HISTORY</code> å‚æ•°æ¥æŒ‡å®š <code>minibuffer</code> çš„å†å²åˆ—è¡¨:
</p>

<p>
æœ‰ä¸¤ç§å¯èƒ½çš„å€¼:
</p>

<ul class="org-ul">
<li><code>VARIABLE</code>: ä½¿ç”¨å˜é‡(symbol)ä½œä¸ºå†å²åˆ—è¡¨;</li>
<li><code>(VARIABLE . STARTPOS)</code>: ä½¿ç”¨å˜é‡ä½œä¸ºå†å²åˆ—è¡¨, <code>STARTPOS</code> æ˜¯å†å²åˆ—è¡¨çš„åˆå§‹ä½ç½®,æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°,å¦‚æœä¸º0å°±æ˜¯å’Œåªä½¿ç”¨å˜é‡ä¸€æ ·.</li>
</ul>

<p>
å¦‚æœä¸æŒ‡å®šçš„è¯å°±ä¼šä½¿ç”¨é»˜è®¤å†å²åˆ—è¡¨ <code>minibuffer-history</code>. <code>read-from-minibuffer</code> å’Œ <code>completing-read</code> éƒ½ä¼šè‡ªåŠ¨ç»™å†å²åˆ—è¡¨æ–°å¢åŠ å…ƒç´ ,å¹¶ä¸”æä¾›å‘½ä»¤ç»™ç”¨æˆ·é‡æ–°ä½¿ç”¨åˆ—è¡¨ä¸Šçš„å…ƒç´ .
</p>

<p>
å†å²åˆ—è¡¨æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„,é¦–å…ˆç”± <code>history-length</code> å˜é‡å†³å®š,å¦‚æœæŸä¸ªå†å²åˆ—è¡¨æœ‰ <code>history-length</code> å±æ€§,é‚£ä¹ˆè¯¥åˆ—è¡¨çš„é•¿åº¦å°±ç”±è¯¥å±æ€§çš„å€¼å†³å®š.
</p>

<p>
<code>history-delete-duplicates</code> å˜é‡å¯ä»¥å†³å®šæ˜¯å¦åˆ é™¤é‡å¤çš„å†å²è®°å½•.
</p>
</div>
</div>




<div id="outline-container-orga989135" class="outline-4">
<h4 id="orga989135">åˆå§‹è¾“å…¥ (Initial Input)</h4>
<div class="outline-text-4" id="text-orga989135">
<p>
æœ‰å‡ ä¸ªå…³äº <code>minibuffer</code> è¾“å…¥çš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ªå‚æ•°å«åš <code>INITIAL</code>,å®ƒèƒ½å¤Ÿè®© <code>minibuffer</code> ä»¥ç‰¹å®šæ–‡æœ¬å¼€å¤´,ä¸è¿‡è¿™ä¸ªå‡ ä¹æ˜¯è¢«èˆå¼ƒäº†.
</p>

<p>
å› ä¸ºè¿™ä¸ªå‚æ•°ä¸º <code>non-nil</code> çš„æ—¶å€™æ˜¯ä¸€ä¸ªæ‰°ä¹±æ€§çš„æ¥å£(intrusive interface),æ‰€ä»¥ä¸æ¨èä½¿ç”¨,å†å²åˆ—è¡¨æä¾›äº†æ›´å¥½çš„æ–¹æ³•æ¥å®Œæˆè¿™ç§äº‹æƒ….
</p>
</div>
</div>



<div id="outline-container-org056232d" class="outline-4">
<h4 id="org056232d">è¡¥å…¨ (Completion)</h4>
<div class="outline-text-4" id="text-org056232d">
<p>
è¡¥å…¨å°±æ˜¯æ ¹æ®æ–‡æœ¬çš„å¼€å¤´å¡«å……æ–‡æœ¬çš„å‰©ä½™éƒ¨åˆ†,é€šè¿‡å¯¹æ¯”ç”¨æˆ·çš„è¾“å…¥å’Œä¸€ä¸ªå¯ç”¨çš„å®Œæ•´æ–‡æœ¬çš„åˆ—è¡¨,æˆ‘ä»¬å«å®ƒè¡¥å…¨è¡¨(<code>completion table</code>),ç„¶ååˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬æœ€æ¥è¿‘å“ªä¸€ä¸ª.
</p>

<p>
æ ‡å‡†çš„ <code>Emacs</code> å‘½ä»¤æä¾›äº† <code>symbol</code> / æ–‡ä»¶/ ç¼“å†²åŒº /è¿›ç¨‹åå­—çš„è¡¥å…¨,å½“ç„¶ <code>Emacs</code> ä¹Ÿæä¾›äº†åŸå‡½æ•° <code>try-completion</code> ä»¥åŠé«˜çº§å‡½æ•° <code>completing-read</code> æ¥è®©ç”¨æˆ·å®ç°å¯¹å…¶å®ƒç±»å‹åå­—çš„è¡¥å…¨.
</p>
</div>

<ul class="org-ul">
<li><a id="orgc317b13"></a>åŸºç¡€è¡¥å…¨ (Basic Completion)<br>
<div class="outline-text-5" id="text-orgc317b13">
<p>
è¿™ç« èŠ‚çš„ <code>API</code> éƒ½æ˜¯å’Œ <code>minibuffer</code> æœ¬èº«æ— å…³çš„,å› ä¸ºè¿™æ ·,å®ƒä»¬èƒ½å¤Ÿç”¨åœ¨å¾ˆå¤šå…¶å®ƒçš„åœ°æ–¹ä¸Š.
</p>
</div>
</li>




<li><a id="orgfea86ea"></a>Minibufferè¡¥å…¨ (Minibuffer Completion)<br>
<div class="outline-text-5" id="text-orgfea86ea">
<p>
ç”¨äºè¡¥å…¨ <code>minibuffer</code> çš„åŸºæœ¬æ¥å£.
</p>
</div>
</li>


<li><a id="org10052d3"></a>è¡¥å…¨å‘½ä»¤ (Completion Commands)<br>
<div class="outline-text-5" id="text-org10052d3">
<p>
æè¿°ç”¨äºè¡¥å…¨ <code>minibuffer</code> çš„æŒ‰é”®æ˜ å°„(<code>keymap</code>),å‘½ä»¤ä»¥åŠç”¨æˆ·é€‰é¡¹.
</p>
</div>
</li>


<li><a id="org4f1e9e1"></a>é«˜çº§è¡¥å…¨ (High-Level Completion)<br>
<div class="outline-text-5" id="text-org4f1e9e1">
<p>
é’ˆå¯¹ç‰¹å®šç§ç±»(ç¼“å†²åŒº/ <code>symbol</code> / å‘½ä»¤ / é¢œè‰²,ç­‰ç­‰)åå­—çš„é«˜çº§è¡¥å…¨å‡½æ•°.
</p>
</div>
</li>


<li><a id="orgab98fbc"></a>è¯»å–æ–‡ä»¶åå­— (Reading File Names)<br>
<div class="outline-text-5" id="text-orgab98fbc">
<p>
æè¿°ç”¨äºè¡¥å…¨æ–‡ä»¶åå­—,ç›®å½•åå­—è¿˜æœ‰ <code>shell</code> å‘½ä»¤åå­—çš„é«˜çº§å‡½æ•°.
</p>
</div>
</li>


<li><a id="org1495bdd"></a>è¡¥å…¨ç›¸å…³å˜é‡ (Completion Variables)<br>
<div class="outline-text-5" id="text-org1495bdd">
<p>
è¡¥å…¨ç›¸å…³çš„ç”¨æˆ·é€‰é¡¹,ä¿®æ”¹é»˜è®¤çš„è¡¥å…¨è¡Œä¸º.
</p>
</div>
</li>


<li><a id="org027fd4e"></a>ç¼–ç¨‹è¡¥å…¨ (Programmed Completion)<br>
<div class="outline-text-5" id="text-org027fd4e">
<p>
æœ‰æ—¶å€™ä¸å¯èƒ½æˆ–è€…ä¸æ–¹ä¾¿æå‰åˆ›å»ºä¸€ä¸ªåŒ…å«åŒ¹é…å€¼çš„ <code>alist</code> æˆ–è€… <code>obarray</code>,è¿™ç§æƒ…å†µä¸‹ä½ å¯ä»¥æä¾›è‡ªå·±çš„å‡½æ•°æ¥è®¡ç®—æŒ‡å®š <code>string</code> çš„è¡¥å…¨çš„å¯èƒ½å€¼.
</p>

<p>
è¿™å«åšç¼–ç¨‹è¡¥å…¨,æ¯”å¦‚ <code>Emacs</code> åœ¨è¡¥å…¨æ–‡ä»¶åå­—çš„æ—¶å€™å°±ä½¿ç”¨äº†ç¼–ç¨‹è¡¥å…¨.è¿™ç« èŠ‚å°±æ˜¯æè¿°ç›¸å…³çš„æ¥å£.
</p>
</div>
</li>


<li><a id="org7a75975"></a>åœ¨ç¼“å†²åŒºä¸­è¡¥å…¨ (Completion in Buffers)<br>
<div class="outline-text-5" id="text-org7a75975">
<p>
é™¤äº†åœ¨ <code>minibuffer</code> ä¸­è¡¥å…¨, <code>Emacs</code> è¿˜å…è®¸åœ¨ç¼“å†²åŒºä¸Šè¿›è¡Œè¡¥å…¨.
</p>

<p>
é’©å­å˜é‡ <code>completion-at-point-functions</code> æ˜¯ä¸€ä¸ªå‡½æ•°åˆ—è¡¨,é‡Œé¢çš„å‡½æ•°éƒ½æ˜¯ç”¨äºè®¡ç®—ç”¨äºè¡¥å…¨æŸä¸ªç‚¹ä¸Šæ–‡æœ¬çš„è¡¥å…¨è¡¨(<code>completion table</code>).
</p>

<p>
<code>Major mode</code> å¯ä»¥ç”¨è¿™ä¸ªå˜é‡æ¥æä¾›è¡¥å…¨è¡¨.å½“è¿è¡Œ <code>completion-at-point</code> çš„æ—¶å€™,åˆ—è¡¨ä¸Šçš„å‡½æ•°å°±ä¼šè¢«ä¾æ¬¡è°ƒç”¨,ä¸éœ€è¦ä¼ å…¥å‚æ•°.
</p>

<p>
æ¯ä¸ªå‡½æ•°éƒ½åº”è¯¥è¿”å› <code>nil</code>,é™¤éå®ƒèƒ½å¤Ÿè´Ÿè´£è¯¥ç‚¹ä¸Šçš„æ–‡æœ¬çš„è¡¥å…¨,å¦åˆ™å°±åº”è¯¥è¿”å›å¦‚ä¸‹å½¢å¼çš„åˆ—è¡¨ <code>(START END COLLECTION . PROPS)</code>.
</p>

<p>
<code>START</code> å’Œ <code>END</code> ç•Œå®šäº†è¢«è¡¥å…¨çš„æ–‡æœ¬, <code>COLLECTION</code> å°±æ˜¯è¡¥å…¨è¡¨, <code>PROPS</code> å°±æ˜¯ä¸€ä¸ªè®°å½•äº†é¢å¤–ä¿¡æ¯çš„ <code>plist</code>.
</p>

<p>
æ–‡ç« ä½™ä¸‹éƒ¨åˆ†å°±æ˜¯è®²è§£ç¼–å†™è¿™äº›å‡½æ•°éœ€è¦æ³¨æ„çš„åœ°æ–¹.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-org8945b92" class="outline-4">
<h4 id="org8945b92">Yes-or-NoæŸ¥è¯¢ (Yes-or-No Queries)</h4>
<div class="outline-text-4" id="text-org8945b92">
<p>
<code>Emacs</code> æä¾›äº†è¯¢é—®ç”¨æˆ· <code>yes-or-no</code> é—®é¢˜çš„å‡½æ•°: <code>y-or-n-p</code> çš„é—®é¢˜å¯ä»¥ç”¨ä¸€ä¸ªå­—ç¬¦å›ç­”; <code>yes-or-no-p</code> çš„é—®é¢˜åˆ™éœ€è¦ç”¨ä¸‰æˆ–è€…å››ä¸ªå­—ç¬¦å›ç­”, <code>yes-or-no-p</code> é€‚åˆç”¨äºé‡è¦çš„é—®é¢˜(<code>momentous questions</code>).
</p>

<p>
ä¸¥æ ¼æ¥è®², <code>yes-or-no-p</code> ä½¿ç”¨ <code>minibuffer</code>, è€Œ <code>y-or-n-p</code> ä¸,è¿˜æœ‰ <code>y-or-n-p</code> æœ‰ä¸€ä¸ªé™æ—¶ç‰ˆæœ¬: <code>y-or-n-p-with-timeout</code>,è¶…è¿‡å¤šå°‘ç§’å°±æä¾›é»˜è®¤å›ç­”.
</p>
</div>
</div>


<div id="outline-container-org0a14b49" class="outline-4">
<h4 id="org0a14b49">å¤šé‡é€‰æ‹©æŸ¥è¯¢ (Multiple Queries)</h4>
<div class="outline-text-4" id="text-org0a14b49">
<p>
å¦‚æœæœ‰ä¸€ç³»åˆ—ç±»ä¼¼çš„é—®é¢˜éœ€è¦é€ä¸ªè¯¢é—®,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>map-y-or-n-p</code>,å¦‚æœä¸€ä¸ªé—®é¢˜çš„å›ç­”ä¸æ­¢ <code>yes</code> å’Œ <code>no</code>,é‚£ä¹ˆä½¿ç”¨ <code>read-answer</code>.
</p>
</div>
</div>

<div id="outline-container-orgf6e8a01" class="outline-4">
<h4 id="orgf6e8a01">è¯»å–å¯†ç  (Reading a Password)</h4>
<div class="outline-text-4" id="text-orgf6e8a01">
<p>
å¦‚æœè¦è¯»å–ä¸€ä¸ªå¯†ç å¹¶ä¸”æŠŠå¯†ç ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªç¨‹åº,å¯ä»¥ä½¿ç”¨ <code>read-password</code>.
</p>
</div>
</div>

<div id="outline-container-org8384676" class="outline-4">
<h4 id="org8384676">åœ¨Minibufferä¸­ä½¿ç”¨çš„å‘½ä»¤ (Minibuffer Commands)</h4>
<div class="outline-text-4" id="text-org8384676">
<p>
ä¸€äº›åœ¨ <code>minibuffer</code> é‡Œé¢ä½¿ç”¨çš„å‘½ä»¤.
</p>
</div>
</div>

<div id="outline-container-org30e4cdf" class="outline-4">
<h4 id="org30e4cdf">Minibufferçª—å£ (Minibuffer Windows)</h4>
<div class="outline-text-4" id="text-org30e4cdf">
<p>
ä¸€äº› <code>APIs</code>: å¯ä»¥è®¿é—®å’Œé€‰æ‹© <code>minibuffer</code> çª—å£,ä»¥åŠæµ‹è¯•å®ƒä»¬æ˜¯å¦æ¿€æ´»å’Œæ§åˆ¶å®ƒä»¬å¦‚ä½•æ”¹å˜å¤§å°.
</p>
</div>
</div>

<div id="outline-container-orged583d6" class="outline-4">
<h4 id="orged583d6">Minibufferå†…å®¹ (Minibuffer Contents)</h4>
<div class="outline-text-4" id="text-orged583d6">
<p>
ç”¨äºè·å– <code>minibuffer</code> çš„æç¤ºå’Œå†…å®¹çš„å‡½æ•°.
</p>
</div>
</div>

<div id="outline-container-org55e8300" class="outline-4">
<h4 id="org55e8300">é€’å½’Minibuffer (Recursive Mini)</h4>
<div class="outline-text-4" id="text-org55e8300">
<p>
ç”¨äºå¤„ç†é€’å½’ <code>minibuffer</code> çš„å‡½æ•°å’Œå˜é‡.
</p>
</div>
</div>

<div id="outline-container-org36abc75" class="outline-4">
<h4 id="org36abc75">Minibufferæ‚é¡¹ (Minibuffer Misc)</h4>
<div class="outline-text-4" id="text-org36abc75">
<p>
å°±æ˜¯æ‚é¡¹.
</p>
</div>
</div>
</div>


<div id="outline-container-org50b6df8" class="outline-3">
<h3 id="org50b6df8">å‘½ä»¤å¾ªç¯ (Command Loop)</h3>
<div class="outline-text-3" id="text-org50b6df8">
<p>
åœ¨å¯åŠ¨ <code>Emacs</code> æ—¶,å®ƒä¼šé©¬ä¸Šè¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯:
</p>

<p>
æ¯ä¸€è½®å¾ªç¯æ˜¯ä¸ºäº†è¯»å–ç”¨æˆ·çš„æŒ‰é”®åºåˆ—(<code>key sequence</code>),ä¸€ä¸ªæŒ‰é”®åºåˆ—å°±æ˜¯ä¸€ä¸ªè¾“å…¥äº‹ä»¶åºåˆ—(a sequence input events);
</p>

<p>
ä¸€æ—¦ç­‰åˆ°åˆ°ç”¨æˆ·çš„è¾“å…¥,å°±ä¼šæ ¹æ®æŒ‰é”®åºåˆ—æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤;æ‰§è¡Œå‘½ä»¤å¹¶ä¸”æ˜¾ç¤ºç»“æœ.
</p>

<p>
ç„¶åè¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯,è¿™å’Œ <code>shell</code> è§£æå™¨çš„ <code>REPL</code> (<code>Read-Eval-Print Loop</code>) ä¸€æ ·,ç”¨ä»£ç æè¿°å¤§æ¦‚å¦‚ä¸‹:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">while</span> is-emacs-running               <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">is-emacs-running is t</span>
  (<span style="color: #F0DFAF; font-weight: bold;">let*</span> ((input (func-to-read))       <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">func-to-read &#22312;&#35835;&#21462;&#21040;&#36755;&#20837;&#21069;&#20250;&#19968;&#30452;&#26242;&#20572;&#24490;&#29615;</span>
         (command (command-lookup input))
         (res (func-to-eval command)))
    (func-to-print res)))
</pre>
</div>

<p>
è¿™ä¸ªæ— é™å¾ªç¯å«åšç¼–è¾‘å™¨å‘½ä»¤å¾ªç¯(<code>editor command loop</code>),ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸€äº›ç‰¹åˆ«çš„è¾“å…¥æ¥ä¸­æ–­è¿™ä¸ªå¾ªç¯.
</p>

<p>
å®é™…ä¸Š <code>Emacs</code> çš„å¤„ç†è¿œæ¯”ä¸Šé¢çš„æè¿°è¦å¤æ‚,å…ˆæŠ›å¼€å¤æ‚çš„æƒ…å†µä¸è°ˆ,ä¸¾ä¸ªç®€å•çš„ä¾‹å­:
</p>

<p>
å‡è®¾ç”¨æˆ·ç°åœ¨è¾“å…¥ <code>C-n</code> æ¥è¿›è¡Œç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œ.
</p>

<p>
é¦–å…ˆ <code>Emacs</code> é€šè¿‡ <code>read-key-sequence</code> æ¥è¯»å–ç”¨æˆ·è¾“å…¥çš„,ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ <code>func-to-read</code>,å¾—åˆ°çš„ <code>input</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å‘é‡(vector),
</p>

<p>
è¿™é‡Œæ˜¯å­—ç¬¦ä¸² <code>"^N"</code>;
</p>

<p>
ç„¶å <code>Emacs</code> æ ¹æ® <code>input</code> æŸ¥æ‰¾å¯¹åº”å‘½ä»¤çš„,ä¸Šé¢çš„ <code>(command-lookup input)</code> å¤§æ¦‚å°±æ˜¯ <code>(lookup-key (current-global-map) input)</code>,
</p>

<p>
å¾—åˆ°çš„ <code>command</code> æ˜¯å‘½ä»¤çš„å®šä¹‰,è¿™é‡Œæ˜¯ <code>next-line</code> çš„å®šä¹‰;
</p>

<p>
æœ€åå°±æ˜¯æ‰§è¡Œå‘½ä»¤ç„¶åæ˜¾ç¤ºç»“æœäº†, <code>Emacs</code> ä¼šç”¨ <code>command-execute</code> æ‰§è¡Œ <code>command</code>,ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ <code>func-to-eval</code>,
</p>

<p>
è‡³äº <code>func-to-print</code> å°±ä¸å¤ªæ¸…æ¥šäº†,æœ¬äººä¹Ÿæ²¡æœ‰åœ¨æ–‡æ¡£ä¸Šçœ‹åˆ°æœ‰å†™æ˜¯å“ªä¸ªå‡½æ•°.
</p>

<p>
ä¹‹æ‰€ä»¥è¯´ <code>Emacs</code> çš„å®é™…å¤„ç†è¦æ›´å¤æ‚æ˜¯å› ä¸ºè¾“å…¥æœ‰å¾ˆå¤šç§ç±»å‹,å¹¶ä¸” <code>Emacs</code> æœ¬èº«ä¹Ÿè¦åšä¸€äº›åˆ«çš„å¤„ç†,
</p>

<p>
å…·ä½“å†…å®¹å°±çœ‹è¿™é‡Œ: <code>M-: (info "(elisp)Command Overview")</code>
</p>
</div>


<div id="outline-container-org4ea0cfb" class="outline-4">
<h4 id="org4ea0cfb">å®šä¹‰å‘½ä»¤ (Defining Commands)</h4>
<div class="outline-text-4" id="text-org4ea0cfb">
<p>
<code>Emacs</code> çš„å‘½ä»¤å’Œå‡½æ•°æ˜¯ä¸¤ä¸ªæ¦‚å¿µ,ä¸è¿‡ä¸¤è€…å…³ç³»ååˆ†æ¥è¿‘,å‡½æ•°çš„åå­—ä¸èƒ½è¢« <code>execute-extended-command</code> è¯»å–åˆ°,ä¸è¿‡å¯ä»¥ä½¿ç”¨ <code>interactive</code> æ¥æŠŠä¸€ä¸ª <code>Lisp</code> å‡½æ•°å˜æˆå‘½ä»¤.
</p>

<p>
ä¸€èˆ¬æ˜¯ <code>interactive</code> ä¸€å®šè¦æ˜¯åœ¨å‡½æ•°ä½“çš„ç¬¬ä¸€ä¸ª <code>form</code> (top-level),è¿™æ¡è§„åˆ™é€‚ç”¨äº <code>lambda</code> è¡¨è¾¾å¼å’Œ <code>defun form</code>.
</p>

<p>
<code>interactive</code> å’Œå‡½æ•°çš„å®é™…æ‰§è¡Œæ˜¯æ²¡æœ‰å…³ç³»çš„,å®ƒå°±æ˜¯ä¸€ä¸ª <code>flag</code>,å‘Šè¯‰ <code>Emacs</code> çš„å‘½ä»¤å¾ªç¯è¿™ä¸ªå‡½æ•°èƒ½ä¸èƒ½è¢«è¯»å–/äº¤äº’å¼ä½¿ç”¨.
</p>

<p>
<code>interactive</code> çš„å‚æ•°è§„å®šäº†äº¤äº’è°ƒç”¨çš„æ—¶å€™å¦‚ä½•è¯»å–å‚æ•°.
</p>

<p>
é™¤äº†åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨ <code>interactive</code>,è¿˜å¯ä»¥é€šè¿‡æŒ‡å®šç»™å‡½æ•°çš„ <code>symbol</code> çš„ <code>interactive-form</code> å±æ€§è®¾å®šä¸º <code>not-nil</code> æ¥æŠŠå‡½æ•°å˜ä¸ºä¸€ä¸ªå‘½ä»¤,è¿™ä¸ªçš„ä¼˜å…ˆçº§æ¯”ç›´æ¥ä½¿ç”¨ <code>interactive</code> è¦é«˜,è¿™ä¸ªç‰¹æ€§å¾ˆå°‘è¢«ä½¿ç”¨.
</p>

<p>
æœ‰æ—¶å€™åªæ˜¯æƒ³è®©è¿™ä¸ªå‡½æ•°åªèƒ½ç”¨äºäº¤äº’ä½¿ç”¨,è¿™ç§æƒ…å†µä¸‹å¯ä»¥ç›´æ¥æˆ–è€…é€šè¿‡ <code>declare form</code> ç»™å‡½æ•°çš„ <code>symbol</code> çš„ <code>interactive-only</code> å±æ€§è®¾å®šä¸º <code>non-nil</code>,å¦‚æœä» <code>Lisp</code> è°ƒç”¨è¿™ä¸ªå‘½ä»¤çš„è¯å­—èŠ‚ç ç¼–è¯‘å™¨å°±ä¼šäº§ç”Ÿè­¦å‘Š. <code>describe-function</code> çš„è¾“å‡ºä¼šåŒ…å«ç±»ä¼¼çš„ä¿¡æ¯.
</p>

<p>
å€¼å¾—æ³¨æ„çš„æ˜¯,é€šç”¨å‡½æ•°(Generic Functions)æ˜¯ä¸èƒ½è½¬åŒ–å˜æˆå‘½ä»¤çš„,ä¸è¿‡å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°ç„¶åè®©è¿™ä¸ªå‡½æ•°è°ƒç”¨é€šç”¨å‡½æ•°è¿™ç§æ–¹å¼æ¥é—´æ¥ä½¿ç”¨.
</p>
</div>



<ul class="org-ul">
<li><a id="org7623920"></a>ä½¿ç”¨ interactive (Using Interactive)<br>
<div class="outline-text-5" id="text-org7623920">
<p>
<code>(interactive arg-descriptor)</code>,è°ƒç”¨å‘½ä»¤çš„æ—¶å€™ä¼šæ ¹æ® <code>arg-descriptor</code> è¯»å–å‘½ä»¤çš„å‚æ•°, <code>arg-descriptor</code> æœ‰ä¸‰ç§å¯èƒ½:
</p>

<ul class="org-ul">
<li><code>nil</code> æˆ–è€…æ”¾ç€ä¸ç®¡,å°±æ˜¯æŒ‡å‘½ä»¤ä¸éœ€è¦ä»»ä½•å‚æ•°.</li>

<li><p>
<code>string</code>,å®ƒçš„å†…å®¹æ˜¯ä¸€ä¸ªç”± <code>newlines</code> åˆ†å‰²åšä¸ºåˆ†å‰²ç¬¦çš„å…ƒç´ åºåˆ—,æ¯ä¸€ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå‚æ•°,æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª <code>Interactive Code</code> åé¢è·Ÿç€ä¸€ä¸ªå¯é€‰çš„æç¤ºå­—ç¬¦ä¸²(prompt). <code>Interactive Code</code> å¯ä»¥åœ¨è¿™é‡Œçœ‹ <code>M-: (info "elisp("Interactive Codes")")</code>.
</p>

<p>
æç¤ºå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ <code>%</code> æ¥è·å–ä¸Šä¸€ä¸ªå‚æ•°çš„å€¼.
</p>

<p>
å¦‚æœ <code>arg-descriptor</code> ä»¥ <code>*</code> å­—ç¬¦å¼€å¤´,å¹¶ä¸”å¦‚æœåœ¨ <code>read-only</code> ç¼“å†²åŒº è°ƒç”¨è¯¥å‘½ä»¤å°±ä¼šå¼•å‘é”™è¯¯;
</p>

<p>
å¦‚æœä»¥ <code>@</code> å­—ç¬¦å¼€å¤´,å¹¶ä¸”å¦‚æœæŒ‰é”®åºåˆ—åŒ…å«ä»»ä½•é¼ æ ‡äº‹ä»¶,é‚£ä¹ˆä¸ç¬¬ä¸€ä¸ªäº‹ä»¶å…³è”çš„çª—å£å°±ä¼šåœ¨å‘½ä»¤æ‰§è¡Œå‰è¢«é€‰ä¸­;
</p>

<p>
å¦‚æœä»¥ <code>^</code> å­—ç¬¦å¼€å¤´,å¹¶ä¸”å¦‚æœå‘½ä»¤åœ¨ <code>shift-translation</code> ä¸‹å”¤é†’,é‚£ä¹ˆå‘½ä»¤åœ¨æ‰§è¡Œå‰å°±ä¼šä¸´æ—¶è®¾å®š <code>mark</code> å’Œæ¿€æ´»åŒºåŸŸ(region),æˆ–è€…æ‹“å±•ä¸€ä¸ªæ—©å·²æ¿€æ´»çš„åŒºåŸŸ,
</p>

<p>
å¦‚æœå‘½ä»¤åœ¨æ²¡æœ‰ <code>shift-translation</code> çš„æƒ…å†µä¸‹æ¿€æ´»,é‚£ä¹ˆåŒºåŸŸå°–æˆ–è¢«ä¸´æ—¶æ¿€æ´»,ç„¶ååœ¨è¿è¡Œå‰å–æ¶ˆæ¿€æ´»(deactivate).
</p>

<p>
å¯ä»¥ä¸‰ä¸ªå­—ç¬¦ä¸€èµ·ä½¿ç”¨,å¹¶ä¸”é¡ºåºæ— å…³è¦ç´§.
</p>

<p>
æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">pesudo-rename</span> (oldname newname)
  (<span style="color: #F0DFAF; font-weight: bold;">interactive</span> <span style="color: #CC9393;">"sOldname to rename: \nsRename %s to: "</span>)
  (message (format <span style="color: #CC9393;">"oldname: %s to newname: %s"</span> oldname newname)))
</pre>
</div></li>

<li><p>
ä¸€ä¸ªé <code>string</code> çš„ <code>Lisp</code> è¡¨è¾¾å¼,å¹¶ä¸”å®ƒçš„è¿ç®—ç»“æœåº”è¯¥æ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨(list of arguments).
æ¯”å¦‚,
</p>
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">pesudo-rename</span> (oldname newname)
  (<span style="color: #F0DFAF; font-weight: bold;">interactive</span> (<span style="color: #F0DFAF; font-weight: bold;">let*</span> ((name1 (read-string <span style="color: #CC9393;">"name1: "</span>))
                      (name2 (read-string (format <span style="color: #CC9393;">"reaname %s to name2: "</span> name1))))
                 (list name1 name2)))
  (message (format <span style="color: #CC9393;">"Oldname: %s to newname: %s"</span> oldname newname)))
</pre>
</div>

<p>
æ³¨æ„çš„æ˜¯,å‚æ•°å€¼ä¸åº”è¯¥åŒ…å«ä»»ä½•ä¸èƒ½è¢«æ‰“å°ç„¶åè¯»å–çš„æ•°æ®ç±»å‹,ä¸€äº›åŠŸèƒ½ä¼šä¿å­˜ <code>command-history</code> åˆ°ä¸€ä¸ªæ–‡æ¡£é‡Œé¢,å¯èƒ½ä¼šåœ¨åç»­ä¼šè¯ä¸­è¢«è¯»å–,
å¦‚æœä¸€ä¸ªå‘½ä»¤çš„å‚æ•°åŒ…å«è¿™äº›æ•°æ®ç±»å‹(ä¼šä½¿ç”¨ <code>#&lt;...&gt;</code> è¯­æ³•æ‰“å°),é‚£ä¹ˆè¿™äº›åŠŸèƒ½å°±ä¸ä¼šæ­£å¸¸å·¥ä½œ.
</p></li>
</ul>

<p>
<code>(interactive-form function)</code> å¯ä»¥è·å–å‡½æ•°çš„ <code>interactive form</code>.
</p>
</div>
</li>


<li><a id="orga4a452f"></a>é€šç”¨å‘½ä»¤ (Generic Commands)<br>
<div class="outline-text-5" id="text-orga4a452f">
<p>
æœ‰äº›äº¤äº’å‡½æ•°çš„å®ç°å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©å®ç°,è¿™äº›å°±æ˜¯é€šç”¨å‘½ä»¤.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-orgd06a1f7" class="outline-4">
<h4 id="orgd06a1f7">äº¤äº’å¼è°ƒç”¨ (Interactive Call)</h4>
<div class="outline-text-4" id="text-orgd06a1f7">
<p>
ä¸€äº›å…³äºå‘½ä»¤çš„ <code>APIs</code>.
</p>
</div>
</div>


<div id="outline-container-org3a11ecd" class="outline-4">
<h4 id="org3a11ecd">åŒºåˆ†äº¤äº’å¼è°ƒç”¨ (Distinguish Interactive)</h4>
<div class="outline-text-4" id="text-org3a11ecd">
<p>
åˆ¤æ–­å‘½ä»¤æ˜¯å¦è¢«äº¤äº’å¼ä½¿ç”¨.
</p>
</div>
</div>


<div id="outline-container-org7c4772e" class="outline-4">
<h4 id="org7c4772e">å‘½ä»¤å¾ªç¯çš„ä¿¡æ¯ (Command Loop Info)</h4>
<div class="outline-text-4" id="text-org7c4772e">
<p>
ä¸€äº›å…³äºå‘½ä»¤è®°å½•çš„ <code>APIs</code>.
</p>
</div>
</div>


<div id="outline-container-org034f6aa" class="outline-4">
<h4 id="org034f6aa">å‘½ä»¤åè°ƒæ•´æŒ‡é’ˆ (Adjusting Point)</h4>
<div class="outline-text-4" id="text-org034f6aa">
<p>
å½“æŒ‡é’ˆå¤„äºæ‹¥æœ‰ <code>display</code> æˆ–è€… <code>composition</code> å±æ€§æˆ–è€…ä¸å¯è§çš„æ–‡æœ¬ä¸­ <code>Emacs</code> å°±ä¸èƒ½æ˜¾ç¤ºæŒ‡é’ˆ.å› æ­¤åœ¨å‘½ä»¤æ‰§è¡Œå,å¦‚æœæŒ‡é’ˆåœ¨è¿™ç§æ–‡æœ¬ä¸­,å‘½ä»¤å¾ªç¯ä¼šæŠŠæŒ‡æ­£ç§»åŠ¨åˆ°æ–‡æœ¬çš„è¾¹ç•Œä¸­,è¿™æ ·æ–‡æœ¬å°±ä¸èƒ½è¢«è§¦ç¢°åˆ°.
</p>

<p>
å¯ä»¥é€šè¿‡ <code>disable-point-adjustment</code> ä»¥åŠ <code>global-disable-point-adjustment</code> æ¥å…³é—­è¿™ä¸ªç‰¹æ€§.
</p>
</div>
</div>


<div id="outline-container-org22068a6" class="outline-4">
<h4 id="org22068a6">è¾“å…¥äº‹ä»¶ (Input Events)</h4>
<div class="outline-text-4" id="text-org22068a6">
<p>
<code>Emacs</code> çš„å‘½ä»¤å¾ªç¯è¯»å–ä¸€ä¸ªè¾“å…¥äº‹ä»¶çš„åºåˆ—,è¾“å…¥äº‹ä»¶è¡¨ç¤ºé”®ç›˜æˆ–è€…é¼ æ ‡çš„æ´»åŠ¨,åˆæˆ–è€…æ˜¯å‘é€ç»™ <code>Emacs</code> çš„ç³»ç»Ÿäº‹ä»¶.
</p>

<p>
è¡¨ç¤ºé”®ç›˜æ´»åŠ¨çš„äº‹ä»¶æ˜¯å­—ç¬¦(characters)æˆ–è€… <code>symbols</code>,å…¶ä»–ç±»å‹çš„äº‹ä»¶ä¸€å®šæ˜¯åˆ—è¡¨(lists).å¯ä»¥é€šè¿‡ <code>eventp</code> æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¾“å…¥äº‹ä»¶.
</p>
</div>


<ul class="org-ul">
<li><a id="org1f8f171"></a>é”®ç›˜äº‹ä»¶ (Keyboard Events)<br>
<div class="outline-text-5" id="text-org1f8f171">
<p>
ä»é”®ç›˜ä¸­èƒ½å¤Ÿè·å–çš„è¾“å…¥ç±»å‹æœ‰ä¸¤ç§,æ™®é€šé”®(ordinary keys)å’ŒåŠŸèƒ½é”®(function keys).ä¸€ä¸ªæ™®é€šé”®å®é™…ä¸Šå°±æ˜¯å¯¹åº”ä¸€ä¸ªå­—ç¬¦;
</p>

<p>
å­—ç¬¦æœ‰å¯èƒ½è¢«ä¿®é¥°è¿‡,ä¹Ÿå°±æ˜¯é…åˆä¿®é¥°é”®(<code>meta</code>, <code>control</code>, <code>shift</code>, <code>hyper</code>, <code>super</code>, <code>alt</code>)ä¸€èµ·è¾“å…¥.
</p>

<p>
è¾“å…¥æ™®é€šé”®çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶,è¯¥äº‹ä»¶çš„å€¼å°±æ˜¯ä¸€ä¸ª <code>Lisp</code> å­—ç¬¦å¯¹è±¡,ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•´æ•°,è¿™ç§äº‹ä»¶å«åšå­—ç¬¦äº‹ä»¶(character event).
</p>

<p>
ä¸€ä¸ªå­—ç¬¦äº‹ä»¶çš„å€¼æ˜¯è¿™è®¡ç®—çš„:
</p>

<p>
æœ‰524288(\(2^{19}\))ä¸ªåŸºç¡€å­—ç¬¦,ä» 0 å¼€å§‹å¯¹æ‰€æœ‰åŸºç¡€å­—ç¬¦è¿›è¡Œç¼–ç : 0 ~ 524287,åŸºç¡€å­—ç¬¦çš„ç¼–ç å«åšåŸºç¡€ç (basic code),ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªåŸºç¡€ç éœ€è¦ 20 ä½å­—èŠ‚;
</p>

<p>
æœ‰6ç§ä¿®é¥°é”®,æ¯ç§éƒ½æœ‰å®ƒä»¬å„è‡ªçš„å€¼;
</p>

<p>
å¦‚æœæ²¡æœ‰é…åˆä¿®é¥°é”®è¾“å…¥,é‚£ä¹ˆå­—ç¬¦äº‹ä»¶çš„å€¼å°±æ˜¯åŸºç¡€ç çš„å…¶ä¸­ä¸€ä¸ª(0 ~ 524287),æ¯”å¦‚è¾“å…¥ <code>a</code> é”®æ‰€äº§ç”Ÿçš„äº‹ä»¶çš„å€¼å°±æ˜¯ <code>?a</code>,ä¹Ÿå°±æ˜¯ 97.
</p>

<p>
å¦‚æœé…åˆä¿®é¥°é”®ä¸€èµ·è¾“å…¥,é‚£ä¹ˆ <b>å¤§éƒ¨åˆ†çš„</b> å­—ç¬¦äº‹ä»¶çš„å€¼å°±ç­‰äºæ‰€æœ‰ä¿®é¥°é”®äº‹ä»¶çš„å€¼åŠ ä¸ŠåŸºç¡€ç :
</p>

<p>
<b>meta</b>: 2**27 (the 28th bit);
</p>

<p>
<b>control</b>: 2**26 (the 27th bit),ä½†æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µ,
</p>

<p>
<code>control + ASCII</code> è¿™ç§ç»„åˆå¯¹ <code>Emacs Lisp</code> æ˜¯æœ‰ç‰¹æ®Šæ„ä¹‰çš„,å®ƒä»¬éƒ½æœ‰è‡ªå·±çš„å€¼,æ¯”å¦‚ <code>Ctrl + a</code> å°±æ˜¯1, <code>Ctrl + b</code> æ˜¯2, <code>Ctrl + c</code> æ˜¯3,å¦‚æ­¤ç±»æ¨,
</p>

<p>
è€Œå¯¹äº <code>control + non-ASCII</code> è¿™ç§ç»„åˆæ‰æ˜¯ <code>control</code> çš„å€¼å’Œå­—ç¬¦çš„å€¼åŠ èµ·æ¥,æ¯”å¦‚ <code>Ctrl + %</code> çš„å€¼å°±æ˜¯37(?\%)åŠ ä¸Š 2**26 å¾—åˆ° 67108901;
</p>

<p>
<b>shift</b>: 2**25 bit (the 26th bit), è¦æ³¨æ„ <code>Shift + a</code> å¾—åˆ°çš„å€¼ä¸ç­‰äº <code>?A</code>, <code>Shift + letter</code> è¿™ç§ç»„åˆä¸ä»£è¡¨åˆ‡æ¢å­—ç¬¦çš„å¤§å°å†™;
</p>

<p>
<b>hyper</b>: 2**24 bit (the 25th bit);
</p>

<p>
<b>super</b>: 2**23 bit (the 24th bit);
</p>

<p>
<b>alt</b>: 2** 22 bit (the 23th bit),ä¸è¿‡æ³¨æ„çš„æ˜¯,å¤§éƒ¨ä»½é”®ç›˜çš„ <code>Alt</code> é”®éƒ½ä¼šè¢«å½“ä½œ <b>meta</b> æ¥å¤„ç†çš„.
</p>

<p>
æ€»å¾—æ¥è¯´,ä¸€ä¸ªå­—ç¬¦äº‹ä»¶éœ€è¦ 28 ä½å­—èŠ‚æ¥å‚¨å­˜: <code>0000 0000 0000 0000 0000 0000 0000</code>.
</p>
</div>
</li>


<li><a id="orgd7e743a"></a>åŠŸèƒ½é”® (Function Keys)<br>
<div class="outline-text-5" id="text-orgd7e743a">
<p>
åŠŸèƒ½é”®ä¸æ™®é€šé”®ä¸ä¸€æ ·,é‡‡ç”¨ <code>symbols</code> ä½œä¸ºè¡¨ç¤º, <code>symbols</code> çš„åå­—å°±æ˜¯åŠŸèƒ½é”®çš„æ ‡ç­¾,æ¯”å¦‚ <code>&lt;F1&gt;</code> é”®å°±æ˜¯ç”¨ <code>f1</code> è¡¨ç¤º.
</p>

<p>
æ–‡æ¡£ä¸Šä¸¾äº†å‡ ä¸ªä¾‹å­,è‡ªè¡ŒæŸ¥é˜….
</p>
</div>
</li>


<li><a id="orge77ca93"></a>é¼ æ ‡äº‹ä»¶ (Mouse Events)<br>
<div class="outline-text-5" id="text-orge77ca93">
<p>
<code>Emacs</code> æ”¯æŒç‚¹å‡»äº‹ä»¶(click events),æ‹–æ‹½äº‹ä»¶(drag events),æŒ‰é’®æŒ‰ä¸‹(button-down events)å’Œè¿åŠ¨äº‹ä»¶(motion events)4ä¸ªç±»å‹çš„é¼ æ ‡äº‹ä»¶.
</p>

<p>
æ‰€æœ‰ç±»å‹çš„äº‹ä»¶éƒ½æ˜¯é‡‡ç”¨ <code>lists</code> åšä¸ºè¡¨ç¤º. <code>list</code> çš„ <code>car</code> ç»“æœæ˜¯äº‹ä»¶ç±»å‹,ä¹Ÿå°±æ˜¯å‘Šè¯‰ <code>Emacs</code> ä½¿ç”¨çš„é¼ æ ‡æŒ‰é’®ä»¥åŠ <code>modifier keys</code>.
</p>

<p>
äº‹ä»¶ç±»å‹è¿˜å¯ä»¥åŒºåˆ†åŒå‡»ä»¥åŠä¸‰å‡»,å‰©ä½™çš„ <code>list</code> å…ƒç´ åŒ…å«ä½ç½®ä»¥åŠæ—¶é—´ä¿¡æ¯.
</p>

<p>
å¯¹äºæŒ‰é”®æŸ¥æ‰¾(key lookup)æ¥è¯´åªæœ‰äº‹ä»¶ç±»å‹æ˜¯é‡è¦çš„:åŒç±»å‹çš„ä¸¤ä¸ªäº‹ä»¶æ˜¯ä¸€å®šæ‰§è¡ŒåŒä¸€ä¸ªå‘½ä»¤,å‘½ä»¤å¯ä»¥é€šè¿‡ <code>e</code> <code>interactive code</code> æ¥è·å–è¿™äº›äº‹ä»¶çš„å…¨å€¼.
</p>

<p>
ä¸€ä¸ªä»¥é¼ æ ‡äº‹ä»¶å¼€å¤´çš„æŒ‰é”®åºåˆ—ä¼šé€šè¿‡å½“å‰é¼ æ ‡æ‰€åœ¨çš„çª—å£çš„ <code>keymaps</code> æ¥è¯»å–,ä¸æ˜¯å½“å‰ç¼“å†²åŒº,è¿™å¹¶éæš—ç¤ºåœ¨æŸä¸ªçª—å£ç‚¹å‡»å°±ä¼šé€‰æ‹©é‚£ä¸ªçª—å£å’Œæˆ–è€…å®ƒçš„ç¼“å†²åŒº,
</p>

<p>
è¿™å®Œå…¨æ˜¯ç”±æŒ‰é”®åºåˆ—çš„ç»‘å®šå‘½ä»¤æ¥æ§åˆ¶çš„.
</p>
</div>
</li>


<li><a id="org52374d3"></a>ç‚¹å‡»äº‹ä»¶ (Click Events)<br>
<div class="outline-text-5" id="text-org52374d3">
<p>
ç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡æŒ‰é’®å¹¶ä¸”åœ¨åŒä¸€ä¸ªåœ°æ–¹é‡Šæ”¾å®ƒ,è¿™æ ·ä¼šäº§ç”Ÿä¸€ä¸ªç‚¹å‡»äº‹ä»¶.æ‰€æœ‰é¼ æ ‡äº‹ä»¶éƒ½ç”¨åŒä¸€ä¸ªæ ¼å¼:
</p>

<p>
<code>(EVENT-TYPE POSITION CLICK-COUNT)</code>
</p>

<ul class="org-ul">
<li><p>
EVENT-TYPE
</p>

<p>
ä¸€ä¸ªè¡¨ç¤ºä½¿ç”¨äº†å“ªä¸ªé¼ æ ‡æŒ‰é’®çš„ <code>symbol</code>.æ˜¯ <code>mouse-1</code>, <code>mouse-2</code> &#x2026; å…¶ä¸­ä¸€ä¸ª,åˆ†åˆ«ä»å·¦åˆ°å³è¡¨ç¤ºé¼ æ ‡æŒ‰é’®.
</p>

<p>
è¿˜å¯ä»¥åƒåŠŸèƒ½é”®é‚£æ ·ä½¿ç”¨ <code>A-</code> <code>C-</code>, <code>H-</code>, <code>M-</code>, <code>S-</code> å’Œ <code>s-</code> æ¥åˆ†åˆ«è¡¨ç¤º <code>alt</code>, <code>control</code>, <code>hyper</code>, <code>meta</code>, <code>shift</code> å’Œ <code>super</code> é”®.
</p>

<p>
è¯¥ <code>symbol</code> ä¹Ÿè¡¨ç¤ºäº‹ä»¶çš„äº‹ä»¶ç±»å‹,æŒ‰é”®ç»‘å®šæ ¹æ®å®ƒä»¬äº‹ä»¶ç±»å‹æ¥æè¿°äº‹ä»¶,å› æ­¤å¦‚æœæœ‰ä¸ª <code>mouse-1</code> çš„æŒ‰é”®ç»‘å®š,é‚£ä¹ˆè¿™ä¸ªç»‘å®šå°†ä¼šåº”ç”¨äºæ‰€æœ‰äº‹ä»¶ç±»å‹ä¸º <code>mouse-1</code> çš„äº‹ä»¶ä¸Š.
</p></li>

<li><p>
POSITION
</p>

<p>
ä¸€ä¸ªé¼ æ ‡ä½ç½®åˆ—è¡¨,è®°å½•å‘ç”Ÿé¼ æ ‡ç‚¹å‡»çš„ä½ç½®.
</p>

<p>
ç‚¹å‡»çš„ä½ç½®åˆ†ä¸ºä¸¤ç±»:
</p>

<ol class="org-ol">
<li>æ–‡æœ¬åŒºåŸŸ(<code>text area</code>), <code>mode line</code>, <code>header line</code>, æ¡çº¹(<code>fringe</code>)æˆ–è€…è¾¹ç¼˜åŒºåŸŸ(<code>marginal areas</code>);</li>

<li>æ»šåŠ¨æ¡</li>
</ol></li>
</ul>


<p>
<code>M-: (info "elisp(Accessing Mouse)")</code> æœ‰ä»‹ç»å¦‚ä½•è·å–é¼ æ ‡äº‹ä»¶çš„ä½ç½®åˆ—è¡¨,è¿™é‡Œå°±å…ˆä¸è¯´äº†.
</p>


<p>
å¦‚æœåœ¨ç¬¬ä¸€ç±»ä½ç½®å‘ç”Ÿç‚¹å‡»äº‹ä»¶,é‚£ä¹ˆé¼ æ ‡ä½ç½®çš„ <code>list</code> å°±æ˜¯å¦‚ä¸‹å½¢å¼:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(WINDOW POS-OR-AREA (X . Y) TIMESTAMP
        OBJECT TEXT-POS (COL . ROW)
        IMAGE (DX . DY) (WIDTH . HEIGHT))
</pre>
</div>

<ul class="org-ul">
<li><code>WINDOW</code>: ç‚¹å‡»å‘ç”Ÿçš„çª—å£.</li>
<li><code>POS-OR-AREA</code>: å¦‚æœç‚¹å‡»ä½ç½®åœ¨æ–‡æœ¬åŒºåŸŸå†…,å°±è¡¨ç¤ºè¢«ç‚¹å‡»çš„å­—ç¬¦çš„ç¼“å†²åŒºä½ç½®,æˆ–è€…å¦‚æœåœ¨æ–‡æœ¬åŒºåŸŸä¹‹å¤–å°±è¡¨ç¤ºçª—å£ä½ç½®.
æ˜¯ <code>mode-line, header-line, vertical-line, left-margin, right-margin, left-fringe æˆ– right-fringe</code> çš„å…¶ä¸­ä¹‹ä¸€.
å¦‚æœäº‹ä»¶çš„å‰ç½®é”®(imaginary prefix keys)å·²ç»è¢« <code>Emacs</code> ç»‘å®šäº†çš„è¯,é‚£ä¹ˆ <code>POS-OR-AREA</code> å°±æ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸€ä¸ªä¸Šè¿° <code>symbol</code> çš„ <code>list</code>.</li>
<li><code>X, Y</code>: ç‚¹å‡»çš„ç›¸å¯¹åƒç´ åæ ‡.</li>
<li><code>TIMESTAMP</code>: ç‚¹å‡»äº‹ä»¶çš„å‘ç”Ÿæ—¶é—´,æ˜¯ä¸€ä¸ªæ•´æ•°,è¡¨ç¤ºä»ç³»ç»Ÿåˆå§‹æ—¶é—´åˆ°ç›®å‰çš„å¾®ç§’.</li>
<li><code>OBJECT</code>: å¦‚æœç‚¹å‡»çš„ä½ç½®æ²¡æœ‰æ–‡æœ¬å°±è¿”å› <code>nil</code>;å¦åˆ™å°±æ˜¯ <code>(STRING . STRING-POS)</code>, <code>STRING</code> è¡¨ç¤ºè¢«ç‚¹å‡»çš„ <code>string</code> ä»¥åŠå®ƒçš„æ‰€æœ‰å±æ€§, <code>STRING-POS</code> å°±æ˜¯ç‚¹å‡»çš„ä½ç½®.</li>
<li><code>TEXT-POS</code>: å¦‚æœåœ¨è¾¹ç¼˜åŒºåŸŸæˆ–è€…æ¡çº¹(fringe)ä¸Šç‚¹å‡»,é‚£ä¹ˆè¿™å°±æ˜¯çª—å£ä¸Šç¬¬ä¸€ä¸ªå¯è§å­—ç¬¦çš„ç¼“å†²åŒºä½ç½®;å¦‚æœåœ¨ <code>mode line</code> æˆ–è€… <code>header line</code> ç‚¹å‡»å°±æ˜¯ <code>nil</code>;å¯¹äºå…¶ä»–äº‹ä»¶å°±æ˜¯è·ç¦»ç‚¹å‡»ä½ç½®çš„æœ€è¿‘ç¼“å†²åŒºä½ç½®.</li>
<li><code>COL, ROW</code>: å®é™…çš„åˆ—è¡Œåæ ‡.</li>
<li><code>IMAGE</code>: ç‚¹å‡»å‘ç”Ÿçš„å›¾åƒå¯¹è±¡,å¦‚æœæ²¡æœ‰å›¾ç‰‡å°±æ˜¯ <code>nil</code>,å¦åˆ™å°±æ˜¯å’Œ <code>find-image</code> è¿”å›å€¼ä¸€æ ·çš„å›¾åƒå¯¹è±¡.</li>
<li><code>DX, DY</code>: ç›¸å¯¹äº <code>OBJECT</code> å·¦ä¸Šè§’çš„ç›¸å¯¹åƒç´ åæ ‡, <code>OBJECT</code> ä¸º <code>(0 . 0)</code>;å¦‚æœ <code>OBJECT</code> ä¸º <code>nil</code>,é‚£ä¹ˆå°±æ˜¯ç›¸å¯¹äºç‚¹å‡»ä½ç½®å­—ç¬¦çš„åä¸Šè§’çš„åƒç´ åæ ‡.</li>
<li><code>WIDTH, HEIGHT</code>: å¦‚æœ <code>OBJECT</code> ä¸ä¸º <code>nil</code> é‚£ä¹ˆå°±æ˜¯å®ƒçš„å®½é«˜,å¦åˆ™å°±æ˜¯è¿™äº›è¢«ç‚¹å‡»å­—ç¬¦.</li>
</ul>


<p>
å¦‚æœåœ¨ç¬¬äºŒç±»ä½ç½®å‘ç”Ÿç‚¹å‡»äº‹ä»¶,é‚£ä¹ˆé¼ æ ‡ä½ç½®çš„ <code>list</code> å°±æ˜¯å¦‚ä¸‹å½¢å¼:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(WINDOW AREA (PORTION . WHOLE) TIMESTAMP PART)
</pre>
</div>

<ul class="org-ul">
<li><code>WINDOW</code>: æ»šåŠ¨æ¡è¢«ç‚¹å‡»ä¸­çš„çª—å£.</li>
<li><code>AREA</code>: å€¼ä¸º <code>vertical-scroll-bar</code> çš„ <code>symbol</code>.</li>
<li><code>PORTION</code>: æ»šåŠ¨æ¡é¡¶éƒ¨åˆ°ç‚¹å‡»ä½ç½®çš„åƒç´ æ•°é‡,æœ‰äº›å·¥å…·,æ¯”å¦‚ <code>GTK+</code>, <code>Emacs</code> æ˜¯ä¸èƒ½è·å–è¿™ä¸ªå€¼çš„,è¿™ä¸ªæ—¶å€™å°±ä¸º <code>0</code>.</li>
<li><code>TIMESTAMP</code>: ç‚¹å‡»æ—¶é—´,åŒæ ·å¯¹äº <code>GTK+</code> è¿™äº›å·¥å…·æ— æ³•è·å–.</li>
<li><code>PART</code>: æ»šåŠ¨æ¡çš„ç‚¹å‡»ä½ç½®,å¦‚æœåœ¨æ»šåŠ¨æ¡æ»‘å—ä¸Šå°±æ˜¯ <code>handle</code>,å¦‚æœåœ¨æ»‘å—ä»¥ä¸Šå°±æ˜¯ <code>above-handle</code>,ä»¥ä¸‹å°±æ˜¯ <code>below-handle</code>,å¦‚æœåˆ°äº†æ»šåŠ¨æ¡çš„ä¸¤ç«¯å°±åˆ†åˆ«æ˜¯ <code>up</code> å’Œ <code>down</code>.</li>
</ul>


<ul class="org-ul">
<li><p>
CLICK-COUNT
</p>

<p>
è®°å½•äº†åŒä¸€ä¸ªé¼ æ ‡æŒ‰é’®å¿«é€Ÿé‡å¤ç‚¹å‡»çš„æ¬¡æ•°.
</p></li>
</ul>
</div>
</li>


<li><a id="orgaf2b8c9"></a>æ‹–æ‹½äº‹ä»¶ (Drag Events)<br>
<div class="outline-text-5" id="text-orgaf2b8c9">
<p>
æ‹–æ‹½äº‹ä»¶å°±æ˜¯ç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡å¹¶ä¸”åœ¨é‡Šæ”¾æŒ‰é’®å‰ç§»åŠ¨åˆ°åˆ«çš„å­—ç¬¦çš„ä½ç½®,å®ƒçš„å½¢å¼æ˜¯è¿™æ ·çš„:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(EVENT-TYPE (WINDOW1 START-POSITION) (WINDOW2 END-POSITION))
</pre>
</div>

<ul class="org-ul">
<li><code>EVENT-TYPE</code>: <code>drag-</code> å¼€å¤´çš„ <code>symbol</code>,æ¯”å¦‚ <code>drag-mouse-2</code>.</li>
<li><code>(WINDOW1 START-POSITION)</code> å’Œ <code>(WINDOW2 END-POSITION)</code> åˆ†åˆ«è¡¨ç¤ºæŒ‰ä¸‹æŒ‰é’®æ—¶å€™çš„ä½ç½®å’Œé‡Šæ”¾æŒ‰é’®æ—¶å€™çš„ä½ç½®,é‡Šæ”¾æ—¶å€™å¯èƒ½ä¼šåœ¨çª—å£çš„è¾¹ç•Œå¤–,é‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªåŒ…å«äº†çª—å£æ‰€å¤„äºçš„frameçš„ <code>list</code>.</li>
</ul>

<p>
å¦‚æœ <code>read-key-sequence</code> æ¥æ”¶äº†ä¸€ä¸ªæ²¡æœ‰æŒ‰é”®ç»‘å®šçš„æ‹–æ‹½äº‹ä»¶,é‚£ä¹ˆå°±æŠŠå®ƒè½¬åŒ–æˆåœ¨æ‹–æ‹½å¼€å§‹ä½ç½®çš„å‘ç”Ÿçš„ç‚¹å‡»äº‹ä»¶.
</p>
</div>
</li>


<li><a id="org4d35c20"></a>æŒ‰é’®æŒ‰ä¸‹äº‹ä»¶ (Button-Down Events)<br>
<div class="outline-text-5" id="text-org4d35c20">
<p>
æ²¡æœ‰åŠæ³•åœ¨æŒ‰é’®é‡Šæ”¾ä»¥å‰åŒºåˆ†ç‚¹å‡»å’Œæ‹–æ‹½äº‹ä»¶,å¦‚æœè¦åœ¨æŒ‰é’®æŒ‰ä¸‹çš„æ—¶å€™è¿›è¡Œå¤„ç†,é‚£ä¹ˆå°±éœ€è¦å¤„ç†è¿™ä¸ªäº‹ä»¶,å®ƒçš„å½¢å¼ç±»ä¼¼ç‚¹å‡»äº‹ä»¶,é™¤äº† <code>EVENT-TYPE</code> æ˜¯ä¸€ä¸ªä»¥ <code>down-</code> å¼€å¤´çš„ <code>symbol</code>.
</p>

<p>
<code>read-key-sequence</code> ä¼šæ— è§†æ²¡æœ‰å‘½ä»¤ç»‘å®šçš„ <code>button-down</code> äº‹ä»¶,æ‰€ä»¥å‘½ä»¤å¾ªç¯ä¼šæ— è§†å®ƒä»¬.ä¸€èˆ¬ä½¿ç”¨ <code>button-down</code> äº‹ä»¶çš„åŸå› æ˜¯ä¸ºäº†åœ¨æŒ‰é’®ä»¥å‰é€šè¿‡è¯»å– <code>motion events</code> æ¥è·Ÿè¸ªé¼ æ ‡çš„åŠ¨ä½œ(motion).
</p>
</div>
</li>


<li><a id="org83917c7"></a>é‡å¤äº‹ä»¶ (Repeat Events)<br>
<div class="outline-text-5" id="text-org83917c7">
<p>
åœ¨æ²¡æœ‰ç§»åŠ¨é¼ æ ‡çš„æƒ…å†µä¸‹å¿«é€ŸæŒ‰ä¸‹åŒä¸€ä¸ªæŒ‰é’®å¤šäºä¸€æ¬¡, <code>Emacs</code> ä¼šå¯¹åç»­æŒ‰ä¸‹åŠ¨ä½œäº§ç”Ÿä¸€ç§å«åš <code>repeat</code> çš„é¼ æ ‡äº‹ä»¶.
</p>

<p>
æœ€å¸¸è§çš„æ˜¯åŒå‡»äº‹ä»¶(<code>double-click</code>),åŒå‡»äº‹ä»¶çš„ç±»å‹åŒ…å«äº† <code>double-</code> å‰ç¼€,å¦‚æœåŒå‡»å·¦é”®çš„æ—¶å€™æŒ‰ç€ <code>meta</code> é”®,é‚£ä¹ˆäº‹ä»¶ç±»å‹å°±æ˜¯ <code>M-double-mouse-1</code>.
</p>

<p>
å½“ç”¨æˆ·åŒå‡»çš„æ—¶å€™ <code>Emacs</code> ä¼šå¯¹ç¬¬ä¸€ä¸‹ç”Ÿæˆä¸€ä¸ªæ™®é€šçš„ç‚¹å‡»äº‹ä»¶,ç„¶åæ‰å¯¹ç¬¬äºŒä¸‹ç”ŸæˆåŒå‡»äº‹ä»¶.
</p>

<p>
å¦‚æœç‚¹å‡»äº†ä¸€ä¸‹æŒ‰é’®ç„¶åå†æŒ‰ä¸‹å¹¶ä¸”åœ¨é‡Šæ”¾å‰æ‹–åŠ¨é¼ æ ‡,é‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸€ä¸ª <code>double-drag</code> äº‹ä»¶,å¦‚æœ <code>double-drag</code> æ²¡æœ‰ç»‘å®š,é‚£ä¹ˆ <code>Emacs</code> å°±ä¼šæŸ¥æ‰¾æ™®é€šçš„ <code>drag</code> äº‹ä»¶çš„ç»‘å®š,å¦‚æœ <code>drag</code> ä¹Ÿæ²¡æœ‰ç»‘å®š,é‚£ä¹ˆå°±ä¼šç›´æ¥å¿½ç•¥.
</p>

<p>
åœ¨ <code>double-click</code> æˆ–è€… <code>double-drag</code> ä¹‹å‰, <code>Emacs</code> ä¼šåœ¨ç”¨æˆ·ç¬¬äºŒæ¬¡æŒ‰ä¸‹é¼ æ ‡çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ª <code>double-down</code> äº‹ä»¶,åŒæ ·å¦‚æœæ²¡æœ‰ç»‘å®šçš„è¯å°±ä¼šä½¿ç”¨æ™®é€šçš„ <code>button-down</code> çš„ç»‘å®š,å¦‚æœ <code>button-down</code> ä¹Ÿæ²¡æœ‰ç»‘å®š,é‚£ä¹ˆå°±ä¼šç›´æ¥å¿½ç•¥.
</p>

<p>
ä¸‰æ¬¡å¿«é€Ÿç‚¹å‡»ä¼šäº§ç”Ÿä¸‰å‡»(triple-click)äº‹ä»¶,å’ŒåŒå‡»å¯¹åº”,æœ‰ <code>triple-drag</code> ä»¥åŠ <code>triple-down</code> äº‹ä»¶,ä¸‰æ¬¡ä»¥ä¸Šä¹Ÿæ˜¯ <code>triple</code> äº‹ä»¶,å¯ä»¥é€šè¿‡äº‹ä»¶åˆ—è¡¨æ¥çœ‹åˆ°å®é™…ç‚¹å‡»æ¬¡æ•°.
</p>
</div>
</li>


<li><a id="org21e17e4"></a>åŠ¨ä½œäº‹ä»¶ (Motion Events)<br>
<div class="outline-text-5" id="text-org21e17e4">
<p>
æ‰€è°“åŠ¨ä½œäº‹ä»¶å°±æ˜¯æè¿°é¼ æ ‡åœ¨æ²¡æœ‰ä»»ä½•æŒ‰é’®æ´»åŠ¨çš„æƒ…å†µä¸‹çš„åŠ¨ä½œ.äº‹ä»¶å½¢å¼å¦‚ä¸‹,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(mouse-movement POSITION)
</pre>
</div>

<p>
å…¶ä¸­ <code>POSITION</code> æ˜¯ä¸€ä¸ªä½ç½® <code>list</code>,è¡¨ç¤ºäº†é¼ æ ‡æŒ‡é’ˆçš„å½“å‰ä½ç½®. <code>track-mouse</code> form å…è®¸åŠ¨ä½œäº‹ä»¶åœ¨å®ƒçš„ä½“å†…äº§ç”Ÿ,ä¹‹å¤–åˆ™ä¸è¡Œ.
</p>
</div>
</li>


<li><a id="org7c63b48"></a>ç„¦ç‚¹äº‹ä»¶ (Focus Events)<br>
<div class="outline-text-5" id="text-org7c63b48">
<p>
<code>Emacs</code> æä¾›é€šç”¨çš„æ–¹æ³•è®©ç”¨æˆ·æ‹¥æœ‰é€‰æ‹©çª—å£çš„æƒåŠ›,çª—å£çš„é€‰æ‹©å«åš <code>focus</code>.åœ¨ç”¨æˆ·åˆ‡æ¢frameçš„æ—¶å€™å°±ä¼šäº§ç”Ÿ "focus" äº‹ä»¶.
</p>

<p>
äº‹ä»¶å½¢å¼å¦‚ä¸‹:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(switch-frame NEW-FRAME)
</pre>
</div>

<p>
ä¸€äº›çª—å£ç®¡ç†å™¨(window managers, WM for short)è¢«è®¾ç½®æˆåªè¦ç§»åŠ¨é¼ æ ‡åˆ°ä¸€ä¸ªçª—å£å°±è¶³ä»¥ <code>focus</code> åˆ°å®ƒèº«ä¸Š.
</p>

<p>
ç„¶è€Œ <code>Emacs</code> ä¸åŒ,éœ€è¦ç”¨æˆ·é€šè¿‡é¼ æ ‡æˆ–è€…é”®ç›˜åœ¨frameä¸Šè¾“å…¥æ‰è¡Œ,åªæ˜¯åœ¨frameä¹‹é—´ç§»åŠ¨æ˜¯ä¸ä¼šäº§ç”Ÿ <code>focus</code> äº‹ä»¶çš„.
</p>

<p>
<code>Emacs</code> æ˜¯ä¸ä¼šåœ¨æŒ‰é”®åºåˆ—çš„ä¸­é—´ç”Ÿæˆä¸€ä¸ª <code>focus</code> äº‹ä»¶,å› ä¸ºä¼šæ‰“ä¹±(garble)åºåˆ—.
</p>
</div>
</li>


<li><a id="org2bb084a"></a>æ‚é¡¹äº‹ä»¶ (Misc Events)<br>
<div class="outline-text-5" id="text-org2bb084a">
<p>
ä¸€äº›åˆ«çš„ç³»ç»Ÿäº‹ä»¶,å…·ä½“è‡ªå·±çœ‹.
</p>
</div>
</li>


<li><a id="org66c24a2"></a>åˆ†ç±»äº‹ä»¶ (Classifying Events)<br>
<div class="outline-text-5" id="text-org66c24a2">
<p>
ä¸€äº›å¯ä»¥å¸®åŠ©åˆ¤åˆ«äº‹ä»¶ç±»å‹çš„ <code>API</code>, <code>event-modifiers</code> è·å–äº‹ä»¶çš„ <code>modifiers</code>, <code>event-basic-type</code> è¿”å›äº‹ä»¶æè¿°çš„æŒ‰é”®æˆ–è€…é¼ æ ‡æŒ‰é’®,ç§»é™¤äº†æ‰€æœ‰ <code>modifiers</code>.
</p>

<p>
<code>mouse-movement-p</code> åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸€ä¸ªåŠ¨ä½œäº‹ä»¶ç­‰ç­‰.
</p>
</div>
</li>


<li><a id="orgeb357a2"></a>è®¿é—®é¼ æ ‡äº‹ä»¶ (Accessing Mouse)<br>
<div class="outline-text-5" id="text-orgeb357a2">
<p>
ä¸€äº›å…³äºè·å–é¼ æ ‡äº‹ä»¶æ•°æ®çš„ <code>APIs</code>
</p>
</div>
</li>


<li><a id="orga370d22"></a>è®¿é—®æ»šåŠ¨æ¡ (Accessing Scroll)<br>
<div class="outline-text-5" id="text-orga370d22">
<p>
å…³äºæ»šåŠ¨äº‹ä»¶çš„ <code>APIs</code>.
</p>
</div>
</li>


<li><a id="org9070e24"></a>æŠŠäº‹ä»¶å˜ä¸ºå­—ç¬¦ä¸² (Strings of Events)<br>
<div class="outline-text-5" id="text-org9070e24">
<p>
ä¸å»ºè®®æŠŠäº‹ä»¶å‚¨å­˜ä¸ºå­—ç¬¦ä¸²,ä¹‹æ‰€ä»¥å­˜åœ¨è¿™ç§ä¸œè¥¿æ˜¯å› ä¸ºå†å²å…¼å®¹é—®é¢˜,æ–°çš„ <code>Lisp</code> ç¨‹åºæœ€å¥½ä¸è¦é‡‡ç”¨è¿™ç§æ–¹å¼,ç”¨å‘é‡(vector)æ¥æ›¿ä»£å­—ç¬¦ä¸²(string),å…·ä½“è‡ªè¡Œé˜…è¯»æ–‡æ¡£.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-org080e750" class="outline-4">
<h4 id="org080e750">è¯»å–è¾“å…¥ (Reading Input)</h4>
<div class="outline-text-4" id="text-org080e750">
<p>
å‘½ä»¤å¾ªç¯ä½¿ç”¨ <code>read-key-sequence</code> å‡½æ•°æ¥è¯»å–æŒ‰é”®åºåˆ—, <code>read-key-sequence</code> ä½¿ç”¨ <code>read-event</code> è¯»å–äº‹ä»¶.
</p>

<p>
<code>Emacs</code> ä¼šæ ¹æ® <code>extra-keyboard-modifiers</code> æ¥è°ƒæ•´æ‰€è¯»çš„æ¯ä¸€ä¸ªäº‹ä»¶,å¦‚æœå¯ä»¥çš„è¯,ä¼šåœ¨ <code>read-event</code> è¿”å›ä¹‹å‰é€šè¿‡ <code>keyboard-translate-table</code> æ¥æŠŠäº‹ä»¶ç¿»è¯‘æˆåˆ«ä¸œè¥¿.
</p>

<p>
å…³äºå¦‚ä½•ä½¿ç”¨ <code>keyboard-translate-table</code>,å¯ä»¥é˜…è¯» <code>M-: (info "(elisp) Event Mod")</code> æ¥æŸ¥çœ‹ <code>keyboard-translate</code> å‡½æ•°çš„ä¾‹å­.
</p>

<p>
å…³äºç¿»è¯‘çš„å…·ä½“æœºåˆ¶å°±åœ¨ <code>Keymaps</code> ç« èŠ‚è¯´.äº‹ä»¶è¯»å–å‡½æ•°è¿˜èƒ½å¤Ÿæ¿€æ´»å½“å‰è¾“å…¥æ³•,å…·ä½“ä»¥åè¯´.
</p>
</div>
</div>


<div id="outline-container-org6ccdcaa" class="outline-4">
<h4 id="org6ccdcaa">ç‰¹æ®Šäº‹ä»¶ (Special Events)</h4>
<div class="outline-text-4" id="text-org6ccdcaa">
<p>
<code>read-event</code> ä¼šå¤„ç†è¿™äº›äº‹ä»¶å¹¶ä¸”ä¸è¿”å›å®ƒä»¬,ç›¸å <code>read-event</code> ä¼šç­‰å¾…ç¬¬ä¸€ä¸ªéç‰¹æ®Šäº‹ä»¶å¹¶ä¸”è¿”å›å®ƒ.
</p>
</div>
</div>


<div id="outline-container-org1a9c913" class="outline-4">
<h4 id="org1a9c913">ç­‰å¾…ç»“æŸæ—¶é—´æˆ–è€…è¾“å…¥ (Waiting)</h4>
<div class="outline-text-4" id="text-org1a9c913">
<p>
<code>Emacs Lisp</code> ä¸­æœ‰ä¸¤ä¸ªç±»ä¼¼äºåˆ«çš„è¯­è¨€çš„ <code>sleep</code> ä¸€æ ·çš„å‡½æ•°, <code>sit-for</code> å’Œ <code>sleep-for</code>,è¿™ä¸¤è€…éƒ½ä¼šç­‰å¾…æŒ‡å®šçš„ç§’æ•°,å¦‚æœåœ¨ç»“æŸä¹‹å‰æ¥æ”¶åˆ°ç”¨æˆ·çš„è¾“å…¥,é‚£ä¹ˆç­‰å¾…ä¼šæå‰ç»“æŸ.
</p>

<p>
ä¸¤è€…çš„å·®åˆ«åœ¨äºæ˜¯å¦æ›´è¡Œ <code>Emacs</code> çš„æ˜¾ç¤º,å¯ä»¥ç†è§£ä¸ºæ˜¯å¦å¼‚æ­¥,å‰è€…æ˜¯å¼‚æ­¥è€Œåè€…ä¸ºé˜»å¡.
</p>
</div>
</div>


<div id="outline-container-orgf3e8612" class="outline-4">
<h4 id="orgf3e8612">ä¸­æ­¢ (Quitting)</h4>
<div class="outline-text-4" id="text-orgf3e8612">
<p>
é»˜è®¤æƒ…å†µ <code>C-g</code> å°±æ˜¯ç»‘å®š <code>keyboard-quit</code> å‘½ä»¤,åœ¨ä¸€ä¸ª <code>Lisp</code> å‡½æ•°è¿è¡Œçš„æ—¶å€™è¾“å…¥ <code>C-g</code> ä¼šä¸­æ­¢è¯¥å‡½æ•°.
</p>

<p>
å½“å‘½ä»¤å¾ªç¯åœ¨ç­‰å¾…æŒ‰é”®è¾“å…¥çš„æ—¶å€™è¾“å…¥ <code>C-g</code> ä¸ä¼šé€ æˆä»»ä½•å½±å“,å½“ç„¶æ˜¯æ²¡åŠæ³•çœ‹å‡ºå·®åˆ«çš„.
</p>

<p>
åœ¨ <code>minibuffer</code> ä¸­ <code>C-g</code> çš„å®šä¹‰ä¸å¤§ä¸€æ ·,å®ƒä¼šå…ˆé€€å‡º(exits) <code>minibuffer</code> ç„¶åæ‰ä¸­æ­¢(quits),åŸå› æ˜¯è¿™æ ·å°±å¯ä»¥åœ¨ <code>minibuffer</code> é‡Œé¢é‡æ–°å®šä¹‰ <code>C-g</code> çš„æ„æ€.
</p>

<p>
åœ¨ <code>minibuffer</code> é‡Œé¢,è·Ÿç€å‰ç¼€çš„ <code>C-g</code> æ˜¯ä¸ä¼šè¢«é‡æ–°å®šä¹‰çš„,å¹¶ä¸”æœ‰å–æ¶ˆå‰ç¼€æŒ‰é”®å’Œå‰ç¼€å‚æ•°çš„æ­£å¸¸æ•ˆæœ.
</p>

<p>
å½“ <code>C-g</code> ç›´æ¥ä¸­æ­¢çš„æ—¶å€™æ˜¯ç›´æ¥é€šè¿‡è®¾ç½®å˜é‡ <code>quit-flag</code> ä¸º <code>t</code> æ¥å®ç°çš„. <code>Emacs</code> ä¼šåœ¨åˆé€‚çš„æ—¶é—´æ£€æŸ¥è¿™ä¸ªå˜é‡æ˜¯å¦ä¸ºé <code>nil</code>.
</p>

<p>
åœ¨ <code>C</code> çš„å±‚é¢ä¸Šä¸­æ­¢(quitting)ä¸ä¼šåœ¨ä»»ä½•åœ°æ–¹å‘ç”Ÿ,åªä¼šåœ¨ç‰¹å®šåœ°æ–¹æ£€æŸ¥ <code>quit-flag</code>,ç†ç”±æ˜¯åœ¨åˆ«çš„åœ°æ–¹ä¸­æ­¢ä¼šå¯¼è‡´ <code>Emacs</code> çš„å†…éƒ¨çŠ¶æ€ä¸ä¸€è‡´,ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™æ ·ä¸­æ­¢æ‰ä¸ä¼šå¯¼è‡´ <code>Emacs</code> å´©æºƒ.
</p>

<p>
åƒ <code>read-key-sequence</code> æˆ–è€… <code>read-quoted-char</code> è¿™ç§ç‰¹å®šçš„å‡½æ•°æ¥æ”¶åˆ° <code>C-g</code> æ˜¯å®Œå…¨ä¸ä¼šä¸­æ­¢çš„, <code>C-g</code> å¯¹äºå®ƒä»¬æ¥è¯´åªæ˜¯å®ƒä»¬è¯·æ±‚çš„è¾“å…¥.
</p>

<p>
ä½ å¯ä»¥åœ¨å‡½æ•°çš„å±€éƒ¨é€šè¿‡ç»‘å®š <code>inhibit-quit</code> å˜é‡ä¸ºé <code>nil</code> æ¥é˜»æ­¢ä¸­æ­¢çš„å‘ç”Ÿ,å°½ç®¡ <code>C-g</code> ä»ç„¶ä¼šæŠŠ <code>quit-flag</code> ç»‘å®šä¸º <code>t</code>,ä½†æ˜¯ä¸­æ­¢ä¸ç”Ÿæ•ˆ,æœ€ç»ˆ <code>inhibit-quit</code> ä¼šå†æ¬¡å˜ä¸º <code>nil</code>.
</p>

<p>
è‡³äºä¸ºä»€ä¹ˆ <code>read-quoted-char</code> è¿™ç§å‡½æ•°å¯ä¹Ÿä¸å—ä¸­æ­¢å½±å“,åŸç†æ˜¯å…ˆç»‘å®š <code>inhibit-quit</code> ä¸º <code>t</code> ç„¶ååœ¨ <code>inhibit-quit</code> å˜å› <code>nil</code> ä¹‹å‰ç»‘å®š <code>quit-flag</code> ä¸º <code>nil</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">read-quoted-char</span> (<span style="color: #7CB8BB;">&amp;optional</span> prompt)
  <span style="color: #9FC59F;">"...DOCUMENTATION..."</span>
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((message-log-max nil) done (first t) (code 0) char)
    (<span style="color: #F0DFAF; font-weight: bold;">while</span> (not done)
      (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((inhibit-quit first)
            ...)
        (<span style="color: #F0DFAF; font-weight: bold;">and</span> prompt (message <span style="color: #CC9393;">"%s-"</span> prompt))
        (<span style="color: #F0DFAF; font-weight: bold;">setq</span> char (read-event))
        (<span style="color: #F0DFAF; font-weight: bold;">if</span> inhibit-quit (<span style="color: #F0DFAF; font-weight: bold;">setq</span> quit-flag nil)))
      ...set the variable &#8216;<span style="color: #BFEBBF;">code</span>&#8217;...)
    code))
</pre>
</div>
</div>
</div>


<div id="outline-container-org3e3d5ea" class="outline-4">
<h4 id="org3e3d5ea">å‰ç¼€å‘½ä»¤å‚æ•° (Prefix Command Arguments)</h4>
<div class="outline-text-4" id="text-org3e3d5ea">
<p>
å‰ç¼€å‘½ä»¤å‚æ•°æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹å¼: <code>raw</code> å’Œæ•°å€¼(numeric).
</p>

<p>
å‘½ä»¤å¾ªç¯å†…éƒ¨ä½¿ç”¨rawæ–¹å¼, <code>Lisp</code> å˜é‡ä¹Ÿæ˜¯è¿™æ ·å‚¨å­˜ä¿¡æ¯çš„,ä¸è¿‡ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä½¿ç”¨.
</p>

<p>
<code>raw</code> å½¢å¼çš„å‰ç¼€å‘½ä»¤å‚æ•°ä¼šæ˜¯ä»¥ä¸‹å…¶ä¸­ä¸€ä¸ª:
</p>

<ul class="org-ul">
<li><code>nil</code>:æ„å‘³ç€æ²¡æœ‰å‰ç¼€å‚æ•°,æ•°å­—è¡¨ç¤ºæ–¹å¼ä¸º1,ä¸è¿‡å¯¹äºå¾ˆå¤šå‘½ä»¤æ¥è¯´ <code>nil</code> å’Œæ•°å­—1æ˜¯ä¸åŒçš„;</li>

<li>æ•´æ•°:è¡¨ç¤ºå‚æ•°è‡ªèº«,ä¹Ÿå°±æ˜¯è¯´å°±æ˜¯è¦è¾“å…¥æ•´æ•°ä½œä¸ºå‚æ•°;</li>

<li>åªæœ‰ä¸€ä¸ªæ•´æ•°å…ƒç´ çš„åˆ—è¡¨:è¿™ç§å½¢å¼æ˜¯ç”±äºåªè¾“å…¥ä¸€ä¸ªæˆ–è€…å¤šä¸ª <code>C-us</code> å¹¶ä¸”ä¸å¸¦æ•°å­—è€Œå¯¼è‡´å¾—,æ•°å€¼å°±æ˜¯åˆ—è¡¨é‡Œé¢çš„å€¼;</li>

<li><code>symbol -</code>:è¡¨ç¤ºè¾“å…¥äº† <code>M--</code> æˆ–è€… <code>C-u -</code> å¹¶ä¸”æ²¡å¸¦æ•°å­—,å¯¹åº”çš„æ•°å€¼ä¸º <code>-1</code>.</li>
</ul>
</div>
</div>


<div id="outline-container-orgaed2381" class="outline-4">
<h4 id="orgaed2381">é€’å½’ç¼–è¾‘ (Recursive Editing)</h4>
<div class="outline-text-4" id="text-orgaed2381">
<p>
å½“ <code>Emacs</code> å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨è¿›å…¥ä¸€ä¸ªå‘½ä»¤å¾ªç¯(command loop),è¿™æ˜¯ <b>ç¬¬ä¸€ä¸ªå‘½ä»¤å¾ªç¯</b>,å¹¶ä¸”åªæœ‰ <code>Emacs</code> ç»“æŸçš„æ—¶å€™è¿™ä¸ªå¾ªç¯æ‰ä¼šç»“æŸ.
</p>

<p>
<code>Lisp</code> ç¨‹åºå¯ä»¥åœ¨ <b>ç¬¬ä¸€ä¸ªå‘½ä»¤å¾ªç¯</b> ä¸‹åˆ›å»ºæ–°çš„å‘½ä»¤å¾ªç¯,è¿™é‡Œæš‚ä¸”æŠŠæ–°çš„å‘½ä»¤å¾ªç¯å«åš <b>å­å‘½ä»¤å¾ªç¯</b>, è¿™ç§å‘½ä»¤å¾ªç¯ä¸­åµŒå¥—å­å‘½ä»¤å¾ªç¯çš„æƒ…å†µå«åš <b>é€’å½’ç¼–è¾‘</b>.
</p>

<p>
æˆ‘ä»¬æŠŠ <b>ç¬¬ä¸€ä¸ªå‘½ä»¤å¾ªç¯</b> å«åšé¡¶å±‚(<code>top-level</code>)å‘½ä»¤å¾ªç¯,æŠŠ <b>å­å‘½ä»¤å¾ªç¯</b> å«åšé€’å½’ç¼–è¾‘å±‚(<code>recursive editing level</code>)å‘½ä»¤å¾ªç¯.
</p>

<p>
ä¸€æ—¦ä¸€ä¸ªå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªé€’å½’ç¼–è¾‘å±‚å‘½ä»¤å¾ªç¯,é‚£ä¹ˆè¿™ä¸ªå‘½ä»¤å°±ä¼šè¢«æŒ‚èµ·,ç”¨æˆ·å¯ä»¥åœ¨ç»§ç»­å‘½ä»¤çš„æ‰§è¡Œå‰åšä»»æ„çš„ç¼–è¾‘.
</p>

<p>
é¡¶å±‚å’Œé€’å½’ç¼–è¾‘å±‚çš„å‘½ä»¤å¾ªç¯ä¸‹å¯ç”¨çš„å‘½ä»¤(<code>commands</code>)ä»¥åŠæŒ‰é”®æ˜ å°„(<code>keymaps</code>)æ˜¯ä¸€æ ·çš„,
</p>

<p>
ä¸è¿‡æœ‰å°‘éƒ¨åˆ†å‘½ä»¤æ˜¯é’ˆå¯¹é€’å½’ç¼–è¾‘å±‚å‘½ä»¤å¾ªç¯çš„,è¿™äº›å‘½ä»¤æ˜¯ä¸€ç›´éƒ½å¯ç”¨çš„,å¦å¤–æœ‰äº›å‘½ä»¤åªä¼šåœ¨é€’å½’ç¼–è¾‘å±‚å¾ªç¯æ²¡æœ‰ç»“æŸæ—¶å¯ç”¨.
</p>

<p>
è¿™ä¸€å°éƒ¨åˆ†å‘½ä»¤åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯å¯ç”¨çš„,ä½†æ˜¯åœ¨é€’å½’ç¼–è¾‘ä»¥å¤–çš„æƒ…å†µä¸‹ä½¿ç”¨æ˜¯æ²¡ä»»ä½•ä½œç”¨çš„.
</p>

<p>
æ‰€æœ‰çš„å‘½ä»¤å¾ªç¯éƒ½è®¾ç«‹äº† (<code>all-purpose error handlers</code>) é€šç”¨é”™è¯¯å¤„ç†,æ‰€ä»¥å‘½ä»¤å¾ªç¯é‡Œé¢å¼•å‘çš„å¼‚å¸¸ä¸ä¼šå¯¼è‡´å‘½ä»¤å¾ªç¯ç»“æŸ.
</p>
</div>
</div>



<div id="outline-container-org054d0d2" class="outline-4">
<h4 id="org054d0d2">ç¦ç”¨å‘½ä»¤ (Disabling Commands)</h4>
<div class="outline-text-4" id="text-org054d0d2">
<p>
ç¦ç”¨å‘½ä»¤å°±æ˜¯æ ‡è®°ä¸€ä¸ªå‘½ä»¤,å½“ä½¿ç”¨åˆ°è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™å°±è¦è¯·æ±‚ç”¨æˆ·ç¡®è®¤.åº•å±‚æœºåˆ¶å°±æ˜¯ç»™å‘½ä»¤çš„ <code>symbol</code> å­˜æ”¾(put)ä¸€ä¸ªä¸ºé <code>nil</code> çš„ <code>disabled</code> å±æ€§.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(put 'command-to-be-executed 'disabled t)
</pre>
</div>

<p>
å½“ç„¶,åªæœ‰äº¤äº’å¼ä½¿ç”¨æ‰ä¼šå—åˆ°å½±å“,åœ¨ <code>Lisp</code> ç¨‹åºä¸­å½“ä½œå‡½æ•°æ¥æ˜¯ç”¨æ˜¯ä¸ä¼šå—åˆ°å½±å“çš„.
</p>

<p>
å¦‚æœ <code>disabled</code> å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,é‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å°±ä¼šä½œä¸ºæç¤ºæ¶ˆæ¯.
</p>
</div>
</div>


<div id="outline-container-orgdba5152" class="outline-4">
<h4 id="orgdba5152">å‘½ä»¤å†å² (Command History)</h4>
<div class="outline-text-4" id="text-orgdba5152">
<p>
<code>Emacs</code> ä¼šè®°å½•ä»»ä½•æ‰§è¡Œè¿‡çš„ <code>M-x</code> å‘½ä»¤, <code>M-:</code> å‘½ä»¤ä»¥åŠä» <code>minibuffer</code> è¯»å–å‚æ•°çš„å‘½ä»¤,è¿™äº›è¢«è®¤ä¸ºæ˜¯å¤æ‚çš„å‘½ä»¤,å¯ä»¥é€šè¿‡ <code>command-history</code> æ¥æŸ¥çœ‹.
</p>
</div>
</div>


<div id="outline-container-org5fcec6f" class="outline-4">
<h4 id="org5fcec6f">é”®ç›˜å® (Keyboard Macros)</h4>
<div class="outline-text-4" id="text-org5fcec6f">
<p>
ä¸€ç»„è¾“å…¥äº‹ä»¶å°±æ˜¯ä¸€ä¸ªé”®ç›˜å®,å¯ä»¥çœ‹åšä¸€ä¸ªå‘½ä»¤æˆ–è€…ä½œä¸ºä¸€ä¸ªæŒ‰é”®çš„å®šä¹‰.é”®ç›˜å®çš„ <code>Lisp representation</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…åŒ…å«äº‹ä»¶çš„å‘é‡.
</p>

<p>
æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp">[?\C-e return ?\C-y return]
</pre>
</div>

<p>
åœ¨ <code>M-: (info "Keyboard Macro Registers")</code> è¿™é‡Œå¯ä»¥äº†è§£å¦‚ä½•å½•åˆ¶ä»¥åŠä¿å­˜é”®ç›˜å®.
</p>
</div>
</div>
</div>


<div id="outline-container-orga584345" class="outline-3">
<h3 id="orga584345">æ–‡æœ¬ (Text)</h3>
<div class="outline-text-3" id="text-orga584345">
<p>
è¿™ç« èŠ‚ä¸»è¦æ˜¯å…³äºå¦‚ä½•å¤„ç†ç¼“å†²åŒºä¸­çš„æ–‡æœ¬,è¿™ä¸ªç« èŠ‚ä¸­,æ–‡æœ¬æŒ‡çš„æ˜¯ç¼“å†²åŒºä¸­çš„å­—ç¬¦,åŒ…æ‹¬å®ƒä»¬çš„å±æ€§.
</p>

<p>
å¤„ç†çš„æ“ä½œåŒ…æ‹¬:åœ¨ç¼“å†²åŒºä¸Šçš„ç‚¹çš„é™„è¿‘è¿›è¡Œæ–‡æœ¬æ£€è§†,æ’å…¥,æˆ–è€…åˆ é™¤. <b>ç‚¹(<code>point</code>)æ˜¯å¤„äºä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„,è€ŒæŒ‡é’ˆ(<code>cursor</code>)æ˜¯å‡ºç°åœ¨ç‚¹çš„åé¢</b>.
</p>
</div>

<div id="outline-container-orgb915e94" class="outline-4">
<h4 id="orgb915e94">ç‚¹é™„è¿‘çš„æ–‡æœ¬ (Near Point)</h4>
<div class="outline-text-4" id="text-orgb915e94">
<p>
æ£€è§†ç‚¹é™„è¿‘çš„å­—ç¬¦.
</p>
</div>
</div>


<div id="outline-container-orgf3963be" class="outline-4">
<h4 id="orgf3963be">æ£€è§†ç¼“å†²åŒºçš„å†…å®¹ (Buffer Contents)</h4>
<div class="outline-text-4" id="text-orgf3963be">
<p>
ä¸€äº›å¯ä»¥æŠŠç¼“å†²åŒºçš„éƒ¨åˆ†æ–‡æœ¬è½¬åŒ–æˆå­—ç¬¦ä¸²çš„å‡½æ•°.
</p>
</div>
</div>


<div id="outline-container-org560e1be" class="outline-4">
<h4 id="org560e1be">æ¯”è¾ƒæ–‡æœ¬ (Comparing Text)</h4>
<div class="outline-text-4" id="text-org560e1be">
<p>
æ¯”è¾ƒä¸¤ä¸ªç¼“å†²åŒºä¸Šéƒ¨åˆ†æ–‡æœ¬.
</p>
</div>
</div>



<div id="outline-container-orgea4ea9b" class="outline-4">
<h4 id="orgea4ea9b">æ’å…¥æ–‡æœ¬ (Insertion)</h4>
<div class="outline-text-4" id="text-orgea4ea9b">
<p>
è¿™ä¸ªç« èŠ‚ä¸»è¦æ˜¯å…³äº <code>Emacs Lisp</code> çš„æ’å…¥æ–‡æœ¬çš„ <code>API</code>.
</p>

<p>
æ’å…¥æ–‡æœ¬å°±æ˜¯å¾€ç¼“å†²åŒºæ’å…¥æ–°çš„æ–‡æœ¬,è¢«æ’å…¥çš„æ–‡æœ¬ä¼šä½äºç‚¹ä¹‹ä¸­,ä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´.æœ‰äº›æ’å…¥æ–‡æœ¬çš„å‡½æ•°ä¼šæŠŠæ–‡æœ¬æ’å…¥åˆ°ç‚¹ä¹‹å,è€Œæœ‰äº›ç›¸å.
</p>

<p>
å¦‚æœåœ¨ç‚¹ä¹‹å‰æ’å…¥æ–‡æœ¬ä¼šå¯¼è‡´ä½äºç‚¹åé¢çš„æ ‡è®°(marker)å‘ç”Ÿç§»åŠ¨.å¦‚æœå½“å‰ç¼“å†²åŒºæˆ–è€…æ–‡æœ¬æ˜¯åªè¯»(read-only)çš„,é‚£ä¹ˆåœ¨é‡Œé¢æ’å…¥æ–‡æœ¬çš„å‡½æ•°ä¼šæŠ¥é”™.
</p>

<p>
ä» <code>string</code> æˆ–è€… <code>buffer</code> å¤åˆ¶æ–‡æœ¬å­—ç¬¦çš„å‡½æ•°ä¼šæŠŠå­—ç¬¦çš„å±æ€§ä¹Ÿå¤åˆ¶è¿‡æ¥.ç›¸æ¯”ä¹‹ä¸‹,å­—ç¬¦ä½œä¸ºå‚æ•°è€Œä¸æ˜¯ä½œä¸º <code>string</code> æˆ–è€… <code>buffer</code> ä¸€éƒ¨åˆ†çš„æ—¶å€™,å®ƒä»¬ä¼šç»§æ‰¿é‚»è¿‘æ–‡æœ¬(<code>neighboring text</code>)çš„æ–‡æœ¬å±æ€§.
</p>

<p>
å‡è®¾æ–‡æœ¬æ¥è‡ª <code>string</code> æˆ–è€… ç¼“å†²åŒº},ä¸ºäº†æŠŠæ–‡æœ¬æ’å…¥ <code>multibyte</code> ç¼“å†²åŒº ä¸­,å‡½æ•°ä¼šæŠŠæ–‡æœ¬ä» <code>unibyte</code> è½¬åŒ–ä¸º <code>multibyte</code>,åè¿‡ä¹Ÿæ¥ä¸€æ ·.
</p>

<p>
ç„¶è€Œå®ƒä»¬ä¸ä¼šæŠŠ <code>128</code> åˆ° <code>255</code> ç¼–ç èŒƒå›´çš„ <code>unibyte</code> å­—ç¬¦è½¬åŒ–,å³ä½¿æ’å…¥æ–‡æœ¬çš„å½“å‰çš„ç¼“å†²åŒºæ˜¯ä¸€ä¸ª <code>multibyte</code> ç¼“å†²åŒº.
</p>
</div>
</div>




<div id="outline-container-org6ffe80b" class="outline-4">
<h4 id="org6ffe80b">æ’å…¥æ–‡æœ¬çš„å‘½ä»¤ (Commands for Insertion)</h4>
<div class="outline-text-4" id="text-org6ffe80b">
<p>
å’Œä¸Šé¢ç« èŠ‚ä¸ä¸€æ ·,è¿™æ˜¯å…³äºæ’å…¥æ–‡æœ¬çš„å‘½ä»¤.
</p>
</div>
</div>


<div id="outline-container-org6e22026" class="outline-4">
<h4 id="org6e22026">åˆ é™¤æ–‡æœ¬ (Deletion)</h4>
<div class="outline-text-4" id="text-org6e22026">
<p>
åˆ é™¤æ–‡æœ¬ä¹Ÿå°±æ˜¯è¯´ç§»é™¤ç¼“å†²åŒºä¸Šçš„éƒ¨åˆ†æ–‡æœ¬,å¹¶ä¸”ä¸æŠŠè¢«ç§»é™¤çš„æ–‡æœ¬ä¿å­˜åœ¨ <code>kill ring</code> ä¸­,å› æ­¤,è¢«åˆ é™¤çš„æ–‡æœ¬æ˜¯ä¸èƒ½è¢« <code>yank</code> çš„,
</p>

<p>
ä¸è¿‡å¯ä»¥ä½¿ç”¨ <code>undo</code> æœºåˆ¶é‡æ–°æ’å…¥è¢«åˆ é™¤çš„æ–‡æœ¬åˆ°åŸæ¥çš„ä½ç½®ä¸Š.ä¸è¿‡åœ¨ä¸€äº›ç‰¹æ®Šæ¡ˆä¾‹ä¸‹,æŸäº›åˆ é™¤æ–‡æœ¬çš„å‡½æ•°çš„ç¡®ä¼šæŠŠåˆ é™¤çš„æ–‡æœ¬ä¿å­˜åœ¨ <code>kill ring</code> ä¸­.
</p>
</div>
</div>


<div id="outline-container-org260904f" class="outline-4">
<h4 id="org260904f">åˆ é™¤æ–‡æœ¬çš„å‘½ä»¤ (User-Level Deletion)</h4>
<div class="outline-text-4" id="text-org260904f">
<p>
å’Œä¸Šä¸ªç« èŠ‚ä¸ä¸€æ ·,è¿™æ˜¯å…³äºåˆ é™¤æ–‡æœ¬çš„å‘½ä»¤.
</p>
</div>
</div>


<div id="outline-container-org6ae9362" class="outline-4">
<h4 id="org6ae9362">Kill Ring (The Kill Ring)</h4>
<div class="outline-text-4" id="text-org6ae9362">
<p>
åœ¨ <code>Emacs</code> ä¸­æ€æ–‡æœ¬(<code>kill text</code>)å’Œåˆ é™¤æ–‡æœ¬(<code>delete text</code>)æ˜¯ä¸¤ä¸ªæ¦‚å¿µ,è¿™é‡Œå…ˆæŠŠæ€æ–‡æœ¬çš„å‡½æ•°å«åš <code>kill function</code>,å‘½ä»¤å«åš <code>kill command</code>.
</p>

<p>
<code>kill function</code> åŸºæœ¬éƒ½ <code>kill-xxx</code> çš„å‘½åæ–¹å¼,å’Œ <code>delete-xxx</code> çš„åˆ é™¤æ–‡æœ¬çš„å‡½æ•°ä¸ä¸€æ ·.
</p>

<p>
å’Œåˆ é™¤æ–‡æœ¬ä¸€æ ·, <code>kill function</code> ä¼šåˆ é™¤æ–‡æœ¬,ä½†æ˜¯å®ƒä»¬ä¼šæŠŠåˆ é™¤çš„æ–‡æœ¬ä¿å­˜åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­,è¿™ä¸ªåˆ—è¡¨å«åš <code>kill ring</code>,
</p>

<p>
ç›®çš„æ˜¯ä¸ºäº†ä¹‹åå¯ä»¥æŠŠåˆ é™¤çš„æ–‡æœ¬æ‰¾å›æ¥é‡æ–°åˆ©ç”¨,ä¹‹æ‰€ä»¥å« <code>ring</code> æ˜¯å› ä¸ºä¼šæŠŠåˆ—è¡¨é‡Œé¢çš„å…ƒç´ ç”¨å¾ªç¯çš„é¡ºåºæ¥å¯¹å¾…,è¿™ä¸ªåˆ—è¡¨ä¿å­˜åœ¨ <code>kill-ring</code> ä¸­.
</p>

<p>
å¯ä»¥å¯¹ <code>kill-ring</code> è¿›è¡Œå¸¸è§„çš„åˆ—è¡¨æ“ä½œ.è€Œåˆ é™¤æ–‡æœ¬çš„å‡½æ•°å¹¶ä¸ä¼šæŠŠåˆ é™¤çš„æ–‡æœ¬ä¿å­˜èµ·æ¥,è¿™å°±æ˜¯ä¸¤è€…çš„å·®åˆ«.
</p>
</div>

<ul class="org-ul">
<li><a id="org9c2d6fb"></a>Kill Ring çš„æ¦‚å¿µ (Kill Ring Concepts)<br>
<div class="outline-text-5" id="text-org9c2d6fb">
<p>
<code>Kill ring</code> ä¼šè®°å½•è¢«æ€æ‰çš„æ–‡æœ¬åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­,æœ€è¿‘çš„è®°å½•ä¼šæ’åœ¨ç¬¬ä¸€ä½,æœ‰ç‚¹ç±»ä¼¼æ ˆ(stack),æ–‡æ¡£ä¸Šæœ‰ä¸ªä¾‹å­:
</p>

<div class="org-src-container">
<pre class="src src-elisp">'(<span style="color: #CC9393;">"some text"</span> <span style="color: #CC9393;">"a different piece of text"</span> <span style="color: #CC9393;">"even older text"</span>)
</pre>
</div>

<p>
<code>Kill ring</code> æœ‰é•¿åº¦é™åˆ¶, <code>kill-ring-max</code> å¯ä»¥è®¾ç½®.åœ¨åˆ—è¡¨è¾¾åˆ°æœ€å¤§é™åˆ¶çš„æ—¶å€™,æ–°å¢åŠ ä¸€ä¸ªå…ƒç´ ä¼šè‡ªåŠ¨åˆ é™¤åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªçš„å…ƒç´ .
</p>

<p>
å½“ <code>kill command</code> å’Œå…¶å®ƒé <code>kill command</code> çš„å‘½ä»¤äº¤é”™ä½¿ç”¨çš„æ—¶å€™,æ¯ä¸ªéƒ½ä¼š <code>kill command</code> éƒ½ä¼šæ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ åˆ° <code>kill ring</code> ä¸­.
</p>

<p>
å¦‚æœå¤šä¸ª <code>kill commands</code> è¿ç»­åœ°(<code>in succession</code>)ä½¿ç”¨,é‚£ä¹ˆå°±ä¼šåªäº§ç”Ÿä¸€ä¸ªå…ƒç´ æ¥æ·»åŠ åˆ° <code>kill ring</code> ä¸­.æ‰€æœ‰åç»­çš„è¿ç»­ <code>kill commands</code> ä¼šæŠŠæ–‡æœ¬åŠ è½½ç¬¬ä¸€ä¸ª <code>kill command</code> ç”Ÿæˆçš„æ–‡æœ¬ä¸­.
</p>

<p>
å¯¹äº <code>yanking</code>,åªæœ‰ <code>kill ring</code> ä¸­å¼€å¤´çš„å…ƒç´ æ‰ä¼šè¢«æ‰¾å›.ä¸€äº› <code>yank</code> å‘½ä»¤ä¼šè½¬æ¢ <code>kill ring</code> æ¥æŠŠåˆ«çš„å…ƒç´ æ”¾åœ¨å¼€å¤´.
</p>

<p>
ä¸è¿‡è¿™ä¸ªè½¬æ¢å¹¶ä¸ä¼šæ”¹å˜ <code>kill ring</code> æœ¬èº«,æœ€è¿‘çš„å…ƒç´ è¿˜æ˜¯æ”¾åœ¨ç¬¬ä¸€ä½.
</p>
</div>
</li>


<li><a id="orge644615"></a>Kill Function (Kill Functions)<br>
<div class="outline-text-5" id="text-orge644615">
<p>
<code>kill-region</code> å°±æ˜¯ <code>killing text</code> çš„ <code>subroutine</code>,ä»»ä½•è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å‘½ä»¤éƒ½æ˜¯ <code>kill command</code>.
</p>

<p>
å®ƒä¼šæŠŠæœ€è¿‘è¢«æ€æ‰çš„æ–‡æœ¬æ·»åŠ åˆ° <code>kill ring</code> çš„å¤´éƒ¨æˆ–è€…æ·»åŠ åˆ°æœ€è¿‘çš„æ–‡æœ¬ä¸­,å®ƒä¼šæ ¹æ® <code>last-command</code> æ¥åˆ¤æ–­ä¸Šä¸€ä¸ªå‘½ä»¤æ˜¯ä¸æ˜¯ä¸€ä¸ª <code>kill command</code>,
</p>

<p>
å†å†³å®šæ˜¯å¦æ·»åŠ åˆ°ä¸Šä¸€ä¸ªå‘½ä»¤çš„æ–‡æœ¬ä¸­,è¿˜æ˜¯æ·»åŠ åˆ°å¤´éƒ¨ä¸­. <code>kill command</code> åœ¨ä¿å­˜æ–‡æœ¬ä¹‹å‰ä¼šå…ˆè°ƒç”¨ <code>filter-buffer-substring</code> æ¥å¯¹æ–‡æœ¬è¿›è¡Œç­›é€‰,æ‰€ä»¥ä¿å­˜çš„æ–‡æœ¬å¯èƒ½ä¼šä¸ç¼“å†²åŒºä¸Šçš„ä¸ä¸€æ ·.
</p>
</div>
</li>



<li><a id="orgd6f9fd5"></a>Yanking (Yanking)<br>
<div class="outline-text-5" id="text-orgd6f9fd5">
<p>
<code>Yanking</code> æ„å‘³æ’å…¥ <code>kill ring</code> ä¸­çš„æ–‡æœ¬,ä¸è¿‡å¹¶éç›²ç›®çš„æ’å…¥æ–‡æœ¬. <code>yank</code> å‘½ä»¤æˆ–è€…ç›¸å…³å‘½ä»¤ä¼šå…ˆä½¿ç”¨ <code>insert-for-yank</code> æ¥å¯¹æ’å…¥çš„æ–‡æœ¬è¿›è¡Œç‰¹æ®Šå¤„ç†.
</p>

<p>
<code>insert-for-yank</code> ç±»ä¼¼ <code>insert</code>,ä¸è¿‡å®ƒä¼šæ ¹æ®æ–‡æœ¬çš„ <code>yank-handler</code> å±æ€§ä»¥åŠ <code>yank-handled-properties</code> è¿˜æœ‰ <code>yank-excluded-properties</code> å˜é‡æ¥å¯¹æ’å…¥çš„æ–‡æœ¬è¿›è¡Œå¤„ç†,
</p>

<p>
ç„¶åæŠŠå¤„ç†åç»“æœæ’å…¥åˆ°å½“å‰ç¼“å†²åŒºä¸­.
</p>

<p>
<code>yank-handler</code> çš„æ ¼å¼å¦‚: <code>(FUNCTION [PARAM] [NOEXCLUDE] [UNDO])</code>,ç¬¬ä¸€ä¸ªä»¥å¤–çš„å…ƒç´ å¯ä»¥ä¸å†™
</p>

<ul class="org-ul">
<li><code>FUNCTION</code>: é <code>nil</code> çš„æ—¶å€™,ä¼šè¢«è°ƒç”¨æ¥æ’å…¥æ–‡æœ¬, <code>nil</code> çš„æ—¶å€™æ˜¯è°ƒç”¨ <code>insert</code>.</li>
<li><code>PARAM</code>: å¦‚æœè¯¥å…ƒç´ ä¸ºé <code>nil</code>,å®ƒå°±ä»£æ›¿è¢«æ’å…¥çš„æ–‡æœ¬,ä½œä¸º <code>FUNCTION</code> çš„å‚æ•°.</li>
<li><code>NOEXCLUDE</code>: å¦‚æœè¯¥å…ƒç´ ä¸ºé <code>nil</code>,é‚£ä¹ˆå°±ç¦ç”¨ <code>yank-handled-properties</code> å’Œ <code>yank-excluded-properties</code> å¯¹æ’å…¥æ–‡æœ¬çš„å¤„ç†.</li>
<li><code>UNDO</code>: å¦‚æœè¯¥å…ƒç´ ä¸ºé <code>nil</code>,é‚£ä¹ˆå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå¯ä»¥è¢« <code>yank-pop</code> è°ƒç”¨çš„å‡½æ•°,ç”¨æ¥æ’¤é”€å½“å‰æ–‡æœ¬çš„æ’å…¥,è¯¥å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°:å½“å‰åŒºåŸŸçš„èµ·ç‚¹å’Œç»“æŸç‚¹. <code>FUNCTION</code> å¯ä»¥è®¾ç½® <code>yank-undo-function</code> æ¥é‡å†™ <code>UNDO</code> çš„å€¼.</li>
</ul>
</div>
</li>


<li><a id="org0bd3cff"></a>Yankå‘½ä»¤ (Yank Commands)<br>
<div class="outline-text-5" id="text-org0bd3cff">
<p>
é«˜çº§çš„ <code>yanking</code> å‘½ä»¤,è‡ªå·±é˜…è¯».
</p>
</div>
</li>


<li><a id="orgb836383"></a>ä½çº§ Kill Ring (Low-Level Kill Ring)<br>
<div class="outline-text-5" id="text-orgb836383">
<p>
ä¸€äº›ç”¨æ¥è®¿é—® <code>kill ring</code> çš„ä½çº§å‡½æ•°å’Œå˜é‡,æ–¹ä¾¿äºå…³æ³¨çª—å£ç³»ç»Ÿé€‰æ‹©çš„ <code>Lisp</code> ç¨‹åºå‘˜.
</p>
</div>
</li>


<li><a id="org718f351"></a>Kill Ring çš„å†…éƒ¨ (Internals of Kill Ring)<br>
<div class="outline-text-5" id="text-org718f351">
<p>
<code>kill-ring</code> å˜é‡ä»¥ <code>string</code> åˆ—è¡¨çš„å½¢å¼ä¿å­˜äº† <code>kill ring</code> çš„å†…å®¹,æœ€è¿‘çš„æ–‡æœ¬å¿…å®šæ˜¯æ”¾åœ¨åˆ—è¡¨ç¬¬ä¸€ä½.
</p>

<p>
<code>kill-ring-yank-pointer</code> å˜é‡æŒ‡å‘ <code>kill ring</code> åˆ—è¡¨ä¸Šçš„è¿æ¥(link),è¿æ¥æ˜¯ä¸€ä¸ªåˆ—è¡¨,å®ƒçš„ <code>car</code> æ˜¯è¢«æ‰¾å›çš„æ–‡æœ¬,
</p>

<p>
<code>kill-ring-yank-pointer</code> å¯ä»¥ç”¨æ¥ç¡®è®¤ <code>kill ring</code> çš„å¤´éƒ¨.ç§»åŠ¨ <code>kill-ring-yank-pointer</code> åˆ°åˆ«çš„è¿æ¥ä¸Šè¢«æˆä¸ºè½¬æ¢ <code>kill ring</code> (<code>rotating the kill ring</code>).
</p>

<p>
å½“ç„¶è½¬æ¢æ˜¯è™šæ‹Ÿçš„,å¹¶ä¸ä¼šæ”¹å˜ <code>kill-ring</code> çš„å€¼.=kill-ring= å’Œ <code>kill-ring-yank-pointer</code> éƒ½æ˜¯æ™®é€šçš„åˆ—è¡¨,
</p>

<p>
<code>kill-ring-yank-pointer</code> å’Œ <code>kill ring</code> åˆ—è¡¨ä¸Šçš„è¿æ¥æ˜¯åŒä¸€ä¸ª <code>Lisp</code> å¯¹è±¡,å¯ä»¥é€šè¿‡ <code>eq</code> æµ‹è¯•.
</p>

<pre class="example" id="orge6e128c">

kill-ring                  ---- kill-ring-yank-pointer
  |                       |
  |                       v
  |     --- ---          --- ---      --- ---
   --&gt; |   |   |------&gt; |   |   |--&gt; |   |   |--&gt; nil
        --- ---          --- ---      --- ---
         |                |            |
         |                |            |
         |                |             --&gt;"yet older text"
         |                |
         |                 --&gt; "a different piece of text"
         |
          --&gt; "some text"

</pre>
</div>
</li>
</ul>
</div>


<div id="outline-container-org58688e1" class="outline-4">
<h4 id="org58688e1">æ’¤é”€ (Undo)</h4>
<div class="outline-text-4" id="text-org58688e1">
<p>
å¤§éƒ¨ä»½ç¼“å†²åŒºéƒ½æœ‰ä¸€ä¸ªæ’¤é”€åˆ—è¡¨(undo list),ç”¨æ¥è®°å½•ç¼“å†²åŒºä¸Šçš„æ–‡æœ¬æ”¹å˜,ç”¨äºä¹‹åå®ç°æ’¤é”€æ“ä½œ, ç¼“å†²åŒºå±€éƒ¨å˜é‡ <code>buffer-undo-list</code> è®°å½•äº†ç¼“å†²åŒºçš„æ”¹å˜è®°å½•.
</p>

<p>
åªæœ‰ä¸€äº›ç‰¹æ®Šç”¨é€”çš„ç¼“å†²åŒºæ˜¯ä¸è®°å½•æ”¹å˜çš„,å¦‚æœ <code>buffer-undo-list</code> ä¸º <code>t</code> å°±è¡¨ç¤ºè¯¥ç¼“å†²åŒºä¸è®°å½•æ”¹å˜,å› æ­¤è¿™äº›ç¼“å†²åŒºä¸èƒ½æ‰§è¡Œæ’¤é”€.
</p>
</div>
</div>


<div id="outline-container-org3ac2930" class="outline-4">
<h4 id="org3ac2930">ç»´æŠ¤æ’¤é”€åˆ—è¡¨ (Maintaining Undo)</h4>
<div class="outline-text-4" id="text-org3ac2930">
<p>
è¿™ä¸ªç« èŠ‚æ˜¯å…³äºå¦‚ä½•å¯ç”¨æˆ–è€…ç¦ç”¨ä¸€ä¸ªç¼“å†²åŒºçš„æ’¤é”€ä¿¡æ¯ä»¥åŠè§£é‡Šäº†æ’¤é”€åˆ—è¡¨å¦‚ä½•è‡ªåŠ¨æˆªæ–­.
</p>

<p>
ä¸€èˆ¬ä¸€ä¸ªæ–°åˆ›å»ºçš„ç¼“å†²åŒºä¼šè‡ªåŠ¨å¯ç”¨æ’¤é”€æ¶ˆæ¯è®°å½•, <del>é™¤éæ˜¯ä¸€ä¸ªåå­—ä»¥ç©ºæ ¼å¼€å¤´çš„ç¼“å†²åŒº</del> (<b>åé¢è¿™ä¸ªä»å¥ä¸ªäººéªŒè¯è¿‡,å’Œæ–‡æ¡£æè¿°ä¸ç¬¦åˆ</b>).
</p>
</div>
</div>


<div id="outline-container-orge44d3a0" class="outline-4">
<h4 id="orge44d3a0">å¡«å…… (Filling)</h4>
<div class="outline-text-4" id="text-orge44d3a0">
<p>
å¡«å……çš„æ„æ€æ˜¯é€šè¿‡ç§»åŠ¨è¡Œçš„æ–­å£(breaks)æ¥è°ƒæ•´è¡Œçš„é•¿åº¦æ¥æ¥è¿‘æœ€å¤§å®½åº¦(ä¸èƒ½å¤§äº).å¦å¤–,è¿˜å¯ä»¥é€šè¿‡æ’å…¥ç©ºæ ¼æ¥äº§ç”Ÿå·¦æˆ–è€…å³è¾¹è·è¿›è¡Œå¯¹é½.è¡Œçš„å®½åº¦ç”± <code>fill-column</code> æ¥æ§åˆ¶,
</p>

<p>
ä¸ºäº†æ–¹ä¾¿é˜…è¯»,è¡Œçš„é•¿åº¦æˆ–è€…å’Œåˆ—æœ€å¥½ä¸è¦è¶…è¿‡ <code>70</code>. è¿™ä¸ªç« èŠ‚ä»‹ç»çš„å‘½ä»¤éƒ½æ˜¯åšè¿™æ–¹é¢çš„äº‹æƒ….
</p>
</div>
</div>


<div id="outline-container-orgf2b2656" class="outline-4">
<h4 id="orgf2b2656">å¤–è¾¹è· (Margins)</h4>
<div class="outline-text-4" id="text-orgf2b2656">
<p>
æ˜¯ä¸Šä¸€ç« çš„ç»§ç« .
</p>
</div>
</div>


<div id="outline-container-org1bfac5f" class="outline-4">
<h4 id="org1bfac5f">é€‚åº”å¡«å…… (Adaptive Fill)</h4>
<div class="outline-text-4" id="text-org1bfac5f">
<p>
<code>Emacs</code> æœ‰ <code>Adaptive Fill Mode</code>,å½“å¯ç”¨çš„æ—¶å€™, <code>Emacs</code> æˆ–åªåŠ¨æ ¹æ®å½“å‰è¢«å¡«å……çš„æ®µè½çš„æ–‡æœ¬æ¥å†³å®šå¡«å……å‰ç¼€(fill prefix),è€Œä¸æ˜¯æ˜¯ç”¨å›ºå®šé•¿åº¦.
</p>

<p>
åœ¨å¡«å……å‘ç”Ÿçš„æ—¶å€™,å¡«å……å‰ç¼€ä¼šè¢«æ’å…¥åˆ°å½“å‰æ®µè½çš„ç¬¬äºŒè¡Œçš„å¼€å¤´,åç»­è¡Œä¹Ÿä¼šæ”¶åˆ°å½±å“.
</p>
</div>
</div>


<div id="outline-container-org4e24245" class="outline-4">
<h4 id="org4e24245">è‡ªåŠ¨å¡«å…… (Auto Filling)</h4>
<div class="outline-text-4" id="text-org4e24245">
<p>
è¿™é‡Œä»‹ç»äº† <code>Auto Fill mode</code>,å°±ä¸è¯´äº†.
</p>
</div>
</div>


<div id="outline-container-org4700160" class="outline-4">
<h4 id="org4700160">æ–‡æœ¬æ’åº (Sorting)</h4>
<div class="outline-text-4" id="text-org4700160">
<p>
è¿™é‡Œè®²çš„å‡½æ•°å…¨éƒ¨éƒ½æ˜¯å’Œæ’åºæ–‡æœ¬æœ‰å…³çš„,å’Œ <code>sort</code> ç±»ä¼¼ä½†ä¸ä¸€æ ·,å¹¶éç»™åˆ—è¡¨é‡Œé¢çš„å…ƒç´ è¿›è¡Œæ’åº.
</p>
</div>
</div>


<div id="outline-container-orgebabf22" class="outline-4">
<h4 id="orgebabf22">åˆ— (Columns)</h4>
<div class="outline-text-4" id="text-orgebabf22">
<p>
å­—ç¬¦çš„ä½ç½®æ˜¯ä»ç¼“å†²åŒºå¼€å§‹ä½ç½®è¿›è¡Œè®¡ç®—,è€Œåˆ—çš„ä½ç½®æ˜¯ä»è¡Œçš„å¼€å§‹ä½ç½®è®¡ç®—,åˆ—ç›¸å…³çš„å‡½æ•°å°±æ˜¯åœ¨è¿™ä¸¤è€…ä¹‹é—´è½¬æ¢.
</p>
</div>
</div>



<div id="outline-container-org6266a8e" class="outline-4">
<h4 id="org6266a8e">ç¼©è¿› (Indentation)</h4>
<div class="outline-text-4" id="text-org6266a8e">
<p>
ä»å·¦å¤–è¾¹è·ä¹‹åå¼€å§‹è®¡ç®—å‡ºåˆ—ä»¥åŠç¼©è¿›æ•°é‡.å…·ä½“å°±ä¸å†™äº†,åæ­£æœ‰å…³ç¼©è¿›æ“ä½œçš„å¯ä»¥çœ‹è¿™é‡Œ.
</p>
</div>


<ul class="org-ul">
<li><a id="orgf02c65c"></a>åŸå‡½æ•°ç¼©è¿› (Primitive Indent)<br>
<div class="outline-text-5" id="text-orgf02c65c">
<p>
å…³äºè·å–ä»¥åŠæ’å…¥ç¼©è¿›çš„åŸå‡½æ•°.
</p>
</div>
</li>


<li><a id="orgdcb968c"></a>Modeç‰¹å®šçš„ç¼©è¿› (Mode-Specific Indent)<br>
<div class="outline-text-5" id="text-orgdcb968c">
<p>
<code>Major Mode</code> çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯è‡ªå®šä¹‰ <code>&lt;TAB&gt;</code> æŒ‰é”®çš„ç¼©è¿›.è¿™ä¸ªç« èŠ‚å°±æ˜¯æè¿° <code>&lt;TAB&gt;</code> æŒ‰é”®çš„æœºåˆ¶ä»¥åŠå¦‚ä½•æ§åˆ¶å®ƒ.
</p>

<p>
åœ¨å¤§éƒ¨ä»½çš„ç¼–è¾‘æ¨¡å¼ä¸­, <code>&lt;TAB&gt;</code> éƒ½æ˜¯ç»‘å®šåˆ° <code>indent-for-tab-command</code> å‘½ä»¤ä¸­.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-orgf71a383" class="outline-4">
<h4 id="orgf71a383">å¤§å°å†™æ”¹å˜ (Case Changes)</h4>
<div class="outline-text-4" id="text-orgf71a383">
<p>
è¿™é‡Œæ–‡æ¡£æè¿°çš„æ”¹å˜æ–‡æœ¬å¤§å°å†™çš„å‡½æ•°éƒ½æ˜¯ç”¨äºç¼“å†²åŒºä¸Šçš„æ–‡æœ¬çš„,å¦‚æœæ˜¯åº”ç”¨äºå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦å¯ä»¥çœ‹è¿™é‡Œ <code>M-: (info "Case Conversion")</code>.
</p>

<p>
è¿˜å¯ä»¥é€šè¿‡ <code>case table</code> æ¥è‡ªå®šä¹‰å¦‚ä½•åˆ‡æ¢å¤§å°å†™,å…·ä½“çœ‹è¿™é‡Œ <code>(info "Case Tables")</code>.
</p>
</div>
</div>


<div id="outline-container-org7440d36" class="outline-4">
<h4 id="org7440d36">æ–‡æœ¬å±æ€§ (Text Properties)</h4>
<div class="outline-text-4" id="text-org7440d36">
<p>
ç¼“å†²åŒºä¸Šçš„æ¯ä¸ªå­—ç¬¦æˆ–å­—ç¬¦ä¸²éƒ½æœ‰ä¸€ä¸ªæ–‡æœ¬å±æ€§åˆ—è¡¨,æ¯”è¾ƒåƒ <code>symbol</code> çš„å±æ€§åˆ—è¡¨.æ–‡æœ¬å±æ€§æ˜¯å±äºåœ¨ç‰¹å®šåœ°æ–¹ä¸Šçš„ç‰¹å®šå­—ç¬¦,ä¹Ÿå°±æ˜¯è¯´,è„¸ä¸ªåŒæ ·çš„å­—ç¬¦åœ¨ä¸åŒåœ°æ–¹ä¸Šçš„å±æ€§æ˜¯å¯èƒ½ä¸ä¸€æ ·çš„.
</p>

<p>
æ¯ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªåå­—å’Œå€¼,å®ƒä»¬å¯ä»¥ä½¿ä»»æ„ <code>Lisp</code> å¯¹è±¡,ä½†é€šå¸¸åå­—æ˜¯ä¸€ä¸ª <code>symbol</code>,ä¸€èˆ¬æ¯ä¸ªå±æ€§åå­—éƒ½æ˜¯æœ‰å®ƒçš„æ„ä¹‰çš„,æ¯”å¦‚ <code>face</code> è¡¨ç¤ºå­—ç¬¦æ˜¯å¦‚ä½•æ˜¾ç¤ºçš„,
</p>

<p>
<code>category</code> è¡¨ç¤ºå­—ç¬¦çš„åˆ†ç±».
</p>

<p>
åœ¨å­—ç¬¦ä¸²å’Œç¼“å†²åŒºä¹‹é—´å¤åˆ¶æ–‡æœ¬ä¼šä¿ç•™æ¯ä¸ªå­—ç¬¦çš„æ–‡æœ¬å±æ€§,æ¯”å¦‚ <code>insert</code>, <code>substring</code> ä»¥åŠ <code>buffer-substring</code> è¿™ä¸‰ä¸ªå‡½æ•°å°±æ˜¯è¿™æ ·.
</p>
</div>


<ul class="org-ul">
<li><a id="orgd2faef9"></a>æ£€æŸ¥å±æ€§ (Examining Properties)<br>
<div class="outline-text-5" id="text-orgd2faef9">
<p>
ä¸»è¦æ˜¯å…³äºä¸€äº›è·å–æŸä¸ªä½ç½®ä¸Šçš„æ–‡æœ¬å±æ€§,æ¯”å¦‚ <code>get-text-property</code> ä»¥åŠ <code>text-properties-at</code>,åè€…è¿”å›ä¸€ä¸ªå±æ€§åˆ—è¡¨,å‰è€…å¾—åˆ°æŸä¸ªå±æ€§çš„å€¼,
</p>

<p>
å…·ä½“é˜…è¯»æ–‡æ¡£.
</p>
</div>
</li>


<li><a id="org98a2eea"></a>æ”¹å˜æ–‡æœ¬å±æ€§ (Changing Properties)<br>
<div class="outline-text-5" id="text-org98a2eea">
<p>
è¿™é‡Œæ˜¯å…³äºç”¨äºæ”¹å˜ç¼“å†²åŒºæˆ–è€…å­—ç¬¦ä¸²æŒ‡å®šèŒƒå›´å†…çš„æ–‡æœ¬å±æ€§çš„å‡½æ•°, <code>set-text-properties</code> å‡½æ•°å¯ä»¥ç”¨æ¥å¢åˆ æ”¹æŒ‡å®šèŒƒå›´å†…çš„æ–‡æœ¬çš„å±æ€§.
</p>

<p>
å› ä¸ºæ–‡æœ¬å±æ€§è¢«è®¤ä¸ºæ˜¯ç¼“å†²åŒºå†…å®¹çš„ä¸€éƒ¨åˆ†,æ‰€ä»¥æ”¹å˜æ–‡æœ¬å±æ€§ä¼šæŠŠç¼“å†²åŒºè®¤ä¸ºè¢«ä¿®æ”¹è¿‡.ç¼“å†²åŒºä¸Šçš„æ–‡æœ¬å±æ€§æ˜¯å¯ä»¥æ’¤é”€çš„(undoable).
</p>

<p>
è¿˜æœ‰,åœ¨å­—ç¬¦ä¸²ä¸­,ä½ç½®æ˜¯ä»0å¼€å§‹çš„,è€Œåœ¨ç¼“å†²åŒºä¸­æ˜¯ä»1å¼€å§‹çš„.
</p>
</div>
</li>



<li><a id="orgb65c024"></a>æ–‡æœ¬å±æ€§æœç´¢ (Property Search)<br>
<div class="outline-text-5" id="text-orgb65c024">
<p>
é€šå¸¸è¿ç»­çš„æ–‡æœ¬å­—ç¬¦çš„åŒä¸€ä¸ªå±æ€§ä¼šæœ‰ç›¸åŒçš„å€¼,æ‰€ä»¥è¯´ä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„æ£€æŸ¥å­—ç¬¦çš„å±æ€§,ç›´æ¥å¤„ç†ä¸€æ®µæœ‰ç€ç›¸åŒå±æ€§çš„å­—ç¬¦ä¼šæ›´å¿«.
</p>

<p>
è¿™ç« èŠ‚çš„å‡½æ•°ä¸ä¼šç§»åŠ¨ç‚¹(point),ç›¸åä¼šè¿”å›ä¸€ä¸ªä½ç½®(position)æˆ– <code>nil</code>. <b>ä¸€ä¸ªä½ç½®æ˜¯å¤„äºä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„</b>,è¿™äº›å‡½æ•°è¿”å›çš„ä½ç½®æ˜¯å¤„äºä¸¤ä¸ªä¸åŒå±æ€§çš„å­—ç¬¦ä¹‹é—´çš„.
</p>
</div>
</li>


<li><a id="org9244e58"></a>ç‰¹æ®Šå±æ€§ (Special Properties)<br>
<div class="outline-text-5" id="text-org9244e58">
<p>
ä¸€äº›æœ‰ç‰¹æ®Šç”¨é€”çš„å±æ€§,æ¯”å¦‚ä¸Šé¢æåˆ°çš„ <code>face</code> å’Œ <code>category</code>.
</p>
</div>
</li>


<li><a id="org9ddfeab"></a>æ ¼å¼åŒ–ç”¨çš„æ–‡æœ¬å±æ€§ (Format Properties)<br>
<div class="outline-text-5" id="text-org9ddfeab">
<p>
è¿™äº›å±æ€§å½±å“å¡«å……å‘½ä»¤çš„è¡Œä¸º.
</p>
</div>
</li>


<li><a id="org26bdf14"></a>æ–‡æœ¬å±æ€§çš„ç²˜æ€§ (Sticky Properties)<br>
<div class="outline-text-5" id="text-org26bdf14">
<p>
å½“ç”¨æˆ·åœ¨ç¼“å†²åŒºä¸Šé¢è¾“å…¥ <code>self-inserting</code> å­—ç¬¦ (å¯ä»¥ç†è§£ä¸ºè¾“å…¥çš„å­—ç¬¦)æ—¶å€™,è¾“å…¥çš„å­—ç¬¦ä¼šæ‹¥æœ‰ä¸è¾“å…¥ä½ç½®å‰é¢çš„å­—ç¬¦ä¸€æ ·çš„å±æ€§,è¿™ç§°ä¸ºå±æ€§çš„ç»§æ‰¿.
</p>

<p>
ä¸€ä¸ª <code>Lisp</code> ç¨‹åºå¯ä»¥åšåˆ°æœ‰ç»§æ‰¿æ’å…¥æˆ–æ— ç»§æ‰¿æ’å…¥,å–å†³äºå¯¹æ’å…¥åŸå‡½æ•°çš„é€‰æ‹©,æ¯”å¦‚ <code>insert</code> å°±æ˜¯ä¸å¸¦ç»§æ‰¿åœ°æ’å…¥æ–‡æœ¬,å®ƒä¼šä¿ç•™è¢«æ’å…¥å­—ç¬¦ä¸²çš„å±æ€§,è¢«æ’å…¥çš„å­—ç¬¦ä¸²çš„å±æ€§ä¸ä¼šå› ä¸ºåœ¨åˆ«çš„ç¼“å†²åŒºä¸Šæ”¹å˜.
</p>

<p>
è€Œ <code>serf-inserting</code> å­—ç¬¦å› ä¸ºè¾“å…¥çš„æ—¶å€™ä½¿ç”¨äº†å¸¦ç»§æ‰¿æ’å…¥çš„åŸå‡½æ•°,æ‰€ä»¥ <code>self-inserting</code> å­—ç¬¦ä¼šç»§æ‰¿å±æ€§.
</p>

<p>
åœ¨æ’å…¥æ–‡æœ¬çš„æ—¶å€™,å“ªäº›å±æ€§è¢«ç»§æ‰¿,ä»¥åŠæ˜¯ä»å“ªé‡Œç»§æ‰¿æ˜¯å–å†³äºé‚£äº› <code>sticky</code> å±æ€§.åœ¨ä¸€ä¸ªå­—ç¬¦åé¢æ’å…¥å¹¶ä¸”ç»§æ‰¿è¿™ä¸ªå­—ç¬¦çš„å±æ€§,è¿™ç§å« <code>rear-sticky</code>,
</p>

<p>
åœ¨æ–‡å­—å‰é¢æ’å…¥å¹¶ä¸”ç»§æ‰¿è¿™ä¸ªå­—ç¬¦çš„å±æ€§å«åš <code>front-sticky</code>.å¦‚æœä¸¤è¾¹éƒ½å¯¹åŒä¸€ä¸ªå±æ€§æä¾›ä¸åŒçš„ <code>sticky</code> å€¼(å°±æ˜¯åœ¨æ–‡æœ¬ä¸­é—´è¿›è¡Œæ–‡æœ¬æ’å…¥çš„æ“ä½œ),é‚£ä¹ˆå‰é¢çš„ä¸€ä¸ªå­—ç¬¦çš„å€¼ä¼˜å…ˆ.
</p>

<p>
å¯ä»¥é€šè¿‡ <code>front-sticky</code> ä»¥åŠ <code>rear-nonsticky</code> ä¸¤ä¸ªå±æ€§ä»¥åŠ <code>text-property-default-nonsticky</code> å˜é‡æ¥æ§åˆ¶ä¸åŒæ–‡æœ¬å±æ€§çš„ç²˜æ€§.
</p>

<p>
å¦‚æœä¸€ä¸ªå­—ç¬¦çš„ <code>front-sticky</code> å±æ€§çš„å€¼ä¸º <code>t</code>,é‚£ä¹ˆè¿™ä¸ªå­—ç¬¦çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯æœ‰ <code>front-sticky</code> ç²˜æ€§çš„,å¦‚æœæ˜¯æŒ‡å®šç‰¹å®šå±æ€§,æ¯”å¦‚ <code>(face read-only)</code>,è¿™æ ·å°±æ˜¯æŒ‡å®š <code>face</code> å±æ€§ä¸ºç²˜æ€§,
</p>

<p>
åœ¨è¯¥å­—ç¬¦å‰é¢æ’å…¥ä¼šå¯¼è‡´è¢«æ’å…¥çš„æ–‡æœ¬éƒ½ç»§æ‰¿è¿™ä¸ªå­—ç¬¦çš„ <code>face</code> å±æ€§.
</p>

<p>
<code>read-nonsticky</code> æ˜¯è®©åœ¨å­—ç¬¦åé¢æ’å…¥æ–‡æœ¬ä¸ç»§æ‰¿è¯¥å­—ç¬¦çš„å±æ€§,å­—ç¬¦çš„å¤§éƒ¨ä»½å±æ€§é»˜è®¤éƒ½æ˜¯ <code>rear-sticky</code>,æ¥å—çš„å€¼å’Œä¸Šé¢ <code>front-sticky</code> æè¿°ä¸€æ ·.
</p>
</div>
</li>


<li><a id="org6823ec1"></a>æƒ°æ€§è®¡ç®—æ–‡æœ¬å±æ€§ (Lazy Properties)<br>
<div class="outline-text-5" id="text-org6823ec1">
<p>
å°±æ˜¯åœ¨éœ€è¦è¿™äº›å±æ€§çš„æ—¶å€™è®¡ç®—å‡ºç»“æœ.
</p>
</div>
</li>


<li><a id="org75564a4"></a>å®šä¹‰å¯ç‚¹å‡»æ–‡æœ¬ (Clickable Text)<br>
<div class="outline-text-5" id="text-org75564a4">
<p>
è®¾ç½®é“¾æ¥çš„å®˜æ–¹æ•™ç¨‹,å°±ä¸æ€»ç»“äº†,è‡ªè¡Œé˜…è¯».
</p>
</div>
</li>


<li><a id="org66fed8d"></a>å®šä¹‰ä»¥åŠä½¿ç”¨åŸŸ (Fields)<br>
<div class="outline-text-5" id="text-org66fed8d">
<p>
æ‰€è°“åŸŸå°±æ˜¯ç¼“å†²åŒºé‡Œé¢ä¸€æ®µè¿ç»­çš„å­—ç¬¦,å¹¶ä¸”å®ƒä»¬çš„å±æ€§ <code>field</code> çš„å€¼éƒ½æ˜¯ä¸€æ ·(ç”¨ <code>eq</code> æ¯”è¾ƒ).
</p>
</div>
</li>


<li><a id="org5669a90"></a>ä¸ºä»€ä¹ˆæ–‡æœ¬å±æ€§ä¸æ˜¯åŒºé—´ (Not Intervals)<br>
<div class="outline-text-5" id="text-org5669a90">
<p>
å…·ä½“ä¸ç¿»è¯‘äº†,è‡ªå·±è¯».
</p>
</div>
</li>
</ul>
</div>
</div>


<div id="outline-container-orgd9deedc" class="outline-3">
<h3 id="orgd9deedc">è¯­æ³•è¡¨ (Syntax Tables)</h3>
<div class="outline-text-3" id="text-orgd9deedc">
<p>
è¯­æ³•è¡¨è´Ÿè´£ä¸ºç¼“å†²åŒºä¸Šçš„æ¯ä¸€ä¸ªå­—ç¬¦åˆ†é…è¯­æ³•è§’è‰²(<code>syntactic role</code>).è¯­æ³•è¡¨å¯ä»¥å†³å®šå•è¯(word),ç¬¦å·(symbol)å’Œå…¶ä»–è¯­æ³•æˆåˆ†(syntactic constructs)ä»å“ªé‡Œå¼€å§‹åˆ°å“ªé‡Œç»“æŸ.
</p>

<p>
è®¸å¤š <code>Emacs</code> åŠŸèƒ½éƒ½æ˜¯ç”¨è¿™äº›ä¿¡æ¯,åŒ…æ‹¬ <code>Font Lock mode</code> å’Œå„ç§å¤æ‚çš„ç§»åŠ¨å‘½ä»¤(<code>movement commands</code>).
</p>
</div>


<div id="outline-container-org311808e" class="outline-4">
<h4 id="org311808e">è¯­æ³•è¡¨åŸºç¡€ (Syntax Basics)</h4>
<div class="outline-text-4" id="text-org311808e">
<p>
è¯­æ³•è¡¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„,å¯ä»¥ç”¨æ¥æŸ¥æ‰¾æ¯ä¸ªå­—ç¬¦çš„è¯­æ³•ç±»(<code>syntax class</code>)å’Œå…¶ä»–è¯­æ³•å±æ€§(<code>syntactic properties</code>). <code>Lisp</code> ç¨‹åºä¼šç”¨å®ƒæ¥æ‰«ç„æ–‡æœ¬ä»¥åŠåœ¨æ–‡æœ¬é—´ç§»åŠ¨.
</p>

<p>
å†…éƒ¨å®ç°ä¸­,ä¸€ä¸ªè¯­æ³•è¡¨å°±æ˜¯ä¸€ä¸ªå­—ç¬¦è¡¨(<code>char-table</code>),åœ¨ <code>index C</code> ä¸Šçš„å…ƒç´ å°±æè¿°äº†ä»£å·ä¸º <code>C</code> çš„å­—ç¬¦,å®ƒçš„å€¼æ˜¯ä¸€ä¸ªæŒ‡å®šäº†å­—ç¬¦çš„è¯­æ³•çš„ <code>cons cell</code>.
</p>

<p>
ç„¶å <code>Emacc</code> æä¾›äº†é«˜çº§å‡½æ•° <code>char-syntax</code> å’Œ <code>modify-synbtax-entry</code> æ¥æ£€æŸ¥å’Œä¿®æ”¹è¯­æ³•è¡¨çš„å†…å®¹,è€Œä¸æ˜¯åƒå­—ç¬¦è¡¨é‚£æ ·ä½¿ç”¨ <code>aset</code> å’Œ <code>aref</code>.
</p>

<p>
æ¯ä¸ªç¼“å†²åŒºéƒ½æœ‰è‡ªå·±çš„ä¸»è¦æ¨¡å¼,å¹¶ä¸”æ¯ä¸ªä¸»è¦æ¨¡å¼éƒ½æœ‰è‡ªå·±çš„è¯­æ³•è¡¨,æ¯ä¸ªè¯­æ³•è¡¨å¯¹åŒä¸€ä¸ªå­—ç¬¦æŒ‡å®šçš„ä½œç”¨å¯èƒ½ä¸ä¸€æ ·,æ¯”å¦‚,
</p>

<p>
åœ¨ <code>Emacs Lisp mode</code> é‡Œé¢ä»¥ <code>;</code> å¼€å¤´çš„è¯­å¥è¡¨ç¤ºæ³¨é‡Š,åœ¨ <code>C mode</code> é‡Œé¢ <code>;</code> åˆ™æ˜¯è¡¨ç¤ºè¯­å¥(<code>statement</code>)çš„ç»“å°¾.å¾ˆæ˜æ˜¾,è¯­æ³•è¡¨å¯¹äºæ¯ä¸ªç¼“å†²åŒºæ¥è¯´æ˜¯å±€éƒ¨çš„(<code>local</code>).
</p>

<p>
æ€»çš„æ¥è¯´,æ¯ä¸ª <code>mode</code> éƒ½æœ‰è‡ªå·±çš„è¯­æ³•è¡¨,è€Œä½¿ç”¨äº† <code>mode</code> çš„ç¼“å†²åŒºä¼šå®‰è£…å¯¹åº” <code>mode</code> çš„è¯­æ³•è¡¨.æ¯”å¦‚, <code>Emacs Lisp mode</code> çš„è¯­æ³•è¡¨å°±æ˜¯ <code>emacs-lisp-mode-syntax-table</code> çš„å€¼,
</p>

<p>
<code>C mode</code>,æ”¹å˜ <code>mode</code> çš„è¯­æ³•è¡¨ä¼šå½±å“æ‰€æœ‰æ˜¯ç”¨äº†è¯¥ <code>mode</code> çš„ç¼“å†²åŒº.
</p>

<p>
è¯­æ³•è¡¨ä¼šç”¨ç»§æ‰¿äºåˆ«çš„è¯­æ³•è¡¨,è¢«ç»§æ‰¿çš„è¯­æ³•è¡¨å«åšçˆ¶è¯­æ³•è¡¨(<code>parent syntax table</code>),ç»§æ‰¿å¾—åˆ°çš„è¯­æ³•è¡¨å¯ä»¥åªæ”¹å˜æŸäº›å­—ç¬¦,å…¶ä½™çš„ä¸å˜.
</p>

<p>
<code>Emacs</code> æä¾›ä¸€ä¸ªæ ‡å‡†è¯­æ³•è¡¨ <code>(standard-syntax-table)</code>,ä¹Ÿå°±æ˜¯é»˜è®¤çš„çˆ¶è¯­æ³•è¡¨,åŒæ—¶è¿™å¼ è¯­æ³•è¡¨ä¹Ÿè¢« <code>Fundamental mode</code> ä½¿ç”¨ç€,æŒ‰ç…§ç»§æ‰¿çº§åˆ«æ¥è¯´å°±æ˜¯æ ¹è¯­æ³•è¡¨.
</p>

<p>
<code>Emacs Lisp reader</code> ä¸ä½¿ç”¨è¯­æ³•è¡¨,å®ƒæœ‰è‡ªå·±å†…ç½®çš„è¯­æ³•è§„åˆ™,å¹¶ä¸”ä¸èƒ½æ”¹å˜.ä¸€äº› <code>Lisp</code> ç³»ç»Ÿä¼šæä¾›é‡æ–°å®šä¹‰è¯»å–è¯­æ³•(<code>read syntax</code>)çš„èƒ½åŠ›,æ¯”å¦‚ <code>Racket</code>,è€Œ <code>Emacs Lisp</code> ä¸æä¾›è¿™ç‰¹æ€§æ˜¯ä¸ºäº†ç®€æ´.
</p>
</div>
</div>


<div id="outline-container-org04015f8" class="outline-4">
<h4 id="org04015f8">è¯­æ³•æè¿°ç¬¦ (Syntax Descriptors)</h4>
<div class="outline-text-4" id="text-org04015f8">
<p>
å­—ç¬¦çš„è¯­æ³•ç±»å†³å®šäº†å®ƒçš„è¯­æ³•è§’è‰²,æ¯ä¸ªè¯­æ³•è¡¨éƒ½ä¼šä¸ºæ¯ä¸ªå­—ç¬¦æŒ‡å®šè¯­æ³•ç±»,ä¸åŒè¯­æ³•è¡¨ä¸Šçš„åŒä¸€ä¸ªå­—ç¬¦çš„è¯­æ³•ç±»æ˜¯æ²¡æœ‰å¿…ç„¶è”ç³»çš„.
</p>

<p>
æ¯ä¸ªè¯­æ³•ç±»éƒ½æ˜¯ç”¨ä¸€ä¸ªæ–¹ä¾¿è®°å¿†çš„å­—ç¬¦(<code>mnemonic character</code>)æ¥å‘½å,è¿™ä¸ªå­—ç¬¦å«åšæŒ‡ç¤ºå­—ç¬¦(<code>designator character</code>),è™½ç„¶è¯´æŒ‡ç¤ºå­—ç¬¦è¦è¢«åˆ†é…å’Œè¯­æ³•ç±»,
</p>

<p>
ä½†æ˜¯ä¸ç®¡æŒ‡ç¤ºå­—ç¬¦è¢«åˆ†é…åˆ°å“ªä¸ªè¯­æ³•ç±»,ç¤ºå­—ç¬¦æœ¬èº«æ˜¯æœ‰è‡ªå·±çš„è¯­ä¹‰,æ¯”å¦‚ <code>\</code> å°±æ˜¯è¡¨ç¤ºè½¬ä¹‰,ä¸ç®¡å®ƒåœ¨è¯­æ³•è¡¨ä¸Šé¢æ˜¯å“ªä¸ªç±», <code>M-: (info "(elisp)Syntax Class Table")</code> æœ‰è¯­æ³•ç±»å’Œå®ƒä»¬çš„æŒ‡ç¤ºå­—ç¬¦.
</p>

<p>
è¯­æ³•æè¿°å™¨æ˜¯ä¸€ä¸ª <code>Lisp</code> å­—ç¬¦ä¸²,ç”¨æ¥æè¿°ä¸€ä¸ªå­—ç¬¦çš„è¯­æ³•ç±»å’Œå…¶ä»–è¯­æ³•å±æ€§.å½“ä½ è¦ä¿®æ”¹ä¸€ä¸ªå­—ç¬¦çš„è¯­æ³•,ç»™ <code>modify-syntax-entry</code> å‡½æ•°ä¼ å…¥ä¸€ä¸ªè¯­æ³•æè¿°å™¨ä½œä¸ºå‚æ•°å°±å¯ä»¥å®Œæˆäº†.
</p>

<p>
è¯­æ³•æè¿°å™¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å°±æ˜¯è¯­æ³•ç±»çš„æŒ‡ç¤ºå­—ç¬¦,å¦‚æœæœ‰ç¬¬äºŒä¸ªå­—ç¬¦,é‚£ä¹ˆå°±æ˜¯å‰è€…çš„åŒ¹é…å­—ç¬¦(<code>matching character</code>),æ¯”å¦‚åœ¨ <code>Lisp</code> é‡Œé¢ <code>(</code> çš„åŒ¹é…å­—ç¬¦å°±æ˜¯ <code>)</code>,ç©ºæ ¼æ²¡æœ‰åŒ¹é…å­—ç¬¦.ç„¶åå‰©ä¸‹çš„å­—ç¬¦å°±æ˜¯é¢å¤–çš„è¯­æ³•å±æ€§(<code>syntax properties</code>)äº†,å¯ä»¥çœ‹ <code>M-: (info "(elisp)Syntax Flags")</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #CC9393;">"&lt;DESIGNATOR-CHAR&gt;&lt;MATCHING-CHAR&gt;&lt;PROPERTIE-CHARS&gt;"</span>
</pre>
</div>

<p>
æœ€ç®€å•çš„è¯­æ³•æè¿°ç¬¦å°±æ˜¯åªæœ‰ä¸€ä¸ªæŒ‡ç¤ºå­—ç¬¦.å†ä¸¾ä¸€äº›ä¾‹å­,
</p>

<p>
<code>C mode</code> é‡Œé¢çš„ <code>*</code> çš„è¯­æ³•æè¿°å™¨æ˜¯ <code>. 23</code>,ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ <code>punctuation</code> (å¯ä»¥æŸ¥çœ‹ä¸Šé¢çš„ <code>Syntax Class Table</code> å¾—çŸ¥ï¼‰, ä¸­é—´çš„ <code>&lt;MATCHING-CHAR&gt;</code> æ²¡æœ‰è¢«ä½¿ç”¨,ç¬¬3å’Œç¬¬4å­—ç¬¦:2å’Œ3,å…·ä½“æ„ä¹‰å¯ä»¥é€šè¿‡ä¸Šé¢çš„ <code>Syntax Flags</code> æŸ¥çœ‹.
</p>
</div>
</div>



<div id="outline-container-orga85b806" class="outline-4">
<h4 id="orga85b806">è¯­æ³•è¡¨å‡½æ•° (Syntax Table Functions)</h4>
<div class="outline-text-4" id="text-orga85b806">
<p>
ä¸€äº›å…³äºåˆ›å»º,è®¿é—®å’Œä¿®æ”¹è¯­æ³•è¡¨çš„å‡½æ•°.
</p>
</div>
</div>


<div id="outline-container-orgd261fc0" class="outline-4">
<h4 id="orgd261fc0">è¯­æ³•å±æ€§ (Syntax Properties)</h4>
<div class="outline-text-4" id="text-orgd261fc0">
<p>
å½“è¯­æ³•è¡¨ä¸è¶³å¤Ÿçµæ´»æ¥æŒ‡å®šä¸€é—¨è¯­è¨€çš„è¯­æ³•,å¯ä»¥ä¸ºç¼“å†²åŒºä¸Šçš„ç‰¹å®šå­—ç¬¦è€Œè¦†ç›–è¯­æ³•è¡¨,é€šè¿‡åº”ç”¨ <code>syntax-table</code> æ–‡æœ¬å±æ€§æ¥å®Œæˆ,è¯¥å±æ€§çš„åˆæ³•å€¼æ˜¯ä»¥ä¸‹å…¶ä¸­ä¹‹ä¸€:
</p>

<ul class="org-ul">
<li><p>
<code>SYNTAX-TABLE</code>
</p>

<p>
å¦‚æœå±æ€§çš„å€¼æ˜¯ä¸ªè¯­æ³•è¡¨,ç¼“å†²åŒºå°±ä¼šä½¿ç”¨è¯¥è¡¨,è€Œä¸æ˜¯å½“å‰ç¼“å†²åŒºæ­£åœ¨ä½¿ç”¨çš„ <code>mode</code> çš„è¯­æ³•è¡¨.
</p></li>

<li><p>
<code>(SYNTAX-CODE . MATCHING-CHAR)</code>
</p>

<p>
æ˜¯ (<code>raw syntax descriptor</code>) <code>raw</code> å½¢å¼çš„è¯­æ³•æè¿°å™¨.
</p></li>

<li><p>
<code>nil</code>
</p>

<p>
æ˜¯ç”¨ç¼“å†²åŒºå½“å‰çš„è¯­æ³•è¡¨,ä¸åšä»»ä½•æ”¹å˜.
</p></li>
</ul>

<p>
å½“ <code>parse-sexp-lookup-properties</code> ä¸º <code>non-nil</code> çš„æ—¶å€™,åƒ <code>forward-sexp</code> è¿™ç§æ‰«ç„å‡½æ•°å°±ä¼šæ³¨æ„æ–‡æœ¬çš„ <code>syntax-table</code> å±æ€§,ç„¶åæ ¹æ®å±æ€§çš„å€¼æ¥å†³å®šæ˜¯å¦æ˜¯ç”¨å¯¹åº”çš„è¯­æ³•è¡¨.
</p>

<p>
å¦åˆ™å°±æ˜¯ç”¨å½“å‰è¯­æ³•è¡¨.
</p>
</div>
</div>


<div id="outline-container-orgbba509a" class="outline-4">
<h4 id="orgbba509a">åŠ¨ä½œå’Œè¯­æ³• (Motion and Syntax)</h4>
<div class="outline-text-4" id="text-orgbba509a">
<p>
èƒ½å¤Ÿåœ¨æœ‰ç€æŒ‡å®šè¯­æ³•ç±»çš„å­—ç¬¦ä¹‹é—´è¿›è¡Œç§»åŠ¨çš„å‡½æ•°. <code>skip-syntax-forward</code> å’Œ <code>skip-syntax-backward</code> å¯ä»¥åˆ†åˆ«å‘å‰å’Œå‘åè·³è¿‡æŒ‡å®šçš„è¯­æ³•ç±»,åœ¨é‡åˆ°ä¸ç¬¦åˆæ¡ä»¶çš„åœ°æ–¹åœä¸‹,å‚æ•°æ˜¯ä¸€ä¸ªè¡¨ç¤ºäº†å¤šä¸ªè¯­æ³•ç±»çš„å­—ç¬¦ä¸² <code>SYNTAXES</code> å’Œä¸€ä¸ªä½ç½®é™åˆ¶ <code>LIMIT</code>,æœ€åè¿”å›ç§»åŠ¨è·ç¦».
</p>

<p>
å¦‚æœ <code>SYNTAXES</code> æ˜¯ä»¥ <code>^</code> å¼€å¤´,é‚£ä¹ˆå°±ä¼šè·³è¿‡æ²¡æœ‰å‡ºç°åœ¨ <code>SYNTAXES</code> é‡Œé¢çš„æƒ…å†µ.
</p>

<p>
<code>backward-prefix-chars</code> æŠŠç§»åŠ¨ç‚¹ç»è¿‡ä»»æ„æ•°é‡å¸¦æœ‰å‰ç¼€è¯­æ³•(<code>prefix syntax</code>)çš„è¡¨è¾¾å¼,å‰ç¼€è¯­æ³•è¡¨è¾¾å¼å¯ä»¥é€šè¿‡ <code>M-: (info "(elisp)Syntax Flags")</code> æ¥äº†è§£.
</p>
</div>
</div>


<div id="outline-container-orgcf44e82" class="outline-4">
<h4 id="orgcf44e82">è§£æè¡¨è¾¾å¼ (Parsing Expressions)</h4>
<div class="outline-text-4" id="text-orgcf44e82">
<p>
è¿™ç« æ˜¯å…³äºå¦‚ä½•è§£æ(<code>parsing</code>)å’Œ(<code>scanning</code>)å¯¹ç§°çš„è¡¨è¾¾å¼(<code>balanced expressions</code>),æˆ‘ä»¬å«å®ƒä»¬ <code>sexps</code>,è¿™æ˜¯ <code>Lisp</code> çš„æœ¯è¯­,å®é™…ä¸Šè¿™äº›å‡½æ•°è¿˜èƒ½å¯¹ <code>Lisp</code> ä»¥å¤–çš„è¯­è¨€ç”Ÿæ•ˆ.
</p>

<p>
è¯­æ³•è¡¨æ§åˆ¶çš„å­—ç¬¦çš„ç›´è¯‘(<code>interpretation</code>),è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåŒä¸€ä¸ªå­—ç¬¦åœ¨ä¸åŒ <code>mode</code> ä¸‹æœ‰ä¸åŒä½œç”¨çš„åŸå› .è€Œä¸€ä¸ªå­—ç¬¦çš„è¯­æ³•æ§åˆ¶ç€å®ƒå¦‚ä½•æ”¹å˜ <code>parser</code> çš„çŠ¶æ€,è€Œä¸æ˜¯æè¿°å®ƒè‡ªèº«çš„çŠ¶æ€.
</p>

<p>
æ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†éš”ç¬¦(<code>string delimiter character</code>)å°±è®© <code>parser</code> åœ¨å¤„äºå­—ç¬¦ä¸²ä¸­(<code>in-string</code>)å’Œå¤„äºä»£ç ä¸­(<code>in-code</code>)ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´åˆ‡æ¢,
</p>

<p>
ä½†æ˜¯å­—ç¬¦çš„è¯­æ³•ä¸èƒ½ç›´æ¥è¯´æ˜å­—ç¬¦æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²é‡Œé¢,æ¯”å¦‚: <code>(put-text-property 1 9 'syntax-table '(15 . nil))</code>,æ ¹æ® <code>M-: (info "(elisp)Syntax Table Internals")</code> å¯ä»¥çœ‹åˆ° <code>15</code> æ˜¯å­—ç¬¦ä¸²åˆ†éš”ç¬¦çš„ä»£å·,
</p>

<p>
è¿™æ˜¯å‘Šè¯‰ <code>Emacs</code> å½“å‰ç¼“å†²åŒºçš„å‰8ä¸ªå­—ç¬¦éƒ½æ˜¯å­—ç¬¦ä¸²åˆ†éš”ç¬¦,è€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,è€Œç»“æœå°±æ˜¯ <code>Emacs</code> ä¼šæŠŠè¿™ä¸ª <code>8</code> ä¸ªå­—ç¬¦çœ‹ä½œ4ä¸ªè¿ç»­çš„å­—ç¬¦ä¸²å¸¸é‡(å› ä¸ºä¸åŒçš„å˜æ¢çŠ¶æ€,æ‰€ä»¥æ˜¯4ä¸ª).
</p>
</div>

<ul class="org-ul">
<li><a id="orgd53b6c5"></a>æ ¹æ®è§£æç§»åŠ¨ (Motion via Parsing)<br>
<div class="outline-text-5" id="text-orgd53b6c5">
<p>
æ ¹æ®è§£æç»“æœç§»åŠ¨çš„ç›¸å…³ <code>API</code>.
</p>
</div>
</li>


<li><a id="org79ac42b"></a>ä½ç½®è§£æ (Position Parse)<br>
<div class="outline-text-5" id="text-org79ac42b">
<p>
æ ¹æ®ç¼“å†²åŒºä½ç½®æ¥è®¡ç®—å‡ºè¯­æ³•çŠ¶æ€,ç”¨äºè¯­æ³•åˆ†æ(<code>syntactic analysis</code>),æ¯”å¦‚ç¼©è¿›ä¿¡æ¯è¿™ç§æœ‰ç”¨çš„ä¿¡æ¯.
</p>
</div>
</li>


<li><a id="org88ba125"></a>Parserçš„çŠ¶æ€ (Parser State)<br>
<div class="outline-text-5" id="text-org88ba125">
<p>
<code>Parser</code> çŠ¶æ€æ˜¯ä¸€ä¸ªè£…ç€11ä¸ªå…ƒç´ çš„åˆ—è¡¨,æè¿°äº†è¯­æ³• <code>parser</code> çš„çŠ¶æ€,åƒ <code>syntax-ppss</code> è¿™ç§å‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ª <code>parser</code> çŠ¶æ€ä½œä¸ºè¿”å›å€¼.
</p>

<p>
<code>Parser</code> çŠ¶æ€çš„å…ƒç´ åˆ†åˆ«æœ‰ä»¥ä¸‹å«æ„:
</p>

<ul class="org-ul">
<li>ç¬¬ä¸€ä¸ªå…ƒç´ : æ‹¬å·çš„æ·±åº¦,ä»0å¼€å§‹è®¡ç®—,å¦‚æœé—­åˆæ‹¬å· <code>)</code> æ¯” å¼€æ‹¬å· <code>(</code> è¿˜è¦å¤š,é‚£ä¹ˆè¯¥å…ƒç´ å°±æ˜¯ä¸€ä¸ªè´Ÿæ•´æ•°.</li>
<li>ç¬¬äºŒä¸ªå…ƒç´ : æœ€å†…å±‚çš„æ‹¬å·åˆ†ç»„çš„å¼€å§‹å­—ç¬¦çš„ä½ç½®,å¦‚æœæ²¡æœ‰æœ€å†…å±‚è¡¨è¾¾å¼å°±è¿”å› <code>nil</code>,æ¯”å¦‚ <code>(a b c))</code>,è§£æè¡¨è¾¾å¼å†…ä»»æ„ä¸€ä¸ªä½ç½®å°±æ˜¯å¼€æ‹¬å· <code>(</code> çš„ä½ç½®.</li>
<li>ç¬¬ä¸‰ä¸ªå…ƒç´ : ä¸Šä¸€ä¸ªå®Œå…¨å­è¡¨è¾¾å¼(<code>complete subexpression</code>)çš„ç»“æŸå¤„å¼€å§‹çš„å­—ç¬¦ä½ç½®,å¦åˆ™ä¸º <code>nil</code>, æ¯”å¦‚ <code>(a b c)</code>,å¦‚æœç‚¹åœ¨ <code>a</code> çš„åé¢,é‚£ä¹ˆè¯¥å…ƒç´ å°±æ˜¯ <code>a</code> çš„ä½ç½®,å¦‚æœç‚¹åœ¨ <code>a</code> ä¸Š,é‚£ä¹ˆå°±æ˜¯ <code>nil</code>.</li>
<li>ç¬¬å››ä¸ªå…ƒç´ : å¦‚æœä½ç½®åœ¨å­—ç¬¦ä¸²ä¸Šå°±è¿”å›è¯¥å­—ç¬¦ä¸²çš„ç»“å°¾å­—ç¬¦,æˆ–è€…å¦‚æœç»“å°¾çš„æ˜¯é€šç”¨åˆ†éš”ç¬¦,é‚£ä¹ˆå°±è¿”å› <code>t</code>.æ¯”å¦‚ä½ç½®å¤„äº <code>"abc"</code> ä¸­,è¿”å›å°±æ˜¯ <code>34</code> (<code>"</code>).</li>
<li>ç¬¬äº”ä¸ªå…ƒç´ : <code>t</code> è¡¨ç¤ºä½ç½®å¤„äºä¸å¯åµŒå¥—çš„æ³¨é‡Šä¸­,å¦åˆ™å°±æ˜¯ <code>nil</code>.</li>
<li>ç¬¬å…­ä¸ªå…ƒç´ : å¦‚æœç«¯ç‚¹(<code>end point</code>)è·Ÿåœ¨ä¸€ä¸ªå¼•ç”¨å­—ç¬¦åé¢(æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šä»€ä¹ˆæ˜¯å¼•ç”¨å­—ç¬¦),é‚£ä¹ˆå®ƒå°±æ˜¯ <code>t</code>.</li>
<li>ç¬¬ä¸ƒä¸ªå…ƒç´ : æ‰«ç„æ—¶å€™é‡åˆ°çš„æœ€å°æ‹¬å·æ·±åº¦(éš¾é“ä¸åº”è¯¥éƒ½æ˜¯0å—).</li>
<li>ç¬¬å…«ä¸ªå…ƒç´ : å½“å‰ä½ç½®çš„æ³¨é‡Šé£æ ¼.</li>
<li>ç¬¬ä¹ä¸ªå…ƒç´ : ä½†ä½ç½®å¤„äºå­—ç¬¦ä¸²æˆ–è€…æ³¨é‡Šä¹‹ä¸­,è¯¥å€¼å°±æ˜¯å¼€å§‹çš„ä½ç½®.</li>
<li>ç¬¬åä¸ªå…ƒç´ : å½“å‰ä½ç½®ä»é‡Œåˆ°å¤–æ‰€æœ‰å¼€æ‹¬å·çš„ä½ç½®.</li>
<li>ç¬¬åä¸€ä¸ªå…ƒç´ : å¦‚æœä¸Šä¸€ä¸ªè¢«æ‰«ç„åˆ°çš„ç¼“å†²åŒºä½ç½®æ˜¯åŒå­—ç¬¦ç»“æ„(æ¯”å¦‚æ³¨é‡Šåˆ†éš”ç¬¦æˆ–è€…è½¬ä¹‰å’Œå­—ç¬¦å¼•ç”¨ç¬¦å·å¯¹)çš„ç¬¬ä¸€ä¸ªå­—ç¬¦,é‚£ä¹ˆå°±æ˜¯è¯¥ä½ç½®ä¸Šçš„ <code>syntax code</code>,å¦åˆ™ä¸º <code>nil</code>.</li>
</ul>
</div>
</li>


<li><a id="orgdb4d2d1"></a>åº•å±‚è§£æ (Low-Level Parsing)<br>
<div class="outline-text-5" id="text-orgdb4d2d1">
<p>
ä½¿ç”¨è¡¨è¾¾å¼è§£æå™¨(parser)çš„æœ€åŸºæœ¬æ–¹æ³•å°±æ˜¯æŒ‡å®šå¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ä¹‹é—´çš„èŒƒå›´è¿›è¡Œè§£æ: <code>parse-partial-sexp</code>.
</p>
</div>
</li>


<li><a id="org24d6667"></a>æ§åˆ¶è§£æ (Control Parsing)<br>
<div class="outline-text-5" id="text-org24d6667">
<p>
ä¸€äº›æ§åˆ¶è§£æçš„å‚æ•°.
</p>
</div>
</li>
</ul>
</div>



<div id="outline-container-org9f073ae" class="outline-4">
<h4 id="org9f073ae">è¯­æ³•è¡¨å†…éƒ¨å®ç° (Syntax Table Internals)</h4>
<div class="outline-text-4" id="text-org9f073ae">
<p>
è¯­æ³•è¡¨å°±æ˜¯ç”±å­—ç¬¦è¡¨å®ç°çš„,ä½†æ˜¯å¤§éƒ¨ä»½ <code>Lisp</code> ç¨‹åºä¸ç›´æ¥é€šè¿‡å®ƒçš„å†…éƒ¨å®ç°æ¥å·¥ä½œ,è¯­æ³•è¡¨å¹¶ä¸æ˜¯ä»¥è¯­æ³•æè¿°ç¬¦çš„å½¢å¼å‚¨å­˜è¯­æ³•æ•°æ®(syntax data).
</p>

<p>
è¯­æ³•è¡¨çš„æ¯ä¸ªæ¡ç›®éƒ½æ˜¯ä¸€ä¸ªç”Ÿè¯­æ³•æè¿°ç¬¦ (<code>raw syntax descriptor</code>): <code>(SYNTAX-CODE . MATCHING-CHAR)</code>.
</p>

<p>
<code>SYNTAX-CODE</code> æ˜¯ä¸€ä¸ªæ•´æ•°,ç¼–ç äº†è¯­æ³•ç±»å’Œè¯­æ³• <code>flags</code>, <code>MATCHING-CHAR</code> å°±æ˜¯åŒ¹é…å­—ç¬¦(å¦‚æœæœ‰çš„è¯).
</p>

<p>
æ€»ä½“ä¸Šæ¥çœ‹è·Ÿè¯­æ³•æè¿°ç¬¦å·®ä¸å¤š.
</p>

<p>
ä½¿ç”¨ <code>aref</code> è·å–ä¸€ä¸ªå­—ç¬¦çš„ç”Ÿè¯­æ³•æè¿°ç¬¦: <code>(aref (syntax-table) CHAR)</code>. åˆ†åˆ«åœ¨ <code>Lisp Interaction mode</code> ä¸­å’Œ <code>C mode</code> ä¸­çš„ <code>*</code> ,
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">in Lisp Interaction mode</span>
(lisp-interaction-mode)
(aref (syntax-table) ?\*) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (3)</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">in C mode</span>
(c-mode)
(aref (syntax-table) ?\*) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (393217)</span>

</pre>
</div>

<p>
åˆ†åˆ«æ˜¯ <code>3</code> å’Œ <code>393217</code>,å¦‚æœæƒ³æ ¹æ® <code>SYNTAX CODE</code> è·å–å‡ºè¯­æ³•ç±»,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>syntax-class</code>:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(syntax-class '(3)) <span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">= &gt; 3</span>
(syntax-class '(393217)) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; 1, 393217 = 1 + (ash 17) + (ash 18), syntax descriptor: ". 23"</span>
</pre>
</div>

<p>
<code>Syntax flag</code> è¢«ç¼–ç åœ¨é«˜é˜¶ä½ä¸Š(<code>higher order bits</code>),ä»æœ€å°çš„å…³é”®ä½(æ°¸è¿œæ˜¯ç¬¬0ä½)ä¹‹åçš„16ä½(bits)æˆ–16ä½ä»¥ä¸Šè¿›è¡Œå‚¨å­˜,æ¯”å¦‚ä¸Šé¢ <code>C mode</code> çš„ <code>*</code>,å®ƒçš„ <code>SYNTAX-CODE</code> åº”è¯¥æ˜¯è¿™æ ·çš„,
</p>

<p>
<code>110 0000 0000 0000 0001</code>
</p>

<p>
æ ¹æ®å®ƒçš„è¯­æ³•æè¿°ç¬¦ <code>". 23"</code> ,å¯ä»¥æ¨ç†åˆ°å®ƒçš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹,å…¶ä¸­ <code>23</code> æ˜¯ <code>SYNTAX FLAGS</code>:
</p>

<ol class="org-ol">
<li>æŒ‡ç¤ºå™¨å­—ç¬¦ <code>.</code> è¡¨ç¤ºçš„è¯­æ³•ç±» <code>punctuation</code>,å¯¹åº”çš„ä»£ç ä¸º <code>1</code> (æ–‡æ¡£æœ‰è¯­æ³•ç±»å¯¹åº”çš„ä»£ç è¡¨).</li>
<li>ç¬¬ä¸€ä¸ª <code>FLAG</code> ä¸º2,æ ¹æ® <code>prefix</code> å¯¹åº” <code>flag</code> çš„è¡¨å¯ä»¥çœ‹å‡º,è¦ä»ç¬¬0ä½å¼€å§‹å¾€å·¦ç§»åŠ¨ <code>17</code> ä½, <code>(ash 1 17)</code>.</li>
<li>ç¬¬äºŒä¸ª <code>FLAG</code> ä¸º3,åŒä¸Š,å·¦ç§»åŠ¨ <code>18</code> ä½, <code>(ash 1 18)</code>.</li>
<li>ç»¼åˆæ‰€å¾— <code>(+ 1 (ash 1 17) (ash 1 18))</code>,ç­‰äº393217.</li>
</ol>

<p>
å…¶å® <code>Emacs Lisp</code> å·²ç»æä¾›äº† <code>string-to-syntax</code> å¸®åŠ©æˆ‘ä»¬è®¡ç®—å‡ºè¯­æ³•æè¿°ç¬¦çš„ <code>SYNTAX CODE</code>.
</p>
</div>
</div>


<div id="outline-container-org624dce1" class="outline-4">
<h4 id="org624dce1">åˆ†ç±» (Categories)</h4>
<div class="outline-text-4" id="text-org624dce1">
<p>
<code>Emacs Lisp</code> æä¾›äº†åˆ«çš„æ–¹æ³•ç»™å­—ç¬¦åˆ†ç±»: æ ¹æ®éœ€è¦æ¥å®šä¹‰ä¸åŒåˆ†ç±»,ç„¶åç‹¬ç«‹åœ°æŠŠå­—ç¬¦åˆ†é…åˆ°ä¸€åˆ°å¤šä¸ªåˆ†ç±»ä¸­.
</p>

<p>
æ¯ä¸ªç¼“å†²åŒºéƒ½æœ‰ä¸€ä¸ªåˆ†ç±»è¡¨(<code>category table</code>),è®°å½•äº†å®šä¹‰å“ªäº›åˆ†ç±»ä»¥åŠå“ªäº›å­—ç¬¦å±äºå“ªäº›åˆ†ç±».
</p>

<p>
æ¯ä¸ªåˆ†ç±»è¡¨å®šä¹‰äº†è‡ªå·±çš„åˆ†ç±»,å®é™…ä¸Šå®ƒä»¬å¤§éƒ¨ä»½éƒ½å¤åˆ¶æ ‡å‡†åˆ†ç±»è¡¨(<code>standard categories table</code>)æ¥çš„.
</p>

<p>
å…·ä½“ <code>API</code> çœ‹æ–‡æ¡£.
</p>
</div>
</div>
</div>


<div id="outline-container-orga417383" class="outline-3">
<h3 id="orga417383">çº¿ç¨‹ (Threads)</h3>
<div class="outline-text-3" id="text-orga417383">
<p>
ä»¥å‰çš„è®¡ç®—æœºçš„ <code>CPU</code> éƒ½åªæœ‰ä¸€ä¸ªæ ¸å¿ƒ,ä¹Ÿå°±æ˜¯ä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡,
</p>

<p>
ä¸ºäº†è®©è®¡ç®—æœº <b>çœ‹ä¸Šå»</b> èƒ½å¤Ÿåƒå¿è€…é‚£æ ·(é€šè¿‡é«˜é€Ÿç§»åŠ¨)åˆ†èº«åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡,å‡è®¾æœ‰ <code>A, B, C</code> ä¸‰ä¸ªä»»åŠ¡,
</p>

<p>
äººä»¬æƒ³åˆ°äº†è®© <code>CPU</code> åœ¨ä¸€æ®µæ—¶é—´å†…æ‰§è¡Œä»»åŠ¡ <code>A</code>,è¿™ä¸ªæ—¶é—´éå¸¸çŸ­,æ—¶é—´ç»“æŸåè®°å½•ä¸‹ä»»åŠ¡ <code>A</code> çš„è¿›åº¦,
</p>

<p>
ç„¶å <code>CPU</code> å»æ‰§è¡Œä»»åŠ¡ <code>B</code>,æ‰§è¡Œä¸€æ®µæ—¶é—´ååŒæ ·è®°å½•ä¸‹ä»»åŠ¡ <code>B</code> çš„è¿›åº¦,
</p>

<p>
æ¥ç€ <code>CPU</code> å»æ‰§è¡Œä»»åŠ¡ <code>C</code> ,ç»è¿‡ä¸€è½®åˆ‡æ¢åˆå›åˆ° <code>A</code> è¿™ä¸ªæœªå®Œæˆçš„ä»»åŠ¡ä¸Š,
</p>

<p>
å‡å¦‚ <code>A</code> åœ¨ä¸Šä¸€è½®ä¸­å·²ç»å®Œæˆäº†,é‚£ä¹ˆä»è¿™ä¸€è½®å¼€å§‹å†ä¹Ÿä¸ä¼šåˆ‡æ¢åˆ° <code>A</code> è€Œæ˜¯ä¸‹ä¸€ä¸ªæœªå®Œæˆçš„ä»»åŠ¡çš„æ‰§è¡Œä¸Šäº†;
</p>

<p>
å¦‚æœå…¶ä¸­ä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§æ¯”è¾ƒé«˜,å¯ä»¥åœ¨ä¸éœ€è¦ç­‰åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½åˆ‡æ¢ä¸€è½®åœ°æƒ…å†µä¸‹æ›´é¢‘ç¹åœ°åˆ‡æ¢åˆ°å®ƒçš„æ‰§è¡Œä¸Š,
</p>

<p>
å¦‚æ­¤ç±»æ¨ä¸€ç›´æŒç»­ç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆ.
</p>

<p>
è¯·åŠ¡å¿…ç†è§£è¿™ç§ <b>CPUé€ä¸ªæ‰§è¡Œä¸åŒä»»åŠ¡çš„"åˆ‡ç‰‡"</b> çš„æ–¹å¼, è¿™ä¸ªæ¦‚å¿µä»¥åä¼šåœ¨åç¨‹(coroutine),è¿›ç¨‹(process)ä»¥åŠå¼‚æ­¥ç¼–ç¨‹ä¸­å‡ºç°.
</p>

<p>
<br>
</p>

<p>
ä»»åŠ¡çš„è°ƒåº¦æ–¹å¼æœ‰ä¸¤ç§: åä½œå¼(cooperative or non-preemetive)ä»¥åŠæŠ¢å å¼(preemetive).
</p>

<p>
ç¬¬ä¸€ç§å°±æ˜¯åœ¨å®šä¹‰ä»»åŠ¡æ—¶åˆ¶å®šå¥½è®¡åˆ’è¿›åº¦:æ‰§è¡Œåˆ°ä»€ä¹ˆæ—¶å€™ä¸ºä¸€ä¸ªé˜¶æ®µ,ä»€ä¹ˆæ—¶å€™ä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µ,åœ¨æ‰§è¡Œæ—¶æŒ‰ç…§è®¡åˆ’è¿›åº¦æ¥æ‰§è¡Œ,
</p>

<p>
æ¯å½“æ‰§è¡Œå®Œä»»åŠ¡çš„ä¸€ä¸ªé˜¶æ®µæ—¶å°±æš‚åœä¸‹æ¥æŠŠ <code>CPU</code> è®©å‡ºå»æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡,å¦‚æ­¤ç±»æ¨,ç›´åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆ, <b>ä»»åŠ¡ä¹‹é—´çš„è°ƒåº¦ç”±ä»»åŠ¡è‡ªèº«å†³å®š</b>,
</p>

<p>
å› ä¸ºæ²¡æœ‰è§„å®šä»»åŠ¡çš„æ¯ä¸ªé˜¶æ®µéœ€è¦å¤šå°‘æ—¶é—´,æ‰€ä»¥æ¯æ¬¡åˆ‡æ¢ä»»åŠ¡çš„æ—¶é—´éƒ½ä¸ä¸€æ ·,å¦‚æœæŸä¸ªä»»åŠ¡æ˜¯ <b>æ„å¤–</b> æ°¸ä¹…å æ®äº† <code>CPU</code>,
</p>

<p>
é‚£ä¹ˆå…¶å®ƒä»»åŠ¡å°±ä¸€ç›´å¤„äºç­‰å¾… <code>CPU</code> çš„çŠ¶æ€;è¿™ç§è°ƒåº¦æ–¹å¼ä¹Ÿæ˜¯æœ‰ä¼˜ç‚¹çš„,åœ¨åªæœ‰ä¸€ä¸ªæ ¸å¿ƒå¤„ç†ä»»åŠ¡å¹¶ä¸”æ²¡æœ‰è®¤ä¸ºå¹²æ¶‰çš„æƒ…å†µä¸‹,
</p>

<p>
è¿™äº›ä»»åŠ¡æ¯æ¬¡éƒ½æ˜¯ä»¥åŒæ ·çš„é¡ºåºæ‰§è¡Œ,åœ¨å¤šæ ¸å¤„ç†ä¸‹å°±æ²¡æœ‰è¿™ä¸ªä¼˜åŠ¿äº†;
</p>

<p>
ç¬¬äºŒç§åˆ™æ˜¯ <b>ç”±æ“ä½œç³»ç»Ÿå¯¹ä»»åŠ¡è¿›è¡Œè°ƒåº¦</b>,æ“ä½œç³»ç»Ÿå†³å®šä»»åŠ¡æ‰§è¡Œå¤šä¹…æ‰è®©å‡º <code>CPU</code>,æ¯ä¸ªä»»åŠ¡çš„åˆ‡æ¢æ—¶é—´æ˜¯ä¸€æ ·çš„,
</p>

<p>
ä¸€æ—¦æ—¶é—´åˆ°äº†å°±ä¼šè®°å½•ä¸‹å½“å‰æ‰§è¡Œä¸­ä»»åŠ¡çš„è¿›åº¦,å¹¶å¼ºè¿«å®ƒæŠŠ <code>CPU</code> è®©å‡ºå»æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡,è¿™æ ·å°±æ²¡æœ‰ç¬¬ä¸€ç§è°ƒåº¦æ–¹å¼çš„å¼Šç«¯äº†,
</p>

<p>
ä½†ä¹Ÿæ˜¯å› ä¸ºæ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œæ§åˆ¶è°ƒåº¦,ä¸ç®¡æ˜¯ä¸€ä¸ªæ ¸å¿ƒè¿˜æ˜¯å¤šä¸ªæ ¸å¿ƒå¤„ç†è¿™äº›ä»»åŠ¡,å®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸å¯é¢„æµ‹çš„,
</p>

<p>
æ‰€ä»¥è¡ç”Ÿå‡ºäº†å¦‚ä½•ç¡®ä¿å¤šä»»åŠ¡æ‰§è¡Œé¡ºåºçš„é—®é¢˜.
</p>

<p>
è¿™ä¸¤ç§è°ƒåº¦æ–¹å¼ä¸­,æŠ¢å å¼æ˜¯æ¯”è¾ƒä¸»æµçš„.
</p>

<p>
<br>
</p>

<p>
ä¸€ä¸ªçº¿ç¨‹çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªä»»åŠ¡, <code>CPU</code> çš„ä¸€ä¸ªæ ¸å¿ƒåŒä¸€æ—¶é—´åªèƒ½è·‘ä¸€ä¸ªè¿›ç¨‹(process),è€Œä¸€ä¸ªè¿›ç¨‹æ”¯æŒå¤šä¸ªçº¿ç¨‹,
</p>

<p>
å› æ­¤åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹ä»¬å ç”¨åŒä¸€å—å†…å­˜åŒºåŸŸ,ä¹Ÿå°±æ˜¯è¿›ç¨‹å ç”¨çš„åŒºåŸŸ,çº¿ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡è®¿é—®/ä¿®æ”¹åŒä¸€ä¸ªå†…å­˜åœ°å€å®ç° <b>äº¤æµ/é€šä¿¡</b>,
</p>

<p>
é€šä¿¡å¿…ç„¶éœ€è¦è€ƒè™‘ä¸€ä¸ª <b>å…ˆå</b> é—®é¢˜,å°±åƒä¸¤ä¸ªäººèŠå¤©ä¸€æ ·,ç¬¬ä¸€ä¸ªäººå…ˆè¯´è¯,å¦å¤–ä¸€ä¸ªäººå¬å®Œåå›åº”,ç¬¬ä¸€ä¸ªäººå¬å®Œå›åº”åä¹Ÿä½œå‡ºè‡ªå·±çš„å›åº”,
</p>

<p>
å¦‚æ­¤å¾ªç¯,ç›´åˆ°ä¸¤äººèŠå¤©ç»“æŸ.
</p>

<p>
å°±æ‹¿ä¸€ä¸ªå‡è®¾çš„ä¾‹å­æ¥çœ‹: ç°æœ‰ä¸¤ä¸ªçº¿ç¨‹,å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ \(A\) ä¿®æ”¹æŸä¸ªå†…å­˜åœ°å€,å¦å¤–ä¸€ä¸ªçº¿ç¨‹ \(B\) è®¿é—®è¿™ä¸ªå†…å­˜åœ°å€æ¥è·å¾—ä¿®æ”¹åçš„å€¼.
</p>

<p>
ä½†å› ä¸ºæ˜¯æŠ¢å å¼è°ƒåº¦,å®¹æ˜“å‡ºç°è¿™ç§æƒ…å†µ: çº¿ç¨‹ \(A\) åœ¨æ‰§è¡Œä¿®æ”¹åˆ°ä¸€åŠæ—¶è¢«å¼ºè¿«è®©å‡º <code>CPU</code>,è¿™æ ·æ²¡æ³•ç¡®å®šçº¿ç¨‹ \(A\) æ˜¯å¦åœ¨è®©å‡º <code>CPU</code> å‰ä¿®æ”¹åˆ°äº†å†…å­˜,
</p>

<p>
å› æ­¤çº¿ç¨‹ \(B\) è·å–åˆ°çš„å€¼ <b>å¯èƒ½</b> æ˜¯æœªä¿®æ”¹çš„,ç»“æœæ˜¯ä¸ç¡®å®šçš„.
</p>

<p>
ä¸ºæ­¤å¿…é¡»è¦ç¡®ä¿çº¿ç¨‹ä»¬çš„æ‰§è¡Œé¡ºåºèƒ½å¤Ÿæ­£ç¡®å®Œæˆä»»åŠ¡,ä»è€Œé¿å…ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„çº¿ç¨‹åŒæ—¶è®¿é—®/ä¿®æ”¹åŒä¸€ä¸ªå†…å­˜åœ°å€çš„æƒ…å†µ,è¿™æœ‰ä¸€ä¸ªå«æ³•: ä¿è¯ <b>çº¿ç¨‹åŒæ­¥</b>.
</p>

<p>
<br>
</p>

<p>
<code>Emacs Lisp</code> æä¾›æœ‰é™çš„å¹¶å‘æœºåˆ¶-çº¿ç¨‹çš„æ”¯æŒ,å®ƒçš„çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä¸Šæ˜¯åä½œå¼(mostly cooperative, or non-preemetive)çº¿ç¨‹æ¨¡å‹,
</p>

<p>
ç„¶è€Œ, <code>Emacs</code> çš„çº¿ç¨‹æ”¯æŒå·²ç»è¢«è®¾è®¡æˆæ–¹ä¾¿ä»¥åæ”¯æŒæ›´åŠ ç»†ç²’åº¦(fine-grained)çš„å¹¶å‘,è®©ç¨‹åºä¸å†ä¾èµ–åä½œå¼çº¿ç¨‹.
</p>

<p>
åœ¨è°ƒç”¨ <code>thread-yield</code> å‘é€è¯·æ±‚æ—¶,æˆ–è€…åœ¨ç­‰å¾…é”®ç›˜è¾“å…¥/å¼‚æ­¥è¿›ç¨‹çš„è¾“å‡ºæ—¶,åˆæˆ–è€…æ˜¯ä¸çº¿ç¨‹ç›¸å…³çš„é˜»å¡æ“ä½œæ—¶(æ¯”å¦‚ <code>mutex locking</code> æˆ–è€… <code>thread-join</code>),çº¿ç¨‹åˆ‡æ¢ä¼šå‡ºç°.
</p>

<p>
<code>Emacs Lisp</code> æä¾›åŸæ“ä½œæ¥åˆ›å»ºä»¥åŠæ§åˆ¶çº¿ç¨‹,åŒæ—¶ä¹Ÿæä¾›åˆ›å»ºå’Œæ§åˆ¶äº’æ–¥é”(<code>mutexes</code>)å’Œæ¡ä»¶å˜é‡(<code>condition variables</code>)ç”¨äºçº¿ç¨‹åŒæ­¥.
</p>

<p>
å…¨å±€å˜é‡è¢«æ‰€æœ‰ <code>Emacs Lisp</code> çº¿ç¨‹å…±äº«,è€Œå±€éƒ¨å˜é‡ä¸æ˜¯,ä¸€ä¸ªåŠ¨æ€çš„ <code>let</code> ç»‘å®šæ˜¯å±€éƒ¨çš„.
</p>

<p>
æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å½“å‰ç¼“å†²åŒºä»¥åŠåŒ¹é…æ•°æ®(<code>match data</code>).
</p>

<p>
æ³¨æ„, <code>let</code> ç»‘å®šåœ¨ <code>Emacs Lisp</code> çš„å®ç°ä¸­æ˜¯è¢«ç‰¹åˆ«å¯¹å¾…çš„,æ²¡æœ‰ä»»ä½•æ–¹æ³•å¯ä¹Ÿå¤åˆ¶ <code>let</code> çš„ <code>unwinding</code> ä»¥åŠ <code>rewinding</code> è¡Œä¸º.
</p>

<p>
æ‰€ä»¥,å³ä½¿ç”¨ <code>unwind-protect</code> æ‰‹åŠ¨ <code>let</code> ä¹Ÿä¸èƒ½è®©ä¸€ä¸ªå˜é‡å˜æˆçº¿ç¨‹ç‰¹å®š(<code>thread-specific</code>).
</p>

<p>
åœ¨è¯æ³•ç»‘å®šçš„æƒ…å†µä¸­,é—­åŒ…å’Œå…¶å®ƒ <code>Lisp</code> å¯¹è±¡ä¸€æ ·,é—­åŒ…ä¸­çš„ç»‘å®šæ˜¯è¢«æ¿€æ´»è¯¥é—­åŒ…çš„çº¿ç¨‹å…±äº«çš„.
</p>
</div>

<div id="outline-container-org52a9f76" class="outline-4">
<h4 id="org52a9f76">åŸºç¡€çš„çº¿ç¨‹å‡½æ•° (Basic Thread Functions)</h4>
<div class="outline-text-4" id="text-org52a9f76">
<p>
çº¿ç¨‹å¯ä»¥è¢«åˆ›å»ºå’Œç­‰å¾…,ä¸èƒ½è¢«ç›´æ¥ç»“æŸ,ä½†æ˜¯å½“å‰çº¿ç¨‹å¯ä»¥è¢«éšå¼ç»“æŸ,èƒ½å¤Ÿå‘é€ä¿¡å·ç»™å…¶å®ƒçš„çº¿ç¨‹.
</p>

<p>
è™½ç„¶è¯¥å°èŠ‚çš„å‰©ä¸‹å†…å®¹éƒ½æ˜¯ <code>API</code>,ä½†æ˜¯å”¯è¯»è¿™ä¸€å—çš„å†…å®¹æˆ‘å¾ˆæ„Ÿå…´è¶£.
</p>

<ul class="org-ul">
<li><p>
<code>(make-thread FUNCTION &amp;optional NAME)</code>
</p>

<p>
åˆ›å»ºä¸€ä¸ªè°ƒç”¨ <code>FUNCTION</code> çš„çº¿ç¨‹å¹¶ä¸”è¿”å›è¯¥çº¿ç¨‹,åœ¨ <code>FUNCTION</code> è¿”å›çš„æ—¶å€™çº¿ç¨‹å°±ç»“æŸäº†.
</p>

<p>
äº‹å®ä¸Š(<code>in effect</code>),è¢«åˆ›å»ºçš„çº¿ç¨‹æ²¡æœ‰ä»»ä½•å±€éƒ¨ç»‘å®š,æ–°çº¿ç¨‹çš„å½“å‰ç¼“å†²åŒºæ˜¯ä»å½“å‰çš„çº¿ç¨‹ä¸­ç»™ç»§æ‰¿çš„.
</p>

<p>
<code>NAME</code> æ˜¯ç»™çº¿ç¨‹æä¾›ä¸€ä¸ªåå­—,ç›®çš„ç”¨äºè°ƒè¯•ä»¥åŠå‘Šè¯‰å¼€å‘äººå‘˜çš„çº¿ç¨‹ç›®çš„,æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸².
</p></li>

<li><p>
<code>(threadp OBJECT)</code>
</p>

<p>
åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸€ä¸ª <code>Emacs</code> çº¿ç¨‹.
</p></li>

<li><p>
<code>(thread-join THREAD)</code>
</p>

<p>
é˜»å¡(block)ç›´åˆ° <code>THREAD</code> ç»“æŸæˆ–è€…å½“å‰çº¿ç¨‹æ¥æ”¶åˆ°æ¶ˆæ¯.è¿”å› <code>THREAD</code> æ‰§è¡Œå‡½æ•°çš„ç»“æœ.å¦‚æœ <code>THREAD</code> æ—©å·²ç»ç»“æŸå°±ä¼šé©¬ä¸Šè¿”å›.
</p></li>

<li><p>
<code>(thread-signal THREAD ERROR-SYMBOL DATA)</code>
</p>

<p>
ç±»ä¼¼ç”¨äºå¼•å‘å¼‚å¸¸çš„ <code>signal</code>,åŒºåˆ«ä¿¡å·æ˜¯å‘é€ç»™çº¿ç¨‹,è€Œå¤§éƒ¨ä»½ä¿¡å·çš„åŠ¨ä½œéƒ½æ˜¯åœæ­¢æ‰§è¡Œ.
</p>

<p>
å¦‚æœ <code>THREAD</code> æ˜¯å½“å‰çº¿ç¨‹å°±ä¼šç«‹åˆ»è°ƒç”¨ <code>signal</code>,å¦åˆ™ <code>THREAD</code> å°±ä¼šæ¥æ”¶ä¿¡å·å¹¶ä¸”æˆä¸ºå½“å‰çº¿ç¨‹.
</p>

<p>
å¦‚æœ <code>THREAD</code> è¢« <code>mutex-lock, condition-wait æˆ–è€… thread-join</code> é˜»å¡,é‚£ä¹ˆ <code>thread-signal</code> å°±ä¼šå–æ¶ˆå®ƒçš„é˜»å¡ (<code>unblock it</code>).
</p>

<p>
å¦‚æœ <code>THREAD</code> æ˜¯ä¸»çº¿ç¨‹,é‚£ä¹ˆä¿¡å·å°±ä¸ä¼šè¢«ä¼ æ’­åˆ°é‚£é‡Œ,ç›¸åä¼šä½œä¸ºä¸»çº¿ç¨‹çš„æ¶ˆæ¯(<code>message</code>)è¢«æ˜¾ç¤º.
</p>

<p>
å…³äº <code>Emacs</code> æ˜¯å¦‚ä½•å¤„ç†ä¿¡å·çš„,å¯ä»¥å‚è€ƒ <code>M-: (info "(elisp) Processing of Errors")</code>.
</p></li>

<li><p>
<code>(thread-yield)</code>
</p>

<p>
ç»™ä¸‹ä¸€ä¸ªå¯è¿è¡Œçº¿ç¨‹è®©å‡ºæ‰§è¡Œ(Yield execution to next runnable thread).
</p></li>

<li><p>
<code>(thread-name THREAD)</code>
</p>

<p>
è·å–çº¿ç¨‹çš„åå­—,è¿™ä¸ªåå­—æ˜¯åœ¨ <code>make-thread</code> æŒ‡å®šçš„.
</p></li>

<li><p>
<code>(thread-live-p THREAD)</code>
</p>

<p>
åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å­˜æ´».
</p></li>

<li><p>
<code>(thread--blocker THREAD)</code>
</p>

<p>
è¿”å› <code>THREAD</code> æ­£åœ¨ç­‰å¾…(<code>waiting on</code>)çš„å¯¹è±¡.è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯ç”¨äºè°ƒè¯•çš„.
</p>

<p>
å¦‚æœçº¿ç¨‹å› ä¸º <code>thread-join</code> è¢«é˜»å¡,å°±ä¼šè¿”å›ç­‰å¾…çš„çº¿ç¨‹;å¦‚æœæ˜¯å› ä¸º <code>mutex-lock</code> å°±è¿”å› <code>mutex</code>;å¦‚æœæ˜¯å› ä¸º <code>condition-wait</code> å°±è¿”å›æ¡ä»¶å˜é‡.
</p>

<p>
å¦åˆ™,è¿”å› <code>nil</code>.
</p></li>

<li><p>
<code>(current-thread)</code>
</p>

<p>
è¿”å›å½“å‰çš„çº¿ç¨‹.
</p></li>

<li><p>
<code>(all-threads)</code>
</p>

<p>
è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„åˆ—è¡¨.
</p></li>

<li><p>
<code>main-thread</code>
</p>

<p>
å‚¨å­˜äº†ä¸»çº¿ç¨‹çš„å˜é‡,å¦‚æœ <code>Emacs</code> ç¼–è¯‘çš„æ—¶å€™æ²¡æœ‰çº¿ç¨‹æ”¯æŒå°±è¿”å› <code>nil</code>.
</p></li>

<li><p>
<code>(thread-last-error &amp;optional CLEANUP)</code>
</p>

<p>
å½“çº¿ç¨‹æ‰§è¡Œçš„ä»£ç å‘é€äº†ä¸€ä¸ªé”™è¯¯ä¿¡å·å¹¶ä¸”æ²¡è¢«å¤„ç†,é‚£ä¹ˆçº¿ç¨‹ç»“æŸ.å…¶ä»–çº¿ç¨‹å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥è®¿é—®é€ æˆçº¿ç¨‹é”™è¯¯çš„åŸå› .
</p>

<p>
åªè¦æœ‰çº¿ç¨‹å‘ç”Ÿé”™è¯¯,ç»“æœå°±ä¼šè¢«é‡å†™.
</p></li>
</ul>
</div>
</div>


<div id="outline-container-org47c816f" class="outline-4">
<h4 id="org47c816f">äº’æ–¥é” (Mutexes)</h4>
<div class="outline-text-4" id="text-org47c816f">
<p>
åœ¨ä»»ä½•æ—¶å€™æœ‰0åˆ°1ä¸ªçº¿ç¨‹ä¼šæ‹¥æœ‰ä¸€æŠŠäº’æ–¥é”(<code>mutex</code>).å¦‚æœçº¿ç¨‹åœ¨åˆ«çš„çº¿ç¨‹æ—©å·²ç»æ‹¥æœ‰çš„æƒ…å†µä¸‹è¯•å›¾è·å–(acquire)ä¸€ä¸ª <code>mutex</code>,
</p>

<p>
é‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ç›´åˆ° <code>mutex</code> è¢«å…¶å®ƒçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢.
</p>

<p>
<code>Emacs Lisp</code> çš„ <code>mutexes</code> æ˜¯å¯ä»¥é€’å½’çš„,å°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨è‡ªå·±æ—©å·²æ‹¥æœ‰ <code>mutex</code> çš„æƒ…å†µä¸‹å†æ¬¡è·å–ä¸€åˆ°å¤šä¸ª <code>mutexes</code>.
</p>

<p>
<code>Mutex</code> ä¼šè®°å½•è¢«è·å–å¤šå°‘æ¬¡,ç„¶åè·å–æ¬¡æ•°ä¸€å®šè¦ä¸é‡Šæ”¾æ¬¡æ•°åŒ¹é…,æœ€åä¸€æ¬¡çš„é‡Šæ”¾ä¼šæŠŠ <code>mutex</code> è¿˜åŸæˆæœªè¢«æŒæœ‰çš„çŠ¶æ€ (<code>unowned state</code>),
</p>

<p>
å…è®¸å…¶ä»–çº¿ç¨‹è·å–å®ƒ.
</p>

<ul class="org-ul">
<li><p>
<code>(mutexp OBJECT)</code>
</p>

<p>
åˆ¤æ–­æ˜¯å¦ <code>mutex</code>.
</p></li>

<li><p>
<code>(make-mutex &amp;optional name)</code>
</p>

<p>
åˆ›å»ºä¸€ä¸ª <code>mutex</code> å¹¶ä¸”è¿”å›å®ƒ,ç±»ä¼¼çº¿ç¨‹å¯ä»¥æŒ‡å®šåå­—.
</p></li>

<li><p>
<code>(mutex-name MUTEX)</code>
</p>

<p>
è·å– <code>MUTEX</code> çš„åå­—,è¿™ä¸ªåå­—æ˜¯è¢« <code>make-mutex</code> æŒ‡å®š.
</p></li>

<li><p>
<code>(mutex-lock MUTEX)</code>
</p>

<p>
ä¸€ç›´é˜»å¡ç›´åˆ°æœ‰çº¿ç¨‹è·å–äº† <code>MUTEX</code>,åˆæˆ–è€…ç›´åˆ°è¯¥çº¿ç¨‹æ¥æ”¶åˆ°äº† <code>thread-signal</code> å‘é€çš„ä¿¡å·.å¦‚æœè¯¥çº¿ç¨‹æ—©å·²ç»æ‹¥æœ‰ <code>MUTEX</code>,é‚£ä¹ˆå°±ç›´æ¥è¿”å›.
</p></li>

<li><p>
<code>(mutex-unlock MUTEX)</code>
</p>

<p>
é‡Šæ”¾ <code>MUTEX</code>.å¦‚æœè¯¥çº¿ç¨‹æ²¡æœ‰æ‹¥æœ‰ <code>MUTEX</code> å°±ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯(signal an error).
</p></li>

<li><p>
<code>(with-mutex MUTEX BODY...)</code>
</p>

<p>
<code>BODY</code> æ‰§è¡Œçš„æ—¶å€™è‡ªåŠ¨è·å–ä¸€ä¸ª <code>MUTEX</code>,æ‰§è¡Œç»“æŸåè‡ªåŠ¨é‡Šæ”¾,è¿”å›çš„ç»“æœæ˜¯ <code>BODY</code> çš„ç»“æœ.
</p></li>
</ul>
</div>
</div>



<div id="outline-container-orgca53d4c" class="outline-4">
<h4 id="orgca53d4c">æ¡ä»¶å˜é‡ (Condition Variables)</h4>
<div class="outline-text-4" id="text-orgca53d4c">
<p>
æ¡ä»¶å˜é‡æ˜¯çº¿ç¨‹åŒæ­¥çš„ä¸€ç§æ‰‹æ®µ,åœ¨ä¸€äº›äº‹ä»¶å‘ç”Ÿå‰ä¸€ç›´é˜»å¡,çº¿ç¨‹ç­‰åˆ°æ¡ä»¶å˜é‡æ”¶åˆ°å…¶å®ƒçº¿ç¨‹çš„é€šçŸ¥,ç„¶åç»§ç»­æ‰§è¡Œ.æ¡ä»¶å˜é‡éœ€è¦ç»“åˆ <code>mutex</code> ä»¥åŠä¸€äº›æ¡ä»¶(<code>conditions</code>)æ¥å·¥ä½œ.æ­£ç¡®çš„æ“ä½œæ˜¯,
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">for thread which is waiting</span>
(<span style="color: #F0DFAF; font-weight: bold;">with-mutex</span> mutex
  (<span style="color: #F0DFAF; font-weight: bold;">while</span> (not global-variable)
    (condition-wait cond-var)))

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">for thread which is notifying</span>
(<span style="color: #F0DFAF; font-weight: bold;">with-mutex</span> mutex
  (<span style="color: #F0DFAF; font-weight: bold;">setq</span> global-variable (some-computation))
  (condition-notify cond-var))
</pre>
</div>

<ul class="org-ul">
<li><p>
<code>(make-condition-variable MUTEX &amp;optional NAME)</code>
</p>

<p>
åˆ›å»ºä¸€ä¸ªå…³è” <code>MUTEX</code> çš„æ¡ä»¶å˜é‡å¹¶ä¸”è¿”å›å®ƒ,è¿˜å¯ä»¥ç»™è¿™ä¸ªæ¡ä»¶æŒ‡å®šä¸€ä¸ªåå­—.
</p></li>

<li><p>
<code>(condition-variable-p OBJECT)</code>
</p>

<p>
åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ¡ä»¶å˜é‡.
</p></li>

<li><p>
<code>(condition-wait COND)</code>
</p>

<p>
ç­‰å¾…å¦å¤–ä¸€ä¸ªçº¿ç¨‹é€šçŸ¥ <code>COND</code>,è¿™ä¸ªå‡½æ•°ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æ¡ä»¶ <code>COND</code> è¢«é€šçŸ¥,åˆæˆ–è€…è¯¥çº¿ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªç”¨ <code>thread-signal</code> å‘å‡ºçš„ä¿¡å·.
</p>

<p>
åœ¨ä¸æŒæœ‰æ¡ä»¶å˜é‡å…³è”çš„ <code>mutex</code> ä¸‹è°ƒç”¨è¿™ä¸ªå‡½æ•°æ˜¯é”™è¯¯çš„.è¿™ä¸ªå‡½æ•°ä¼šåœ¨ç­‰å¾…çš„æ—¶å€™é‡Šæ”¾ <code>mutex</code>,è¿™æ ·é‚£äº›è¦å‘é€é€šçŸ¥çš„çº¿ç¨‹å°±å¯ä»¥è·å– <code>mutex</code> äº†.
</p></li>

<li><p>
<code>(condition-notify COND &amp;optional ALL)</code>
</p>

<p>
é€šçŸ¥ <code>COND</code>.ä¸€å®šè¦åœ¨æŒæœ‰ <code>mutex</code> çš„æƒ…å†µä¸‹æ‰èƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°.ä¸€èˆ¬æ˜¯å•ä¸ªç­‰å¾…ä¸­çš„çº¿ç¨‹æ¥æ”¶åˆ°é€šçŸ¥,å¦‚æœ <code>ALL</code> æ˜¯ <code>non-nil</code>,é‚£ä¹ˆæ‰€æœ‰ç­‰åˆ° <code>COND</code> çš„çº¿ç¨‹éƒ½ä¼šæ¥æ”¶åˆ°é€šçŸ¥.
</p>

<p>
è¿™ä¸ªå‡½æ•°ä¼šåœ¨ç­‰å¾…çš„æ—¶å€™é‡Šæ”¾ <code>COND</code> å…³è”çš„ <code>mutex</code>,è¿™æ ·é‚£äº›ç­‰å¾… <code>COND</code> çš„çº¿ç¨‹å°±å¯ä»¥è·å– <code>mutex</code> äº†.
</p></li>

<li><p>
<code>(condition-name COND)</code>
</p>

<p>
è·å– <code>COND</code> çš„åå­—,è¿™ä¸ªåå­—æ˜¯è¢« <code>make-condition-variable</code> æŒ‡å®šçš„.
</p></li>

<li><p>
<code>(condition-mutex COND)</code>
</p>

<p>
è·å– <code>COND</code> å…³è”çš„ <code>mutex</code>,å…³è”çš„ <code>mutex</code> æ˜¯ä¸å¯æ”¹å˜çš„.
</p></li>
</ul>
</div>
</div>


<div id="outline-container-org37c24c5" class="outline-4">
<h4 id="org37c24c5">çº¿ç¨‹åˆ—è¡¨ (The Thread List)</h4>
<div class="outline-text-4" id="text-org37c24c5">
<p>
<code>list-threads</code> å‘½ä»¤å¯ä»¥å®æ—¶åˆ—å‡ºæ‰€æœ‰å½“å‰å­˜æ´»çš„çº¿ç¨‹,æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯é€šè¿‡ <code>make-thread</code> æŒ‡å®šçš„åå­—æˆ–è€…æ˜¯ <code>Emacs Lisp</code> æä¾›çš„æ ‡è¯†å±•ç¤º.
</p>

<ul class="org-ul">
<li><p>
<code>thread-list-refresh-seconds</code>
</p>

<p>
åˆ—è¡¨åˆ·æ–°æ—¶é—´.
</p></li>
</ul>

<p>
è¯¥åˆ—è¡¨çš„ç¼“å†²åŒºæ”¯æŒä¸€äº›å‘½ä»¤:
</p>

<ol class="org-ol">
<li><p>
<code>b</code>: å±•ç¤ºçº¿ç¨‹å½“å‰æ‰§è¡Œç‚¹ä¸Šçš„ <code>backtrace</code>,æ³¨æ„è¿™ä¸ª <code>backtrace</code> å°±æ˜¯ä¸€ä¸ªå¿«ç…§,å®é™…æ—¶åˆ»çš„çŠ¶æ€å¯èƒ½ä¸æ­¤åˆ»æ˜¾ç¤ºçš„ä¸ä¸€æ ·.
</p>

<p>
åœ¨ <code>backtrace</code> ç¼“å†²åŒºä¸­æŒ‰ä¸‹ <code>g</code> å¯ä»¥è¿›è¡Œåˆ·æ–°.
</p></li>

<li><p>
<code>s</code>: ç»™çº¿ç¨‹åœ¨å½“å‰çš„æ‰§è¡Œç‚¹å‘é€ä¿¡å·.åœ¨ <code>s</code> åè¾“å…¥ <code>q</code> å‘é€ç»“æŸ(quit)çš„ä¿¡å·æˆ–è€… <code>e</code> å‘é€é”™è¯¯(error)çš„ä¿¡å·.
</p>

<p>
çº¿ç¨‹å¯ä»¥å®ç°å¯¹ä¿¡å·çš„å¤„ç†,å¦åˆ™é»˜è®¤è¡Œä¸ºæ˜¯ç»“æŸçº¿ç¨‹.ä½¿ç”¨è¿™ä¸ªå‘½ä»¤çš„æ˜¯åå¿…é¡»å…ˆè¦ç†è§£å¦‚ä½•é‡å¯ç›®æ ‡çº¿ç¨‹,å› ä¸º <code>Emacs session</code> ä¼šå› ä¸ºé‡è¦çº¿ç¨‹è¢«æ€è€Œè¡¨ç°ä¸æ­£å¸¸.
</p></li>

<li><code>g</code>: æ›´æ–°çº¿ç¨‹åˆ—è¡¨.</li>
</ol>
</div>
</div>
</div>


<div id="outline-container-org089e337" class="outline-3">
<h3 id="org089e337">è¿›ç¨‹ (Processes)</h3>
<div class="outline-text-3" id="text-org089e337">
<p>
åœ¨æ“ä½œç³»ç»Ÿçš„æœ¯è¯­ä¸­,ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè®©ç¨‹åºè¿è¡Œçš„åœ°æ–¹. <code>Emacs</code> åœ¨è¿›ç¨‹å†…è¿è¡Œ, <code>Emacs Lisp</code> èƒ½å¤Ÿè°ƒç”¨å…¶å®ƒç¨‹åºçš„è¿›ç¨‹,è®©å®ƒä»¬åœ¨è‡ªå·±çš„è¿›ç¨‹å†…è¿è¡Œ,
</p>

<p>
è¿™äº›è¿›ç¨‹è¢«ç§°ä¸º <code>Emacs</code> è¿›ç¨‹çš„ <code>subprocesses</code> æˆ–è€… <code>child processes</code>,ä¹Ÿå°±æ˜¯å­è¿›ç¨‹, <code>Emacs</code> è¿›ç¨‹å°±æ˜¯å®ƒä»¬çš„ <code>parent process</code>,ä¹Ÿå°±æ˜¯çˆ¶è¿›ç¨‹.
</p>

<p>
<code>Emacs</code> çš„å­è¿›ç¨‹å¯ä»¥æ˜¯åŒæ­¥æˆ–è€…å¼‚æ­¥çš„,å–å†³äºåˆ›å»ºæ—¶å€™çš„è®¾å®š.åŒæ­¥çš„å­è¿›ç¨‹ä¼šè®© <code>Lisp</code> ç¨‹åºç­‰å¾…å­è¿›ç¨‹çš„ç»“æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œ;
</p>

<p>
è€Œå¼‚æ­¥çš„è¿›ç¨‹åˆ™æ˜¯å¯ä»¥ä¸ <code>Lisp</code> ç¨‹åºå¹³è¡Œ/åŒæ—¶è¿è¡Œ.åœ¨ <code>Emacs Lisp</code> ä¸­,å­è¿›ç¨‹æ˜¯ <code>process</code> å¯¹è±¡, <code>Lisp</code> ç¨‹åºä¼šé€šè¿‡è¿™ä¸ªå¯¹è±¡æ¥ä¸å­è¿›ç¨‹é€šä¿¡æˆ–è€…æ§åˆ¶å®ƒ,
</p>

<p>
æ¯”å¦‚,å¯ä»¥ç»™å­è¿›ç¨‹å‘é€ä¿¡å·,ä»å­è¿›ç¨‹è·å–çŠ¶æ€ä¿¡æ¯/æ¥æ”¶è¾“å‡º,æˆ–è€…ç»™è¿›ç¨‹å‘é€è¾“å…¥.
</p>

<p>
é™¤äº†ç¨‹åºçš„è¿›ç¨‹å¤–, <code>Emacs Lisp</code> è¿˜å¯ä»¥æ‰“å¼€å‡ ç§ä¸åŒçš„è®¾å¤‡çš„é“¾æ¥,ä»¥åŠä¸åŒæˆ–è€…ç›¸åŒæœºå™¨ä¸Šçš„è¿›ç¨‹é“¾æ¥,æ”¯æŒçš„ç±»å‹æœ‰:
</p>

<p>
<code>TCP</code> ä»¥åŠ <code>UDP</code> ç½‘ç»œé“¾æ¥,åºåˆ—ç«¯å£é“¾æ¥(<code>serial port connections</code>)å’Œç®¡é“é“¾æ¥(<code>pipe connections</code>),æ¯ä¸ªé“¾æ¥éƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ç›®æ ‡.
</p>

<p>
å¯ä»¥åˆ©ç”¨ <code>processp</code> æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸€ä¸ªè¿›ç¨‹.é™¤äº†å½“å‰ <code>Emacs session</code> çš„å­è¿›ç¨‹å¤–,è¿˜å¯ä»¥è®¿é—®åŒä¸€å°æœºå™¨ä¸Šçš„å…¶å®ƒè¿›ç¨‹.
</p>
</div>

<div id="outline-container-org7bffc2c" class="outline-4">
<h4 id="org7bffc2c">åˆ›å»ºå­è¿›ç¨‹ (Subprocess Creation)</h4>
<div class="outline-text-4" id="text-org7bffc2c">
<p>
æœ‰ä¸‰ä¸ªåŸå‡½æ•°(<code>primitives</code>)å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ç»™ç¨‹åºè¿è¡Œ: åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¼‚æ­¥è¿›ç¨‹çš„ <code>make-process</code>, åˆ›å»ºä½†ä¸è¿”å›åŒæ­¥è¿›ç¨‹çš„ <code>call-process</code> å’Œ <code>call-process-region</code>.
</p>

<p>
ä¸‰è€…çš„å‚æ•°å½¢å¼ååˆ†ç›¸ä¼¼,å®ƒä»¬éƒ½æ˜¯æŒ‡å®šä¸€ä¸ªè¦è¿è¡Œçš„ç¨‹åºæ–‡ä»¶,ç„¶åå†å¯é€‰åœ°æä¾›å‚æ•°.å¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å¯æ‰§è¡Œæˆ–è€…æ²¡æ‰¾åˆ°,é‚£ä¹ˆå°±ä¼šå‘é€ä¸€ä¸ªé”™è¯¯ä¿¡å·.
</p>

<p>
å¦‚æœæ–‡ä»¶åå­—æ˜¯ç›¸å¯¹è·¯å¾„å½¢å¼çš„,é‚£ä¹ˆå°±ä¼šåœ¨å˜é‡ <code>exec-path</code> åŒ…å«çš„æ–‡ä»¶åˆ—è¡¨ä¸­æŸ¥æ‰¾, <code>Emacs</code> åœ¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šæ ¹æ®ç¯å¢ƒå˜é‡ <code>PATH</code> çš„å€¼æ¥åˆå§‹åŒ– <code>exec-path</code>.
</p>

<p>
æ ‡å‡†çš„æ–‡ä»¶åå­—ç»“æ„ä¸­, <code>~</code>, <code>.</code> å’Œ <code>..</code> åœ¨ <code>exec-path</code> æ˜¯å¯ä»¥è¢«æ­£å¸¸è§£æçš„,ä½†æ˜¯ç¯å¢ƒå˜é‡æ›¿æ¢(<code>environment variable substitutions</code>),æ¯”å¦‚ <code>Emacs</code> æ˜¯ä¸è®¤è¯† <code>$HOME</code> çš„,ä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>(substitute-in-file-name "$HOME")</code> æ‰§è¡Œæ›¿æ¢.
</p>

<p>
<code>exec-path</code> ä¸­çš„ <code>nil</code> è¡¨ç¤º <code>default-directory</code>.å¯ä»¥é€šè¿‡ <code>exec-suffixes</code> è®¾ç½®æ‰§è¡Œæ–‡ä»¶çš„åç¼€æ¥è¿›è¡ŒæŸ¥æ‰¾.
</p>

<p>
<b>æ³¨æ„, <code>call-process</code> å’Œ <code>call-process-region</code> çš„ <code>PROGRAM</code> å‚æ•°åº”è¯¥åªåŒ…å«ç¨‹åºçš„åå­—,ä¸åº”è¯¥åŒ…å«ç»™ç¨‹åºæä¾›çš„å‚æ•°,è¦é€šè¿‡ <code>ARGS</code> å‚æ•°æ¥ä¼ ; <code>make-process</code> åªæœ‰ä¸€ä¸ª <code>COMMAND</code> å‚æ•°,å¯ä»¥åŒ…å«ç¨‹åºåå­—ä»¥åŠå‚æ•°</b>.
</p>

<p>
æ¯ä¸ªå­è¿›ç¨‹åˆ›å»ºå‡½æ•°éƒ½æœ‰ä¸€ä¸ªçš„å‚æ•°ç”¨æ¥æŒ‡å®šç¨‹åºçš„è¾“å‡ºåœ°æ–¹,ä¸€èˆ¬å°±æ˜¯ç¼“å†²åŒºæˆ–è€…ç¼“å†²åŒºçš„åå­—å¯¹åº”çš„å½¢å¼å‚æ•°æ˜¯ <code>BUFFER</code> æˆ–è€… <code>DESTINATION</code>,å¯ä»¥æ˜¯ <code>nil</code>,è¡¨ç¤ºèˆå¼ƒè¾“å‡º,é™¤éæœ‰ä¸ªè‡ªå®šä¸€ä¸ªç­›é€‰å‡½æ•°(<code>filter function</code>)å¤„ç†è¾“å‡º.
</p>

<p>
å¦‚æœæŒ‡å®šçš„ç¼“å†²åŒºä¸å­˜åœ¨ <code>Emacs</code> ä¼šè‡ªåŠ¨åˆ›å»º.ä¸€èˆ¬æ¥è¯´,ä¸åº”è¯¥è®©å¤šä¸ªè¿›ç¨‹æŠŠè¾“å‡ºå‘é€ç»™åŒä¸€ä¸ªç¼“å†²åŒº,å› ä¸ºä¼šå¯¼è‡´è¾“å‡ºéšæœºæ··ä¹±,è€ŒåŒæ­¥è¿›ç¨‹å¯ä»¥æŠŠè¾“å‡ºå‘é€ç»™æ–‡ä»¶.åœ¨é»˜è®¤æƒ…å†µä¸‹,æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯çš„ç›®çš„åœ°æ˜¯åŒä¸€ä¸ª,ä¸‰ä¸ªåŸå‡½æ•°å…è®¸å†³å®šæ˜¯å¦åŒä¸€ä¸ªç›®çš„åœ°.
</p>

<p>
æ¯”å¦‚è¦æ‰§è¡Œ <code>ls</code> å‘½ä»¤æ¥æ˜¾ç¤º <code>/home/saltb0rn</code> ç›®å½•ä¸‹çš„æ–‡ä»¶,å¹¶ä¸”æŠŠè¾“å‡ºå‘é€åˆ°ç¼“å†²åŒº - <code>ls-buf</code> ä¸­.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">async process</span>
(make-process <span style="color: #DCDCCC; font-weight: bold;">:name</span> <span style="color: #CC9393;">"list-dir"</span> <span style="color: #DCDCCC; font-weight: bold;">:buffer</span> <span style="color: #CC9393;">"ls-buf"</span> <span style="color: #DCDCCC; font-weight: bold;">:command</span> (list <span style="color: #CC9393;">"ls"</span> <span style="color: #CC9393;">"/home/saltb0rn"</span>))

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">sync process</span>
(call-process <span style="color: #CC9393;">"ls"</span> nil (list <span style="color: #CC9393;">"ls-buf"</span> <span style="color: #CC9393;">"ls-buf"</span>) nil <span style="color: #CC9393;">"/home/saltb0rn"</span>)
                                        <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">&#21457;&#36865;&#24403;&#21069; buffer &#30340; (point-min) &#21040; (point-max) &#30340;&#25991;&#26412;&#32473; =ls=,&#21487;&#20197;&#26032;&#24314;&#19968;&#20010; buffer &#24182;&#19988;&#36755;&#20837; /home/saltb0rn</span>
(call-process-region (point-min) (point-max) <span style="color: #CC9393;">"ls"</span> nil <span style="color: #CC9393;">"ls-buf"</span>)

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#23545;&#20110;&#19968;&#20010;&#20197;&#19978;&#30340;&#21442;&#25968;&#30340;&#21629;&#20196; cp</span>
(make-process <span style="color: #DCDCCC; font-weight: bold;">:name</span> <span style="color: #CC9393;">"cp-file"</span> <span style="color: #DCDCCC; font-weight: bold;">:buffer</span> <span style="color: #CC9393;">"cp-buf"</span> <span style="color: #DCDCCC; font-weight: bold;">:command</span> (list <span style="color: #CC9393;">"cp"</span> <span style="color: #CC9393;">"/home/saltb0rn/a"</span> <span style="color: #CC9393;">"/home/saltb0rn/b"</span>))
(call-process <span style="color: #CC9393;">"cp"</span> nil (list <span style="color: #CC9393;">"cp-buf"</span> <span style="color: #CC9393;">"cp-buf"</span>) nil <span style="color: #CC9393;">"/home/saltb0rn/a"</span> <span style="color: #CC9393;">"/home/saltb0rn/b"</span>)
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">call-process-region &#23601;&#19981;&#28436;&#31034;&#20102;</span>
</pre>
</div>

<p>
è¿™é‡Œè¦æ³¨æ„, <code>wildcard</code> å­—ç¬¦ä»¥åŠå…¶ä»– <code>Shell</code> çš„ä¸œè¥¿æ˜¯æ²¡æœ‰ç”¨çš„,è¿˜è¦å†æ¬¡æé†’ <code>~</code> æ˜¯è§£æä¸äº†çš„,è¦æ‰‹åŠ¨è§£æ.
</p>

<p>
è¿˜æœ‰å­è¿›ç¨‹ä¼šé»˜è®¤ç»§æ‰¿ <code>Emacs</code> çš„ç¯å¢ƒ,å¯ä»¥é€šè¿‡è¦†å†™ <code>process-environment</code> æ¥æ”¹å˜ç»§æ‰¿çš„ç¯å¢ƒ.
</p>
</div>
</div>




<div id="outline-container-org53aa405" class="outline-4">
<h4 id="org53aa405">Shellå‚æ•° (Shell Arguments)</h4>
<div class="outline-text-4" id="text-org53aa405">
<p>
æœ‰æ—¶å€™ <code>Lisp</code> ç¨‹åºéœ€è¦ç»™ä¸€ä¸ª <code>shell</code> ä¸€ä¸ªç”±ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤.è¿™äº›ç¨‹åºåº”è¯¥èƒ½å¤Ÿæ”¯æŒä»»ä½•åˆæ³•çš„æ–‡ä»¶åå­—,ä¸è¿‡ <code>shell</code> ä¼šç‰¹åˆ«å¯¹ä¸€äº›å­—ç¬¦,æ‰€ä»¥è¿™äº›å­—ç¬¦å‡ºç°åœ¨æ–‡ä»¶åå­—ä¸­ä¼šè®© <code>shell</code> å¾ˆå›°æ‰°,
</p>

<p>
<code>shell-quote-argument</code> å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜,æ„å»ºä¸€ä¸ª <code>shell</code> å‘½ä»¤.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(concat <span style="color: #CC9393;">"diff -u "</span>
        (shell-quote-argument oldfile)
        <span style="color: #CC9393;">" "</span>
        (shell-quote-argument newfile))
</pre>
</div>

<p>
<code>split-string-and-unquote</code> å¯ä»¥æŠŠå‘½ä»¤å˜æˆä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨, <code>combine-and-quote-strings</code> å¯ä»¥æŠŠä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨åˆå¹¶æˆä¸€ä¸ªå‘½ä»¤.
</p>

<p>
è¿™ä¸¤ä¸ªå‡½æ•°ä¸€èˆ¬éƒ½æ˜¯ç»™ <code>make-process</code>, <code>call-process</code> æˆ–è€… <code>start-process</code> æ˜¯ç”¨çš„.æ³¨æ„,  <code>combine-and-quote-strings</code> å¹¶ä¸æ˜¯ä¸ºäº†åšå’Œ <code>shell-quote-argument</code> çš„äº‹æƒ…,
</p>

<p>
æ‰€ä»¥ä¸€äº› <code>shell</code> ä¼šè¿ç®—çš„ç‰¹åˆ«å­—ç¬¦è¿˜æ˜¯éœ€è¦ç”¨ <code>shell-quote-argument</code> æ¥å¤„ç†,ä¹Ÿå°±æ˜¯è¯´,å½“æ¶‰åŠåˆ° <code>shell</code> ä¸€å®šè¦ç”¨ <code>shell-quote-argument</code>.
</p>
</div>
</div>




<div id="outline-container-org902e9e0" class="outline-4">
<h4 id="org902e9e0">åˆ›å»ºåŒæ­¥è¿›ç¨‹ (Synchronous Processes)</h4>
<div class="outline-text-4" id="text-org902e9e0">
<p>
åœ¨åˆ›å»ºä¸€ä¸ªåŒæ­¥è¿›ç¨‹å, <code>Emacs</code> éœ€è¦ç­‰åˆ°è¿›ç¨‹ç»“æŸåæ‰èƒ½ç»§ç»­åšå…¶å®ƒäº‹æƒ….åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­,ç”¨æˆ·å¯ä»¥è¾“å…¥ä¸€æ¬¡ <code>C-g</code> ç»™è¿›ç¨‹å‘é€ <code>SIGINT</code> ä¿¡å·æ¥æ€æ‰è¯¥è¿›ç¨‹,
</p>

<p>
ä½†è¿™åªæ˜¯å‘Šè¯‰è¿›ç¨‹è¦ç»“æŸ,è¿›ç¨‹è¿˜éœ€è¦ç­‰åˆ°ä¸€å°æ®µæ—¶é—´ç»“æŸ,åœ¨è¿™ä¸ªæœŸé—´è¾“å…¥ç¬¬äºŒæ¬¡ <code>C-g</code> ä¼šå‘é€ <code>SIGKILL</code> ç»™è¿›ç¨‹,ç«‹åˆ»æ€æ‰è¿›ç¨‹(åœ¨ <code>MS-DOS</code> ä¸Šæ˜¯ä¸ªä¾‹å¤–).
</p>

<p>
åŒæ­¥çš„å­è¿›ç¨‹ä¼šè¿”å›ä¸€ä¸ªæ ‡è¯†,ä¹Ÿå°±æ˜¯çŠ¶æ€ç ,æ¥è¯´æ˜ç¨‹åºæ˜¯å¦‚ä½•ç»“æŸçš„:æ­£å¸¸ç»“æŸæˆ–è€…å› ä¸ºä¸€äº›é”™è¯¯è€Œç»“æŸ.åŒæ­¥å­è¿›ç¨‹çš„è¾“å‡ºä¸€èˆ¬éƒ½æ˜¯è¢«ç¼–ç ç³»ç»Ÿç¼–ç è¿‡çš„,å°±åƒè¯»å–æ–‡ä»¶ä¸€æ ·,è¾“å…¥åŒæ ·ç»è¿‡ç¼–ç .
</p>

<p>
åœ¨ <b>åˆ›å»ºå­è¿›ç¨‹</b> çš„é‚£ç¯‡ç¬”è®°ä¸­æœ‰æåˆ°ä¸€ä¸‹ <code>call-process</code> çš„ç”¨æ³•,è¿™é‡Œå°±ä¸è¯¦ç»†ç¬”è®°äº†,ä¸»è¦æ˜¯å…³äº <code>process-file</code> è¿™ä¸ªå‡½æ•°,å®ƒå’Œ <code>call-process</code> å·®ä¸å¤š,
</p>

<p>
ä¸åŒä¹‹å¤„åœ¨äº <code>process-file</code> åˆ›å»ºçš„å­è¿›ç¨‹ä¼šæ ¹æ® <code>default-directory</code> çš„å€¼æ¥å†³å®šæ˜¯å¦æ˜¯ç”¨ä¸€ä¸ªæ–‡ä»¶å¤„ç†å™¨(file handler), <code>default-directory</code> çš„å€¼å°±æ˜¯å­è¿›ç¨‹å½“å‰çš„å·¥ä½œç›®å½•,
</p>

<p>
<code>process-file</code> å¯ä»¥åœ¨è¿œç¨‹ç›®å½•è¿è¡Œä¸€ä¸ªè¿›ç¨‹,å½“ç„¶æœ¬åœ°ä¹Ÿæ˜¯ <code>okay</code> çš„,æ˜¯ <code>call-process</code> çš„è¿œç¨‹ç‰ˆæœ¬.
</p>

<p>
(å¦‚æœä½ ç”¨ <code>Emacs</code> è¿œç¨‹ç¼–è¾‘äº†æ–‡ä»¶,å¯èƒ½éœ€è¦åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸€äº›å‘½ä»¤,é‚£ä¹ˆè¿™ä¸ªæ¯«æ— ç–‘é—®æ˜¯ä½ æƒ³è¦çš„),=process-file-shell-command= æ˜¯ä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„ç‰ˆæœ¬.
</p>

<p>
å…¶ä»–å°±ä¸å†™äº†,è‡ªå·±è¯»æ–‡æ¡£.
</p>
</div>
</div>


<div id="outline-container-orgd428d45" class="outline-4">
<h4 id="orgd428d45">åˆ›å»ºå¼‚æ­¥è¿›ç¨‹ (Asynchronous Processes)</h4>
<div class="outline-text-4" id="text-orgd428d45">
<p>
åˆ›å»ºä¸€ä¸ªå¼‚æ­¥è¿›ç¨‹å,è¿›ç¨‹ä¼šå’Œ <code>Emacs</code> å¹³è¡Œ/åŒæ—¶è¿è¡Œ, <code>Emacs</code> è¿˜å¯ä»¥ä¸å®ƒé€šä¿¡,ä½†æ˜¯æ³¨æ„, <code>Emacs</code> ä¸å¼‚æ­¥è¿›ç¨‹çš„é€šä¿¡æ˜¯éƒ¨åˆ†å¼‚æ­¥çš„:
</p>

<p>
<code>Emacs</code> åªæœ‰åœ¨è°ƒç”¨ç‰¹å®šå‡½æ•°ä¸‹æ‰ä¼šç»™è¿›ç¨‹å‘é€æ•°æ®, <code>Emacs</code> åªæœ‰åœ¨ç­‰å¾…è¾“å…¥æˆ–è€…ä¸€æ®µæ—¶é—´å»¶è¿Ÿå(waiting for input or for a time delay)æ‰èƒ½æ¥æ”¶åˆ°è¿›ç¨‹çš„æ•°æ®.
</p>

<p>
å¼‚æ­¥è¿›ç¨‹æ˜¯ç”± <code>pty (pseudo-terminal)</code> æˆ–è€… <code>pipe</code> æ¥æ§åˆ¶çš„,é€‰æ‹© <code>pty</code> æˆ–è€… <code>pipe</code> æ˜¯åœ¨åˆ›å»ºè¿›ç¨‹çš„æ—¶å€™å°±å†³å®šçš„äº†,é»˜è®¤æ˜¯æ ¹æ® <code>process-connection-type</code> çš„å€¼æ¥å†³å®š.
</p>

<p>
ä¸€èˆ¬ <code>pty</code> å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯æœ€å¥½çš„é€‰æ‹©,è¿™ä¸ªæ˜¯å¯¹åº”äº <code>Shell</code> æ¨¡å¼,å®ƒæ”¯æŒè¿›ç¨‹å’Œå®ƒçš„å­è¿›ç¨‹ä¹‹é—´çš„ä½œä¸šæ§åˆ¶(<code>job control</code>)æ“ä½œ,æ¯”å¦‚ <code>C-c</code>, <code>C-z</code> ç­‰ç­‰,
</p>

<p>
å› ä¸ºäº¤äº’å½¢çš„ç¨‹åºä¼šæŠŠ <code>pty</code> çœ‹åšç»ˆç«¯è®¾å¤‡(<code>terminal device</code>). <code>pipe</code> æ˜¯ä¸æ”¯æŒè¿™äº›ç‰¹æ€§çš„,ä½†å¦‚æœè¿›ç¨‹æ˜¯ç”¨äº <code>Lisp</code> ç¨‹åºå†…éƒ¨,é‚£ä¹ˆ <code>pipe</code> å°±æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œå› ä¸º <code>pipe</code> æ›´åŠ é«˜æ•ˆ,
</p>

<p>
å¹¶ä¸”é¿å…/å…ç–«(immune)åƒ <code>pty</code> é‚£æ ·ç”±äºå¤§é‡ä¿¡æ¯(500 byte å·¦å³)è€Œå¼•å…¥çš„å…¨è§’å­—ç¬¦æ³¨å…¥(<code>stray character injections</code>)çš„é—®é¢˜,è¿˜æœ‰å¤§éƒ¨ä»½ç³»ç»Ÿéƒ½ä¼šå¯¹å¯è¿è¡Œ <code>pty</code> çš„æ€»æ•°è¿›è¡Œé™åˆ¶,è¿™æ˜¯ä¸€ä»¶å¥½äº‹.
</p>

<p>
<code>make-process</code> å°±æ˜¯åˆ›å»ºå¼‚æ­¥è¿›ç¨‹çš„åŸå‡½æ•°, <code>start-process</code> å¯¹äºå®ƒæ¥è¯´æ˜¯ä¸€ä¸ªé«˜çº§ç‰ˆæœ¬,å’ŒåŒæ­¥è¿›ç¨‹çš„ <code>process-file</code> ä¸€æ ·,å¼‚æ­¥è¿›ç¨‹çš„åˆ›å»ºå‡½æ•°ä¹Ÿæœ‰è¿œç¨‹ç‰ˆæœ¬ <code>start-file-process</code>,
</p>

<p>
ä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¿œç¨‹æ‰§è¡Œå¼‚æ­¥å‘½ä»¤,å¦‚æœ <code>default-directory</code> æ˜¯è¿œç¨‹ç›®å½•,é‚£ä¹ˆæ‰§è¡Œçš„å°±æ˜¯è¿œç¨‹å‘½ä»¤,å¦åˆ™æ˜¯æœ¬åœ°å‘½ä»¤, <code>start-file-process-shell-command</code> åˆ™æ›´åŠ å¥½ç”¨.
</p>

<p>
å…¶å®ƒè‡ªå·±çœ‹.
</p>
</div>
</div>



<div id="outline-container-org08e93b3" class="outline-4">
<h4 id="org08e93b3">åˆ é™¤è¿›ç¨‹ (Deleting Processes)</h4>
<div class="outline-text-4" id="text-org08e93b3">
<p>
"åˆ é™¤ä¸€ä¸ªè¿›ç¨‹"ä¼šé©¬ä¸Šæ–­å¼€ <code>Emacs</code> å’Œè¿™ä¸ª(Emacsçš„)å­è¿›ç¨‹çš„é“¾æ¥.å…¶å®åœ¨è¿›ç¨‹ç»“æŸä¹‹åå°±ä¼šè‡ªåŠ¨è¢« <code>Emacs</code> åˆ é™¤(ä¸ä¸€å®šæ˜¯é©¬ä¸Š).å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åˆ é™¤ä¸€ä¸ªè¿›ç¨‹,åˆ é™¤ä¸€ä¸ªå·²ç»åœæ­¢ä½†æ˜¯åˆæœªè¢«åˆ é™¤çš„è¿›ç¨‹æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„.
</p>

<p>
åˆ é™¤ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ç»™è¿™ä¸ªè¿›ç¨‹ä»¥åŠå®ƒçš„å­è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·,å¹¶ä¸”è°ƒç”¨è¿›ç¨‹çš„å“¨å…µ(<code>sentinel</code>,åŒæ­¥è¿›ç¨‹æ²¡æœ‰å“¨å…µè¿™ç§ä¸œè¥¿).åœ¨è¿›ç¨‹è¢«åˆ é™¤çš„æ—¶å€™,åªè¦æœ‰å…¶å®ƒ <code>Lisp</code> ç¨‹åºæŒ‡å‘å®ƒ,é‚£ä¹ˆå®ƒå°±ä¼šç»§ç»­å­˜åœ¨.
</p>

<p>
æ‰€æœ‰èƒ½å¤Ÿè®¿é—®è¿›ç¨‹çš„åŸå‡½æ•°éƒ½æ¥å—å·²ç»è¢«åˆ é™¤çš„è¿›ç¨‹.ä½†æ˜¯é‚£äº›æ¶‰åŠ <code>I/O</code> æ“ä½œæˆ–è€…å‘é€æ¶ˆæ¯æ“ä½œçš„åŸå‡½æ•°ä¼šå¼•å‘é”™è¯¯.
</p>

<p>
<code>delete-process</code> å¯ä»¥é€šè¿‡ç»™è¿›ç¨‹å‘é€ä¸€ä¸ª <code>SIGKIL</code> ä¿¡å·æ¥åˆ é™¤è¿›ç¨‹,å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°,å¯ä»¥æ˜¯è¿›ç¨‹å¯¹è±¡/è¿›ç¨‹åå­—,ç¼“å†²åŒºå¯¹è±¡/ç¼“å†²åŒºåå­—,ç¼“å†²åŒºå¯¹è±¡ä»¥åŠç¼“å†²åŒºåå­—è¡¨ç¤º <code>get-buffer-process</code> è¿”å›çš„è¿›ç¨‹.
</p>

<p>
å¯¹ä¸€ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹è°ƒç”¨ <code>delete-process</code> ä¼šä¸­æ­¢è¯¥è¿›ç¨‹,æ›´æ–°è¯¥è¿›ç¨‹çš„çŠ¶æ€ä»¥åŠé©¬ä¸Šè¿è¡Œè¯¥è¿›ç¨‹çš„å“¨å…µ,å¯¹å·²ç»ç»“æŸçš„è¿›ç¨‹æ²¡æœ‰æ•ˆæœ.
</p>

<p>
å¦‚æœæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å¯¹è±¡æ˜¯ä¸€ä¸ªç½‘ç»œ(<code>network</code>),ä¸²å£(<code>serial</code>)æˆ–è€… <code>pipe</code> è¿æ¥,é‚£ä¹ˆå®ƒçš„çŠ¶æ€å°±å˜æˆ <code>closed</code>,å¦åˆ™æ˜¯ <code>singal</code>.
</p>
</div>
</div>



<div id="outline-container-org4a5cd3c" class="outline-4">
<h4 id="org4a5cd3c">è¿›ç¨‹ä¿¡æ¯ (Process Information)</h4>
<div class="outline-text-4" id="text-org4a5cd3c">
<p>
ä¸€äº›èƒ½å¤Ÿè®¿é—®è¿›ç¨‹ä¿¡æ¯çš„å‡½æ•°:
</p>

<ul class="org-ul">
<li>æŒ‰ç…§æ¡ä»¶æ¥æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹,å¯ä»¥ç”¨ <code>list-processes</code> ä»¥åŠ <code>process-list</code>;</li>

<li>è·å–è¿›ç¨‹åå­—æœ‰ <code>process-name</code>;</li>

<li>æ ¹æ®åå­—è·å–è¿›ç¨‹;è·å–è¿›ç¨‹æ‰§è¡Œçš„å‘½ä»¤æœ‰ <code>process-command</code>;</li>

<li>è·å–é“¾æ¥è¿›ç¨‹(å°±æ˜¯ç½‘ç»œ,ä¸²å£æˆ–è€…ç®¡é“é“¾æ¥å…¶ä¸­ä¸€ä¸ª)çš„ä¿¡æ¯;</li>

<li>å’Œè·å–è¿›ç¨‹ <code>pid</code> æœ‰ <code>process-id</code>;</li>

<li>è·å–è¿›ç¨‹çŠ¶æ€æœ‰ <code>process-status</code>;</li>

<li>åˆ¤æ–­è¿›ç¨‹æ˜¯å¦å­˜æ´»æœ‰ <code>process-live-p</code>;</li>

<li>è·å–è¿›ç¨‹çš„ç»“æŸçŠ¶æ€ç æœ‰ <code>process-exit-status</code>;</li>

<li>è·å–è¿›ç¨‹æ­£åœ¨ä½¿ç”¨çš„ç»ˆç«¯åå­—æœ‰ <code>process-tty-name</code>;</li>

<li>è·å–è¿›ç¨‹çš„è¾“å‡ºè§£ç æ–¹å¼ä»¥åŠè¾“å…¥çš„ç¼–ç æ–¹å¼æœ‰ <code>process-coding-system</code>;</li>

<li>è®¾ç½®è¿›ç¨‹çš„è¾“å‡ºè§£ç æ–¹å¼ä»¥åŠè¾“å…¥çš„ç¼–ç æ–¹å¼ <code>set-process-coding-system</code>;</li>

<li>è·å–è¿›ç¨‹çš„å±æ€§åˆ—è¡¨(<code>property list, or plist</code> )ä¸­çš„æŸä¸ªå±æ€§çš„å€¼æœ‰ <code>process-get</code>;</li>

<li>è®¾ç½®è¿›ç¨‹çš„å±æ€§åˆ—è¡¨ä¸­çš„æŸä¸ªå±æ€§æœ‰ <code>process-put</code>;</li>

<li>è·å–è¿›ç¨‹çš„å±æ€§åˆ—è¡¨æœ‰ <code>process-plist</code>;</li>

<li>è®¾ç½®è¿›ç¨‹çš„å±æ€§åˆ—è¡¨æœ‰ <code>set-process-plist</code>;</li>
</ul>
</div>
</div>



<div id="outline-container-org3fa609e" class="outline-4">
<h4 id="org3fa609e">ç»™è¿›ç¨‹å‘é€è¾“å…¥ (Input to Processes)</h4>
<div class="outline-text-4" id="text-org3fa609e">
<p>
å¯ä»¥ç»™å¼‚æ­¥å­è¿›ç¨‹å‘é€æ•°æ®,å¦‚æœå­è¿›ç¨‹è¿è¡Œçš„æ˜¯ä¸€ä¸ªç¨‹åº,é‚£ä¹ˆæ•°æ®å°±æ˜¯è¯¥ç¨‹åºçš„æ ‡å‡†è¾“å…¥;å¦‚æœè¿è¡Œçš„æ˜¯ä¸€ä¸ªé“¾æ¥,é‚£ä¹ˆå°±æ˜¯ç»™è¿æ¥çš„è®¾å¤‡æˆ–è€…ç¨‹åºå‘é€çš„æ•°æ®.
</p>

<p>
ä¸€äº›æ“ä½œç³»ç»Ÿä¼šé™åˆ¶ <code>pty</code> çš„ç¼“å†²è¾“å…¥çš„å¤§å°,åœ¨è¿™äº›ç³»ç»Ÿä¸Š, <code>Emacs</code> ä¼šå®šæœŸå‘é€ <code>EOF</code> åˆ†å¼€æ•°æ®æ¥å¼ºè¿«æ•°æ®é€šè¿‡,å¯¹äºå¤§éƒ¨ä»½ç¨‹åºè€Œè¨€,è¿™äº› <code>EOFs</code> æ˜¯æ— å®³çš„.
</p>

<p>
åœ¨å­è¿›ç¨‹æ¥æ”¶åˆ°è¾“å…¥ä¹‹å‰,ä¼šå…ˆæ ¹æ® <code>set-process-coding-system</code> çš„è®¾å®š,æˆ–è€…ä¸º <code>non-nil</code> çš„ <code>coding-system-for-write</code>,åˆæˆ–è€…é»˜è®¤çš„ç¼–ç æ–¹å¼æ¥å¯¹è¿™äº›è¾“å…¥è¿›è¡Œç¼–ç .
</p>

<p>
æœ‰æ—¶å€™ç³»ç»Ÿä¸èƒ½ç»™è¿›ç¨‹æ¥æ”¶è¾“å…¥,å› ä¸ºè¾“å…¥ç¼“å†²åŒº(<code>input buffer</code>)æ»¡äº†,å½“è¿™ç§æƒ…å†µå‘ç”Ÿäº†,å‘é€è¾“å…¥çš„å‡½æ•°ä¼šç­‰ä¸€ä¸‹,æ¥æ”¶å­è¿›ç¨‹çš„è¾“å‡ºç„¶åå†æ¬¡å°è¯•.
</p>

<p>
<code>process-send-string</code> å’Œ <code>process-send-region</code> å°±æ˜¯å‘é€è¾“å…¥çš„å‡½æ•°, <code>process-running-child-p</code> åˆ¤æ–­ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦æœ‰è‡ªå·±çš„å­è¿›ç¨‹çš„æ§åˆ¶æƒ.
</p>

<p>
è¿™äº›å‡½æ•°çš„ <code>PROCESS</code> å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªè¿›ç¨‹å¯¹è±¡,è¿›ç¨‹çš„åå­—,ç¼“å†²åŒºå¯¹è±¡æˆ–è€…ç¼“å†²åŒºåå­—(=get-buffer-process=å¯ä»¥æ ¹æ®ç¼“å†²åŒºåå­—è·å¾—å¯¹åº”è¿›ç¨‹).
</p>
</div>
</div>


<div id="outline-container-org6c402cb" class="outline-4">
<h4 id="org6c402cb">ç»™è¿›ç¨‹å‘é€ä¿¡å· (Signals to Processes)</h4>
<div class="outline-text-4" id="text-org6c402cb">
<p>
ç»™å­è¿›ç¨‹å‘é€ä¿¡å·æ˜¯é˜»æ­¢å­è¿›ç¨‹æ´»åŠ¨çš„ä¸€ç§æ–¹æ³•.æœ‰å‡ ç§ä¸åŒçš„ä¿¡å·,ä¸åŒçš„ä¿¡å·æœ‰ä¸åŒçš„æ•ˆæœ,ä¿¡å·æ˜¯ç”±æ“ä½œç³»ç»Ÿå®šä¹‰çš„.
</p>

<p>
æ¯”å¦‚ <code>SIGINT</code> æ„å‘³ç€ <code>interrupting</code>,ä¹Ÿå°±æ˜¯ä¸­æ–­å­è¿›ç¨‹,ç›¸å½“äºè¾“å…¥ <code>C-c</code> æˆ–è€…ç±»ä¼¼çš„æ“ä½œ.
</p>

<p>
å¤§éƒ¨ä»½ä¿¡å·ä¼šæ€æ‰è¿›ç¨‹,ä¹Ÿæœ‰ä¸€äº›åœæ­¢æˆ–è€…é‡å¯è¿›ç¨‹çš„æ‰§è¡Œ,å¤§éƒ¨ä»½ä¿¡å·å¯ä»¥è¢«ç¨‹åºå¯é€‰åœ°å¤„ç†,å¦‚æœç¨‹åºå¤„ç†äº†ä¿¡å·,é‚£ä¹ˆå°±ä¸èƒ½çŸ¥é“ä¿¡å·çš„æ ‡å‡†æ•ˆæœäº†.
</p>

<p>
(if the program handles the signal, then we can say nothing in general about its effects.)
</p>

<p>
åœ¨ <code>Emacs</code> ä¸­,ç»™å­è¿›ç¨‹å‘é€ä¿¡å·åˆ†æ˜¾å¼å’Œéšå¼, <code>Emacs</code> ä¼šè‡ªåŠ¨åœ¨ç‰¹å®šæ—¶é—´é‡Œé¢å‘é€ä¿¡å·,æ¯”å¦‚ä¼šåœ¨æ€æ‰ç¼“å†²åŒºçš„æ—¶å€™ç»™æ‰€æœ‰å…³è”çš„è¿›ç¨‹å‘é€ <code>SIGHUP</code> ä¿¡å·;
</p>

<p>
æ€æ‰ <code>Emacs</code> ä¼šç»™æ‰€æœ‰ <code>Emacs</code> çš„å­è¿›ç¨‹å‘é€ <code>SIGHUP</code> ä¿¡å·;è¿™äº›éƒ½æ˜¯éšå¼çš„æ–¹å¼.è€Œæ˜¾å¼çš„æ–¹å¼å°±æ˜¯è°ƒç”¨ <code>Emacs Lisp</code> æä¾›çš„ <code>API</code> æ¥æ‰‹åŠ¨æ€æ­»è¿›ç¨‹.
</p>

<p>
<code>Emacs Lisp</code> çš„æ¯ä¸€ä¸ªä¿¡å·å‘é€åŠŸèƒ½éƒ½æ¥æ”¶ä¸¤ä¸ªå¯é€‰çš„å‚æ•°: <code>PROCESS</code> å’Œ <code>CURRENT-GROUP</code>.
</p>

<p>
<code>PROCESS</code> ä¸€å®šè¦æ˜¯ä¸ªè¿›ç¨‹å¯¹è±¡,æˆ–è€…ç¼“å†²åŒºå¯¹è±¡,æˆ–è€…ç¼“å†²åŒºåå­—,åˆæˆ–è€… <code>nil</code>,å½“æ˜¯ä¸€ä¸ªç¼“å†²åŒºå¯¹è±¡æˆ–è€…æ˜¯ç¼“å†²åŒºåå­—çš„æ—¶å€™,
</p>

<p>
ä¼šè‡ªåŠ¨é€šè¿‡ <code>get-buffer-process</code> è·å–è¿›ç¨‹. <code>nil</code> è¡¨ç¤ºå½“å‰ç¼“å†²åŒºçš„è¿›ç¨‹.é™¤äº†(except with) <code>stop-process</code> å’Œ <code>continue-process</code> å¤–,åœ¨è¿›ç¨‹ä¸å­˜æ´»,æˆ–è€…è¿›ç¨‹æ˜¯ä¸€ä¸ªé“¾æ¥çš„æƒ…å†µä¸‹è°ƒç”¨è¿™äº›å‡½æ•°ä¼šå¼•å‘é”™è¯¯.
</p>


<p>
<code>CURRENT-GROUP</code> åªæœ‰åœ¨è¿è¡Œä¸€ä¸ªä½œä¸šæ§åˆ¶(job-control)çš„ <code>shell</code> ä½œä¸º <code>Emacs</code> å­è¿›ç¨‹çš„æƒ…å†µä¸‹æ‰ä¼šæœ‰åŒºåˆ«. (ç±»ä¼¼çº¿ç¨‹ç»„,å»ºè®®å…ˆäº†è§£ä»¥ä¸‹è¿›ç¨‹ç»„çš„æ¦‚å¿µ).
</p>

<p>
å¦‚æœ <code>CURRENT-GROUP</code> æ˜¯ <code>non-nil</code>,é‚£ä¹ˆä¿¡å·å°±ä¼šè¢«å‘é€åˆ° <code>Emacs</code> ä¸å­è¿›ç¨‹é€šä¿¡çš„ç»ˆç«¯çš„å½“å‰è¿›ç¨‹ç»„,å½“å­è¿›ç¨‹æ˜¯ä¸€ä¸ªä½œä¸šæ§åˆ¶ <code>shell</code> æ—¶å€™,è¯¥å‚æ•°å°±è¡¨ç¤º <code>shell</code> å½“å‰ <code>subjob</code>.
</p>

<p>
å¦‚æœ <code>CURRENT-GROUP</code> æ˜¯ <code>nil</code>,ä¿¡å·ä¼šè¢«å‘é€åˆ° <code>Emacs</code> çš„ä¸­é—´å­è¿›ç¨‹çš„è¿›ç¨‹ç»„,å¦‚æœå­è¿›ç¨‹æ˜¯ä¸€ä¸ªä½œä¸šæ§åˆ¶çš„ <code>shell</code>,é‚£ä¹ˆè¿™ä¸ªå‚æ•°è¡¨ç¤º <code>shell</code> æœ¬èº«.
</p>

<p>
å¦‚æœ <code>CURRENT-GROUP</code> æ˜¯ <code>lambda</code>,é‚£ä¹ˆä¿¡å·ä¼šè¢«å‘é€åˆ°æ‹¥æœ‰ç»ˆç«¯çš„è¿›ç¨‹ç»„ä¸Š,ä½†æ˜¯è¯¥å‚æ•°ä¸æ˜¯ <code>shell</code> æœ¬èº«.
</p>

<p>
<code>APIs</code> å°±è‡ªå·±é˜…è¯»äº†,è¦æ³¨æ„çš„æ˜¯,è¿™äº› <code>APIs</code> éƒ½æ˜¯åªæ˜¯é’ˆå¯¹æœ¬åœ°çš„å¼‚æ­¥è¿›ç¨‹çš„,å¦‚æœè¦ç”¨  <code>interrupt-process</code> ä¸­æ–­éæœ¬åœ°è¿›ç¨‹,é‚£ä¹ˆå°±éœ€è¦æ¥åˆ <code>interrupt-process-functions</code> æ¥å®ç°è‡ªå·±çš„ <code>interrupt-process</code>.
</p>

<p>
<code>interrupt-process-functions</code> æ˜¯ä¸€ä¸ªå‡½æ•°åˆ—è¡¨,è€Œ <code>interrupt-process</code> ä¼šæŒ‰ç…§è¿™ä¸ªåˆ—è¡¨çš„é¡ºåºè°ƒç”¨åˆ—è¡¨é‡Œé¢æ¯ä¸ªçš„å‡½æ•°,ç›´åˆ°å…¶ä¸­ä¸€ä¸ªå‡½æ•°è¿”å› <code>non-nil</code>,è¿™äº›å‡½æ•°æ¥æ”¶çš„å‚æ•°å’Œ <code>interrupt-process</code> çš„ä¸€æ ·.
</p>

<p>
é»˜è®¤å‡½æ•° <code>internal-default-interrupt-process</code> éœ€è¦æ”¾åœ¨åˆ—è¡¨çš„æœ€åä¸€ä½.ç°å®ä¸­ <code>Tramp</code> å°±æ˜¯è¿™ä¹ˆå®ç° <code>interrupt-process</code> çš„æ–¹å¼.
</p>
</div>
</div>





<div id="outline-container-org303b3dd" class="outline-4">
<h4 id="org303b3dd">æ¥æ”¶è¿›ç¨‹çš„è¾“å‡º (Output from Processes)</h4>
<div class="outline-text-4" id="text-org303b3dd">
<p>
å¼‚æ­¥å­è¿›ç¨‹çš„è¾“å‡ºåœ¨å†™å…¥æ ‡å‡†è¾“å‡ºæµä¹‹å‰ä¼šå…ˆé€šè¿‡ä¸€ä¸ªå«åšè¿‡æ»¤å‡½æ•°(<code>filter function</code>)çš„å‡½æ•°.æ¯ä¸ªå¼‚æ­¥å­è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé»˜è®¤è¿‡æ»¤å‡½æ•°,å…¶è¡Œä¸ºå°±æ˜¯ç®€å•åœ°æ’å…¥è¾“å‡ºåˆ°ç¼“å†²åŒºä¸­,
</p>

<p>
è¯¥ç¼“å†²åŒºå°±æ˜¯è¿›ç¨‹å…³è”çš„ç¼“å†²åŒº.å¦‚æœè¿›ç¨‹æ²¡æœ‰å…³è”ç¼“å†²åŒº,é‚£ä¹ˆé»˜è®¤çš„è¿‡æ»¤å‡½æ•°å°±ä¼šä¸¢å¼ƒè¾“å‡º.
</p>

<p>
å¦‚æœå­è¿›ç¨‹å†™å…¥æ ‡å‡†é”™è¯¯æµ,é»˜è®¤çš„é”™è¯¯è¾“å‡ºä¹Ÿä¼šå…ˆé€šè¿‡è¿›ç¨‹çš„è¿‡æ»¤å‡½æ•°.
</p>

<p>
å¦‚æœ <code>Emacs</code> ä½¿ç”¨ <code>pty (pesudo-TTY)</code> ä¸å­è¿›ç¨‹è¿›è¡Œé€šä¿¡,é‚£ä¹ˆå°±ä¸å¯èƒ½åˆ†å¼€æ ‡å‡†è¾“å‡ºæµå’Œæ ‡å‡†é”™è¯¯æµ,å› ä¸º <code>pty</code> åªæœ‰ä¸€ä¸ªè¾“å‡ºé€šé“,å¦‚æœä¸æƒ³å ç”¨è¿™äº›è¾“å‡ºæµ,é‚£ä¹ˆå°±æŠŠè¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­.
</p>

<p>
<code>make-process</code> çš„ <code>:stderr</code> å‚æ•°å¯ä»¥é€šè¿‡è®¾ç½®ä¸º <code>non-nil</code> æ¥æŠŠé”™è¯¯è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯åˆ†å¼€,è¿™ç§æƒ…å†µä¸‹, <code>Emacs</code> ä¼šä½¿ç”¨ <code>pipes</code> å’Œå­è¿›ç¨‹é€šä¿¡.
</p>

<p>
åœ¨å­è¿›ç¨‹ç»“æŸçš„æ—¶å€™, <code>Emacs</code> ä¼šè¯»å–æ‰€æœ‰ç­‰å¾…ä¸­çš„è¾“å‡º(<code>pending output</code>),ç„¶ååœæ­¢è¯»å–å­è¿›ç¨‹çš„è¾“å‡º.å› æ­¤,å¦‚æœæœ‰å­è¿›ç¨‹æœ‰è¿˜å­˜æ´»çš„å­è¿›ç¨‹,é‚£ä¹ˆ <code>Emacs</code> ä¸ä¼šæ¥æ”¶å®ƒä»¬çš„è¾“å‡º.
</p>

<p>
åªæœ‰åœ¨ <code>Emacs</code> ç­‰å¾…çš„æ—¶å€™å­è¿›ç¨‹çš„è¾“å‡ºæ‰èƒ½åˆ°è¾¾,ç­‰å¾…çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§:åœ¨è¯»å–ç»ˆç«¯è¾“å…¥æ—¶å€™;åœ¨è°ƒç”¨ <code>sit-for</code> æˆ–è€… <code>sleep-for</code> çš„æ—¶å€™ä»¥åŠåœ¨è°ƒç”¨ <code>accept-process-output</code> çš„æ—¶å€™.
</p>

<p>
è¿™æœ€å°åŒ–äº†å›°æ‰°(plague)å¹¶è¡Œç¼–ç¨‹çš„æŒæ¡é”™è¯¯æ—¶æœºçš„é—®é¢˜(problem of timing errors).
</p>

<p>
æ¯”å¦‚,ä½ å¯ä»¥å®‰å…¨çš„åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¹¶ä¸”æŒ‡å®šç¼“å†²åŒºæˆ–è€…è¿‡æ»¤å‡½æ•°;å¦‚æœæœŸé—´ä»£ç æ²¡æœ‰è°ƒç”¨ä»»ä½•æ‰§è¡Œç­‰å¾…æ“ä½œçš„åŸå‡½æ•°,æ²¡æœ‰ä»»ä½•è¾“å‡ºåœ¨ä½ æ“ä½œç»“æŸå‰åˆ°è¾¾.
</p>


<p>
åœ¨ä¸€äº›æ“ä½œç³»ç»Ÿä¸Š, <code>Emacs</code> åªèƒ½æ¯æ¬¡è¯»å–å­è¿›ç¨‹è¾“å‡ºå¾ˆå°çš„ä¸€éƒ¨åˆ†æ•°æ®,è¿™ä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜,é’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è®¾ç½® <code>process-adaptive-read-buffering</code> ä¸º <code>non-nil</code>,
</p>

<p>
ä»¥æ­¤æ¥è‡ªåŠ¨å»¶è¿Ÿè¯»å–,è¿™æ ·å°±å¯ä»¥è®©è¿›ç¨‹äº§ç”Ÿæ›´å¤šè¾“å‡ºåæ‰è®© <code>Emacs</code> è¯»å–.
</p>
</div>


<ul class="org-ul">
<li><a id="orgedbfd6e"></a>è¿›ç¨‹å…³è”çš„ç¼“å†²åŒº (Processes Buffers)<br>
<div class="outline-text-5" id="text-orgedbfd6e">
<p>
ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰ä¸€ä¸ªå…³è”çš„ç¼“å†²åŒº,æ˜¯ä¸€ä¸ªæ™®é€šçš„ç¼“å†²åŒº,æœ‰ä¸¤ä¸ªç›®çš„:å‚¨å­˜è¿›ç¨‹è¾“å‡ºå’Œå†³å®šæ€æ‰è¿›ç¨‹çš„æ—¶æœº.
</p>

<p>
å¯ä»¥æ ¹æ®ç¼“å†²åŒºæ¥è¯†åˆ«å®ƒæ‰€å…³è¿çš„è¿›ç¨‹,å› ä¸ºåœ¨å®é™…æƒ…å†µä¸­,ä¸€èˆ¬ä¸€ä¸ªè¿›ç¨‹å…³è”ä¸€ä¸ªç¼“å†²åŒº,å¤§éƒ¨ä»½è¿›ç¨‹ä¹Ÿä¼šç”¨ç¼“å†²åŒºæ¥ç¼–è¾‘å‘é€ç»™è¿›ç¨‹çš„è¾“å…¥.
</p>

<p>
é»˜è®¤æƒ…å†µä¸‹,ç¨‹åºè¾“å‡ºä¼šè¢«æ’å…¥åˆ°å…³è”çš„ç¼“å†²åŒºä¸­,å½“ç„¶å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„è¿‡æ»¤å‡½æ•°æ¥æ”¹å˜è¿™ä¸€è¡Œä¸º.è¾“å‡ºæ’å…¥çš„ä½ç½®ç”± <code>process-mark</code> å†³å®š,åœ¨æ’å…¥æ–‡æœ¬å,
</p>

<p>
<code>process-mark</code> ä¼šæ›´æ–°ä¸ºæ–‡æœ¬çš„æœ€åä¸€ä¸ªç‚¹,æ­£å¸¸æƒ…å†µä¸‹ <code>process-mark</code> å°±æ˜¯åœ¨ç¼“å†²åŒºçš„ç»“å°¾.
</p>

<p>
æ€æ‰ç¨‹åºå…³è”çš„ç¼“å†²åŒºä¹Ÿä¼šæ€æ‰è¿›ç¨‹æœ¬èº«,å¦‚æœè¿›ç¨‹çš„ <code>process-query-on-exit-flag</code> å±æ€§æ˜¯ <code>non-nil</code>, <code>Emacs</code> ä¼šå…ˆå¾æ±‚ç”¨æˆ·çš„ç¡®è®¤.
</p>

<p>
å¾æ±‚ç¡®è®¤çš„è¿™ä¸ªè¡Œä¸ºæ˜¯é€šè¿‡ <code>process-kill-buffer-query-function</code> æ¥å®Œæˆçš„,è€Œå®ƒåˆæ˜¯ä» <code>kill-buffer-query-functions</code> ä¸­è¿è¡Œçš„.
</p>

<p>
å…·ä½“ <code>API</code> å°±è‡ªå·±çœ‹äº†.
</p>
</div>
</li>


<li><a id="orgd8774ec"></a>è¿›ç¨‹è¿‡æ»¤å‡½æ•° (Filter Functions)<br>
<div class="outline-text-5" id="text-orgd8774ec">
<p>
ä¸€ä¸ªè¿›ç¨‹è¿‡æ»¤å‡½æ•°å°±æ˜¯ä¸€ä¸ªä»å…³è”è¿›ç¨‹æ¥æ”¶æ ‡å‡†è¾“å‡ºçš„å‡½æ•°.è¿›ç¨‹çš„æ‰€æœ‰è¾“å‡ºéƒ½ä¼šè¢«ä¼ å…¥åˆ°è¿‡æ»¤å‡½æ•°ä¸­,é»˜è®¤çš„è¿‡æ»¤å‡½åªæ˜¯æŠŠè¿›ç¨‹è¾“å‡ºç›´æ¥æ’å…¥åˆ°å…³è”çš„ç¼“å†²åŒºä¸­.
</p>

<p>
é»˜è®¤æƒ…å†µä¸‹,è¿›ç¨‹çš„é”™è¯¯è¾“å‡ºä¹Ÿä¼šè¢«ä¼ å…¥åˆ°è¿‡æ»¤å‡½æ•°ä¸­,é™¤éåœ¨åˆ›å»ºè¿›ç¨‹çš„æ—¶å€™åˆ†å¼€äº†æ ‡å‡†è¾“å‡ºæµå’Œæ ‡å‡†é”™è¯¯æµ.
</p>

<p>
è¿‡æ»¤å‡½æ•°åªæœ‰åœ¨ <code>Emacs</code> ç­‰å¾…æŸäº›äº‹æƒ…çš„æ—¶å€™è¢«è°ƒç”¨,å› ä¸ºè¿›ç¨‹çš„è¾“å‡ºåªä¼šåœ¨è¿™ç§æƒ…å†µä¸‹åˆ°è¾¾.å…·ä½“ä¸Šé¢çš„å¯¼è¯»æœ‰å†™,å°±ä¸å†é‡å¤äº†.
</p>

<p>
ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ä¸€å®šè¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°: å…³è”çš„è¿›ç¨‹å’Œä¸€ä¸ªå­—ç¬¦ä¸²,è¿™ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºè¿›ç¨‹çš„è¾“å‡º,è¿™ä¸ªå‡½æ•°å¯ä»¥å¯¹è¾“å‡ºåšä»»ä½•äº‹æƒ….
</p>

<p>
ä¸€èˆ¬æƒ…å†µä¸‹,ä¼šåœ¨è¿‡æ»¤å‡½æ•°æ‰§è¡ŒæœŸé—´ç¦æ­¢ä¸­æ­¢(quitting)çš„,å¦åˆ™åœ¨å‘½ä»¤å±‚é¢ä¸Šè¾“å…¥ <code>C-g</code> æˆ–è€…åœæ­¢ä¸€ä¸ªç”¨æˆ·å‘½ä»¤ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„æƒ…å†µ.
</p>

<p>
å¦‚æœæƒ³è¦å…è®¸è¿™ä¸€è¡Œä¸º,å¯ä»¥æŠŠ <code>inhibit-quit</code> è®¾ç½®ä¸º <code>nil</code>,å¤§éƒ¨ä»½æƒ…å†µä¸‹æ­£ç¡®åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ <code>with-local-quit</code> å®.
</p>

<p>
å¦‚æœåœ¨è¿‡æ»¤å‡½æ•°æ‰§è¡Œçš„æœŸé—´å‘ç”Ÿé”™è¯¯,é”™è¯¯ä¼šè¢«è‡ªåŠ¨æ•æ‰,æ‰€ä»¥é”™è¯¯ä¸ä¼šåœæ­¢è¿›ç¨‹çš„æ‰§è¡Œ,ä½†æ˜¯å¦‚æœè®¾ç½®äº† <code>debug-on-error</code> ä¸º <code>non-nil</code>,é”™è¯¯å°±ä¸ä¼šè¢«æ•æ‰.
</p>

<p>
è¿™æ ·å¯ä»¥æ–¹ä¾¿ä½¿ç”¨ <code>Lisp</code> è°ƒè¯•å™¨è¿›è¡Œè°ƒè¯•.
</p>

<p>
å¾ˆå¤šè¿‡æ»¤å‡½æ•°æœ‰æ—¶å€™ä¼šæ¨¡ä»¿é»˜è®¤è¿‡æ»¤å™¨çš„è¡Œä¸ºé‚£æ ·æ’å…¥è¾“å‡ºåˆ°è¿›ç¨‹å…³è”çš„ç¼“å†²åŒºä¸­.è¿™ç§è¿‡æ»¤å‡½æ•°éœ€è¦ç¡®ä¿åœ¨æ’å…¥å‰ä¿å­˜äº†å½“å‰ç¼“å†²åŒº,
</p>

<p>
ä»¥åŠé€‰æ‹©æ­£ç¡®çš„ç¼“å†²åŒº,æ’å…¥åå›å¤åŸæ¥çš„ç¼“å†²åŒº,é™¤äº†è¿™äº›å¤–,è¿˜åº”è¯¥æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦å­˜æ´»,æ›´æ–° <code>process-marker</code>,åœ¨æŸä¸‹æƒ…å†µä¸‹è¿˜éœ€è¦æ›´æ–°ç‚¹çš„å€¼.
</p>

<p>
æ­£ç¡®åšæ³•åº”è¯¥æ˜¯è¿™æ ·:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">ordinary-insertion-filter</span> (proc string)
  (<span style="color: #F0DFAF; font-weight: bold;">when</span> (buffer-live-p (process-buffer proc))
    (<span style="color: #F0DFAF; font-weight: bold;">with-current-buffer</span> (process-buffer proc)
      (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((moving (= (point) (process-mark proc))))
        (<span style="color: #F0DFAF; font-weight: bold;">save-excursion</span>
          <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Insert the text, advancing the process marker.</span>
          (goto-char (process-mark proc))
          (insert string)
          (set-marker (process-mark proc) (point)))
        (<span style="color: #F0DFAF; font-weight: bold;">if</span> moving (goto-char (process-mark proc)))))))
</pre>
</div>

<p>
å¦‚æœæƒ³åœ¨æ–°æ–‡æœ¬åˆ°è¾¾çš„æ—¶å€™æ˜¾ç¤ºè¿›ç¨‹çš„ç¼“å†²åŒº,å¯ä»¥åœ¨ <code>with-current-buffer</code> å‰æ’å…¥ <code>(display-buffer (process-buffer proc))</code>.
</p>

<p>
è¿˜æœ‰æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„åˆ¤æ–­å¹¶éå¿…é¡»çš„,å¯ä»¥å»æ‰åˆ¤æ–­å¼ºè¿«ç‚¹åœ¨ç¼“å†²åŒºçš„å°¾éƒ¨,é»˜è®¤çš„è¿‡æ»¤å‡½æ•°ä½¿ç”¨ <code>insert-before-markers</code> ç§»åŠ¨æ‰€æœ‰ <code>markers</code>,
</p>

<p>
åŒ…æ‹¬çª—å£çš„ç‚¹,å› ä¸ºè¿™å¯èƒ½ä¼šç§»åŠ¨ä¸ç›¸å…³çš„ <code>markers</code>,æ‰€ä»¥ä¸€èˆ¬æœ€å¥½åªç§»åŠ¨çª—å£çš„ç‚¹,æœ‰æˆ–è€…è®¾ç½®æ’å…¥ç‚¹çš„ç±»å‹ä¸º <code>t</code>.
</p>

<p>
å½“æ‰§è¡Œè¿‡æ»¤å‡½æ•°çš„æ—¶å€™, <code>Emacs</code> ä¼šè‡ªåŠ¨ä¿å­˜ä»¥åŠæ¢å¤åŒ¹é…æ•°æ®(match data).
</p>

<p>
è¿‡æ»¤å‡½æ•°æ¥æ”¶åˆ°çš„è¿›ç¨‹è¾“å‡ºä¼šæœ‰ä»»ä½•ä¸åŒå¤§å°,æ¯”å¦‚ä¸€ä¸ªç¨‹åºå¯èƒ½ä¸€è¡Œå†…ä¼šä¸¤æ¬¡äº§ç”Ÿç›¸åŒçš„è¾“å‡º,ç„¶åä¸€æ¬¡æ€§å‘é€ä¸€æ‰¹ (a batch) <code>200</code> ä¸ªå­—ç¬¦çš„æ–‡æœ¬,æ¥ä¸‹æ¥å†å‘é€5æ‰¹40ä¸ªå­—ç¬¦çš„æ–‡æœ¬.
</p>

<p>
å¦‚æœè¿‡æ»¤å‡½æ•°åœ¨å­è¿›ç¨‹çš„è¾“å‡ºæŸ¥æ‰¾ç‰¹å®šçš„æ–‡æœ¬,é‚£ä¹ˆéœ€è¦æ³¨æ„æ–‡æœ¬å¯èƒ½ä¼šè¢«åˆ†å¼€åˆ°ä¸åŒçš„æ‰¹æ¬¡çš„è¾“å‡ºçš„æƒ…å†µ,æ–¹æ³•å°±æ˜¯æŠŠæ¥æ”¶çš„æ–‡æœ¬æ’å…¥åˆ°ä¸€ä¸ªä¸´æ—¶çš„ç¼“å†²åŒºä¸­ä»¥ä¾›æœç´¢.
</p>

<p>
<code>set-process-filter</code> å’Œ <code>process-filter</code> åˆ†åˆ«ç»™è¿›ç¨‹è®¾ç½®è¿‡æ»¤å‡½æ•°å’Œè·å–è¿›ç¨‹çš„è¿‡æ»¤å‡½æ•°.
</p>
</div>
</li>



<li><a id="orge7e7e93"></a>è§£ç è¿›ç¨‹è¾“å‡º (Decoding Output)<br>
<div class="outline-text-5" id="text-orge7e7e93">
<p>
å½“ <code>Emacs</code> ç›´æ¥æŠŠè¾“å‡ºå†™å…¥å¤šå­—èŠ‚(<code>multibyte</code>)ç¼“å†²åŒºä¸­,å®ƒå°±ä¼šæ ¹æ®è¿›ç¨‹çš„è¾“å‡ºç¼–ç ç³»ç»Ÿ(coding system)æ¥è§£ç .
</p>

<p>
å¦‚æœç¼–ç ç³»ç»Ÿæ˜¯ <code>raw-text</code> æˆ–è€…æ˜¯ <code>no-conversion</code>, <code>Emacs</code> ä¼šä½¿ç”¨ <code>string-to-multibyte</code> æŠŠç»Ÿä¸€å­—èŠ‚(<code>unibyte</code>)è¾“å‡ºè½¬æ¢æˆ <code>multibyte</code>,å¹¶ä¸”æ’å…¥å¤„ç†å¾—åˆ°åçš„ <code>multibyte</code> æ–‡æœ¬.
</p>

<p>
å¯ä»¥ä½¿ç”¨ <code>set-process-coding-system</code> æ¥æŒ‡å®šè¿›ç¨‹ä½¿ç”¨çš„ç¼–ç ç³»ç»Ÿ,å¦åˆ™,å¦‚æœ <code>coding-system-for-read</code> æ˜¯ <code>non-nil</code>,
</p>

<p>
é‚£ä¹ˆå°±ä¼šä½¿ç”¨ <code>coding-system-for-read</code> æŒ‡å®šçš„ç¼–ç ç³»ç»Ÿ;æˆ–è€…æ˜¯é»˜è®¤çš„ç¼–ç ç³»ç»Ÿ.
</p>

<p>
å¦‚æœè¿›ç¨‹è¾“å‡ºçš„æ–‡æœ¬åŒ…å«ç©ºå­—èŠ‚(<code>null byte</code>), <code>Emacs</code> é»˜è®¤ä¼šä½¿ç”¨ <code>no-conversion</code> åšä¸ºç¼–ç ç³»ç»Ÿ.
</p>

<p>
æœ€å¥½ä¸è¦ä½¿ç”¨å“ªç§ç±»ä¼¼äº <code>undecided</code> è¿™ç§æ ¹æ®æ•°æ®åˆ¤æ–­ç¼–ç ç³»ç»Ÿçš„ç¼–ç ç³»ç»Ÿ,å› ä¸ºå¯¹äºå¼‚æ­¥å­è¿›ç¨‹çš„è¾“å‡ºä¸å®Œå…¨å¯é .
</p>

<p>
å› ä¸º <code>Emacs</code> å¿…é¡»åˆ†æ‰¹æ¬¡å¤„ç†å¼‚æ­¥å­è¿›ç¨‹çš„è¾“å‡º, <code>Emacs</code> å¿…é¡»å°è¯•æ£€æŸ¥å‡ºæ¯ä¸ªæ‰¹æ¬¡çš„æ­£ç¡®ç¼–ç ç³»ç»Ÿ,ä½†æ˜¯è¿™å¹¶éç™¾åˆ†ç™¾æˆåŠŸ.
</p>

<p>
æ‰€ä»¥,æœ€å¥½è‡ªå·±æŒ‡å®šä¸€ä¸ªç¼–ç ç³»ç»Ÿ,æ¯”å¦‚ <code>latin-1-unix</code>,ä¸è¦ <code>undecided</code> æˆ–è€… <code>latin-1</code>.
</p>

<p>
åœ¨ <code>Emacs</code> è°ƒç”¨ä¸€ä¸ªè¿›ç¨‹è¿‡æ»¤å‡½æ•°æ—¶, <code>Emacs</code> ä¼šæ ¹æ®è¿›ç¨‹çš„è¿‡æ»¤ç¼–ç ç³»ç»Ÿ(<code>filter coding system</code>)ç»™è¿‡æ»¤å‡½æ•°æä¾›ä¸€ä¸ªå¤šå­—èŠ‚å­—ç¬¦ä¸²æˆ–è€…ç»Ÿä¸€å­—ç¬¦ä¸²çš„è¿›ç¨‹è¾“å‡º.
</p>

<p>
<code>Emacs</code> ä¼šæ ¹æ®è¿›ç¨‹è¾“å‡ºçš„ç¼–ç ç³»ç»Ÿæ¥è§£ç è¾“å‡º,è¿™ä¸ªç¼–ç ç³»ç»Ÿé€šå¸¸ä¼šäº§ç”Ÿä¸€ä¸ªå¤šå­—èŠ‚å­—ç¬¦ä¸²,é™¤äº†åƒ <code>binary</code> å’Œ <code>raw-text</code> è¿™æ ·çš„ç¼–ç ç³»ç»Ÿ.
</p>
</div>
</li>




<li><a id="org467a44d"></a>æ¥æ”¶è¿›ç¨‹è¾“å‡º (Accepting Output)<br>
<div class="outline-text-5" id="text-org467a44d">
<p>
ä¸»è¦æ˜¯å…³äº <code>accept-process-output</code> çš„ç”¨æ³•.
</p>
</div>
</li>


<li><a id="org08f507d"></a>è¿›ç¨‹å’Œçº¿ç¨‹ (Processes and Threads)<br>
<div class="outline-text-5" id="text-org08f507d">
<p>
<code>Emacs</code> çš„çº¿ç¨‹æ˜¯ç›¸å¯¹äºè¿›ç¨‹åé¢æ‰å¾—åˆ°æ”¯æŒçš„,ç”±äºåŠ¨æ€ç»‘å®šæœ‰æ—¶å€™ä¼šå’Œ <code>accept-process-output</code> åŒæ—¶è¢«ä½¿ç”¨,
</p>

<p>
é»˜è®¤æƒ…å†µä¸‹,ä¸€ä¸ªè¿›ç¨‹ä¼šè¢«é”å®šåˆ°(be locked to)é‚£ä¸ªåˆ›å»ºäº†è¯¥è¿›ç¨‹çš„çº¿ç¨‹ä¸Š,è¿›ç¨‹çš„è¾“å‡ºåªèƒ½è¢«è¯¥çº¿ç¨‹æ¥æ”¶.
</p>

<p>
ä¸€ä¸ª <code>Lisp</code> ç¨‹åºå¯ä»¥æŒ‡å®šè¿›ç¨‹è¢«é”å®šåˆ°å“ªä¸ªçº¿ç¨‹ä¸Š,æˆ–è€…è®© <code>Emacs</code> è§£é”ä¸€ä¸ªè¿›ç¨‹,ä¸€æ—¦è¢«è§£é”,è¿›ç¨‹çš„è¾“å‡ºå°±å¯ä»¥ç»™ä»»ä½•çº¿ç¨‹å¤„ç†.
</p>

<p>
ä¸€ä¸ªæ—¶é—´å†…åªå¯ä»¥æœ‰ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…æŒ‡å®šè¿›ç¨‹çš„è¾“å‡º,ä¸€æ—¦è¿›ç¨‹å¼€å§‹ç­‰å¾…è¾“å‡º, <code>Emacs</code> å°±ä¸´æ—¶é”å®šè¿›ç¨‹ç›´åˆ° <code>accept-process-output</code> æˆ–è€… <code>sit-for</code> è¿”å›.
</p>

<p>
å¦‚æœçº¿ç¨‹ç»“æŸ,æ‰€æœ‰è¢«é”å®šåˆ°è¯¥çº¿ç¨‹çš„è¿›ç¨‹éƒ½ä¼šè¢«è§£é”.
</p>

<p>
<code>process-thread</code> è¿”å›é”å®šè¿›ç¨‹çš„çº¿ç¨‹,å¦‚æœè¿›ç¨‹å·²ç»è¢«è§£é”å°±è¿”å› <code>nil</code>; <code>set-process-thread</code> æŠŠè¿›ç¨‹é”å®šåˆ°çº¿ç¨‹ä¸Š.
</p>
</div>
</li>
</ul>
</div>


<div id="outline-container-org684c63b" class="outline-4">
<h4 id="org684c63b">å“¨å…µ:æ£€æµ‹è¿›ç¨‹çŠ¶æ€çš„æ”¹å˜ (Sentinels)</h4>
<div class="outline-text-4" id="text-org684c63b">
<p>
è¿›ç¨‹å“¨å…µå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°,åœ¨å…³è”çš„è¿›ç¨‹å‘é€çŠ¶æ€æ”¹å˜çš„æ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°.å“¨å…µå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°:å‘ç”ŸçŠ¶æ€å˜åŒ–çš„è¿›ç¨‹å¯¹è±¡ä»¥åŠä¸€ä¸ªæè¿°çŠ¶æ€å˜åŒ–çš„åŸå› çš„å­—ç¬¦ä¸².
</p>

<p>
æè¿°æœ‰è¿™å‡ ç§å¯èƒ½:
</p>

<ul class="org-ul">
<li><code>"finished\n"</code></li>
<li><code>"deleted\n"</code></li>
<li><code>"exited abnormally with code EXITCODE (core dumped)\n"</code> , å…¶ä¸­ <code>(core dumped)</code> åªæœ‰è¿›ç¨‹ <code>dumped core</code> çš„æ—¶å€™æ‰ä¼šå‡ºç°.</li>
<li><code>"failed with code FAIL-CODE\n"</code></li>
<li><code>"SIGNAL-DESCRIPTION (core dumped)\n"</code>, <code>SIGNAL-DESCRIPTION</code> æ˜¯ç³»ç»Ÿå®šä¹‰ä¿¡å·çš„æè¿°æ–‡æœ¬,æ¯”å¦‚ <code>SIGKILL</code> çš„å°±æ˜¯ <code>killed</code>,å…¶ä¸­ <code>(core dumped)</code> åªæœ‰è¿›ç¨‹ <code>dumped core</code> çš„æ—¶å€™æ‰ä¼šå‡ºç°.</li>
<li><code>"open from HOST-NAME\n"</code></li>
<li><code>"open\n"</code></li>
<li><code>"connection broken by remote peer\n"</code></li>
</ul>

<p>
å“¨å…µåªä¼šåœ¨ <code>Emacs</code> ç­‰å¾…æŸäº›äº‹æƒ…çš„æ—¶å€™æ‰èƒ½è¿è¡Œ,è¿™é¿å…äº†å“¨å…µåœ¨è¿è¡Œæ—¶æœºçš„é”™è¯¯,è¿è¡Œæ—¶æœºçš„é”™è¯¯ä¼šå¯¼è‡´å“¨å…µåœ¨å…¶ä»–çš„ <code>Lisp</code> ç¨‹åºä¸­é—´è¿è¡Œ.
</p>

<p>
ç¨‹åºå¯ä»¥é€šè¿‡è°ƒç”¨ <code>sit-for</code> æˆ–è€… <code>sleep-for</code> æ¥è¿›è¡Œç­‰å¾…,è¿™æ ·å“¨å…µå°±ä¼šè¿è¡Œäº†. <code>Emacs</code> è¿˜å…è®¸å“¨å…µåœ¨å‘½ä»¤å¾ªç¯è¯»å–è¾“å…¥çš„æ—¶å€™è¿è¡Œ.
</p>

<p>
<code>delete-process</code> ç»ˆç»“è¿è¡Œä¸­çš„è¿›ç¨‹ä¼šè°ƒç”¨å“¨å…µ.
</p>

<p>
<code>Emacs</code> ä¸ä¼šä¸ºå¤šä¸ªåŸå› è€Œç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—(queue)æ¥è°ƒç”¨ä¸€ä¸ªè¿›ç¨‹çš„å“¨å…µ,åªæ˜¯ä»…ä»…è®°ä½å½“å‰çš„çŠ¶æ€ä»¥åŠçŠ¶æ€å‘ç”Ÿäº†æ”¹å˜çš„äº‹å®.
</p>

<p>
å› æ­¤å¦‚æœçŠ¶æ€è¿ç»­(<code>come in quick succession</code>)å‘ç”Ÿä¸¤æ¬¡æ”¹å˜,é‚£ä¹ˆå“¨å…µåªä¼šè°ƒç”¨ä¸€æ¬¡.ç„¶è€Œè¿›ç¨‹çš„ç»ˆç»“å¿…å®šåªä¼šè¿è¡Œä¸€æ¬¡å“¨å…µ.
</p>

<p>
å› ä¸ºä¸å¯èƒ½åœ¨è¿›ç¨‹ç»“æŸåå†æ¬¡æ”¹å˜è¿›ç¨‹çš„çŠ¶æ€äº†.
</p>

<p>
<code>Emacs</code> ä¼šåœ¨è¿è¡Œè¿›ç¨‹çš„å“¨å…µå‰å…ˆæ£€æŸ¥ä»¥ä¸‹è¿›ç¨‹çš„è¾“å‡º,ä¸€æ—¦å“¨å…µå› ä¸ºè¿›ç¨‹ç»ˆç»“è€Œè¿è¡Œ,é‚£ä¹ˆå°±ä¸ä¼šæœ‰æ›´å¤šçš„è¿›ç¨‹è¾“å‡ºäº†.
</p>

<p>
å¦‚æœå“¨å…µè¦æŠŠè¿›ç¨‹çš„è¾“å‡ºå†™å…¥åˆ°è¿›ç¨‹å…³è”çš„ç¼“å†²åŒºä¸­,é‚£ä¹ˆè¯¥å“¨å…µåº”è¯¥å…ˆæ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦è¿˜å­˜æ´»,æ’å…¥è¾“å‡ºåˆ°ä¸€ä¸ªå·²ç»æ­»äº¡äº†çš„ç¼“å†²åŒºä¸­ä¼šå¼•å‘é”™è¯¯.
</p>

<p>
å¦‚æœç¼“å†²åŒºæ­»äº¡äº†, <code>(buffer-name (process-buffer PROCESS))</code> ä¼šè¿”å› <code>nil</code>.
</p>

<p>
åœ¨å“¨å…µæ‰§è¡ŒæœŸé—´,ä¸­æ­¢æ“ä½œ(quitting)æ˜¯è¢«ç¦ç”¨äº†çš„,å¦åˆ™ <code>C-g</code> ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ç»“æœ.å¦‚æœå®åœ¨è¦å…è®¸ä¸­æ­¢æ“ä½œ,
</p>

<p>
é‚£ä¹ˆå¯ä»¥æŠŠ <code>inhibit-quit</code> ç»‘å®šä¸º <code>nil</code>,å¤§éƒ¨ä»½æƒ…å†µä¸‹æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ <code>with-local-quit</code> å®.
</p>

<p>
å“¨å…µæ‰§è¡Œçš„æœŸé—´å‘ç”Ÿçš„é”™è¯¯ä¼šè¢«è‡ªåŠ¨æ•è·,è¿™æ ·å°±ä¸ä¼šåœæ­¢ç¨‹åºçš„æ‰§è¡Œäº†,å¦‚æœæƒ³æ•è·é”™è¯¯,å¯ä»¥æŠŠ <code>debug-on-error</code> è®¾ç½®ä¸º <code>nil</code>,è¿™æ ·å¯ä»¥ä½¿ç”¨ <code>Lisp</code> è°ƒè¯•å™¨æ¥è°ƒè¯•äº†.
</p>

<p>
åœ¨å“¨å…µè¿è¡Œæ—¶å¯ä»¥ä¸´æ—¶è®¾ç½®è¿›ç¨‹å“¨å…µä¸º <code>nil</code>,è¿™æ ·å“¨å…µå°±ä¸ä¼šé€’å½’è¿è¡Œäº†,ç”±äºè¿™æ ·æ˜¯ä¸å¯èƒ½ä¸ºå“¨å…µæŒ‡å®šä¸€ä¸ªæ–°çš„å“¨å…µ.
</p>

<p>
<code>Emacs</code> ä¼šåœ¨æ‰§è¡Œå“¨å…µçš„æ—¶å€™è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤åŒ¹é…æ•°æ®(match data).
</p>

<p>
<code>set-process-sentinel</code> å¯ä»¥å…³è”ä¸€ä¸ªè¿›ç¨‹å’Œä¸€ä¸ªå“¨å…µ,å¦‚æœå…³è”çš„å“¨å…µæ˜¯ <code>nil</code>,é‚£ä¹ˆè¿›ç¨‹å…³è”çš„å°±æ˜¯é»˜è®¤å“¨å…µ: åœ¨è¿›ç¨‹çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æƒ…å†µä¸‹æ’å…¥ä¿¡æ¯åˆ°è¿›ç¨‹çš„ç¼“å†²åŒºä¸­.
</p>

<p>
æ”¹å˜è¿›ç¨‹çš„å“¨å…µä¼šé©¬ä¸Šç”Ÿæ•ˆ,åœ¨è¿˜æ²¡æœ‰è°ƒç”¨è¢«é€‰ä¸­è¦è¿è¡Œçš„å“¨å…µæ—¶å€™,å¹¶ä¸”æŒ‡å®šäº†ä¸€ä¸ªæ–°çš„å“¨å…µ,é‚£ä¹ˆæœ€ç»ˆè°ƒç”¨çš„æ˜¯æ–°çš„å“¨å…µ.
</p>

<p>
<code>process-sentinel</code> å¯ä»¥è·å–è¿›ç¨‹çš„å“¨å…µ.
</p>
</div>
</div>


<div id="outline-container-org2a29695" class="outline-4">
<h4 id="org2a29695">åœ¨ç»“æŸå‰è¯¢é—® (Query Before Exit)</h4>
<div class="outline-text-4" id="text-org2a29695">
<p>
<code>Emacs</code> ç»“æŸçš„æ—¶å€™ä¼šç»ˆç»“æ‰€æœ‰å®ƒçš„å­è¿›ç¨‹,ç»™æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å­è¿›ç¨‹å‘é€ <code>SIGHUP</code> ä¿¡å·,é“¾æ¥ä¼šç›´æ¥å…³é—­.
</p>

<p>
å› ä¸ºå­è¿›ç¨‹å¯èƒ½ä¼šåšä¸€äº›æœ‰ä»·å€¼çš„äº‹æƒ…, <code>Emacs</code> ä¸€èˆ¬ä¼šå…ˆå¾æ±‚ç”¨æˆ·çš„ç¡®è®¤å†ç»ˆç»“å­è¿›ç¨‹.
</p>

<p>
æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè¯¢é—® <code>flag</code>,å¦‚æœæ˜¯ <code>non-nil</code> (é»˜è®¤æ˜¯ <code>t</code>) å°±è¦æ±‚ <code>Emacs</code> åœ¨ç»“æŸçš„å‰æˆ–è€…æ€æ‰è¿›ç¨‹çš„å‰å¾æ±‚ç”¨æˆ·çš„ç¡®è®¤.
</p>

<p>
<code>process-query-on-exit-flag</code> è·å–è¿›ç¨‹çš„è¯¢é—® <code>flag</code>; <code>set-process-query-on-exit-flag</code> è®¾ç½®è¿›ç¨‹çš„è¯¢é—® <code>flag</code>.
</p>

<p>
<code>confirm-kill-processes</code> ä¸º <code>t</code> çš„æ—¶å€™è¿›ç¨‹åœ¨ç»“æŸå‰éœ€è¦å¾æ±‚ç”¨æˆ·ç¡®è®¤,å¦‚æœæ˜¯ <code>nil</code>, <code>Emacs</code> æ€æ‰è¿›ç¨‹å°±ä¸éœ€è¦å¾æ±‚ç¡®è®¤äº†,
</p>

<p>
åŒæ—¶æ‰€æœ‰è¿›ç¨‹çš„è¯¢é—® <code>flag</code> éƒ½ä¼šè¢«å¿½ç•¥.
</p>
</div>
</div>


<div id="outline-container-org34bb1f9" class="outline-4">
<h4 id="org34bb1f9">ç³»ç»Ÿè¿›ç¨‹ (System Processes)</h4>
<div class="outline-text-4" id="text-org34bb1f9">
<p>
é™¤äº†è®¿é—®å’Œæ“ä½œå½“å‰ <code>Emacs</code> ä¼šè¯çš„å­è¿›ç¨‹å¤–, <code>Emacs Lisp</code> è¿˜èƒ½è®¿é—®åŒä¸€å°æœºå™¨ä¸Šçš„å…¶å®ƒè¿›ç¨‹,è¿™äº›ç§°ä¸ºç³»ç»Ÿè¿›ç¨‹,ç›®çš„æ˜¯ä¸ <code>Emacs</code> çš„å­è¿›ç¨‹è¿›è¡ŒåŒºåˆ†.
</p>

<p>
<code>Emacs</code> æä¾›äº†ä¸€äº›è®¿é—®ç³»ç»Ÿè¿›ç¨‹çš„åŸå‡½æ•°,ä½†å¹¶éæ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒè¿™äº› <code>APIs</code>,åœ¨ä¸æ”¯æŒçš„ç³»ç»Ÿè°ƒç”¨è¿™äº›å‡½æ•°éƒ½ä¼šè¿”å› <code>nil</code>.
</p>

<p>
<code>list-system-processes</code> è¿”å›ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹åˆ—è¡¨,æ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯é€šè¿‡å®ƒçš„ <code>PID</code> æ¥è¾¨åˆ«, <code>PID</code> å°±æ˜¯ä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿåˆ†é…çš„æ•°å­—è¿›ç¨‹ <code>ID</code>.
</p>

<p>
<code>process-attributes</code> å¯ä»¥æ ¹æ® <code>PID</code> æ¥è·å–è¿›ç¨‹çš„å±æ€§åˆ—è¡¨,è¿™ä¸ªå±æ€§åˆ—è¡¨æ˜¯ä¸€ä¸ª <code>alist</code>,æœ‰äº›å±æ€§å¹¶éæ‰€æœ‰å¹³å°éƒ½æ”¯æŒçš„,æ‰€ä»¥,è¿™äº›ä¸æ”¯æŒçš„å±æ€§æ˜¯ä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸Šçš„.
</p>

<p>
å±æ€§æœ‰è¿™äº›:
</p>

<ul class="org-ul">
<li><p>
<code>euid</code>
</p>

<p>
æ¿€æ´»è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ· <code>ID</code> (<code>EFFECTIVE USER ID</code>),æ˜¯ä¸€ä¸ªæ•°å­—,å¦‚æœç”¨æˆ·ä¸æ¿€æ´»å½“å‰ <code>Emacs</code> ä¼šè¯çš„ç”¨æˆ·æ˜¯åŒä¸€ä¸ªäºº,
</p>

<p>
é‚£ä¹ˆ <code>euid</code> å°±æ˜¯å’Œ <code>user-uid</code> è¿”å›çš„å€¼ä¸€æ ·.
</p></li>

<li><p>
<code>user</code>
</p>

<p>
å¯¹åº” <code>euid</code> çš„ç”¨æˆ·åå­—,æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸².
</p></li>

<li><p>
<code>egid</code>
</p>

<p>
æœ‰æ•ˆç”¨æˆ·çš„ç”¨æˆ·ç»„ <code>ID</code>.
</p></li>

<li><p>
<code>group</code>
</p>

<p>
å¯¹åº” <code>egid</code> çš„ç”¨æˆ·ç»„åå­—,æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸².
</p></li>

<li><p>
<code>comm</code>
</p>

<p>
è¿è¡Œçº¿ç¨‹çš„å‘½ä»¤åå­—,æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,é€šå¸¸æ˜¯è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„åå­—,ä¸åŒ…å«ç›®å½•,ä½†æ˜¯ä¸€äº›ç‰¹åˆ«çš„ç³»ç»Ÿè¿›ç¨‹ä¼šæ˜¾ç¤ºä¸€ä¸ªä¸å¯¹åº”å¯æ‰§è¡Œæ–‡ä»¶åå­—çš„å­—ç¬¦ä¸².
</p></li>

<li><p>
<code>state</code>
</p>

<p>
è¿›ç¨‹çš„çŠ¶æ€ç ,æ˜¯ä¸€ä¸ªæœ‰ç‰¹å®šå«æ„çš„å­—ç¬¦ä¸²,æœ€å¸¸è§çš„å€¼æœ‰(æ‰€æœ‰å€¼å¯ä»¥é€šè¿‡ <code>ps</code> å‘½ä»¤æ‰‹å†ŒæŸ¥è¯¢):
</p>

<ul class="org-ul">
<li><code>"D"</code> : ä¸å¯ä¸­æ–­çš„ä¼‘çœ  (<code>uninterruptible sleep</code>) , é€šå¸¸æ˜¯ <code>I/O</code>;</li>
<li><code>"R"</code> : è¿è¡Œ;</li>
<li><code>"S"</code> : å¯ä¸­æ–­çš„ä¼‘çœ  (<code>interruptible sleep</code>) ,ä¸€èˆ¬æ˜¯åœ¨ç­‰å¾…æŸäº›æ´»åŠ¨;</li>
<li><code>"T"</code> : åœæ­¢çŠ¶æ€,æ¯”å¦‚è¢«ä¸€ä¸ªä½œä¸šæ§åˆ¶ä¿¡å·åœæ­¢;</li>
<li><code>"Z"</code> : åƒµå°¸çŠ¶æ€: è¿›ç¨‹å·²ç»è¢«ç»ˆç»“,å´æ²¡è¢«å®ƒçš„çˆ¶è¿›ç¨‹æ”¶å‰²(<code>reaped</code>)/æ¸…ç†.</li>
</ul></li>

<li><p>
<code>ppid</code>
</p>

<p>
è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ <code>ID</code>,æ˜¯ä¸€ä¸ªæ•°å­—.
</p></li>

<li><p>
<code>pgrp</code>
</p>

<p>
è¿›ç¨‹çš„è¿›ç¨‹ç»„ <code>ID</code>,æ˜¯ä¸€ä¸ªæ•°å­—.
</p></li>

<li><p>
<code>sess</code>
</p>

<p>
è¿›ç¨‹çš„ä¼šè¯ <code>ID</code>,æ˜¯è¿›ç¨‹çš„ <code>session leader</code> çš„è¿›ç¨‹ <code>ID</code>,æ˜¯ä¸€ä¸ªæ•°å­—.
</p></li>

<li><p>
<code>ttname</code>
</p>

<p>
è¿›ç¨‹çš„æ§åˆ¶ç»ˆç«¯(<code>controlling terminal</code>)çš„åå­—,æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,åœ¨ <code>Unix</code> ä»¥åŠ <code>GNU</code> ç³»ç»Ÿä¸Š,é€šå¸¸æ˜¯ä¸€ä¸ªå¯¹åº”çš„ç»ˆç«¯è®¾å¤‡çš„åå­—,
</p>

<p>
æ¯”å¦‚ <code>/dev/pts65</code>.
</p></li>

<li><p>
<code>tpgid</code>
</p>

<p>
æ­£åœ¨ä½¿ç”¨è¿›ç¨‹ç»ˆç«¯çš„å‰å°è¿›ç¨‹ç»„çš„è¿›ç¨‹ç»„ <code>ID</code>,æ˜¯ä¸€ä¸ªæ•°å­—.
</p></li>

<li><p>
<code>minflt</code>
</p>

<p>
å…ˆç®€å•ä»‹ç»ä»¥ä¸‹,å†…å­˜è®¿é—®æœºåˆ¶,è¿›ç¨‹å¹¶ä¸æ˜¯ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜çš„,è€Œæ˜¯å…ˆé€šè¿‡å†…å­˜ç®¡ç†å•å…ƒ(<code>MMU</code>)æ¥æ˜ å°„ç‰©ç†å†…å­˜åˆ°è™šæ‹Ÿå†…å­˜ä¸Š,ç„¶åè®¿é—®è™šæ‹Ÿå†…å­˜.
</p>

<p>
åœ¨è¿›ç¨‹å¼€å§‹æ—¶ç”±è¿›ç¨‹é€ æˆçš„ <code>minor page faults</code> çš„æ•°å­—, <code>minor page faults</code> æ˜¯æŒ‡è®¿é—®çš„å†…å­˜åœ°å€ä¸å­˜åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸Š,ä½†å­˜åœ¨ç‰©ç†å†…å­˜ä¸Š.
</p></li>

<li><p>
<code>majflt</code>
</p>

<p>
åœ¨è¿›ç¨‹å¼€å§‹å€™ç”±è¿›ç¨‹é€ æˆçš„ <code>major page faults</code> çš„æ•°å­—, <code>major page faults</code> æ˜¯æŒ‡è®¿é—®çš„å†…å­˜åœ°å€ä¸å­˜åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸Š,ä¹Ÿä¸å­˜åœ¨ç‰©ç†å†…å­˜ä¸Š.
</p></li>

<li><p>
<code>cminflt</code>, <code>cmajflt</code>
</p>

<p>
ç±»ä¼¼ <code>minflt</code> å’Œ <code>majflt</code>,ä¸è¿‡è¿˜åŒ…å«äº†è¿›ç¨‹æ‰€æœ‰å­è¿›ç¨‹çš„ <code>page faults</code>.
</p></li>

<li><p>
<code>utime</code>
</p>

<p>
ç”¨æˆ·ä¸Šä¸‹æ–‡ä¸­çš„è¿›ç¨‹è¿è¡Œåº”ç”¨ä»£ç æ‰€èŠ±è´¹çš„æ€»æ—¶é—´,æ˜¯ä¸€ä¸ª <code>Lisp</code> æ—¶é—´æˆ³.
</p></li>

<li><p>
<code>stime</code>
</p>

<p>
ç³»ç»Ÿå†…æ ¸ä¸Šä¸‹æ–‡ä¸­çš„è¿›ç¨‹å¤„ç†ç³»ç»Ÿè°ƒç”¨æ‰€èŠ±è´¹çš„æ€»æ—¶é—´,æ˜¯ä¸€ä¸ª <code>Lisp</code> æ—¶é—´æˆ³.
</p></li>

<li><p>
<code>time</code>
</p>

<p>
<code>utime</code> å’Œ <code>stime</code> çš„æ€»å’Œ,æ˜¯ä¸€ä¸ª <code>Lisp</code> æ—¶é—´æˆ³.
</p></li>

<li><p>
<code>cutime</code>, <code>cstime</code>, <code>ctime</code>
</p>

<p>
ç±»ä¼¼ <code>utime</code>, <code>stime</code> å’Œ <code>time</code>,ä¸è¿‡è¿˜åŒ…å«äº†è¿›ç¨‹æ‰€æœ‰å­è¿›ç¨‹çš„æ—¶é—´.
</p></li>

<li><p>
<code>pri</code>
</p>

<p>
è¿›ç¨‹çš„ä¼˜å…ˆçº§,æ˜¯ä¸€ä¸ªæ•°å­—,è¶Šå°ä¼˜å…ˆåº¦è¶Šé«˜.
</p></li>

<li><p>
<code>nice</code>
</p>

<p>
è¿›ç¨‹çš„ <code>nice</code> å€¼,æ˜¯ä¸€ä¸ªæ•°å­—, <code>nice</code> å€¼ä¼šå½±å“ä¼˜å…ˆçº§ <code>pri(new) = pri(old) + nice</code>,æ‰€ä»¥ <code>nice</code> è¶Šå°è¿›ç¨‹æ›´å®¹æ˜“è¢«è¢«æ‰§è¡Œ.
</p></li>

<li><p>
<code>thcount</code>
</p>

<p>
è¿›ç¨‹çš„çº¿ç¨‹æ•°é‡.
</p></li>

<li><p>
<code>start</code>
</p>

<p>
è¿›ç¨‹å¼€å§‹çš„æ—¶é—´,æ˜¯ä¸€ä¸ª <code>Lisp</code> æ—¶é—´æˆ³.
</p></li>

<li><p>
<code>etime</code>
</p>

<p>
è·ç¦»è¿›ç¨‹å¯åŠ¨çš„æ—¶é—´,æ˜¯ä¸€ä¸ª <code>Lisp</code> æ—¶é—´æˆ³.
</p></li>

<li><p>
<code>vsize</code>
</p>

<p>
è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜å¤§å°,å•ä½æ˜¯ <code>kb(kilobytes)</code>.
</p></li>

<li><p>
<code>rss</code>
</p>

<p>
è¿›ç¨‹é©»ç•™é›†(resident set)å ç”¨çš„ç‰©ç†å†…å­˜çš„å¤§å°,å•ä½æ˜¯ <code>kb</code>.
</p>

<p>
åœ¨å†…å­˜ç®¡ç†ä¸­,ä¸€ä¸ªä½œä¸šä¼šæŒ‰ç…§è§„å®šå¤§å°åˆ’åˆ†æˆè‹¥å¹²ä¸ªå•ä½,è¿™äº›å•ä½å«åšé¡µ,æ¯æ¬¡è¿›ç¨‹æ´»åŠ¨çš„æ—¶å€™ä¼šåŠ è½½è‹¥å¹²ä¸ªé¡µ,è¿™äº›é¡µçš„é›†åˆå«åšè¿›ç¨‹é©»ç•™é›†.
</p></li>

<li><p>
<code>pcpu</code>
</p>

<p>
ä»è¿›ç¨‹å¯åŠ¨å¼€å§‹åˆ°ç°åœ¨ä½¿ç”¨çš„ <code>CPU</code> æ—¶é—´ç™¾åˆ†æ¯”,æ˜¯ä¸€ä¸ª <code>0</code> åˆ° <code>100</code> ä¹‹é—´çš„æµ®ç‚¹æ•°.
</p></li>

<li><p>
<code>pmen</code>
</p>

<p>
è¿›ç¨‹é©»ç•™é›†åˆæ‰€å ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”,æ˜¯ä¸€ä¸ª <code>0</code> åˆ° <code>100</code> ä¹‹é—´çš„æµ®ç‚¹æ•°.
</p></li>

<li><p>
<code>args</code>
</p>

<p>
æ¿€æ´»è¿›ç¨‹çš„å‘½ä»¤çš„å‚æ•°éƒ¨åˆ†,å‚æ•°æ˜¯è¢«ç±»ä¼¼ <code>shell-command</code> çš„åŸå‡½æ•°å¤„ç†è¿‡.
</p></li>
</ul>
</div>
</div>


<div id="outline-container-orgef0ed13" class="outline-4">
<h4 id="orgef0ed13">äº‹åŠ¡é˜Ÿåˆ— (Transaction Queues)</h4>
<div class="outline-text-4" id="text-orgef0ed13">
<p>
<code>Emacs</code> æ”¯æŒåˆ©ç”¨äº‹åŠ¡é˜Ÿåˆ—æ¥å’Œå­è¿›ç¨‹é€šä¿¡,é¦–å…ˆç”¨ <code>tq-create</code> ä¸ºç‰¹å®šè¿›ç¨‹åˆ›å»ºä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—,ç„¶åè°ƒç”¨ <code>tq-enqueue</code> å‘é€äº‹åŠ¡.
</p>

<p>
äº‹åŠ¡é˜Ÿåˆ—æ˜¯é€šè¿‡è¿‡æ»¤å‡½æ•°çš„æ–¹å¼å®ç°çš„.
</p>
</div>
</div>



<div id="outline-container-org3cd7b5a" class="outline-4">
<h4 id="org3cd7b5a">ç½‘ç»œé“¾æ¥ (Network)</h4>
<div class="outline-text-4" id="text-org3cd7b5a">
<p>
<code>Emacs</code> å¯ä»¥æ‰“å¼€è¿æ¥åŒä¸€å°æœºå™¨æˆ–è€…ä¸æ˜¯åŒä¸€å°æœºå™¨ä¸Šçš„å…¶å®ƒè¿›ç¨‹çš„æµ(<code>TCP</code>)å’Œæ•°æ®æŠ¥(<code>datagram</code>)(<code>UDP</code>)ç½‘ç»œé“¾æ¥. <code>Emacs</code> æŠŠç½‘ç»œé“¾æ¥å½“ä½œä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†,
</p>

<p>
å¹¶ä¸”åœ¨ <code>Emacs</code> ä¸­ç½‘ç»œé“¾æ¥å°±æ˜¯è¿›ç¨‹å¯¹è±¡.ä½†æ˜¯å’Œå…¶å®ƒçœŸæ­£çš„è¿›ç¨‹ä¸ä¸€æ ·,å®ƒä¸æ˜¯ <code>Emacs</code> çš„å­è¿›ç¨‹,æ‰€ä»¥å®ƒæ²¡æœ‰è¿›ç¨‹ <code>ID</code>,ä¸èƒ½æ€æ‰å®ƒä¹Ÿä¸èƒ½ç»™å®ƒå‘ä¿¡å·.
</p>

<p>
èƒ½å¤Ÿåšçš„å°±åªæœ‰å‘é€å’Œæ¥æ”¶æ•°æ®. <code>delete-process</code> ä¼šå…³é—­é“¾æ¥,ä½†æ˜¯ä¸ä¼šæ€æ‰é€šä¿¡ç«¯çš„å¦å¤–ä¸€å¤´çš„ç¨‹åº.
</p>

<p>
<code>Lisp</code> ç¨‹åºå¯ä»¥åˆ›å»ºç½‘ç»œæœåŠ¡å™¨æ¥ç›‘å¬é“¾æ¥.ç½‘ç»œæœåŠ¡å™¨ä¹Ÿæ˜¯ä¸€ç§è¿›ç¨‹å¯¹è±¡,ä½†æ˜¯å’Œç½‘ç»œé“¾æ¥ä¸ä¸€æ ·,å®ƒå¹¶ä¸ä¼šè‡ªå·±ä¼ è¾“æ•°æ®,å½“æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚çš„æ—¶å€™,ç½‘ç»œæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œé“¾æ¥,
</p>

<p>
è¿™ä¸ªæ–°çš„ç½‘ç»œé“¾æ¥ä¼šä»ç½‘ç»œæœåŠ¡ç»§æ‰¿ä¸€äº›ä¿¡æ¯,åŒ…æ‹¬è¿›ç¨‹çš„å±æ€§åˆ—è¡¨,ç„¶åç½‘ç»œæœåŠ¡å™¨å›å»ç›‘å¬æ›´å¤šçš„è¯·æ±‚.
</p>

<p>
<code>make-network-process</code> å¯ä»¥åˆ›å»ºç½‘ç»œé“¾æ¥å’Œç½‘ç»œæœåŠ¡å™¨,æ¥æ”¶å…³é”®å­—å‚æ•°,å‚æ•° <code>:server</code> ä¸º <code>t</code> çš„æ—¶å€™è¡¨ç¤ºåˆ›å»ºç½‘ç»œæœåŠ¡å™¨è¿›ç¨‹, <code>:type</code> ä¸º <code>datagram</code> è¡¨ç¤ºåˆ›å»ºæ•°æ®æŠ¥é“¾æ¥.
</p>

<p>
è¿›ç¨‹æ˜¯æœ‰ç±»å‹ä¹‹åˆ†çš„,å¯ä»¥é€šè¿‡ <code>process-type</code> å‡½æ•°æ¥è·å–è¿›ç¨‹ç±»å‹,ç½‘ç»œé“¾æ¥æˆ–è€…ç½‘ç»œæœåŠ¡å™¨çš„ä¼šè¿”å› <code>network</code> çš„ <code>symbol</code>,
</p>

<p>
ä¸²å£(<code>serial port</code>)é“¾æ¥çš„å°±æ˜¯ <code>serial</code>, ç®¡é“(<code>pipe</code>)é“¾æ¥çš„å°±æ˜¯ <code>pipe</code>, çœŸæ­£çš„å­è¿›ç¨‹æ˜¯ <code>real</code>.
</p>

<p>
å¯¹äºç½‘ç»œé“¾æ¥, <code>process-status</code> å¯ä»¥è¿”å› <code>open, closed, connect, stop or failed</code> çš„å…¶ä¸­ä¹‹ä¸€,å¯¹äºç½‘ç»œæœåŠ¡å™¨,å¿…å®šæ˜¯è¿”å› <code>listen</code>.
</p>

<p>
é™¤äº† <code>stop</code>,ä¸Šé¢çš„æ¯ä¸€ä¸ªçŠ¶æ€å¯¹äºçœŸæ­£çš„å­è¿›ç¨‹æ˜¯ä¸å¯èƒ½çš„.
</p>

<p>
å¯ä»¥åˆ©ç”¨ <code>stop-process</code> å’Œ <code>continue-process</code> æ¥åœæ­¢å’Œæ¢å¤ç½‘ç»œé“¾æ¥,å¯¹äºä¸€ä¸ªç½‘ç»œæœåŠ¡å™¨æ¥è¯´,åœæ­¢æ„å‘³ç€ä¸æ¥å—æ–°çš„é“¾æ¥,å½“æ¢å¤ç½‘ç»œæœåŠ¡å™¨çš„æ—¶å€™,
</p>

<p>
æœ€å¤šå¯èƒ½æœ‰ <code>5</code> ä¸ªç½‘ç»œè¯·æ±‚è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­,è¿™ä¸ªæ•°å€¼å¯ä»¥è¢«å¢åŠ ,é™¤éæ“ä½œç³»ç»Ÿä¸å…è®¸,å…·ä½“çœ‹ <code>make-network-process</code> çš„ <code>:server</code> å…³é”®å­—å‚æ•°.
</p>

<p>
å¯¹äºä¸€ä¸ªæµé“¾æ¥æ¥è¯´,åœæ­¢æ„å‘³ç€ä¸å¤„ç†è¾“å…¥,æ‰€æœ‰åˆ°è¾¾çš„è¾“å…¥éƒ½ä¼šç­‰å¾…ç›´åˆ°æ¢å¤äº†é“¾æ¥;å¯¹äºä¸€ä¸ªæ•°æ®æŠ¥é“¾æ¥æ¥è¯´,ä¸€äº›æ•°æ®åŒ…ä¼šè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­,ä½†æ˜¯è¾“å…¥ä¼šè¢«ä¸¢å¼ƒ.
</p>

<p>
å¯ä»¥ç”¨ <code>process-command</code> æ¥åˆ¤æ–­ç½‘ç»œé“¾æ¥æˆ–è€…ç½‘ç»œæœåŠ¡å™¨æ˜¯å¦åœæ­¢äº†, <code>non-nil</code> æ„å‘³ç€åœæ­¢,æ¯”å¦‚ä»¥ä¸‹ä¾‹å­.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(make-network-process <span style="color: #DCDCCC; font-weight: bold;">:name</span> <span style="color: #CC9393;">"echo-server"</span> <span style="color: #DCDCCC; font-weight: bold;">:server</span> t <span style="color: #DCDCCC; font-weight: bold;">:buffer</span> <span style="color: #CC9393;">" *echo-server*"</span> <span style="color: #DCDCCC; font-weight: bold;">:service</span> 10000)
(stop-process (get-process <span style="color: #CC9393;">"echo-server"</span>))
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(continue-process (get-process "echo-server"))</span>
(process-command (get-process <span style="color: #CC9393;">"echo-server"</span>))
</pre>
</div>


<p>
è¿˜æœ‰ <code>Emacs</code> èƒ½å¤Ÿåˆ›å»ºåŠ å¯†çš„ç½‘ç»œé“¾æ¥,å¯ä»¥ä½¿ç”¨å†…ç½®æˆ–å¤–éƒ¨çš„æ”¯æŒ.å†…ç½®æ”¯æŒæ˜¯ä½¿ç”¨ <code>GnuTLS Transport Layer Security Library</code>,
</p>

<p>
å¯ä»¥é€šè¿‡ <code>gnutls-available-p</code> æ£€æŸ¥ <code>Emacs</code> æ˜¯å¦ç¼–è¯‘äº† <code>GnuTLS</code> æ”¯æŒ;å¤–éƒ¨æ”¯æŒå°±æ˜¯æ˜¯ç”¨ <code>starttls.el</code> åº“,è¿™ä¸ªè¦æ±‚ç³»ç»Ÿå®‰è£…äº† <code>gnutls-cli</code> è¿™æ ·çš„åŠŸèƒ½,è€Œ <code>open-network-stream</code> å¯ä»¥å¸®åŠ©ä½ å¤„ç†åˆ›å»ºåŠ å¯†é“¾æ¥çš„ç»†èŠ‚.
</p>
</div>
</div>



<div id="outline-container-org89d27f3" class="outline-4">
<h4 id="org89d27f3">ç½‘ç»œæœåŠ¡å™¨ (Network Servers)</h4>
<div class="outline-text-4" id="text-org89d27f3">
<p>
ä¸»è¦æ˜¯å…³äº <code>make-network-process</code> çš„ä¸€äº›ä»‹ç»,å°±ä¸è¯¦ç»†å†™äº†.
</p>
</div>
</div>


<div id="outline-container-orgf950d7a" class="outline-4">
<h4 id="orgf950d7a">æ•°æ®æŠ¥ (Datagrams)</h4>
<div class="outline-text-4" id="text-orgf950d7a">
<p>
æ•°æ®æŠ¥é“¾æ¥æ˜¯é€šè¿‡ç‹¬ç«‹çš„æ•°æ®åŒ…(packets)è€Œä¸æ˜¯æ•°æ®æµæ¥é€šä¿¡çš„.è°ƒç”¨ä¸€æ¬¡ <code>process-send</code> ä¼šå‘é€ä¸€ä¸ªæ•°æ®åŒ…,å¹¶ä¸”æ¯æ¥æ”¶ä¸€ä¸ªæ•°æ®åŒ…éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡è¿‡æ»¤å‡½æ•°.
</p>

<p>
æ•°æ®æŠ¥é“¾æ¥ä¸éœ€è¦æ¯æ—¶æ¯åˆ»éƒ½è¦è¿æ¥ä¸Šè¿œç¨‹èŠ‚ç‚¹,å®ƒæœ‰ä¸€ä¸ªè¿œç¨‹èŠ‚ç‚¹åœ°å€æ¥æŒ‡å®šæ•°æ®åŒ…å‘é€åˆ°å“ªé‡Œå»,æ¯å½“æ¥æ”¶ä¸€ä¸ªæ•°æ®åŒ…å¹¶ä¸”ä¼ å…¥åˆ°è¿‡æ»¤å‡½æ•°çš„æ—¶å€™,èŠ‚ç‚¹åœ°å€å°±ä¼šè¢«è®¾ç½®ä¸ºè¯¥å‘é€è¯¥æ•°æ®åŒ…çš„èŠ‚ç‚¹çš„åœ°å€,
</p>

<p>
æ‰€ä»¥å¦‚æœè¿‡æ»¤å‡½æ•°è¦å‘é€ä¸€ä¸ªæ•°æ®åŒ…,é‚£ä¹ˆå°±ä¼šå›åˆ°é‚£ä¸ªåœ°å€ä¸Š,å¯ä»¥åœ¨åˆ›å»ºæ•°æ®æŠ¥é“¾æ¥çš„æ—¶å€™é€šè¿‡ <code>:remote</code> å…³é”®å­—è®¾ç½®è¿œç¨‹èŠ‚ç‚¹çš„åœ°å€.
</p>

<p>
<code>process-datagram-address</code> è·å–é“¾æ¥çš„è¿œç¨‹èŠ‚ç‚¹åœ°å€, <code>set-process-datagram-address</code> å¯ä»¥è®¾ç½®é“¾æ¥çš„è¿œç¨‹èŠ‚ç‚¹åœ°å€.
</p>
</div>
</div>


<div id="outline-container-org861f980" class="outline-4">
<h4 id="org861f980">åº•å±‚ç½‘ç»œè®¿é—® (Low-Level Network)</h4>
<div class="outline-text-4" id="text-org861f980">
<p>
<code>make-network-process</code> å°±æ˜¯ <code>Emacs</code> ç”¨æ¥åˆ›å»ºç½‘ç»œé“¾æ¥çš„åŸå‡½æ•°,æœ¬ç« èŠ‚çš„é‡ç‚¹.
</p>
</div>


<ul class="org-ul">
<li><a id="org228661f"></a>ç½‘ç»œè¿›ç¨‹ (Network Processes)<br>
<div class="outline-text-5" id="text-org228661f">
<p>
ä¸»è¦æ˜¯ <code>make-network-process</code> çš„æ–‡æœ¬,å°±ä¸è¯¦ç»†å†™äº†.
</p>
</div>
</li>

<li><a id="org89ba461"></a>ç½‘ç»œé€‰é¡¹ (Network Options)<br>
<div class="outline-text-5" id="text-org89ba461">
<p>
ä¸»è¦æ˜¯ç½‘ç»œé“¾æ¥è¿›ç¨‹å¯¹è±¡çš„é€‰é¡¹,å¯ä»¥åœ¨åˆ›å»ºç½‘ç»œé“¾æ¥åé€šè¿‡ <code>set-network-process-option</code> è®¾ç½®.å°±ä¸è¯¦ç»†è¯´äº†.
</p>
</div>
</li>

<li><a id="org882f7d5"></a>ç½‘ç»œç‰¹æ€§æµ‹è¯• (Network Feature Testing)<br>
<div class="outline-text-5" id="text-org882f7d5">
<p>
æµ‹è¯• <code>Emacs</code> æ˜¯å¦æ”¯æŒæŸäº›ç½‘ç»œç‰¹æ€§,æ€»ä½“ç”¨æ³•æ˜¯è¿™æ ·,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">featurep</span> '<span style="color: #BFEBBF;">make-network-process</span> '(KEYWORD VALUE))
</pre>
</div>

<p>
æ¯”å¦‚è¦æµ‹è¯•æ˜¯å¦æ”¯æŒéé˜»å¡è¿æ¥,å¯ä»¥è¿™æ ·,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">featurep</span> '<span style="color: #BFEBBF;">make-network-process</span> '(<span style="color: #DCDCCC; font-weight: bold;">:nowait</span> t))
</pre>
</div>
</div>
</li>
</ul>
</div>


<div id="outline-container-org1d78224" class="outline-4">
<h4 id="org1d78224">ç½‘ç»œæ‚é¡¹ (Misc Network)</h4>
<div class="outline-text-4" id="text-org1d78224">
<p>
<code>network-interface-list</code> è·å–æœºå™¨ä¸Šçš„ç½‘ç»œæ¥å£åˆ—è¡¨,æ˜¯ä¸€ä¸ª <code>alist</code>,æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ <code>(NAME . ADDRESS)</code> çš„å½¢å¼.
</p>

<p>
<code>network-interface-info</code> æ ¹æ®ç½‘ç»œæ¥å£åå­—è·å–ç½‘ç»œæ¥å£çš„ä¿¡æ¯,æ ¼å¼å¦‚ <code>(ADDR BCAST NETMASK HWADDR FLAGS)</code>,åˆ†åˆ«æ˜¯ <code>IPv4</code> åœ°å€,
</p>

<p>
å¹¿æ’­åœ°å€,ç½‘ç»œæ©ç ,ç¡¬ä»¶åœ°å€å’Œå½“å‰ç½‘ç»œæ¥å£çš„ <code>flags</code> åˆ—è¡¨.
</p>

<p>
<code>format-network-address</code> æŠŠç½‘ç»œåœ°å€çš„ <code>Lisp</code> è¡¨ç¤ºè½¬åŒ–æˆä¸€ä¸ªå­—ç¬¦ä¸²,ä¸€ä¸ªäº”ä¸ªå…ƒç´ çš„å‘é‡ <code>[A B C D P]</code> è¡¨ç¤ºä¸€ä¸ª <code>IPv4</code> åœ°å€ <code>A.B.C.D</code>, <code>P</code> æ˜¯ç«¯å£å·.
</p>

<p>
ä¸€ä¸ªä¹ä¸ªå…ƒç´ çš„å‘é‡ <code>[A B C D E F G H P]</code> è¡¨ç¤ºä¸€ä¸ªç«¯å£å·ä¸º <code>P</code> çš„ <code>IPv6</code> <code>A:B:C:D:E:F:G:H</code> åœ°å€.
</p>

<p>
è¿™äº›å‡½æ•°å¹¶ä¸æ˜¯æ‰€æœ‰ç³»ç»Ÿéƒ½é€‚ç”¨çš„.
</p>
</div>
</div>



<div id="outline-container-org84f4204" class="outline-4">
<h4 id="org84f4204">ä¸²å£ (Serial Ports)</h4>
<div class="outline-text-4" id="text-org84f4204">
<p>
<code>Emacs</code> å¯ä»¥å’Œä¸²å£é€šä¿¡, <code>serial-term</code> å¯ä»¥æ‰“å¼€ä¸€ä¸ªä¸ºä½¿ç”¨ä¸²å£çš„ç»ˆç«¯,å¦‚æœæ˜¯ç¼–å†™ <code>Lisp</code> ç¨‹åº,å¯ä»¥ä½¿ç”¨ <code>make-serial-process</code> åˆ›å»ºä¸€ä¸ªä¸²å£è¿›ç¨‹å¯¹è±¡.
</p>

<p>
ä¸²å£çš„é…ç½®å¯ä»¥åœ¨è¿è¡Œæ—¶å®Œæˆ,ä¸éœ€è¦å…³é—­ä»¥åŠé‡æ–°æ‰“å¼€, <code>serial-process-configure</code> å¯ä»¥è®©ä½ æ”¹å˜é€Ÿåº¦,å­—èŠ‚å¤§å°,å’Œå…¶å®ƒå‚æ•°.
</p>

<p>
å’Œç½‘ç»œé“¾æ¥è¿›ç¨‹ä¸€æ ·,ä¸²å£è¿›ç¨‹ä¹Ÿæ˜¯æ²¡æœ‰è¿›ç¨‹ <code>ID</code>,ä¹Ÿä¸èƒ½ç»™å®ƒå‘é€ä¿¡å·,ä»¥åŠçŠ¶æ€ä¿¡æ¯ä¹Ÿæ˜¯å’Œå…¶å®ƒç±»å‹çš„è¿›ç¨‹ä¸ä¸€æ ·.
</p>

<p>
<code>delete-process</code> å’Œ <code>kill-buffer</code> å¯ä»¥å…³é—­é“¾æ¥,ä½†æ˜¯ä¸ä¼šå¯¹è¿æ¥åˆ°è¯¥ä¸²å£ä¸Šçš„è®¾å¤‡äº§ç”Ÿå½±å“.
</p>
</div>
</div>


<div id="outline-container-org8f8982c" class="outline-4">
<h4 id="org8f8982c">å­—èŠ‚æ‰“åŒ… (Byte Packing)</h4>
<div class="outline-text-4" id="text-org8f8982c">
<p>
è¿™ä¸ªç« èŠ‚ä¸»è¦æ˜¯å…³äºå¦‚ä½•æ‰“åŒ…å’Œè§£åŒ…å­—èŠ‚æ•°ç»„,é€šå¸¸éƒ½æ˜¯ä¸ºäº†äºŒè¿›åˆ¶ä¼ è¾“åè®®æ‰è¿™ä¹ˆåš. <code>Emacs</code> æä¾›äº†ä¸€äº›å‡½æ•°æŠŠå­—èŠ‚æ•°ç»„è½¬åŒ–æˆ <code>alist</code> æˆ–è€…åè¿‡æ¥.
</p>

<p>
å­—èŠ‚æ•°ç»„å¯ä»¥æ˜¯ä¸€ä¸ªç»Ÿä¸€å­—èŠ‚å­—ç¬¦ä¸²(<code>unibyte string</code>)æˆ–è€…æ˜¯ä¸€ä¸ªæ•´æ•°å‘é‡,è€Œ <code>alist</code> åˆ™æ˜¯ <code>symbol</code> å…³è”å›ºå®šå¤§å°çš„å¯¹è±¡æˆ–è€…æ˜¯ä¸€ä¸ª <code>alist</code>.
</p>

<p>
è¿™äº›å‡½æ•°éƒ½æ˜¯æ¥è‡ªäº <code>bindat</code> åº“.å­—èŠ‚æ•°ç»„åˆ° <code>alist</code> çš„è½¬åŒ–ä¹Ÿè¢«å«åšååºåˆ—åŒ–(<code>deserializing</code>)æˆ–è€…è§£åŒ…(<code>unpacking</code>),è€Œåè¿‡æ¥å«åšåºåˆ—åŒ–(<code>serializing</code>)æˆ–è€…æ‰“åŒ…(<code>packing</code>).
</p>
</div>

<ul class="org-ul">
<li><a id="org1f356a0"></a>Bindat è§„èŒƒ (Bindat Spec)<br>
<div class="outline-text-5" id="text-org1f356a0">
<p>
åœ¨æ‰“åŒ…æˆ–è€…è§£åŒ…æ•°æ®å‰éœ€è¦åˆ¶è®¢ä¸€ä¸ªæ•°æ®å¸ƒå±€è§„èŒƒ(<code>data layout specification</code>),å°±æ˜¯ä¸€ä¸ªåµŒå¥—åˆ—è¡¨,æè¿°æœ‰åå­—ä»¥åŠç±»å‹çš„å­—æ®µ.
</p>

<p>
è¯¥è§„èŒƒæ§åˆ¶çš„å­—æ®µè¢«å¤„ç†çš„é•¿åº¦ä»¥åŠæ‰“åŒ…å’Œè§£åŒ…çš„æ–¹å¼.ä¸€èˆ¬è¿™ä¸ªè§„èŒƒçš„å˜é‡çš„åå­—éƒ½æ˜¯ <code>-bindat-spec</code> ç»“å°¾,è¿™ç§åå­—çš„å˜é‡ä¼šè‡ªåŠ¨è¢« <code>Emacs</code> è¯†åˆ«ä¸ºæœ‰é£é™©.
</p>

<p>
å­—æ®µçš„ç±»å‹æè¿°äº†å­—æ®µè¡¨ç¤ºçš„å¯¹è±¡çš„å¤§å°(byteä¸ºå•ä½),è¿˜æœ‰åœ¨å­—æ®µè¡¨ç¤ºå¤šå­—èŠ‚çš„æ—¶å€™å­—èŠ‚æ˜¯å¦‚ä½•æ’åºçš„.åªæœ‰ä¸¤ç§æ’åº, <code>big endian</code> (å¤§ç«¯,é«˜ä½ä¼˜å…ˆ)å’Œ <code>litte endian</code> (å°ç«¯,ä½ä½ä¼˜å…ˆ),
</p>

<p>
<code>big endian</code> ä¹Ÿå«ç½‘ç»œå­—èŠ‚é¡ºåº (<code>network byte ordering</code>).æ¯”å¦‚ <code>#x23cd</code> æœ‰ <code>#x23</code> å’Œ <code>#xcd</code> ä¸¤ä¸ªå­—èŠ‚, <code>big endian</code> æ’åºå°±æ˜¯ <code>#x23 #xcd</code>, <code>little endian</code> å°±æ˜¯ <code>#xcd #x23</code>.
</p>

<p>
ç±»å‹çš„å€¼å‚è€ƒå°±è‡ªå·±çœ‹æ–‡æ¡£äº†.
</p>
</div>
</li>



<li><a id="org78eb784"></a>Bindat Functions<br>
<div class="outline-text-5" id="text-org78eb784">
<p>
<code>Bindat</code> åº“çš„ <code>APIs</code>,è‡ªå·±é˜…è¯».
</p>
</div>
</li>


<li><a id="orge980d9a"></a>Bindat Examples<br>
<div class="outline-text-5" id="text-orge980d9a">
<p>
å‰ä¸¤ç« èŠ‚ä»‹ç»äº†æ¦‚å¿µä»¥åŠä¸€äº› <code>APIs</code>,è¿™ç« èŠ‚å°±æœ‰å®Œæ•´ä¾‹å­.
</p>

<p>
æ‰“åŒ…:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(bindat-pack
 '((numberA u16)
   (numberB u16))
 '((numberA . #x83aa)
   (numberB . #x7e80))) <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; "\203\252~\200"</span>
</pre>
</div>



<p>
è§£åŒ…:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">header</span> {
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">long</span>    <span style="color: #DFAF8F;">dest_ip</span>;
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">long</span>    <span style="color: #DFAF8F;">src_ip</span>;
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">short</span>   <span style="color: #DFAF8F;">dest_port</span>;
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">short</span>   <span style="color: #DFAF8F;">src_port</span>;
};

<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data</span> {
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">char</span>    <span style="color: #DFAF8F;">type</span>;
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">char</span>    <span style="color: #DFAF8F;">opcode</span>;
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">short</span>   <span style="color: #DFAF8F;">length</span>;  <span style="color: #5F7F5F;">/* </span><span style="color: #7F9F7F;">in network byte order  </span><span style="color: #5F7F5F;">*/</span>
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">char</span>    <span style="color: #DFAF8F;">id</span>[8];   <span style="color: #5F7F5F;">/* </span><span style="color: #7F9F7F;">null-terminated string  </span><span style="color: #5F7F5F;">*/</span>
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">char</span>    <span style="color: #DFAF8F;">data</span>[<span style="color: #5F7F5F;">/* </span><span style="color: #7F9F7F;">(length + 3) &amp; ~3 </span><span style="color: #5F7F5F;">*/</span>];
};

<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">packet</span> {
  <span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">header</span>    <span style="color: #DFAF8F;">header</span>;
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">long</span>    <span style="color: #DFAF8F;">counters</span>[2];  <span style="color: #5F7F5F;">/* </span><span style="color: #7F9F7F;">in little endian order  </span><span style="color: #5F7F5F;">*/</span>
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">char</span>    <span style="color: #DFAF8F;">items</span>;
  <span style="color: #7CB8BB;">unsigned</span> <span style="color: #7CB8BB;">char</span>    <span style="color: #DFAF8F;">filler</span>[3];
  <span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data</span>      <span style="color: #DFAF8F;">item</span>[<span style="color: #5F7F5F;">/* </span><span style="color: #7F9F7F;">items </span><span style="color: #5F7F5F;">*/</span>];
};
</pre>
</div>

<p>
å¯¹åº” <code>Bindat</code> è§„èŒƒå°±æ˜¯
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> header-spec
      '((dest-ip   ip)
        (src-ip    ip)
        (dest-port u16)
        (src-port  u16)))

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> data-spec
      '((type      u8)
        (opcode    u8)
        (length    u16)  <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">network byte order</span>
        (id        strz 8)
        (data      vec (length))
        (align     4)))

(<span style="color: #F0DFAF; font-weight: bold;">setq</span> packet-spec
      '((header    struct header-spec)
        (counters  vec 2 u32r)   <span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">little endian order</span>
        (items     u8)
        (fill      3)
        (item      repeat (items)
                   (struct data-spec))))
</pre>
</div>

<p>
å‡è®¾æœ‰ä¸€ä¸ªå¦‚ä¸‹çš„äºŒè¿›åˆ¶æ•°æ®,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> binary-data
      [ 192 168 1 100 192 168 1 101 01 28 21 32
            160 134 1 0 5 1 0 0 2 0 0 0
            2 3 0 5 ?A ?B ?C ?D ?E ?F 0 0 1 2 3 4 5 0 0 0
            1 4 0 7 ?B ?C ?D ?E ?F ?G 0 0 6 7 8 9 10 11 12 0 ])
</pre>
</div>

<p>
è§£ç æˆå¯¹åº”çš„ç»“æ„æ˜¯,
</p>

<div class="org-src-container">
<pre class="src src-elisp">((item
  ((data .
         [1 2 3 4 5])
   (id . <span style="color: #CC9393;">"ABCDEF"</span>)
   (length . 5)
   (opcode . 3)
   (type . 2))
  ((data .
         [6 7 8 9 10 11 12])
   (id . <span style="color: #CC9393;">"BCDEFG"</span>)
   (length . 7)
   (opcode . 4)
   (type . 1)))
 (items . 2)
 (counters .
           [100000 261])
 (header
  (src-port . 5408)
  (dest-port . 284)
  (src-ip .
          [192 168 1 101])
  (dest-ip .
           [192 168 1 100])))
</pre>
</div>

<p>
åˆ©ç”¨ <code>bindat-get-filed</code> è·å–å­—æ®µçš„å€¼,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(bindat-get-field decoded 'item 1 'id)<span style="color: #5F7F5F;">; </span><span style="color: #7F9F7F;">=&gt; "BCDEFG"</span>
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>




<div id="outline-container-orgcab3145" class="outline-3">
<h3 id="orgcab3145">æ˜¾ç¤º (Display)</h3>
</div>


<div id="outline-container-org77f97ed" class="outline-3">
<h3 id="org77f97ed">æŒ‰é”®æ˜ å°„ (Keymaps)</h3>
<div class="outline-text-3" id="text-org77f97ed">
<p>
å‚¨å­˜è¾“å…¥äº‹ä»¶çš„å‘½ä»¤ç»‘å®šæ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„å°±å«åšæŒ‰é”®æ˜ å°„.æŒ‰é”®æ˜ å°„çš„æ¯ä¸€ä¸ªæ¡ç›®éƒ½å…³è”/ç»‘å®šä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„äº‹ä»¶ç±»å‹,æˆ–è€…ç»‘å®šåˆ°å¦å¤–ä¸€ä¸ªæŒ‰é”®æ˜ å°„,åˆæˆ–è€…æ˜¯ä¸€ä¸ªå‘½ä»¤.
</p>

<p>
å½“ä¸€ä¸ªäº‹ä»¶ç±»å‹ç»‘å®šåˆ°ä¸€ä¸ªæŒ‰é”®æ˜ å°„,é‚£ä¹ˆè¿™ä¸ªæŒ‰é”®æ˜ å°„å°±è¢«ç”¨æ¥å¯»æ‰¾ä¸‹ä¸€ä¸ªè¾“å…¥äº‹ä»¶,ä¸€ç›´æŒç»­åˆ°å‘½ä»¤è¢«æ‰¾åˆ°ä¸ºæ­¢,æ•´ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºæŒ‰é”®æŸ¥æ‰¾(<code>key lookup</code>).
</p>
</div>

<div id="outline-container-orgc6e2e98" class="outline-4">
<h4 id="orgc6e2e98">æŒ‰é”®åºåˆ— (Key Sequences)</h4>
<div class="outline-text-4" id="text-orgc6e2e98">
<p>
ä¸€ä¸ªæŒ‰é”®åºåˆ—,åˆç§°æŒ‰é”®,æ˜¯ä¸€ä¸ªç”±ä¸€åˆ°å¤šä¸ªè¾“å…¥äº‹ä»¶å½¢æˆçš„åºåˆ—,æ˜¯ä¸€ä¸ªå•å…ƒ.åœ¨ <code>Emacs Lisp</code> ä¸­å¯ä»¥ç”¨ <code>string</code> æˆ–è€… <code>vector</code> æ¥è¡¨ç¤ºæŒ‰é”®åºåˆ—.
</p>

<p>
åœ¨ <code>string</code> çš„è¡¨ç¤ºä¸‹,å­—æ¯å­—ç¬¦å°±æ˜¯ä»£è¡¨è‡ªèº«,æ¯”å¦‚ <code>"a"</code> å°±æ˜¯è¡¨ç¤ºå­—æ¯a, <code>"2"</code> å°±æ˜¯è¡¨ç¤ºæ•°å­—2.ä¸€äº› <code>modifiers</code>, æ¯”å¦‚ <code>Control</code> å­—ç¬¦æ˜¯ <code>"\C-"</code>, <code>meta</code> å­—ç¬¦æ˜¯ <code>"\M-"</code>.
</p>

<p>
<code>"\C-x"</code> è¡¨ç¤ºæŒ‰é”® <code>C-x</code>,å¦å¤–, <code>&lt;TAB&gt;, &lt;RET&gt;, &lt;ESC&gt; å’Œ &lt;DEL&gt;</code> åˆ†åˆ«æ˜¯ <code>"\t", "\r", "\e" å’Œ "\d"</code>,è¿˜æœ‰ <code>"\C-xl"</code> è¡¨ç¤ºæŒ‰é”® <code>C-x l</code>.
</p>

<p>
å¹¶ä¸æ˜¯æ‰€æœ‰æŒ‰é”®,äº‹ä»¶æˆ–è€…å­—ç¬¦éƒ½èƒ½é€šè¿‡ <code>string</code> è¡¨ç¤º,åŠŸèƒ½é”®,é¼ æ ‡æŒ‰é’®äº‹ä»¶,ç³»ç»Ÿäº‹ä»¶å’Œ <code>non-ASCII</code> å­—ç¬¦ (æ¯”å¦‚, <code>C-=</code> å’Œ <code>H-a</code>)å°±ä¸èƒ½ç”¨ <code>string</code> è¡¨ç¤º,å¿…é¡»ç”¨ <code>vector</code> è¡¨ç¤º.
</p>

<p>
åœ¨ <code>vector</code> è¡¨ç¤ºä¸­, <code>vector</code> çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªè¾“å…¥äº‹ä»¶.æ¯”å¦‚ <code>[?\C-x ?l]</code> è¡¨ç¤º <code>C-x l</code>.
</p>

<p>
å¦‚æœå«Œç›´æ¥ç”¨ä¸Šé¢çš„è¡¨ç¤ºéº»çƒ¦,å¯ä»¥æ˜¯ç”¨ <code>kbd</code> å’Œåºåˆ—æ–‡æœ¬(æ¯”å¦‚ <code>C-x l</code>)æ¥å¾—å‡ºä¸Šé¢çš„è¡¨ç¤º.
</p>
</div>
</div>


<div id="outline-container-org5832b98" class="outline-4">
<h4 id="org5832b98">æŒ‰é”®æ˜ å°„çš„åŸºç¡€ (Keymap Basics)</h4>
<div class="outline-text-4" id="text-org5832b98">
<p>
æŒ‰é”®æ˜ å°„æ˜¯ä¸€ç§ <code>Lisp</code> æ•°æ®ç»“æ„,ä¸ºå„ç§ä¸åŒçš„æŒ‰é”®åºåˆ—æŒ‡å®šæŒ‰é”®ç»‘å®š,æ‰€è°“æŒ‰é”®ç»‘å®šçš„å°±æ˜¯äº‹ä»¶.
</p>

<p>
å¦‚æœä¸€ä¸ªæŒ‰é”®åºåˆ—ç”±ä¸€ä¸ªäº‹ä»¶ç»„æˆ,é‚£ä¹ˆè¿™ä¸ªæŒ‰é”®åºåˆ—åœ¨æŒ‰é”®æ˜ å°„ä¸Šçš„ç»‘å®š(binding in a keymap)å°±æ˜¯é‚£ä¸ªäº‹ä»¶çš„æŒ‰é”®æ˜ å°„çš„å®šä¹‰(keymap's definition).
</p>

<p>
å¯¹äºæ›´é•¿çš„æŒ‰é”®åºåˆ—:é¦–å…ˆåœ¨æŒ‰é”®æ˜ å°„ä¸Šæ‰¾åˆ°ç¬¬ä¸€ä¸ªäº‹ä»¶çš„å®šä¹‰,ç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æŒ‰é”®åºåˆ—é‡Œé¢æ‰€æœ‰çš„äº‹ä»¶éƒ½è¢«å¤„ç†å®Œ.
</p>

<p>
å¦‚æœä¸€ä¸ªæŒ‰é”®åºåˆ—çš„ç»‘å®šæ˜¯ä¸€ä¸ªæŒ‰é”®æ˜ å°„,é‚£ä¹ˆè¿™ä¸ªæŒ‰é”®åºåˆ—å°±æ˜¯ä¸€ä¸ª <code>prefix key</code>,å¦åˆ™å°±æ˜¯ä¸€ä¸ª <code>complete key</code> (å› ä¸ºä¸èƒ½åœ¨å®ƒçš„åŸºç¡€ä¸Šæ·»åŠ æ›´å¤šäº‹ä»¶äº†).
</p>

<p>
å¦‚æœç»‘å®šæ˜¯ <code>nil</code>,é‚£ä¹ˆå°±æ˜¯ <code>undefined</code>.
</p>

<p>
æŸ¥æ‰¾ä¸€ä¸ªæŒ‰é”®åºåˆ—çš„ç»‘å®šä¼šå‡è®¾ä¸­é—´çš„ç»‘å®š(æœ€åä¸€ä¸ªä¹‹å‰çš„æ‰€æœ‰äº‹ä»¶)éƒ½æ˜¯æŒ‰é”®æ˜ å°„,å¦‚æœä¸ç¬¦åˆå‡è®¾,é‚£ä¹ˆè¿™ä¸ªäº‹ä»¶åºåˆ—å°±å½¢æˆä¸äº†ä¸€ä¸ªçœŸæ­£çš„æŒ‰é”®åºåˆ—.
</p>

<p>
æ¢å¥è¯è®²,åœ¨ä»»ä½•åˆæ³•çš„æŒ‰é”®åºåˆ—çš„å°¾éƒ¨ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªçš„äº‹ä»¶éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª <code>prefix key</code>,æ¯”å¦‚ <code>C-f C-n</code> ä¸æ˜¯ä¸€ä¸ªæŒ‰é”®åºåˆ—,é‚£ä¹ˆ <code>C-f</code> å°±ä¸æ˜¯ä¸€ä¸ª <code>prefix key</code>,æ‰€æœ‰ä»¥ <code>C-f</code> å¼€å¤´çš„åºåˆ—éƒ½ä¸æ˜¯ä¸€ä¸ªæŒ‰é”®åºåˆ—.
</p>

<p>
å¤šäº‹ä»¶çš„æŒ‰é”®åºåˆ—çš„åŠ¨ä½œ (the set of possible multi-event key sequences) å–å†³äº <code>prefix keys</code> çš„ç»‘å®š,å› æ­¤ä¸åŒçš„æŒ‰é”®æ˜ å°„ä¼šä¸ä¸€æ ·,å¹¶ä¸”ä¼šå› ä¸ºç»‘å®šçš„æ”¹å˜è€Œå‘ç”Ÿæ”¹å˜.
</p>

<p>
ç„¶è€Œå•äº‹ä»¶ (one-event) æŒ‰é”®åºåˆ—å¿…å®šæ˜¯ä¸€ä¸ªæŒ‰é”®åºåˆ—,å› ä¸ºå®ƒä¸ä¾èµ–ä¸ä»»ä½• <code>prefix keys</code>.
</p>

<p>
åœ¨ä»»ä½•æ—¶å€™,æ€»æœ‰å‡ ä¸ªåŸºç¡€çš„æŒ‰é”®åºåˆ—æ˜¯æ¿€æ´»çš„,ç”¨æ¥æŸ¥æ‰¾æŒ‰é”®ç»‘å®š:
</p>

<ol class="org-ol">
<li>1ä¸ª <code>global map</code>: è¢«æ‰€æœ‰ç¼“å†²åŒºå…±äº«;</li>
<li>1ä¸ª <code>local keymap</code>: ä¸ç‰¹å®šä¸»æ¨¡å¼(<code>major mode</code>)å…³è”;</li>
<li>0åˆ°å¤šä¸ª <code>minor mode keymaps</code>: å±äºå½“å‰å¯ç”¨çš„æ¬¡è¦æ¨¡å¼(<code>minor mode keymaps</code>),ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æ¬¡è¦æ¨¡å¼éƒ½æœ‰æŒ‰é”®æ˜ å°„.</li>
</ol>

<p>
<code>local keymap</code> ä¼šé®æ© <code>global map</code>,è€Œ <code>minor mode keymap</code> ä¼šé®æ© <code>local keymap</code> å’Œ <code>global map</code>.
</p>
</div>
</div>


<div id="outline-container-org160be08" class="outline-4">
<h4 id="org160be08">æŒ‰é”®æ˜ å°„çš„æ ¼å¼ (Format of Keymaps)</h4>
<div class="outline-text-4" id="text-org160be08">
<p>
æ¯ä¸ªæŒ‰é”®æ˜ å°„éƒ½æ˜¯ä¸€ä¸ªåˆ—è¡¨,å®ƒçš„ <code>CAR</code> æ˜¯ä¸€ä¸ª <code>symbol - keymap</code>, <code>CDR</code> å®šä¹‰äº†æŒ‰é”®æ˜ å°„çš„æŒ‰é”®ç»‘å®š.
</p>

<p>
ä¸€ä¸ªå‡½æ•°å®šä¹‰æ˜¯ä¸€ä¸ªæŒ‰é”®æ˜ å°„çš„ <code>symbol</code> æ˜¯ä¸€ä¸ªæŒ‰é”®æ˜ å°„,å¯ä»¥åˆ©ç”¨ <code>keymapp</code> å‡½æ•°æ¥æµ‹è¯•,æ¯”å¦‚,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(fset 'foo '(keymap))
(keymapp 'foo)
</pre>
</div>

<p>
åœ¨ <code>keymap symbol</code> çš„åé¢æœ‰è¿™å‡ ç§å¯èƒ½:
</p>

<ul class="org-ul">
<li><code>(TYPE . BINDING)</code>: ç±»å‹ <code>TYPE</code> çš„äº‹ä»¶çš„ç»‘å®š,æ˜¯ä¸€ä¸ªå­—ç¬¦æˆ–è€… <code>symbol</code>, <code>BINDING</code> æ˜¯ä¸€ä¸ªå‘½ä»¤.</li>
<li><code>(TYPE ITEM-NAME . BINDING)</code>: å’Œä¸Šé¢ç±»ä¼¼,åªæ˜¯è¿™ä¸ªç»‘å®šåŒæ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªæ˜¾ç¤ºåœ¨èœå•çš„é¡¹.</li>
<li><code>(TYPE ITEM-NAME HELP-STRING . BINDING)</code>: å’Œä¸Šé¢ç±»ä¼¼,å¤šäº†ä¸€ä¸ªå¸®åŠ©è¯´æ˜.</li>
<li><code>(TYPE menu-item . DETAILS)</code>: è¯¥ç»‘å®šåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ‹“å±•èœå•é¡¹.</li>
<li><code>(t . BINDING)</code>: è¡¨ç¤ºé»˜è®¤æŒ‰é”®ç»‘å®š,ä»»ä½•æ²¡æœ‰è¢«æŒ‰é”®æ˜ å°„çš„å…¶ä»–å…ƒç´ ç»‘å®šçš„äº‹ä»¶çš„ç»‘å®šå°±æ˜¯ <code>BINDING</code>.é»˜è®¤ç»‘å®šå…è®¸æŒ‰é”®æ˜ å°„åœ¨ä¸æšä¸¾æ‰€æœ‰å¯èƒ½çš„äº‹ä»¶ç±»å‹çš„æƒ…å†µä¸‹å¯¹å®ƒä»¬è¿›è¡Œç»‘å®š.
æ‹¥æœ‰é»˜è®¤ç»‘å®šçš„æŒ‰é”®æ˜ å°„ä¼šå®Œå…¨åŒ¹é…æ‰€æœ‰ä½ä¼˜å…ˆçº§(lower-precedence)çš„æŒ‰é”®æ˜ å°„,é™¤äº†é‚£äº›ç»‘å®šä¸º <code>nil</code> çš„äº‹ä»¶.</li>
<li><code>CHAR-TABLE</code>: å¦‚æœæŒ‰é”®æ˜ å°„çš„å…ƒç´ æ˜¯ä¸€ä¸ªå­—ç¬¦è¡¨,é‚£ä¹ˆå®ƒå°±æ‹¥æœ‰æ‰€æœ‰é <code>modifier bits</code> çš„å­—ç¬¦äº‹ä»¶çš„ç»‘å®š,æ¯”å¦‚ <code>C</code> å°±æ˜¯å­—ç¬¦ <code>C</code>.è¿™ç§å«åš <code>full keymap</code>,åˆ«çš„ <code>keymap</code> å«åš <code>sparse keymaps</code>.</li>
<li><code>VECTOR</code>: ç±»ä¼¼ä¸ <code>CHAR-TABLE</code>,æ•°æ®ç»“æ„ä¸ä¸€æ ·è€Œå·².</li>
<li><code>STRING</code>: å¹¶éå’Œå…¶ä»–å…ƒç´ ä¸€æ ·è¡¨ç¤ºæŒ‰é”®ç»‘å®š,è¿™æ˜¯ <code>overall prompt string</code>,ç”¨äºåšä¸ºèœå•çš„æŒ‰é”®æ˜ å°„.</li>
<li><code>(keymap ...)</code>: å…ƒç´ æœ¬èº«æ˜¯æŒ‰é”®æ˜ å°„,å’Œä¸Šé¢çš„æƒ…å†µä¸ä¸€æ ·,ä¸Šé¢æ˜¯é’ˆå¯¹åªæœ‰ä¸€ä¸ªäº‹ä»¶çš„æ¡ˆä»¶åºåˆ—,è¿™ä¸ªæ˜¯é’ˆå¯¹äºé•¿çš„æŒ‰é”®åºåˆ—çš„,å°±æ˜¯ <code>C-c</code> ä¸ <code>C-c C-c</code> çš„åŒºåˆ«,æ˜¯å¤šå±‚æ¬¡çš„çš„è¡¨ç°.</li>
</ul>

<p>
å½“ç»‘å®šä¸º <code>nil</code> çš„æ—¶å€™,å®ƒä¸æ„æˆä¸€ä¸ªå®šä¹‰,ä½†æ˜¯å®ƒçš„ç¡®æ¯”é»˜è®¤ç»‘å®šå’Œ <code>parent keymap</code> è¦é«˜ä¼˜å…ˆçº§,ä½†æ˜¯åœ¨å¦å¤–ä¸€ä¸ªæ–¹é¢, <code>nil</code> çš„ç»‘å®šä¸ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„ <code>keymap</code>,å› æ­¤å¦‚æœ <code>local map</code> æ˜¯ <code>nil</code> ç»‘å®š,é‚£ä¹ˆå°±ä¼šç›´æ¥ç”¨ <code>global map</code> çš„ç»‘å®š.
</p>

<p>
æŒ‰é”®æ˜ å°„ä¸ä¼šç›´æ¥è®°å½• <code>meta</code> å­—ç¬¦çš„ç»‘å®š,ç›¸å <code>meta</code> å­—ç¬¦è¢«ç”¨äº <code>&lt;ESC&gt;</code> (æˆ–è€…æ˜¯ <code>meta-prefix-char</code> çš„å€¼) å¼€å¤´çš„ä¸¤å­—ç¬¦çš„æŒ‰é”®åºåˆ—çš„æŒ‰é”®æŸ¥æ‰¾ä¸Š.å› æ­¤ <code>M-a</code> ç›¸å½“äº <code>&lt;ESC&gt; a</code>,è¿™æ¡è§„åˆ™åªèƒ½ç”¨äºå­—ç¬¦æŒ‰é”®ä¸Š,æ¯”å¦‚ <code>M-&lt;end&gt;</code> å’Œ <code>&lt;ESC&gt; &lt;end&gt;</code> æ˜¯æ²¡æœ‰å…³ç³»çš„.
</p>

<p>
æƒ³çœ‹ç°å®çš„ä¾‹å­å¯ä»¥é€šè¿‡ <code>c-h v</code> æ¥æ‰¾ <code>XXX-map</code> çœ‹,æ¯”å¦‚ <code>lisp-mode-map</code>,å¯¹äºå¦‚ä½•çœ‹æ‡‚æŒ‰é”®æ˜ å°„è¿˜è¦å­¦ä¼šå¦‚ä½•è®¡ç®—æŒ‰é”®äº‹ä»¶çš„å€¼,å…·ä½“é˜…è¯»è¿™é‡Œ <code>M-: (info "(elisp) Keyboard Events")</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(keymap
 (24 keymap <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">24 &#26159;?\C-x</span>
     (5 . lisp-eval-last-sexp)) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">5 &#26159;?\C-e,&#25152;&#20197; ?\C-x?\C-e &#36816;&#34892; lisp-eval-last-sexp</span>
 (menu-bar keymap
           (lisp #1=<span style="color: #CC9393;">"Lisp"</span> keymap
                 (ind-sexp menu-item <span style="color: #CC9393;">"Indent sexp"</span> indent-sexp <span style="color: #DCDCCC; font-weight: bold;">:help</span> <span style="color: #CC9393;">"Indent each line of the list starting just after point"</span>)
                 (ev-def menu-item <span style="color: #CC9393;">"Eval defun"</span> lisp-eval-defun <span style="color: #DCDCCC; font-weight: bold;">:help</span> <span style="color: #CC9393;">"Send the current defun to the Lisp process made by M-x run-lisp"</span>)
                 (run-lisp menu-item <span style="color: #CC9393;">"Run inferior Lisp"</span> run-lisp <span style="color: #DCDCCC; font-weight: bold;">:help</span> <span style="color: #CC9393;">"Run an inferior Lisp process, input and output via buffer `</span><span style="color: #BFEBBF;">*inferior-lisp*</span><span style="color: #CC9393;">'"</span>)
                 #1#))
 (3 keymap
    <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">3 &#26159; ?\C-c</span>
    (22 . lisp-show-variable-documentation)
    (6 . lisp-show-function-documentation)
    (4 . lisp-describe-sym)
    (1 . lisp-show-arglist)
    (11 . lisp-compile-file)
    (12 . lisp-load-file)
    (3 . lisp-compile-defun) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">3 &#26159; ?\C-c,&#25152;&#20197; ?\C-c?\C-c &#23601;&#36816;&#34892; list-compile-func</span>
    (16 . lisp-eval-paragraph)
    (14 . lisp-eval-form-and-next)
    (18 . lisp-eval-region)
    (5 . lisp-eval-defun)
    (26 . switch-to-lisp))
 (27 keymap
     (24 . lisp-eval-defun))
 <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#21040;&#36825;&#37324;&#20026;&#27490;&#30340;&#19978;&#38754;&#23601;&#26159;&#19968;&#20010; keymap</span>
 keymap   <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">&#36825;&#19968;&#37096;&#20998;&#26159;&#20174;&#21035;&#30340; map &#32487;&#25215;&#36807;&#26469;&#30340;,&#21487;&#20197;&#22312; C-h v lisp-mode-map &#30340;&#25991;&#26723;&#20013;&#30475;&#21040;.</span>
 (127 . backward-delete-char-untabify)
 (27 keymap
     (17 . indent-sexp))
 keymap
 (27 keymap
     (17 . prog-indent-sexp)))
</pre>
</div>
</div>
</div>


<div id="outline-container-org95d78c9" class="outline-4">
<h4 id="org95d78c9">åˆ›å»ºæŒ‰é”®æ˜ å°„ (Creating Keymaps)</h4>
<div class="outline-text-4" id="text-org95d78c9">
<p>
æŒ‰é”®æ˜ å°„æœ‰ä¸¤ç§: <code>full keymap</code> å’Œ <code>sparse keymap</code>,å‰è€…æ˜¯åŒ…å«ä¸€å¼ æ‹¥æœ‰é <code>modifier</code> å­—ç¬¦çš„å­—ç¬¦è¡¨,åè€…æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ¡ç›®çš„æŒ‰é”®æ˜ å°„.
</p>

<p>
åˆ†åˆ«çš„å‡½æ•°æ˜¯ <code>make-keymap</code> å’Œ <code>make-sparse-keymap</code>,è€Œé™¤äº†åˆ›å»ºå¤–,è¿˜å¯ä»¥é€šè¿‡ <code>copy-keymap</code> å¤åˆ¶åˆ«äºº <code>map</code>,è¿™ä¸ªåŠŸèƒ½åŸºæœ¬æ˜¯ç”¨ä¸ä¸Šçš„,å¦‚æœåªæ˜¯æƒ³è¦ä¸€ä¸ªå’Œåˆ«çš„å·®ä¸å¤šçš„æŒ‰é”®æ˜ å°„,é‚£ä¹ˆåº”è¯¥ä½¿ç”¨ <code>set-keymap-parent</code> ç»§æ‰¿åˆ«çš„æŒ‰é”®æ˜ å°„.
</p>
</div>
</div>


<div id="outline-container-org8e82ea0" class="outline-4">
<h4 id="org8e82ea0">ç»§æ‰¿å’ŒæŒ‰é”®æ˜ å°„ (Inheritance and Keymaps)</h4>
<div class="outline-text-4" id="text-org8e82ea0">
<p>
æŒ‰é”®æ˜ å°„å¯ä»¥ç»§æ‰¿åˆ«çš„æŒ‰é”®æ˜ å°„,è¢«ç»§æ‰¿çš„ä¸€ä¸ªå«åš <code>parent keymap</code>,è¿™ç§æŒ‰é”®æ˜ å°„ç»“æ„æ˜¯è¿™æ ·çš„:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(keymap ELEMENTS... . PARENT-KEYMAP)
</pre>
</div>

<p>
ä¸€ä¸ªæ¯”è¾ƒç†Ÿæ‚‰çš„ä¾‹å­å°±æ˜¯ <code>lisp-mode-map</code>,å®ƒçš„ <code>parent keymap</code> å°±æ˜¯ <code>lisp-mode-shared-map</code>.
</p>

<p>
<code>lisp-mode-map</code> ç»§æ‰¿äº†æ‰€æœ‰ <code>lisp-mode-shared-map</code> çš„ç»‘å®š,åœ¨æŸ¥æ‰¾æŒ‰é”®çš„æ—¶å€™, <code>Emacs</code> ä¼šå…ˆçœ‹ <code>lisp-mode-map</code> æœ‰æ²¡æœ‰æŸ¥æ‰¾çš„ç»‘å®š,å¦‚æœæ²¡æœ‰å°±å» <code>lisp-mode-shared-map</code> ä¸ŠæŸ¥æ‰¾.
</p>

<p>
å¦‚æœç”¨ <code>define-key</code> æˆ–è€…å…¶å®ƒæŒ‰é”®ç»‘å®šçš„å‡½æ•°æ”¹å˜äº† <code>lisp-mode-shared-mode</code> çš„ç»‘å®š, <code>lisp-mode-map</code> ä¹Ÿæ˜¯èƒ½å¤Ÿçœ‹åˆ°è¿™äº›æ”¹å˜.
</p>

<p>
ä½†å¦‚æœåè¿‡æ¥,æ”¹å˜ <code>lisp-mode-map</code> ä¸Šé¢çš„ç»‘å®š,æ˜¯ä¸ä¼šå¯¹ <code>lisp-mode-shared-map</code> é€ æˆå½±å“çš„.
</p>

<p>
æ„å»ºä¸€ä¸ªæœ‰ <code>parent keymap</code> çš„æŒ‰é”®æ˜ å°„çš„æ­£ç¡®åšæ³•æ˜¯ä½¿ç”¨ <code>set-keymap-parent</code>,ä¸åº”è¯¥ç›´æ¥é€šè¿‡"æ‰‹åŠ¨"æ„å»º.
</p>

<p>
å¯ä»¥é€šè¿‡ <code>keymap-parent</code> æ¥è·å– <code>parent keymap</code>,æ¯”å¦‚:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(keymap-parent lisp-mode-map)
</pre>
</div>

<p>
å¦‚æœæ²¡æœ‰ <code>parent keymap</code> å°±è¿”å› <code>nil</code>.
</p>

<p>
å‡è®¾ç°åœ¨è¦æ±‚æ„å»ºä¸€ä¸ªå’Œ <code>lisp-mode-map</code> å·®ä¸å¤šçš„ <code>keymap</code>,åˆ©ç”¨ç»§æ‰¿å¯ä»¥è¿™ä¹ˆåš,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((map (map-sparse-keymap)))
  (set-keymap-parent map lisp-mode-map)
  map)
</pre>
</div>

<p>
<code>non-spare</code> æŒ‰é”®æ˜ å°„ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ª <code>parent keymap</code>,ä¸è¿‡æ„ä¹‰ä¸å¤§,å› ä¸ºå®ƒä»¬ä¸€å®šä¼šä¸ºæ‰€æœ‰ä¸å¸¦ <code>modifier bits</code> çš„æ•°å­—å­—ç¬¦æŒ‡å®šäº†ç»‘å®š,
</p>

<p>
æ‰€ä»¥è¿™äº›ç»‘å®šæ˜¯ä¸å¯èƒ½ä»åˆ«çš„ <code>parent keymap</code> ç»§æ‰¿åˆ°çš„.
</p>

<p>
æœ‰æ—¶å€™æƒ³ç»§æ‰¿å¤šä¸ªæ˜ å°„,å¯ä»¥ä½¿ç”¨ <code>make-composed-keymap</code>,æ¯”å¦‚ <code>Emacs</code> çš„ <code>help-mode-map</code>,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((map (make-sparse-keymap)))
  (set-keymap-parent map
                     (make-composed-keymap button-buffer-map special-mode-map))
  ... map) <span style="color: #D0BF8F; font-weight: bold;">... )</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org80e2a3d" class="outline-4">
<h4 id="org80e2a3d">å‰ç¼€é”® (Prefix Keys)</h4>
<div class="outline-text-4" id="text-org80e2a3d">
<p>
æ‰€è°“å‰ç¼€é”®å°±æ˜¯ä¸€ä¸ªç»‘å®šä¸ºä¸€ä¸ª <code>keymap</code> çš„æŒ‰é”®åºåˆ—.å…¶å®ƒæŒ‰é”®æ˜ å°„å®šä¹‰äº†é‚£äº›æ‹“å±•äº†å‰ç¼€æŒ‰é”®çš„æŒ‰é”®åºåˆ—çš„ç»‘å®š,
</p>

<p>
æ¯”å¦‚ <code>C-x</code> æ˜¯ä¸€ä¸ªå‰ç¼€é”®,å®ƒä½¿ç”¨çš„æŒ‰é”®æ˜ å°„åˆšå¥½ä¹Ÿå‚¨å­˜åœ¨ <code>ctl-x-map</code> ä¸­,è¿™ä¸ªæŒ‰é”®æ˜ å°„å®šä¹‰äº†ä»¥ <code>C-x</code> å¼€å¤´çš„æŒ‰é”®åºåˆ—.
</p>

<p>
ä¸€äº›æ ‡å‡†çš„ <code>Emacs</code> å‰ç¼€é”®ä¹Ÿå¯ä»¥åœ¨ <code>Lisp</code> å˜é‡ä¸­æ‰¾åˆ°,å…·ä½“å°±è‡ªå·±æŸ¥é˜…äº† <code>M-: (info "(elisp) Prefix Keys")</code>.
</p>

<p>
å‰ç¼€é”®çš„æŒ‰é”®æ˜ å°„ç»‘å®šå°±æ˜¯ç”¨æ¥æŸ¥æ‰¾è·Ÿåœ¨å‰ç¼€é”®åé¢çš„äº‹ä»¶çš„,ç»‘å®šå¯èƒ½æ˜¯ä¸€ä¸ª <code>symbol</code>,è¿™ä¸ª <code>symbol</code> çš„å‡½æ•°å®šä¹‰å°±æ˜¯ä¸€ä¸ªæŒ‰é”®æ˜ å°„,
</p>

<p>
æ•ˆæœæ˜¯ä¸€æ ·çš„,ä¸è¿‡ <code>symbol</code> åŒæ—¶ä¹Ÿæ˜¯ä½œä¸ºå‰ç¼€é”®çš„åå­—.å› æ­¤, <code>C-x</code> çš„ç»‘å®šå°±æ˜¯ä¸€ä¸ªå«åš <code>Control-X-prefix</code> çš„ <code>symbol</code>,
</p>

<p>
å®ƒçš„ <code>function cell</code> å‚¨å­˜çš„æ˜¯ <code>C-x</code> çš„æŒ‰é”®æ˜ å°„,ä¹Ÿå°±æ˜¯ <code>ctl-x-map</code> çš„å€¼.
</p>

<p>
å‰ç¼€é”®å¯ä»¥å®šä¹‰åœ¨ä»»ä½•æ¿€æ´»çš„æŒ‰é”®æ˜ å°„ä¸Š,å¦‚æœä¸€ä¸ªå‰ç¼€é”®å‡ºç°åœ¨å¤šä¸ªæ¿€æ´»çš„æŒ‰é”®æ˜ å°„ä¸Š,é‚£ä¹ˆå„ä¸ªçš„å®šä¹‰çš„ä½œç”¨å°±ä¼šè¢«åˆå¹¶:
</p>

<p>
æ¬¡è¦æ¨¡å¼(minor mode)æŒ‰é”®æ˜ å°„å®šä¹‰ç¬¬ä¸€,ç„¶åæ˜¯ <code>local map</code> çš„,æœ€åæ˜¯ <code>global map</code> çš„.
</p>

<p>
æ¯”å¦‚ä¸‹é¢å®šä¹‰ <code>C-p</code> (åŸæœ¬æ˜¯å±äº <code>global-map</code> çš„ç»‘å®š) ç­‰åŒäº <code>C-x</code>,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(use-local-map (make-sparse-keymap)
               (local-set-key <span style="color: #CC9393;">"\C-p"</span> ctl-x-map)
               (key-binding <span style="color: #CC9393;">"\C-p\C-f"</span>)
</pre>
</div>

<p>
å¯ä»¥é€šè¿‡ <code>define-prefix-command</code> æ¥å®šä¹‰ä¸€ä¸ª <code>symbol</code> ä¸ºå‰ç¼€é”®çš„ç»‘å®š,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(define-prefix-command SYMBOL <span style="color: #7CB8BB;">&amp;optional</span> MAPVAR PROMPT)
</pre>
</div>

<p>
å¤§æ¦‚çš„è¿‡ç¨‹å°±æ˜¯:åˆ›å»ºä¸€ä¸ª <code>sparse keymap</code> å¹¶ä¸”æŠŠå®ƒå‚¨å­˜ä¸º <code>SYMBOL</code> çš„å‡½æ•°å®šä¹‰, <code>SYMBOL</code> éšåçš„ä¸€ä¸ªæŒ‰é”®åºåˆ—ç»‘å®šä¼šæˆä¸ºå‰ç¼€é”®,è¿”å›å€¼æ˜¯ä¸€ä¸ª <code>symbol</code>.
</p>

<p>
å¦‚æœ <code>MAPVAR</code> æ˜¯ <code>non-nil</code>,è¯¥å‡½æ•°ä¼šæŠŠ <code>MAPVAR</code> å˜ä¸ºå˜é‡è€Œä¸æ˜¯æŠŠ <code>SYMBOL</code> å®šä¹‰ä¸ºå‡½æ•°. <code>PROMPT</code> ç”¨äºèœå•æŒ‰é”®åºåˆ—.
</p>

<p>
<a href="https://www.emacswiki.org/emacs/PrefixKey">EmacsWiki</a>ä¸Šæœ‰ä¸€ä¸ªä¸é”™çš„ä¾‹å­,å¯ä»¥çœ‹ä¸€ä¸‹.
</p>
</div>
</div>



<div id="outline-container-org9e1b550" class="outline-4">
<h4 id="org9e1b550">æ¿€æ´»çš„æŒ‰é”®æ˜ å°„ (Active Keymaps)</h4>
<div class="outline-text-4" id="text-org9e1b550">
<p>
<code>Emacs</code> æœ‰å¾ˆå¤šæŒ‰é”®æ˜ å°„,ä½†æ˜¯åªæœ‰å°‘æ•°æ˜¯åœ¨ä»»ä½•æ—¶å€™æ˜¯æ¿€æ´»çš„.å½“æ¥æ”¶åˆ°ç”¨æˆ·çš„è¾“å…¥, <code>Emacs</code> æ ¹æ® <code>translation keymaps</code> ç¿»è¯‘è¾“å…¥äº‹ä»¶,ç„¶ååœ¨æ¿€æ´»çš„æŒ‰é”®æ˜ å°„æŸ¥æ‰¾æŒ‰é”®ç»‘å®š.
</p>

<p>
é€šå¸¸,æ¿€æ´»çš„æŒ‰é”®æ˜ å°„æ˜¯è¿™äº›,æŒ‰ç…§ä¼˜å…ˆçº§é«˜åˆ°ä½æ’åº:
</p>

<ol class="org-ol">
<li>æŒ‡å®šäº† <code>keymap</code> å±æ€§çš„æŒ‰é”®æ˜ å°„,é€šå¸¸æ˜¯ç”±æŸä¸ª <code>point</code> ä¸Šçš„ <code>keymap</code> æ–‡æœ¬æˆ–è€… <code>overlay</code> å±æ€§æŒ‡å®šçš„.</li>
<li>æ‰€å¯ç”¨çš„æ¬¡è¦æ¨¡å¼(<code>minor mode</code>)çš„æŒ‰é”®æ˜ å°„,å¦‚æœæ¬¡è¦æ¨¡å¼æœ‰è‡ªå·±çš„æŒ‰é”®æ˜ å°„,
ä¸€ä½†å¯ç”¨å°±ä¼šç”± <code>emulation-mode-map-alists</code>, <code>minor-mode-overriding-map-alist</code> å’Œ <code>minor-mode-map-alist</code> æŒ‡å®šä¸ºæ¿€æ´».</li>
<li>å½“å‰ç¼“å†²åŒºçš„æœ¬åœ°æ˜ å°„(<code>local keymap</code>),ç¼“å†²åŒºç‰¹å®šçš„æŒ‰é”®æ˜ å°„,ç”±ç‚¹ä¸Šçš„ <code>local-map</code> æ–‡æœ¬æˆ–è€… <code>overlay</code> å±æ€§æŒ‡å®š,
æ­£å¸¸æ¥è¯´æ˜¯æ ¹æ®ç¼“å†²åŒºçš„ä¸»è¦æ¨¡å¼è®¾å®šæœ¬åœ°æŒ‰é”®æ˜ å°„çš„,å¹¶ä¸”æ‰€æœ‰å¯ç”¨äº†ç›¸åŒä¸»è¦æ¨¡å¼çš„ç¼“å†²åŒºå…±äº«åŒä¸€ä¸ªæœ¬åœ°æŒ‰é”®æ˜ å°„.
æ‰€ä»¥æ³¨æ„ <code>local-set-key</code> çš„ä½¿ç”¨.</li>
<li>å…¨å±€æŒ‰é”®æ˜ å°„(<code>global keymap</code>), ç»‘å®šåˆ° <code>global-map</code> ä¸Š,å¹¶ä¸”æ€»æ˜¯å¤„äºæ¿€æ´»çŠ¶æ€.</li>
</ol>

<p>
é™¤äº†ä¸Šé¢å¹³æ—¶çš„ <code>Emacs</code> è¿˜æä¾›äº†å…¶å®ƒæ¿€æ´»æŒ‰é”®æ˜ å°„çš„æ–¹æ³•,é¦–å…ˆ, <code>overriding-local-map</code> æŒ‡å®šä¸€ä¸ªæ˜ å°„æ¥æ›¿æ¢ä¸Šé¢çš„(é™¤äº† <code>global map</code>).
</p>

<p>
å…¶æ¬¡, <code>terminal-local</code> å˜é‡ <code>overriding-terminal-local-map</code> å¯ä»¥ä½¿ä¸€ä¸ªæ˜ å°„çš„ä¼˜å…ˆçº§é«˜äºä»»ä½•å…¶ä»–æ˜ å°„,åŒ…æ‹¬ <code>overriding-local-map</code>,
</p>

<p>
ä¸€èˆ¬è¿™æ˜¯ç”¨äºä¸´æ—¶çš„(modal/transient)æŒ‰é”®ç»‘å®š,ä¸ºæ­¤ <code>set-transient-map</code> æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ¥å£.
</p>

<p>
æ¿€æ´»æŒ‰é”®æ˜ å°„å¹¶éå”¯ä¸€ä½¿ç”¨å°„çš„æ–¹å¼,è¿˜å¯ä»¥ç”¨äº <code>read-key-sequence</code> ç¿»è¯‘äº‹ä»¶.
</p>

<p>
<code>current-active-maps</code> å¯ä»¥è·å–å½“å‰å¤„äºæ¿€æ´»çŠ¶æ€çš„æŒ‰é”®æ˜ å°„,å…·ä½“ç”¨æ³•çœ‹æ–‡æ¡£.è¿˜æœ‰ <code>key-binding</code> å¯ä»¥å¾—åˆ°æŸä¸ªæŒ‰é”®çš„ç»‘å®š,å…·ä½“ç”¨æ³•æ˜¯
</p>
</div>
</div>



<div id="outline-container-org1aa8cbd" class="outline-4">
<h4 id="org1aa8cbd">æŸ¥æ‰¾æ¿€æ´»çš„æŒ‰é”®æ˜ å°„ (Searching Keymaps)</h4>
<div class="outline-text-4" id="text-org1aa8cbd">
<p>
è¿™æ˜¯å®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„æŸ¥æ‰¾è¿‡ç¨‹çš„ä¼ªä»£ç ,å…¶ä¸­ <code>FIND-IN</code> å’Œ <code>FIND-IN-ANY</code> åˆ†åˆ«æ˜¯åœ¨ä¸€ä¸ªæŒ‰é”®æ˜ å°„å’Œä¸€ä¸ªæŒ‰é”®æ˜ å°„ <code>alist</code> è¿›è¡ŒæŸ¥æ‰¾çš„ä¼ªå‡½æ•°.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">or</span> (<span style="color: #F0DFAF; font-weight: bold;">if</span> overriding-terminal-local-map
        (FIND-IN overriding-terminal-local-map))
    (<span style="color: #F0DFAF; font-weight: bold;">if</span> overriding-local-map
        (FIND-IN overriding-local-map)
      (<span style="color: #F0DFAF; font-weight: bold;">or</span> (FIND-IN (get-char-property (point) 'keymap))
          (FIND-IN-ANY emulation-mode-map-alists)
          (FIND-IN-ANY minor-mode-overriding-map-alist)
          (FIND-IN-ANY minor-mode-map-alist)
          (<span style="color: #F0DFAF; font-weight: bold;">if</span> (get-text-property (point) 'local-map)
              (FIND-IN (get-char-property (point) 'local-map))
            (FIND-IN (current-local-map)))))
    (FIND-IN (current-global-map)))
</pre>
</div>

<p>
å€¼å¾—æ³¨æ„çš„æ˜¯,å¦‚æœæŒ‰é”®åºåˆ—æ˜¯ä»¥ä¸€ä¸ªé¼ æ ‡äº‹ä»¶å¼€å§‹çš„,é‚£ä¹ˆäº‹ä»¶çš„ä½ç½®å°±ä¼šæ›¿ä»£ä¸Šé¢ä»£ç ä¸­çš„ <code>point</code>.
</p>
</div>
</div>


<div id="outline-container-org8b3efb6" class="outline-4">
<h4 id="org8b3efb6">æ§åˆ¶æ¿€æ´»çš„æŒ‰é”®æ˜ å°„ (Controlling Active Maps)</h4>
<div class="outline-text-4" id="text-org8b3efb6">
<p>
<code>API</code> æ–‡æ¡£,è‡ªå·±é˜…è¯».
</p>
</div>
</div>


<div id="outline-container-org11a105d" class="outline-4">
<h4 id="org11a105d">æŒ‰é”®æŸ¥æ‰¾ (Key Lookup)</h4>
<div class="outline-text-4" id="text-org11a105d">
<p>
æŒ‰é”®æŸ¥æ‰¾å°±æ˜¯ä¸€ä¸ªä»æŒ‡å®šçš„æŒ‰é”®æ˜ å°„ä¸­æŸ¥æ‰¾æŒ‰é”®åºåˆ—å¯¹åº”ç»‘å®šçš„è¿‡ç¨‹,ç»‘å®šçš„æŒ‡å®šæˆ–è€…ä½¿ç”¨ä¸æ˜¯æŒ‰é”®æŸ¥æ‰¾çš„ä¸€éƒ¨åˆ†.
</p>

<p>
æŒ‰é”®æŸ¥æ‰¾åªä¼šä½¿ç”¨æŒ‰é”®åºåˆ—ä¸­çš„æ¯ä¸ªäº‹ä»¶çš„ç±»å‹æ¥æŸ¥æ‰¾,äº‹ä»¶å‰©ä½™çš„éƒ¨åˆ†éƒ½ä¼šè¢«å¿½è§†.
</p>

<p>
äº‹å®ä¸Šç”¨äºæŒ‰é”®æŸ¥æ‰¾çš„æŒ‰é”®åºåˆ—å¯èƒ½ä¼šé€šè¿‡å®ƒçš„äº‹ä»¶ç±»å‹æ¥æŒ‡å®šä¸€ä¸ªé¼ æ ‡äº‹ä»¶,è¿™æ ·çš„ä¸€ä¸ªæŒ‰é”®åºåˆ—ä¸æ»¡è¶³ <code>command-execute</code> çš„æ‰§è¡Œæ¡ä»¶,
</p>

<p>
ä½†æ»¡è¶³æŸ¥æ‰¾æˆ–è€…é‡æ–°ç»‘å®šä¸€ä¸ªæŒ‰é”®çš„æ¡ä»¶.
</p>

<p>
æŒ‰é”®æŸ¥æ‰¾é€ä¸ªå¤„ç†äº‹ä»¶:ç¬¬ä¸€ä¸ªè¢«æ‰¾åˆ°çš„äº‹ä»¶çš„ç»‘å®šå¿…é¡»æ˜¯ä¸ªæŒ‰é”®æ˜ å°„,ç„¶åç¬¬äºŒä¸ªäº‹ä»¶çš„ç»‘å®šéœ€è¦åœ¨ä»æŒ‰é”®æ˜ å°„ä¸­æŸ¥æ‰¾,é‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æ‰€æœ‰äº‹ä»¶è¢«å¤„ç†å®Œ,
</p>

<p>
æœ€åä¸€ä¸ªç»‘å®šå¯èƒ½ä¸æ˜¯ä¸€ä¸ªæŒ‰é”®æ˜ å°„.
</p>

<p>
æˆ‘ä»¬ç”¨ <code>keymap entry</code> è¿™ä¸ªæœ¯è¯­æ¥æè¿°åœ¨æŒ‰é”®æ˜ å°„ä¸­æŸ¥æ‰¾çš„ç»“æœ:
</p>

<ol class="org-ol">
<li><code>nil</code>: æŒ‰é”®æœªå®šä¹‰</li>
<li><code>COMMAND</code>: æŒ‰é”®ç»‘å®šçš„å‘½ä»¤</li>
<li><code>ARRAY (string or vector)</code>: æŒ‰é”®ç»‘å®šçš„é”®ç›˜å®</li>
<li><code>KEYMAP</code>: å‰ç¼€é”®çš„ç»‘å®š</li>
<li><code>LIST</code>: å¦‚æœ <code>CAR</code> æ˜¯ <code>symbol</code> <code>keymap</code>,é‚£ä¹ˆè¿™ä¸ª <code>LIST</code> å°±æ˜¯ä¸€ä¸ªæŒ‰é”®æ˜ å°„;å¦‚æœæ˜¯ä¸€ä¸ª <code>symbol</code> <code>lambda</code>,é‚£ä¹ˆå°±æ˜¯ä¸€ä¸ª <code>lambda</code> è¡¨è¾¾å¼,
ä¹Ÿå°±æ˜¯ä¸€ä¸ªå‡½æ•°,ä¸ºäº†æ­£å¸¸æ‰§è¡Œ,å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå‘½ä»¤.</li>
<li><p>
<code>SYMBOL</code>: å¦‚æœ <code>SYMBOL</code> çš„å®šä¹‰æ˜¯ä¸ªå‡½æ•°å°±ç”¨å‡½æ•°å®šä¹‰æ¥æ›¿ä»£ <code>SYMBOL</code>.å¦‚æœ <code>SYMBOL</code> çš„å®šä¹‰æ˜¯å¦å¤–ä¸€ä¸ª <code>SYMBOL</code>,é‚£ä¹ˆå°±é‡å¤è¿™ä¸ªå¤„ç†è¿‡ç¨‹,ç›´åˆ°æ›¿ä»£å‘ç”Ÿ.
</p>

<p>
æœ€ç»ˆç»“æœåº”è¯¥æ˜¯ä¸€ä¸ªæŒ‰é”®æ˜ å°„,æˆ–è€…å‘½ä»¤,åˆæˆ–è€…ä¸€ä¸ªé”®ç›˜å®.
</p>

<p>
éœ€è¦æ³¨æ„çš„æ˜¯,æŒ‰é”®æ˜ å°„ä»¥åŠé”®ç›˜å®ä¸æ˜¯åˆæ³•çš„å‡½æ•°,æ‰€ä»¥ä¸€ä¸ªä¸ä½œä¸ºå‡½æ•°å®šä¹‰çš„ <code>keymap, string æˆ–è€… vector</code> å…³è”çš„ <code>symbol</code> æ˜¯ä¸åˆæ³•çš„å‡½æ•°.
</p>

<p>
ç„¶è€Œä½œä¸ºæŒ‰é”®ç»‘å®šæ˜¯åˆæ³•çš„.å¦‚æœå®šä¹‰æ˜¯ä¸€ä¸ªé”®ç›˜å®,é‚£ä¹ˆ <code>symbol</code> ä½œä¸º <code>command-execute</code> çš„å‚æ•°ä¹Ÿæ˜¯åˆæ³•çš„.
</p>

<p>
å¦‚æœ <code>SYMBOL</code> æ˜¯ <code>undefined</code>,å°±æ˜¯è¯´,æŒ‰é”®æœªå®šä¹‰,ä¸¥æ ¼æ¥è¯´,æŒ‰é”®æ˜¯å®šä¹‰äº†,åªä¸è¿‡å®ƒçš„ç»‘å®šæ˜¯å‘½ä»¤ <code>undefined</code>.
</p>

<p>
è€Œ <code>undefined</code> å‘½ä»¤åšå¾—äº‹æƒ…å°±æ˜¯å’Œæœªå®šä¹‰æŒ‰é”®åšçš„ä¸€æ ·: è°ƒç”¨ <code>ding</code> æ¥å“èµ·æç¤ºéŸ³ (ring the bell) ä½†ä¸å¼•å‘é”™è¯¯.
</p>

<p>
<code>undefined</code> ç”¨åœ¨æœ¬åœ°æŒ‰é”®æ˜ å°„ä¸Šæ¥è¦†ç›–ä¸€ä¸ªå…¨å±€æŒ‰é”®ç»‘å®š,ä½¿æŒ‰é”®å±€éƒ¨æœªå®šä¹‰. <code>nil</code> çš„æœ¬åœ°ç»‘å®šä¼šå¯¼è‡´ <code>undefined</code> å¤±è´¥.
</p></li>
<li><code>ANYTHING ELSE</code>: æ‰€æœ‰å…¶å®ƒç±»å‹çš„å¯¹è±¡,è¡¨ç¤ºç»‘å®šä¸èƒ½ä½œä¸ºä¸€ä¸ªå‘½ä»¤æ¥æ‰§è¡Œ.</li>
</ol>
</div>
</div>


<div id="outline-container-org372319a" class="outline-4">
<h4 id="org372319a">æŒ‰é”®æŸ¥æ‰¾çš„å‡½æ•° (Functions for Key Lookup)</h4>
</div>



<div id="outline-container-org74311b0" class="outline-4">
<h4 id="org74311b0">æ”¹å˜æŒ‰é”®ç»‘å®š (Changing Key Bindings)</h4>
<div class="outline-text-4" id="text-org74311b0">
<p>
é‡æ–°ç»‘å®šæŒ‰é”®çš„æ–¹å¼å°±æ˜¯æ”¹å˜æŒ‰é”®æ˜ å°„çš„æ¡ç›®.å¦‚æœä½ æ”¹å˜å…¨å±€æŒ‰é”®æ˜ å°„é‡Œé¢çš„ç»‘å®š,é‚£ä¹ˆå°±ä¼šå½±å“æ‰€æœ‰ç¼“å†²åŒº(å³ä½¿å¯¹äº <code>global map</code> è¢« <code>local map</code> é®æ©çš„ç¼“å†²åŒºä¸ä¼šæœ‰ç›´æ¥å½±å“).
</p>

<p>
é€šå¸¸æ”¹å˜å½“å‰çš„ç¼“å†²åŒºçš„ <code>local map</code> ä¼šå½±å“æ‰€æœ‰ä½¿ç”¨ç›¸åŒä¸»æ¨¡å¼(<code>major mode</code>)çš„ç¼“å†²åŒº.
</p>

<p>
<code>global-set-key</code> å’Œ <code>local-set-key</code> å¯ä»¥åˆ†åˆ«æ”¹å˜å½“å‰ <code>global map</code> å’Œ <code>local map</code> çš„ç»‘å®š.
</p>

<p>
é€šå¸¸éƒ½ç”¨ <code>global-set-key</code> ä»¥åŠ <code>local-set-key</code> æ¥åšè¿™ç§äº‹,é™¤äº†è¿™ä¸¤ä¸ªä»¥å¤–è¿˜æœ‰æ›´é€šç”¨çš„å‡½æ•°å¯ä»¥åšè¿™ç§äº‹æƒ…:
</p>

<p>
<code>define-key</code> ç»™æŸä¸ªæ˜ å°„è®¾å®šç»‘å®š;
</p>

<p>
<code>substitute-key-definition</code> æ›¿æ¢æŸä¸ªæ˜ å°„é‡Œé¢æŸä¸ªç»‘å®š,è¿™ä¸ªç»‘å®šå‡ºç°çš„æ‰€æœ‰åœ°æ–¹éƒ½ä¼šè¢«æ›¿æ¢;
</p>

<p>
<code>suppress-keymap</code> é€šè¿‡æŠŠ <code>self-insert-command</code> æ˜ å°„åˆ° <code>undefined</code> çš„æ‰‹æ®µæ¥æ”¹å˜æŒ‰é”®æ˜ å°„ä¸Šæ‰€æœ‰å­—ç¬¦,ä¸€æ—¦è¿™ä¹ˆå°±å¯èƒ½æ­£å¸¸å¾·è¾“å…¥æ–‡æœ¬äº†.
</p>
</div>
</div>


<div id="outline-container-org3f4f09f" class="outline-4">
<h4 id="org3f4f09f">é‡æ–°æ˜ å°„å‘½ä»¤ (Remapping Commands)</h4>
<div class="outline-text-4" id="text-org3f4f09f">
<p>
æœ‰ä¸€ç§ç‰¹åˆ«çš„ç»‘å®šå¯ä»¥åœ¨ä¸å¼•ç”¨æŒ‰é”®åºåˆ—çš„æƒ…å†µä¸‹æ˜ å°„å‘½ä»¤ç»‘å®šçš„æŒ‰é”®åˆ°å¦å¤–ä¸€ä¸ªå‘½ä»¤ä¸Š,æ¯”å¦‚æˆ‘è‡ªå·± <code>mode</code> æƒ³æä¾›ä¸€ä¸ªå« <code>my-kill-line</code> å‡½æ•°,
</p>

<p>
ä»¥å‰æ‰§è¡Œ <code>C-k</code> æ‰§è¡Œ <code>kill-line</code>,ç°åœ¨è¦åœ¨ä½¿ç”¨æˆ‘è‡ªå·±çš„ <code>mode</code> ä¸‹è¾“å…¥ <code>C-k</code> çš„æ—¶å€™æ‰§è¡Œ <code>my-kill-line</code>,é€šè¿‡ <code>remap</code> äº‹ä»¶å¯ä»¥è½»æ¾å®ç°,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(define-key my-mode-map [remap kill-line] 'my-kill-line)
</pre>
</div>

<p>
ä¸Šé¢çš„è¡¨è¾¾å¼æ˜¯è¿™ä¹ˆæè¿°: æŠŠ <code>kill-line</code> æ˜ å°„åˆ° <code>my-kill-line</code>,è¿™æ˜¯ä¸€ä¸ªé‡æ–°æ˜ å°„å…³ç³»,æŠŠè¿™ä¸ªæ˜ å°„å…³ç³»æ”¾åˆ° <code>my-mode-map</code> ä¸­.
</p>

<div class="org-src-container">
<pre class="src src-elisp">[remap COMMAND]
</pre>
</div>

<p>
å…¶ä¸­, <code>remap</code> æ˜¯ä¸€ä¸ªäº‹ä»¶, <code>COMMAND</code> æ˜¯è¦è¢«é‡æ–°æ˜ å°„çš„å‘½ä»¤.å…¶å®å¯ä»¥è¿™ä¹ˆç†è§£,è¿™ä¸ªå½¢å¼å°±æ˜¯è·å– <code>COMMAND</code> çš„æŒ‰é”®ç»‘å®š,è€Œå®é™…ä¸Šå®ƒåšçš„äº‹æƒ…ä¹Ÿæ­£æ˜¯è¿™æ ·.
</p>

<p>
å¦‚æœæƒ³å–æ¶ˆé‡æ–°æ˜ å°„,ç›´æ¥è¿™ä¹ˆåšå°±å¥½,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(define-key my-mode-map [remap kill-line] nil)
</pre>
</div>

<p>
è¦æ³¨æ„çš„æ˜¯,é‡æ–°æ˜ å°„åªèƒ½å‘ç”Ÿåœ¨æ¿€æ´»çš„æ˜ å°„ä¸­,æ¯”å¦‚åœ¨ <code>ctrl-x-map</code> æ‰§è¡Œé‡æ–°æ˜ å°„æ˜¯æ— æ•ˆçš„;è¿˜æœ‰ä¸€ä¸ªé‡æ–°æ˜ å°„åªèƒ½åœ¨ä¸€çº§å†…çš„å…³ç³»æœ‰ä½œç”¨,æ¯”å¦‚
</p>

<div class="org-src-container">
<pre class="src src-elisp">(define-key my-mode-map [remap kill-line] 'my-kill-line)
(define-key my-mode-map [remap my-kill-line 'my-other-kill-line)
</pre>
</div>

<p>
è¿™é‡Œ <code>kill-line</code> æ²¡æœ‰è¢«æ˜ å°„åˆ° <code>my-other-kill-line</code> ä¸Š,è¾“å…¥ <code>C-k</code> çš„æ—¶å€™ä¼šæ‰§è¡Œ <code>my-kill-line</code> è€Œä¸æ˜¯ <code>my-other-kill-line</code>,å½“ç„¶, <code>my-kill-line</code> æ˜¯è¢«æ˜ å°„åˆ° <code>my-ohter-kill-line</code> ä¸Šäº†.
</p>

<p>
å¯ä»¥é€šè¿‡ <code>(command-remapping 'kill-line nil my-mode-map)</code> æ¥è·å¾—é‡æ–°æ˜ å°„,è¿™é‡Œè¿”å›çš„æ˜¯ <code>'my-kill-line</code>.
</p>
</div>
</div>



<div id="outline-container-org6ae2f0b" class="outline-4">
<h4 id="org6ae2f0b">ç”¨äºç¿»è¯‘äº‹ä»¶åºåˆ—çš„æŒ‰é”®æ˜ å°„ (Translation Keymaps)</h4>
<div class="outline-text-4" id="text-org6ae2f0b">
<p>
å½“ <code>read-key-sequence</code> å‡½æ•°è¯»å–ä¸€ä¸ªæŒ‰é”®åºåˆ—,å®ƒä¼šç”¨ç¿»è¯‘æŒ‰é”®åºåˆ—æ¥ç¿»è¯‘äº‹ä»¶åºåˆ—æˆåˆ«çš„äº‹ä»¶åºåˆ—.ç¿»è¯‘ç”¨çš„æŒ‰é”®æ˜ å°„å°±æ˜¯ <code>input-decode-map</code>, <code>local-function-key-map</code> å’Œ <code>key-translation-map</code> ä¸‰ä¸ª.
</p>

<p>
è¿™ä¸‰ä¸ªæ˜¯æŒ‰ç…§ä¼˜å…ˆçº§æ’åˆ—çš„.åœ¨ç»“æ„ä¸Š,ç¿»è¯‘ç”¨çš„æŒ‰é”®æ˜ å°„å’Œå…¶ä»–çš„æŒ‰é”®æ˜ å°„æ˜¯ä¸€æ ·çš„,åœ¨ç”¨é€”ä¸Šå´ä¸åŒ:ç¿»è¯‘ç”¨çš„æŒ‰é”®æ˜ å°„(ä¸‹é¢ç§°ä¸ºç¿»è¯‘æ˜ å°„)æ˜¯ç”¨æ¥æŒ‡å®šè¦ç¿»è¯‘çš„å†…å®¹,è€Œä¸æ˜¯ç»‘å®šæ˜ å°„.
</p>

<p>
æ¯å½“è¯»å–ä¸€ä¸ªæŒ‰é”®åºåˆ—,ç¿»è¯‘æ˜ å°„å°±ä¼šæ£€æŸ¥æ¯ä¸ªç¿»è¯‘æ˜ å°„.å¦‚æœå…¶ä¸­ä¸€ä¸ªç¿»è¯‘æ˜ å°„ç»‘å®šäº†åºåˆ— <code>k</code> åˆ°å‘é‡ <code>v</code> ä¸Š,è€Œ <code>k</code> åˆæ˜¯æŒ‰é”®åºåˆ—çš„å­åºåˆ—,é‚£ä¹ˆå­åºåˆ—å‡ºç°çš„åœ°æ–¹å°±ä¼šæ›¿æ¢æˆ <code>v</code>.
</p>

<p>
ç¿»è¯‘æ˜ å°„åªæœ‰åœ¨ <code>Emacs</code> (é€šè¿‡ç”± <code>keyboard-coding-system</code> æŒ‡å®šçš„è¾“å…¥ç¼–ç ç³»ç»Ÿ)è§£ç (decode)é”®ç›˜è¾“å…¥æ‰å·¥ä½œ.
</p>

<p>
æ¯”å¦‚, <code>VT100</code> ç»ˆç«¯ä¼šåœ¨æŒ‰ä¸‹ <code>&lt;PF1&gt;</code> çš„æ—¶å€™å‘é€ <code>&lt;ESC&gt; O P</code> åºåˆ—, <code>Emacs</code> ä¸€å®šæŠŠè¿™ä¸ªåºåˆ—ç¿»è¯‘æˆå•ä¸ªçš„äº‹ä»¶ <code>pf1</code>,å­æ‰€ä»¥èƒ½è¿™ä¹ˆåšæ˜¯å› ä¸º <code>input-decode-map</code> ä¸Šç»‘å®šäº† <code>ESC O P</code> åˆ° <code>[pf1]</code>.
</p>

<p>
å› æ­¤å½“è¾“å…¥ <code>C-c &lt;PF1&gt;</code> çš„æ—¶å€™,ç»ˆç«¯ä¼šæäº¤ä¸€ä¸ªå­—ç¬¦åºåˆ— <code>C-c &lt;ESC&gt; O P</code>,ç„¶å <code>read-key-sequence</code> ä¼šæŠŠå®ƒç¿»è¯‘æˆ <code>C-c &lt;PF1&gt;</code> å¹¶ä¸”è¿”å›ä¸€ä¸ªå‘é‡ <code>[?\C-c pf1]</code>.
</p>
</div>
</div>


<div id="outline-container-org34d75b6" class="outline-4">
<h4 id="org34d75b6">ç»‘å®šæŒ‰é”®çš„å‘½ä»¤ (Key Binding Commands)</h4>
<div class="outline-text-4" id="text-org34d75b6">
<p>
å°±æ˜¯è®² <code>API</code> çš„.
</p>
</div>
</div>


<div id="outline-container-org4b65279" class="outline-4">
<h4 id="org4b65279">æ‰«ææŒ‰é”®æ˜ å°„ (Scanning Keymaps)</h4>
<div class="outline-text-4" id="text-org4b65279">
<p>
ä¸ºäº†æ‰“å°å‡ºå¸®åŠ©ä¿¡æ¯è€Œæ‰«ææ‰€æœ‰å½“å‰çš„æŒ‰é”®æ˜ å°„(å› ä¸º <code>keymap</code> ç»“æ„æœ¬èº«ä¸æ˜¯ç»™äººé˜…è¯»çš„)è¿™ç« èŠ‚å°±æ˜¯è¯´è¿™äº› <code>API</code>.
</p>
</div>
</div>


<div id="outline-container-org638e109" class="outline-4">
<h4 id="org638e109">èœå•æŒ‰é”®æ˜ å°„ (Menu Keymaps)</h4>
<div class="outline-text-4" id="text-org638e109">
<p>
é€šè¿‡ä¸ºé”®ç›˜æŒ‰é”®å’Œé¼ æ ‡æŒ‰é’®å®šä¹‰ç»‘å®š,æŒ‰é”®æ˜ å°„å¯ä»¥åƒèœå•é‚£æ ·æ“ä½œ.ä¸€èˆ¬èœå•éœ€è¦é¼ æ ‡æ“ä½œ,ä½†åŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡é”®ç›˜æ¥æ“ä½œ.
</p>

<p>
æˆ‘ä¸ªäººå¯¹èœå•è¿™å—ä¸å¤ªæ„Ÿå…´è¶£(æˆ‘è‡ªå·±éƒ½ä¸ç”¨èœå•æ ),æ‰€ä»¥æš‚æ—¶æ”¾ä¸‹.ç­‰ä»¥åæƒ³è¯»çš„æ—¶å€™å†çœ‹.
</p>
</div>
</div>
</div>


<div id="outline-container-orga3a03e6" class="outline-3">
<h3 id="orga3a03e6">æ¨¡å¼ (Modes)</h3>
<div class="outline-text-3" id="text-orga3a03e6">
<p>
æ¨¡å¼å°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè‡ªå®šä¹‰ <code>Emacs</code> è¡Œä¸ºçš„å®šä¹‰é›†åˆ.æœ‰ä¸¤ç§ç±»å‹çš„æ¨¡å¼: åœ¨ç¼–è¯‘çš„æ—¶å€™å¯ä»¥é€‰æ‹©å…³é—­æˆ–è€…å¯ç”¨æ¥å†³å®šæ˜¯å¦æä¾›ç‰¹æ€§çš„æ¬¡è¦æ¨¡å¼,
</p>

<p>
ä»¥åŠç”¨æ¥ä¸“é—¨ç¼–è¾‘æŸä¸€ç§æ–‡æœ¬æˆ–è€…ä¸ç‰¹å®šç§ç±»æ–‡æœ¬è¿›è¡Œäº¤äº’çš„ä¸»è¦æ¨¡å¼.æ¯ä¸ªç¼“å†²åŒºä¸€ä¸ªæ—¶é—´å†…åªæœ‰ä¸€ä¸ªä¸»è¦æ¨¡å¼,å¯ä»¥æœ‰0åˆ°å¤šä¸ªæ¬¡è¦æ¨¡å¼.
</p>
</div>


<div id="outline-container-orgb1d663e" class="outline-4">
<h4 id="orgb1d663e">é’©å­ (Hooks)</h4>
<div class="outline-text-4" id="text-orgb1d663e">
<p>
é’©å­å…¶å®å°±æ˜¯å˜é‡,ç”¨æ¥å‚¨å­˜å‡½æ•°,è¿™äº›å‡½æ•°ä¼šåœ¨ç‰¹å®šç¨‹åºæ‰§è¡Œç»“æŸåè¢«è°ƒç”¨. <code>Emacs</code> æä¾›äº†ä¸€äº›ç”¨æ¥è‡ªå®šä¹‰çš„é’©å­,
</p>

<p>
é€šå¸¸éƒ½æ˜¯åœ¨ <code>Emacs</code> çš„åˆå§‹æ–‡ä»¶ (<code>init file</code>) è¿›è¡Œè®¾ç½®,å½“ç„¶ä¹Ÿèƒ½é€šè¿‡ <code>Lisp</code> ç¨‹åºè¿›è¡Œè®¾ç½®.
</p>

<p>
å¤§éƒ¨ä»½é’©å­éƒ½æ˜¯æ™®é€šé’©å­(<code>normal hooks</code>),è¿™ç§é’©å­æ˜¯ä¸€ä¸ªç”±ä¸æ¥å—å‚æ•°çš„å‡½æ•°ç»„æˆçš„åˆ—è¡¨.æ ¹æ®çº¦å®š,æ™®é€šé’©å­çš„åå­—è¦æ±‚ä»¥ <code>-hook</code> ç»“å°¾.
</p>

<p>
æ¯ä¸ªæ¨¡å¼å‘½ä»¤(<code>mode command</code>)éƒ½åº”è¯¥è¿è¡Œä¸€ä¸ªå«åšæ¨¡å¼é’©å­(<code>mode hook</code>)çš„æ™®é€šé’©å­ä½œä¸ºåˆå§‹åŒ–å·¥ä½œçš„æœ€åä¸€æ­¥.
</p>

<p>
ç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡ä¿®æ”¹æ¨¡å¼å®šä¹‰çš„ <code>buffer-local</code> èµ‹å€¼æ¥è‡ªå®šä¹‰æ¨¡å¼çš„è¡Œä¸º.å¤§éƒ¨ä»½æ¬¡è¦æ¨¡å¼ä¹Ÿæ˜¯åœ¨ç»“å°¾æ‰§è¡Œæ¨¡å¼é’©å­.é™¤äº†æ¨¡å¼ä¹‹å¤–,é’©å­ä¹Ÿå¯ä»¥ç”¨åœ¨åˆ«çš„åœ°æ–¹.
</p>

<p>
æ¯”å¦‚. <code>Emacs</code> ä¼šåœ¨æŒ‚èµ·è‡ªå·±ä¹‹å‰è¿è¡Œ <code>suspend-hook</code>.ç»™é’©å­æ·»åŠ å‡½æ•°çš„æ¨èæ–¹æ³•æ˜¯è°ƒç”¨ <code>add-hook</code>.è¿™ç§é’©å­å‡½æ•°åªè¦æ˜¯èƒ½å¤Ÿé€šè¿‡ <code>funcall</code> è°ƒç”¨å°±å¯ä»¥.
</p>

<p>
å¤§éƒ¨ä»½æ™®é€šé’©å­éƒ½æ˜¯åˆå§‹ä¸º <code>void</code> çš„, <code>add-hook</code> çŸ¥é“å¦‚ä½•å¤„ç†, <code>add-hook</code> å¯ä»¥å…¨å±€æˆ–è€…ç¼“å†²åŒºå±€éƒ¨æ·»åŠ é’©å­å‡½æ•°.
</p>

<p>
å¦‚æœä¸€ä¸ªé’©å­å˜é‡ä¸æ˜¯ä»¥ <code>hook</code> ç»“å°¾,æ ¹æ®çº¦å®š,å®ƒå°±ä¸æ˜¯ä¸€ä¸ªæ™®é€šé’©å­,å°±æ˜¯éæ™®é€šé’©å­(<code>abnormal hook</code>),æ„å‘³ç€é’©å­å‡½æ•°æ¥å—å‚æ•°,æˆ–è€…å®ƒä»¬çš„è¿”å›å€¼ä¼šæœ‰ç‰¹æ®Šç”¨é€”.
</p>

<p>
ä¸€èˆ¬è€Œè¨€,é’©å­çš„æ–‡æ¡£ä¼šè¯´æ˜é’©å­å‡½æ•°å¦‚ä½•è°ƒç”¨, <code>add-hook</code> ä¹Ÿå¯ä»¥ç»™éæ™®é€šé’©å­æ·»åŠ å‡½æ•°,æ ¹æ®çº¦æŸ,éæ™®é€šé’©å­çš„åå­—éœ€è¦ä»¥ <code>-functions</code> ç»“å°¾.
</p>

<p>
å¦‚æœä¸€ä¸ªå˜é‡æ˜¯ä»¥ <code>-function</code> ç»“å°¾,å¹¶ä¸”å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå‡½æ•°,è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°åˆ—è¡¨,é‚£ä¹ˆå°±ä¸èƒ½ç”¨ <code>add-hook</code> æ¥è°ƒæ•´è¿™ç§å‡½æ•°é’©å­(<code>function hook</code>),è€Œæ˜¯ç”¨ <code>add-function</code>.
</p>
</div>


<ul class="org-ul">
<li><a id="orge3d81a5"></a>è¿è¡Œé’©å­ (Running Hooks)<br>
<div class="outline-text-5" id="text-orge3d81a5">
<p>
<code>run-hooks</code> æ¥å—ä¸€åˆ°å¤šä¸ªæ™®é€šé’©å­,ä¾æ¬¡è¿è¡Œæ¯ä¸ªé’©å­,æ¯ä¸ªé’©å­éƒ½åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°åˆ—è¡¨,ç„¶åä¾æ¬¡è°ƒç”¨æ¯ä¸ªå‡½æ•°.æœ‰ä¸€ä¸ªåºŸå¼ƒçš„ç”¨æ³•:é’©å­çš„å€¼æ˜¯ä¸€ä¸ªå‡½æ•°,ä½†æ˜¯è¿™ç§ç”¨æ³•å·²ç»åºŸå¼ƒäº†.
</p>

<p>
å¦‚æœé’©å­æ˜¯ç¼“å†²åŒºå±€éƒ¨å˜é‡,é‚£ä¹ˆå°±ç”¨ç¼“å†²åŒºå±€éƒ¨å˜é‡è€Œä¸æ˜¯å…¨å±€å˜é‡,ç„¶è€Œå¦‚æœä½œä¸ºç¼“å†²åŒºå±€éƒ¨å˜é‡çš„é’©å­åŒ…å«å…ƒç´  <code>t</code>,é‚£ä¹ˆå…¨å±€å˜é‡ç‰ˆæœ¬çš„é’©å­ä¹Ÿä¼šè¿è¡Œ.
</p>


<p>
<code>run-hook-with-args</code> æ¥æ”¶ä¸€ä¸ªéæ™®é€šé’©å­,ä¾æ¬¡ç»™é’©å­é‡Œé¢çš„é’©å­å‡½æ•°ä¼ é€’å‚æ•° <code>ARGS</code>: <code>(run-hook-with-args HOOK &amp;rest ARGS)</code>,è¿˜æœ‰ä¸¤ä¸ªå˜ç§å°±ä¸è¯´äº†.
</p>

<p>
æ™®é€šé’©å­çš„ç”¨æ³•,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> test-hook nil)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">test</span> ()
  (run-hooks 'test-hook))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">func1</span> ()
  (message <span style="color: #CC9393;">"no"</span>))

(add-hook 'test-hook 'func1)

(test) <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">log no</span>
</pre>
</div>


<p>
éæ™®é€šé’©å­çš„ç”¨æ³•,
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #F0DFAF; font-weight: bold;">setq</span> test-functions nil)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">test</span> ()
  (run-hook-with-args 'test-functions <span style="color: #CC9393;">"This is the prompt"</span>))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">func1</span> (prompt)
  (message (format <span style="color: #CC9393;">"%s: %s"</span> prompt <span style="color: #CC9393;">"func1"</span>)))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">func2</span> (prompt)
  (message (format <span style="color: #CC9393;">"%s: %s"</span> prompt <span style="color: #CC9393;">"func2"</span>)))

(add-hook 'test-functions 'func1)
(add-hook 'test-functions 'func2)

(test)

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">log:</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">This is the prompt: func2</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">This is the prompt: func1</span>
</pre>
</div>
</div>
</li>




<li><a id="orgef88434"></a>è®¾ç½®é’©å­ (Setting Hooks)<br>
<div class="outline-text-5" id="text-orgef88434">
<p>
<code>Emacs Lisp</code> æä¾› <code>add-hook</code> å’Œ <code>remove-hook</code> æ¥æ·»åŠ å’Œç§»é™¤é’©å­ä¸Šçš„å‡½æ•°, <code>add-hook</code> ä¸ä¼šæ·»åŠ é‡å¤çš„å‡½æ•°,ä¸¤è€…éƒ½æ˜¯é€šè¿‡ <code>equal</code> æ¥æ¯”å¯¹è¦è¢«æ·»åŠ æˆ–è€…åˆ é™¤çš„å‡½æ•°,
</p>

<p>
æ‰€ä»¥è¿™ä¸¤ä¸ªå‡½æ•°ä¸è®ºå¯¹æœ‰åå­—çš„å‡½æ•°è¿˜æ˜¯å¯¹ <code>lambda</code> è¡¨è¾¾å¼éƒ½æœ‰æ•ˆ.
</p>
</div>
</li>
</ul>
</div>
</div>


<div id="outline-container-org7dc9956" class="outline-3">
<h3 id="org7dc9956">Emacs ç¼–ç ç³»ç»Ÿ</h3>
<div class="outline-text-3" id="text-org7dc9956">
<p>
åœ¨è®¡ç®—æœºé‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶,æ–‡æœ¬æ–‡ä»¶(text files)å°±æ˜¯ä¸€ä¸ªä¾‹å­,
</p>

<p>
åœ¨æ–‡æœ¬æ–‡ä»¶çš„æ—¥å¸¸ä½¿ç”¨ä¸­å¶å°”ä¼šå‡ºä¹±ç é—®é¢˜,è¦æƒ³è§£å†³é—®é¢˜éœ€è¦å…ˆäº†è§£æ˜¾ç¤ºæ–‡æœ¬çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„.
</p>

<p>
åˆšæ‰ä¹Ÿæåˆ°æ–‡æœ¬æ–‡ä»¶å°±æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶,ä¹Ÿå°±æ˜¯è¯´å®ƒå‚¨å­˜çš„å†…å®¹å°±æ˜¯ä¸€äº›æ•°å€¼è€Œå·²,é‚£ä¹ˆè¿™äº›æ•°å€¼æ€ä¹ˆåœ¨äººçš„çœ¼é‡Œå˜æˆçš„å­—ç¬¦å‘¢?
</p>

<p>
è¿™æ˜¯å› ä¸ºè®¡ç®—æœºæŒ‰ç…§ä¸€å¥— <b>æ ‡å‡†</b> æ¥æŠŠè¿™äº›æ•°å€¼ç¿»è¯‘æˆæˆ‘ä»¬çœ‹åˆ°çš„æ–‡æœ¬,æ ‡å‡†ä¹Ÿå°±æ˜¯æ‰€è°“çš„ <b>ç¼–ç æ ‡å‡†</b> (coding standard),æˆ–è€…è¯´ç¼–ç ç³»ç»Ÿ(coding system).
</p>

<p>
<b>ç¼–ç æ ‡å‡†</b> å°±æ˜¯ä¸€å¥—ç»™å­—ç¬¦é›†ç¼–å·çš„æ–¹æ¡ˆ,ä¸‹é¢å°±ä¸¾ä¸ªä¸æ°å½“ä¾‹å­æ¥ <b>ç›´è§‚åœ°</b> äº†è§£ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹,
</p>

<p>
å‡è®¾ç°åœ¨æœ‰ä¸€ç§è¯­è¨€ \(A\) ,å®ƒçš„å­—ç¬¦æœ‰ä» <code>a</code> åˆ° <code>z</code> çš„ 26 ä¸ªå­—ç¬¦,ç»™å®ƒä»¬æ¯ä¸ªå­—ç¬¦ç¼–ä¸ªå·:
</p>

<p>
<code>a</code> çš„ç¼–å·ä¸º 0, <code>b</code> çš„ç¼–å·ä¸º 1, å¦‚æ­¤ç±»æ¨, <code>z</code> çš„ç¼–å·å°±ä¸º 25,è¿™äº›ç¼–å·å«åšå­—ç¬¦ç (character code / codepoint),
</p>

<p>
å­—ç¬¦ç çš„èŒƒå›´å«åšå­—ç¬¦ç ç©ºé—´ (codespace),è¿™é‡Œå¥—ç¼–ç æ ‡å‡†çš„ codespace æ˜¯ <code>0..26</code> (ä¸åŒ…æ‹¬ 26).
</p>

<p>
å¦‚æœæˆ‘ä»¬åœ¨æ–‡ä»¶ \(a\) çœ‹åˆ°ä¸€ä¸ªå•è¯: <code>halo</code>, é‚£ä¹ˆæ–‡ä»¶é‡Œé¢å®é™…å‚¨å­˜çš„æ•°å€¼åº”è¯¥æ˜¯è¿™æ ·çš„ <code>&lt;7&gt;&lt;4&gt;&lt;11&gt;&lt;11&gt;</code>,
</p>

<p>
è®¡ç®—æœºå™¨å‚¨å­˜/è¯»å–æ–‡ä»¶éƒ½æ˜¯äºŒè¿›åˆ¶,è¿™é‡Œçš„ <code>&lt;n&gt;</code> è¿™ç§ç¬¦å·è¡¨ç¤ºæ•°å­— n çš„äºŒè¿›åˆ¶.
</p>

<p>
å› ä¸ºè¿™å¥—å­—ç¬¦é‡Œé¢åªæœ‰ 26 ä¸ªå­—ç¬¦,ä¹Ÿå°±æ˜¯è¯´æœ€å°‘éœ€è¦ 5 ä½(bits)æ¥è¡¨ç¤º 26 ç§å¯èƒ½ä¸­çš„ä¸€ç§,(å®é™…ä¸Š5ä½å¯ä»¥è¡¨ç¤º32ç§å­—ç¬¦,å¤šå‡ºæ¥çš„çš„ 6 ä¸ªå°±ä¸ç®¡äº†),
</p>

<p>
ä¸Šé¢è¿™ä¸²æ•°å€¼åœ¨è®¡ç®—æœºé‡Œé¢åº”è¯¥æ˜¯è¿™æ ·æ’åˆ—çš„: <code>00111 00000 01011 01110</code>,
</p>

<p>
è¦æƒ³æ­£å¸¸çœ‹åˆ°å­—ç¬¦ä¸² <code>halo</code>,å°±å¿…é¡»ä½¿ç”¨éµä»è¿™å¥—ç¼–ç æ ‡å‡†çš„ç¨‹åºæ¥æ‰“å¼€æ–‡ä»¶,ç¨‹åºæ ¹æ®æ ‡å‡†è§£æ:æ¯ 5 ä½ç¿»è¯‘å¾—åˆ°ä¸€ä¸ªå­—ç¬¦,
</p>

<p>
è¿™ä¸ªè¿‡ç¨‹ä¼šæ ¹æ®ç¼–å·æ‰¾åˆ°å¯¹åº”çš„ç¬¦å·(symbol),æœ€åæ‰æ˜¾ç¤ºå‡ºæˆ‘ä»¬çœ‹åˆ°çš„å­—ç¬¦ä¸².
</p>

<p>
å‡è®¾ç°åœ¨æœ‰å¦å¤–ä¸€é—¨è¯­è¨€ \(B\),å®ƒçš„å­—ç¬¦æœ‰ä» <code>0</code> åˆ° <code>9</code> çš„ 10 ä¸ªå­—ç¬¦,æŒ‰é¡ºåºè¿›è¡Œä» 0 å¼€å§‹è¿›è¡Œç¼–ç ,å› ä¸ºæœ‰ 10 ç§å¯èƒ½çš„å­—ç¬¦,é‚£ä¹ˆè‡³å°‘éœ€è¦ 4 ä½æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦.
</p>

<p>
å¦‚æœç”¨éµä»è¿™å¥—ç¼–ç æ ‡å‡†çš„ç¨‹åºæ¥æ‰“å¼€æ–‡ä»¶ \(a\),é‚£ä¹ˆè§£æç»“æœå°±ä¸º: <code>0011 1000 0001 0110 1110</code>,åˆ°çš„å†…å®¹å¤§æ¦‚å°±æ˜¯è¿™æ · <code>3816&lt;14&gt;</code>,
</p>

<p>
å¯ä»¥å‘ç°æœ€å 4 ä½æ²¡æœ‰è¢«ç¿»è¯‘å‡ºæ¥; ç”šè‡³å¦‚æœæ–‡æœ¬æ˜¯ 5 ä¸ªå­—ç¬¦çš„è¯,è§£æè¿˜ä¼šå˜æˆ <code>0011 1000 0001 0110 1110 xxxx x</code> è¿™æ ·å¤šå‡º1ä½æ— æ³•è¿›è¡Œç¿»è¯‘.
</p>

<p>
è¿™å°±æ˜¯ä¹±ç ä»¥åŠä¹±ç å‘ç”Ÿçš„æ ¹æœ¬åŸå› ,å› æ­¤è§£å†³ä¹±ç çš„æ ¸å¿ƒæ–¹æ³•å°±æ˜¯è®© <b>ç¨‹åºå‚¨å­˜æ–‡ä»¶æ—¶ä½¿ç”¨çš„ç¼–ç </b> å’Œ <b>ç¨‹åºè¯»å–æ–‡ä»¶æ—¶ä½¿ç”¨ç¼–ç </b> ä¿æŒä¸€è‡´.
</p>

<p>
ç¨‹åºä½¿ç”¨æŸç§ç¼–ç æ ‡å‡†å‚¨å­˜æ–‡ä»¶/å­—ç¬¦ä¸²å«åšç¼–ç (<b>encode</b>), è€Œä»¥æŸç§ç¼–ç æ ‡å‡†è¯»å–æ–‡ä»¶/å­—ç¬¦ä¸²å«åšè§£ç (<b>decode</b>).
</p>

<p>
ä¸è¿‡è¿™æ ·ä¸€æ¥,ä¸¤é—¨è¯­è¨€ä¹Ÿæ²¡æœ‰åŠæ³•åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­æ­£å¸¸æ˜¾ç¤ºäº†,è¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æ˜¯æŠŠä¸¤é—¨è¯­è¨€çš„å­—ç¬¦é›†åˆå¹¶åœ¨ä¸€èµ·,
</p>

<p>
æ¯”å¦‚, <code>0 .. 9a .. z</code>,ç„¶åä» 0 å¼€å§‹ä¾æ¬¡ç»™æ¯ä¸ªå­—ç¬¦é‡æ–°ç¼–å·.
</p>

<p>
<br>
</p>

<p>
æœ€æ—©çš„æ—¶å€™è®¡ç®—æœºåªæ”¯æŒ <code>ASCII</code> ç¼–ç ,åŒ…æ‹¬ä¸€äº›è‹±æ–‡,æ•°å­—å’Œä¸€äº›åŸºç¡€çš„æ ‡ç‚¹ç¬¦å·,ç„¶åç»è¿‡ä¸æ–­å‘å±•ç»ˆäºåˆ°äº† 1986 å¹´,å…±æ”¯æŒäº† 128 ä¸ªå­—ç¬¦.
</p>

<p>
ä½†å®ƒæœ‰ä¸¤ä¸ªç¼ºç‚¹: æ”¯æŒçš„å­—ç¬¦åŸºæœ¬éƒ½æ˜¯ä»¥è‹±è¯­å­—ç¬¦ä¸ºä¸»,éè‹±è¯­ç”¨æˆ·æ²¡æ³•ä½¿ç”¨è‡ªå·±æ¯è¯­çš„å­—ç¬¦;
</p>

<p>
å…¶æ¬¡,128 ä¸ªå­—ç¬¦æ˜¯ä¸å¤Ÿç”¨çš„,å› ä¸ºé”®ç›˜æœ‰ä¸€äº›æ¯”å¦‚ <code>Ctrl</code>, <code>Enter</code> è¿™æ ·çš„ç‰¹æ®ŠæŒ‰é”®.
</p>

<p>
äººä»¬éœ€è¦å®šä¹‰äº†ä¸€äº›è¶³ä»¥è§£å†³è¿™äº›é—®é¢˜çš„å­—ç¬¦é›†, <b>Unicode Standard</b> å°±æ˜¯å…¶ä¸­ä¸€ä¸ª, <b>Unicode Standard</b> æœ€æ—©ä¹Ÿæ˜¯åªæ”¯æŒå¾ˆå°çš„ä¸€éƒ¨åˆ†å­—ç¬¦çš„,
</p>

<p>
ä»ç”¨ 5 ä½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦,åˆ°ç”¨ 6 ä½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦,åæ¥å†åˆ°çš„ç”¨ 7 ä½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦,
</p>

<p>
è¿™ä¸‰ä¸ªç¼–ç æ ‡å‡†ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥é“çš„ <code>UTF-5</code>, <code>UTF-6</code> ä»¥åŠ <code>UTF-7</code>.
</p>

<p>
<code>UTF-7</code> å·²ç»å¯ä»¥æ”¯æŒæ‰€æœ‰ <code>ASCII</code> å­—ç¬¦äº†,è¿™ä¸ªæ—¶å€™å·²ç»æ˜¯ 1990 å¹´ä»£ä¸­æœŸäº†,
</p>

<p>
åœ¨è¿‡å»,ä¸€ä¸ªå­—èŠ‚(byte)ä¸åƒä»Šå¤©è¿™æ ·å›ºå®š 8 ä½(bits),è¿™ç»™è®¡ç®—æœºçš„å‘å±•å¸¦æ¥è¿™å¾ˆå¤šé—®é¢˜(è¿™é‡Œæœ‰<a href="https://softwareengineering.stackexchange.com/questions/120126/what-is-the-history-of-why-bytes-are-eight-bits">è¿™æ–¹é¢çš„è®¨è®º</a>),
</p>

<p>
<a href="https://www.iso.org/obp/ui/#iso:std:iso-iec:2382:-1:ed-3:v1:en">äºæ˜¯åœ¨ 1993 å¹´,å›½é™…æ ‡å‡†åŒ–ç»„ç»‡(ISO)è§„å®š8ä½ä¸º1ä¸ªå­—èŠ‚</a>, <b>Unicode Standard</b> å½“ç„¶ä¹Ÿè¦ç´§è·Ÿæ—¶ä»£çš„æ­¥ä¼.
</p>

<p>
åˆ°äº† <b>Unicode Standard</b> çš„ç¬¬ 4 ä¸ªç‰ˆæœ¬æ—¶æ€»å…±æ”¯æŒ <code>#x10FFFF</code> ä¸ªå­—ç¬¦, å­—ç¬¦ç èŒƒå›´æ˜¯ <code>0..#x10FFFF</code>,
</p>

<p>
æ¯ç§è¯­è¨€çš„å­—ç¬¦é›†éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ªåŒºé—´,è¯¦ç»†å†…å®¹å¯ä»¥çœ‹ <a href="http://www.unicode.org/charts/">å®˜æ–¹æ–‡æ¡£</a> æˆ–è€… <a href="https://unicode-table.com/en/">è¿™é‡Œ(æ›´åŠ ç›´è§‚)</a>.
</p>

<p>
ç”±äºè¿™ä¸ªå­—ç¬¦é›†å®åœ¨æ˜¯å¤ªå¤§äº†,å¦‚æœç›´æ¥æŒ‰ç…§å­—ç¬¦é›†å…ƒç´ ä¸ªæ•°æ¥åˆ†é…æ¯ä¸ªå­—ç¬¦çš„ç©ºé—´,é‚£ä¹ˆæ¯ä¸ªå­—ç¬¦éœ€è¦ 3 ä¸ªå­—èŠ‚ (24 ä½) çš„ç©ºé—´,
</p>

<p>
å› æ­¤å‡ºäºå¯¹ç©ºé—´èŠ‚çœçš„è€ƒè™‘,ç¼–ç æ ‡å‡†éœ€è¦ä¸€äº›ä¼˜åŒ–,æ¯”å¦‚ç»æ‹“å±•åçš„ <code>ASCII</code> å­—ç¬¦é›†åªæœ‰ 256 ä¸ªå­—ç¬¦,å¹¶ä¸éœ€è¦ 4 ä¸ªå­—èŠ‚,
</p>

<p>
é‚£ä¹ˆè¿™ç§å­—ç¬¦å°±ç”¨ä¸€ä¸ªå­—èŠ‚ç©ºé—´å‚¨å­˜è¶³å¤Ÿäº†,ä¸­æ–‡å­—ç¬¦éœ€è¦æ›´å¤š,å¯èƒ½é«˜è¾¾ä¸¤ä¸ªå­—èŠ‚,åŒæ ·ä¹Ÿä¸éœ€è¦ 4 ä¸ªå­—èŠ‚,,å¦‚æ­¤ç±»æ¨,å…¶å®ƒå­—ç¬¦ä¹Ÿå ç”¨å¯¹åº”ç©ºé—´.
</p>

<p>
<b>Unicode Standard</b> ä¸ºæ­¤å®šä¹‰äº†ä¸‰å¥—ç¼–ç æ ‡å‡†æ¥è§£å†³è¿™ä¸ªé—®é¢˜: <b>UTF-8</b>, <b>UTF-16</b> ä»¥åŠ <b>UTF-32</b>, <b>UTF-8</b> æ˜¯æœ€å¸¸è§çš„ä¸€å¥—ç¼–ç æ ‡å‡†,<a href="https://www.unicode.org/standard/principles.html">è¿™é‡Œæ˜¯å®˜æ–¹é¡µé¢.</a>
</p>

<p>
<b>UTF-8</b> è¡¨ç¤º 1 ä¸ªå­—èŠ‚ä½œä¸ºåŸºæœ¬ç¼–ç å•ä½,å› ä¸ºæ¯ä¸ªå­—ç¬¦éœ€è¦çš„ç©ºé—´ä¸æ˜¯ä¸€æ ·çš„,å› æ­¤éœ€è¦ä¸€äº›ä½æ¥æ ‡è¯†æ˜¯å¤šå°‘ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå­—ç¬¦,
</p>

<pre class="example" id="org442bde6">
U+ 0000 ~ U+  007F:  0xxxxxxx
U+ 0080 ~ U+  07FF:  110xxxxx 10xxxxxx
U+ 0800 ~ U+  FFFF:  1110xxxx 10xxxxxx 10xxxxxx
U+10000 ~ U+10FFFF:  11110xxx 10xxxxxx 10xxxxxx
</pre>

<p>
å·¦è¾¹çš„æ˜¯ <code>codespace</code>,å³è¾¹åˆ™æ˜¯ <code>codespace</code> å†…çš„ <code>codepoint</code> ç»è¿‡ <code>UTF-8</code> ç¼–ç åä½(bit)çš„æ’åˆ—æ¨¡æ¿.
</p>

<p>
è¿™é‡Œæ¯ä¸ªå¼€å¤´çš„å­—èŠ‚çš„å¼€å¤´æœ‰å¤šå°‘ä¸ª 1 ä½å°±è¡¨ç¤ºç”¨å¤šå°‘ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç , ä»¥ 10 å¼€å¤´çš„å­—èŠ‚æ˜¯å‰é¢å­—èŠ‚çš„åç»­.
</p>

<p>
è¿™æ ·æœ€é«˜å°±éœ€è¦ç”¨åˆ° 4 ä¸ªå­—èŠ‚äº†,ä¸è¿‡åªè¦æŠŠ <b>ä½¿ç”¨é¢‘ç‡ç›¸å¯¹ä½çš„å­—ç¬¦</b> ä»¥åŠ <b>è¯­è¨€å­—ç¬¦é›†æ¯”è¾ƒå¤§çš„å­—ç¬¦</b> å¾€åæ’,åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹èƒ½èŠ‚çœä¸å°‘ç©ºé—´.
</p>

<p>
é‚£ä¹ˆ <b>UTF-8</b> å…·ä½“æ˜¯å¦‚ä½•å¯¹ä¸€ä¸ªå­—è¿›è¡Œç¼–ç çš„å‘¢?
</p>

<p>
æ¯”å¦‚"ç›"å­—çš„ <code>codepoint</code> ä¸º 30416 (åœ¨ <code>Emacs Lisp</code> å¯ä»¥ç›´æ¥é€šè¿‡ <code>?\ç›</code> è·å¾—), åå…­è¿›åˆ¶æ˜¯ <code>#x76D0</code>, äºŒè¿›åˆ¶æ˜¯ <code>#b0111 0110 1101 0000</code>,
</p>

<p>
æŒ‰ç…§ä¸Šé¢çš„æ¨¡æ¿æ¥çœ‹å¤„äºç¬¬ä¸‰ä¸ªåŒºé—´,ä¹Ÿå°±æ˜¯è¦ç”¨åˆ° 3 ä¸ªå­—èŠ‚,æ ¹æ®å¯¹åº”æ¨¡æ¿çš„ <code>x</code> çš„ä½ç½®åˆ’åˆ†å¥½ä½: <code>0111 011011 010000</code>,
</p>

<p>
å†æŠŠå®ƒä»¬å¡«å…¥æ¨¡æ¿ä¸­,æœ€åå¾—åˆ°çš„ <code>11100111 10011011 10010000</code> (E79B90) å°±æ˜¯"ç›"å­—çš„ <b>UTF-8</b> ç¼–ç .
</p>

<p>
<b>UTF-16</b> æ˜¯æŒ‡æœ€å°‘è¦ç”¨ 2 ä¸ªå­—èŠ‚ä½œä¸ºåŸºæœ¬ç¼–ç å•ä½,ä¹Ÿå°±æ˜¯åœ¨è¿™ç§ç¼–ç ä¸‹çš„å­—ç¬¦éœ€è¦ 2n ä¸ªå­—èŠ‚;
</p>

<p>
<b>UTF-32</b> æ˜¯æŒ‡æœ€å°‘è¦ç”¨ 4 ä¸ªå­—èŠ‚ä½œä¸ºåŸºæœ¬ç¼–ç å•ä½,ä¹Ÿå°±æ˜¯åœ¨è¿™ç§ç¼–ç ä¸‹çš„å­—ç¬¦éœ€è¦ 4n ä¸ªå­—èŠ‚,n æ˜¯æ•´æ•°.
</p>

<p>
è¿™é‡Œå°±ä¸è®¨è®º <b>UTF-16</b> å’Œ <b>UTF-32</b> æ˜¯æ€ä¹ˆç¼–ç çš„äº†,å®ƒä»¬éƒ½ä»¥å¤šå­—èŠ‚ä½œä¸ºåŸºæœ¬ç¼–ç å•ä½,è¿™è®¨è®ºä¸€ä¸‹å¤šå­—èŠ‚ç¼–ç çš„æ’åºé—®é¢˜,
</p>

<p>
æˆ‘ä»¬ç›®å‰æ¥è§¦åˆ°çš„éƒ½æ˜¯å­—èŠ‚ä»å·¦åˆ°å³è¿™æ ·å­æ’åˆ—çš„,ä½†æ˜¯åœ¨è®¡ç®—æœºé‡Œé¢å¹¶ä¸ä¸€æ ·æ˜¯è¿™æ ·çš„,è¿™å½“ç„¶ä¹Ÿæ˜¯å†å²åŸå› ,
</p>

<p>
å¯¹äºæ¯ä¸ªéœ€è¦ <b>å¤šå­—èŠ‚ç¼–ç </b> çš„å­—ç¬¦,å®ƒä»¬çš„å­—èŠ‚æ’åˆ—é¡ºåºå¯èƒ½æœ‰ä¸¤ç§: å¤§ç«¯(<b>big endian</b>)å’Œå°ç«¯(<b>little endian</b>), <code>endian</code> æ˜¯ <code>end</code> çš„å˜å½¢.
</p>

<p>
å¤§ç«¯å°±æ˜¯æŒ‰ç…§ \(ä½ä½ \longrightarrow é«˜ä½\) çš„é¡ºåºæŠŠ <b>ä¸€ä¸ªæ•°æ®</b> çš„ <b>åŸºæœ¬å•ä½</b> ä»é‡è¦(most significant)åˆ°ä¸å¤ªé‡è¦(least significant)çš„é¡ºåºè¿›è¡Œæ’åˆ—,
</p>

<p>
å°±æ‹¿ 10 è¿›åˆ¶æ•°å­— 1230 æ¥è¯´,å®ƒæœ‰ 4 ä¸ªæ•°ä½: <b>åƒç™¾åä¸ª</b>, å…¶ä¸­åƒä½çš„æ”¹å˜å¯¹è¿™ä¸ªæ•°å­—çš„å€¼å½±å“æ˜¯æœ€å¤§çš„,å…¶æ¬¡æ˜¯ç™¾ä½,ç„¶åæ˜¯åä½,æœ€åæ˜¯ä¸ªä½,
</p>

<p>
å› æ­¤åƒä½æ˜¯æœ€é‡è¦çš„,è¿™ 4 ä¸ªæ•°ä½çš„æ’åºå°±ç¬¦åˆå¤§ç«¯çš„å®šä¹‰,ç»“åˆä¸Šé¢çš„å®šä¹‰,æˆ‘ä»¬å¯ä»¥æŠŠ 1230 è¿™ä¸ªæ•°å­—å«åšä¸€ä¸ªæ•°æ®,å®ƒçš„åŸºæœ¬å•ä½å°±æ˜¯æ•°ä½;
</p>

<p>
å°ç«¯åˆ™æ˜¯ç›¸å,æŒ‰ç…§ \(ä½ä½ \longrightarrow é«˜ä½\) çš„é¡ºåºæŠŠ <b>ä¸€ä¸ªæ•°æ®</b> çš„ <b>åŸºæœ¬å•ä½</b> ä»ä¸å¤ªé‡è¦åˆ°é‡è¦çš„é¡ºåºè¿›è¡Œæ’åˆ—,æ‰€ä»¥ 1230 çš„å°ç«¯å°±æ˜¯ 0321.
</p>

<p>
è¿™ä¸¤è€…çš„åŒºåˆ«å°±åƒ <b>å¤ä»£ä¸­å›½äººæ˜¯ä»å³è¾¹å¾€å·¦çš„æ–¹å‘å†™å­—</b> ä¸ <b>ç°ä»£ä¸­å›½äººä»å·¦åˆ°å³çš„æ–¹å‘å†™å­—</b> çš„åŒºåˆ«ä¸€æ ·,å¤æ—¶å€™äººä»¬"ä»¥å³ä¸ºå°Š",å› æ­¤å¤æ–‡é‡Œé¢çš„"å³è¿"å°±æ˜¯å‡å®˜çš„æ„æ€.
</p>

<p>
è¦æ³¨æ„,è¿™é‡Œçš„ <b>é«˜ä½</b> å’Œ <b>ä½ä½</b> åªæ˜¯å•çº¯æŒ‡ä½ç½®,ä¹Ÿä¸ä¸€æ ·æ˜¯å¾€å·¦æ–¹å‘å°±æ˜¯ä½ä½æ–¹å‘,å®Œå…¨æ˜¯äººä¸ºå®šä¹‰çš„,è®¡ç®—æœºçš„é«˜ä½å’Œä½ä½ä¹Ÿä¸€æ ·,é«˜ä½æ˜¯æŒ‡å†…å­˜é«˜ä½,ä½ä½æ˜¯æŒ‡å†…å­˜ä½ä½.
</p>

<p>
è®¡ç®—æœºä¸­å¸¸ç”¨ <b>åŸºæœ¬å•ä½</b> ä¸æ˜¯å­—èŠ‚(byte)å°±æ˜¯ä½(bit),é€šå¸¸æ–‡ä»¶å‚¨å­˜å’Œä¼ è¾“éƒ½æ˜¯ä»¥å­—èŠ‚ä½œä¸ºæ•°æ®çš„ <b>åŸºæœ¬å•ä½</b> çš„,
</p>

<p>
<b>ä¸€ä¸ªæ•°æ®</b> å…·ä½“æŒ‡ä»€ä¹ˆè¦çœ‹æƒ…å†µ,ä¸€ä¸ªæ–‡ä»¶æœ¬èº«ä¹Ÿç¬¦åˆ <b>ä¸€ä¸ªæ•°æ®</b> è¿™ä¸ªè¯´æ³•,è€Œè¿™ä¸ªæ•°æ®æœ¬èº«ä¹Ÿæ˜¯ç”±å¾ˆå¤šä¸ªæ›´å°çš„ <b>ä¸€ä¸ªæ•°æ®</b> ç»„æˆ,
</p>

<p>
æ¯”å¦‚å›¾ç‰‡æ–‡ä»¶çš„ä¸€ä¸ªåƒç´ ç‚¹å°±æ˜¯ <b>ä¸€ä¸ªæ•°æ®</b>, <code>utf-8</code> æ–‡æœ¬æ–‡ä»¶çš„ä¸€ä¸ª <code>codepoint</code> çš„ç¼–ç å°±æ˜¯ <b>ä¸€ä¸ªæ•°æ®</b>,
</p>

<p>
è€Œè¿™äº›æ›´å°çš„ <b>ä¸€ä¸ªæ•°æ®</b> åˆç”±å¾ˆå¤šä¸ªæ›´å°çš„ <b>ä¸€ä¸ªæ•°æ®</b> - å­—èŠ‚,
</p>

<p>
å› ä¸ºå­—èŠ‚æ˜¯ <b>åŸºæœ¬å•ä½</b> äº†,æ‰€ä»¥å®ƒä¸å¯èƒ½æ˜¯ <b>ä¸€ä¸ªæ•°æ®</b>,è¿™ä¸ç¬¦åˆ <b>ä¸€ä¸ªæ•°æ®çš„åŸºæœ¬å•ä½</b> çš„è¯´æ³•,
</p>

<p>
å› æ­¤æˆ‘ä»¬è¦æŠŠæ¯” <b>åŸºæœ¬å•ä½</b> é«˜ä¸€çº§çš„æ•°æ®å«åš <b>ä¸€ä¸ªæ•°æ®</b>,æ¯ç§æ–‡ä»¶çš„ <b>ä¸€ä¸ªæ•°æ®</b> éƒ½ä¸ä¸€æ ·,
</p>

<p>
è™½ç„¶æˆ‘ä¸ªäººè§‰å¾—ä¸Šé¢å·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†,ä½†æˆ‘è¿˜æ˜¯è¦è¯´æ˜ä¸€ä¸‹,åœ¨ä»¥å­—èŠ‚ä½œä¸º <b>åŸºæœ¬å•ä½</b> çš„æƒ…å†µä¸‹, ä¸ç®¡æ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯,å­—èŠ‚è‡ªèº«é‡Œé¢çš„ä½çš„é¡ºåºè¿˜æ˜¯å¤§ç«¯çš„.
</p>

<p>
åœ¨ä¸Šé¢çš„ä¸‰ç§ç¼–ç æ ‡å‡†ä¸­, å…¶ä¸­ <b>UTF-16</b> å’Œ <b>UTF-32</b> éƒ½æ¶‰åŠå¤§å°ç«¯çš„æ¦‚å¿µ,å¹¶ä¸”æ–‡æœ¬æ–‡ä»¶ç¼–ç è¿‡ç¨‹ç›¸å¯¹å¤æ‚,
</p>

<p>
è€Œä»¥å®ƒä»¬ä½œä¸ºå¼€åœºä¾‹å­æ¥è®²æ˜ç™½è¿™å¤§å°ç«¯åœ¨è®¡ç®—æœºä¸­æ˜¯ä»€ä¹ˆçš„ä¸€ä¸ªæ¦‚å¿µæ˜¯ä¸å¤ªåˆé€‚çš„,å› æ­¤å…ˆæŠ›å¼€æ–‡æœ¬ç¼–ç ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´èµ·:
</p>

<p>
ç°åœ¨éœ€è¦æŠŠ 1230 ä½œä¸ºä¸€ä¸ªæ•°æ®å‚¨å­˜åˆ°è®¡ç®—æœºé‡Œé¢,å‡è®¾è®¡ç®—æœºç¼–ç æ•°å­—çš„åŸç†æ˜¯æŠŠæ•°å­—çš„äºŒè¿›åˆ¶å½¢å¼å’Œæ•°å­—æœ¬èº«ç­‰åŒèµ·æ¥,
</p>

<p>
(ç”±äºäºŒè¿›åˆ¶å¯¹äºäººç±»è€Œè¨€è¯»å†™éƒ½ä¸æ–¹ä¾¿,æ‰€ä»¥åé¢åŸºæœ¬ç”¨ 16 è¿›åˆ¶è¿›è¡Œè¯´æ˜),å¹¶ä¸”åªèƒ½è®°å½• 0 åˆ° 65535(#xffff) çš„æ­£æ•´æ•°,
</p>

<p>
è§„å®šä¸€ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªåŸºæœ¬å•ä½,ä¹Ÿå°±æ˜¯è¯´éœ€è¦ç”¨ 4 ä¸ªå­—èŠ‚è®°å½•ä¸€ä¸ªæ•°å­—,
</p>

<p>
æ¯”å¦‚ 1230 çš„äºŒè¿›åˆ¶æ˜¯ <code>#b10011001110</code>,æŒ‰ç…§å¤§ç«¯å®šä¹‰,1230 åœ¨è®¡ç®—æœºé‡Œé¢çš„æ ·å­æ˜¯è¿™æ ·çš„: <code>04 ce</code> (è¡¥ä¸€ä¸ª0æ˜¯å› ä¸ºè®¡ç®—æœºç°åœ¨è§„å®šäº†ç¼–ç ä¸€ä¸ªæ•°æ®æœ€å°‘è¦ä¸ºä¸€ä¸ªå­—èŠ‚),
</p>

<p>
è§£æå› 1230 çš„è¿‡ç¨‹å¾ˆç®€å•: \(0 \times 16^{3} + 4 \times 16^{2} + c \times 16^{1} + e \times 16^{0} = 1230\);
</p>

<p>
æŒ‰ç…§å°ç«¯å®šä¹‰, 1230 çš„å­—èŠ‚åºåˆ—æ˜¯ <code>ce 04</code>,å¦‚æœç›´æ¥è§£ææˆ 10 è¿›åˆ¶ä¼šå‡ºé—®é¢˜: \(c \times 16^{3} + e \times 16^{2} + 0 \times 16^{1} + 4 \times 16^{0} = 52740\),
</p>

<p>
æ‰€ä»¥,åˆ¤æ–­æ•°æ®æ˜¯ä½¿ç”¨å¤§ç«¯è¿˜æ˜¯å°ç«¯ç¼–ç å¯¹äºå­—èŠ‚æµåˆ†ææ¥è¯´æ˜¯å¾ˆé‡è¦çš„.
</p>

<p>
æœ‰äº›åœ°æ–¹ä¸ä¼šè¯´å¤§ç«¯è¿˜æ˜¯å°ç«¯,å®ƒä»¬åªä¼šè¯´ç½‘ç»œå­—èŠ‚åº(network byte order)æˆ–è€…ä¸»æœºå­—èŠ‚åº(host byte order),
</p>

<p>
å…¶å®æ„æ€æ˜¯ä¸€æ ·çš„,ç½‘ç»œå­—èŠ‚åºå°±æ˜¯å¤§ç«¯,ä¸»æœºå­—èŠ‚åºå°±æ˜¯å°ç«¯.
</p>

<p>
å¦‚æœè§‰å¾—è¿™é‡Œæ€»ç»“å¾—ä¸å¤Ÿæ¸…æ¥šçš„è¯,å¯ä»¥çœ‹ <a href="https://www.digital-detective.net/understanding-big-and-little-endian-byte-order/">understanding big and little endian byte order</a> æˆ–è€… <code>Assembly Language Step by Step Programming with Linux, Third Edition</code> çš„ç¬¬äº”ç« å…³äº <code>Endianess</code> çš„å†…å®¹.
</p>

<p>
å›åˆ°æ–‡æœ¬ç¼–ç ä¸Š,æ‹¿ <b>UTF-16</b> æ¥è¯´,å®ƒä¸€ä¸ªæ•°æ®(ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—ç¬¦)éœ€è¦ 2n ä¸ªå­—èŠ‚,åŸºæœ¬å•ä½è¿˜æ˜¯ä¸€ä¸ªå­—èŠ‚,
</p>

<p>
å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªå­—ç¬¦(4ä¸ªå­—èŠ‚)çš„å­—èŠ‚åºåˆ—,å®ƒä»¥å°ç«¯é¡ºåºæ’åˆ—: <code>54 00 | 72 00</code>,é‚£ä¹ˆå®ƒçš„å¤§ç«¯æ’åˆ—å°±æ˜¯è¿™æ ·: <code>00 54 | 00 72</code>.
</p>

<p>
<b>UTF-16</b> å’Œ <b>UTF-32</b> å¯èƒ½ä¼šåœ¨æ–‡ä»¶çš„å¼€å¤´é‡‡ç”¨ <code>BOM(Byte Order Mark)</code> æ¥å£°æ˜è‡ªå·±é‡‡ç”¨å“ªç§é¡ºåº,æœ‰æ²¡æœ‰è¿˜æ˜¯è¦çœ‹å…·ä½“ç¨‹åºå¦‚ä½•ç¼–ç ,
</p>

<p>
è€Œ <b>UTF-8</b> æ˜¯ä¸åˆ†å¤§å°ç«¯çš„,å®ƒåªæœ‰å¤§ç«¯,æ‰€ä»¥ <code>BOM</code> å¯¹äº <b>UTF-8</b> ç¼–ç çš„æ–‡ä»¶æ˜¯æ²¡æœ‰æ„ä¹‰çš„,
</p>

<p>
ç„¶è€Œå¾ˆå¤š <code>Windows</code> ç¨‹åºä¼šåœ¨ <b>UTF-8</b> æ–‡ä»¶å‰é¢åŠ ä¸Šæ— æ„ä¹‰çš„ <code>BOM</code>,è¿™æ˜¯å¾®è½¯å¼€çš„åå¤´,
</p>

<p>
è¿™äº›æ–‡ä»¶å¹¶ä¸æ˜¯æ ‡å‡†çš„ <b>UTF-8</b> ç¼–ç ,åœ¨å…¶å®ƒç³»ç»Ÿä¸Šæ‰“å¼€è¿™äº›æ–‡ä»¶å¯èƒ½ä¼šå› ä¸ºç¼–ç å¼•èµ·è§£æé”™è¯¯çš„é—®é¢˜.
</p>

<p>
åé¢ä¸å†ç»§ç»­å¯¹è¿™ <b>UTF-16</b> å’Œ <b>UTF-32</b> è¿™ä¸¤ç§ç¼–ç è¿›è¡Œæ¢è®¨äº†,å› ä¸ºè¿™å’Œåé¢çš„å†…å®¹å…³ç³»ä¸å¤ªå¤§.
</p>

<p>
<br>
</p>

<p>
<code>Emacs</code> ä½œä¸ºæ–‡æœ¬ç¼–è¾‘å™¨,ç¼–ç é—®é¢˜è‡ªç„¶æ˜¯ä¸å¯èƒ½é¿è€Œä¸è°ˆçš„,è€Œå¦‚æœè¦ç¼–å†™ <code>Emacs Lisp</code> å¤„ç†æ–‡æœ¬çš„è¯,
</p>

<p>
é‚£ä¹ˆç†è§£ <code>Emacs</code> å†…éƒ¨æ–‡æœ¬æœºåˆ¶æ˜¯å¿…è¦åŸºç¡€äº†.
</p>

<p>
<code>Emacs</code> æ²¡æœ‰ç›´æ¥ä½¿ç”¨ <b>Unicode Standard</b>,è€Œæ˜¯åœ¨ <code>Unicode</code> çš„åŸºç¡€ä¸Šè¿›è¡Œæ‹“å±•,
</p>

<p>
åœ¨ <code>#x110000..#x3FFFFF</code> çš„èŒƒå›´ç»™ä¸€äº› <b>æ— æ³•ç”¨ Unicode å’Œ raw 8-bit bytes æ ‡å‡†è§£æçš„å­—ç¬¦</b> è¿›è¡Œç¼–ç ,
</p>

<p>
æ‰€ä»¥ç†è®ºä¸Š <code>Emacs</code> çš„ä¸€ä¸ªå­—ç¬¦éœ€è¦å ç”¨ç”¨ 22 ä½(bit)ç©ºé—´,è¿™å°±æ˜¯ <code>Emacs</code> çš„æ–‡æœ¬çš„å†…éƒ¨è¡¨ç¤º(text representation).
</p>

<p>
åŒæ ·ä¸ºäº†èŠ‚çœå†…å­˜, <code>Emacs</code> ä¹Ÿæ²¡æœ‰ä½¿ç”¨å›ºå®š 22 ä½ç©ºé—´å‚¨å­˜ä¸€ä¸ªå­—ç¬¦,è€Œæ˜¯ç”¨ä¸€ä¸ªé•¿åº¦å¯å˜(variable-length)å­—èŠ‚åºåˆ—(a squence of 8-bit bytes)å‚¨å­˜ä¸€ä¸ªå­—ç¬¦,
</p>

<p>
åºåˆ—çš„é•¿åº¦èŒƒå›´åœ¨ 1 åˆ° 5 ä¸ªå­—èŠ‚å†…(åŒ…æ‹¬5).
</p>

<p>
å¹¶ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯ç”¨çš„ <b>Unicode Standard</b> å‚¨å­˜çš„,è€Œ <code>Emacs</code> ä½œä¸ºä¸€æ¬¾çµæ´»çš„æ–‡æœ¬ç¼–è¾‘å™¨å¯ä¸èƒ½åªæ”¯æŒä¸€ç§ç¼–ç æ ‡å‡†çš„æ–‡ä»¶,
</p>

<p>
æ¯æ¬¡ <code>Emacs</code> æ‰“å¼€æ–‡ä»¶éƒ½éœ€è¦å…ˆæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°ç¼“å†²åŒºä¸­, æ–‡ä»¶å†…å®¹å«åš <code>encoded text</code>, è™½ç„¶åå­—å¸¦äº†ä¸€ä¸ª <code>text</code>,
</p>

<p>
ä½†æ˜¯ä¸æ˜¯å¹³å¸¸æ„ä¹‰ä¸Šäººç±»æ‰€è¯»çš„æ–‡æœ¬,è€Œæ˜¯ä¸€ä¸ªè®¡ç®—æœºèƒ½è¯»çš„å­—èŠ‚åºåˆ—,å‡†ç¡®æ¥è¯´æ˜¯ä¸€ä¸ªç”±å¤šä¸ª <b>å•ä¸ª/ç‹¬ç«‹å­—èŠ‚</b> æ’åˆ—æˆçš„åºåˆ—,
</p>

<p>
ç„¶å <code>Emacs</code> ä¼šæ ¹æ®æ–‡ä»¶çš„ç¼–ç æ ‡å‡†æŠŠ <code>encoded text</code> è½¬æ¢ä¸º <code>Emacs</code> ç¼–ç æ ‡å‡†èƒ½å¤Ÿè§£æçš„ç»“æ„(å¦å¤–ä¸€ä¸ªç§å½¢å¼çš„å­—èŠ‚åºåˆ—),
</p>

<p>
è¿™ç§ç¼–ç ä¹‹é—´çš„è½¬æ¢å«åšå­—ç¬¦ç è½¬æ¢(character code conversion),æœ€åæŠŠè§£æåçš„å†…å®¹ç¿»è¯‘(è§£ç )æˆç»™äººç±»çœ‹çš„å­—ç¬¦,
</p>

<p>
è¿™ä¸ªæ—¶å€™ç¼“å†²åŒºä¸Šé¢çš„å†…å®¹ä¸å†æ˜¯ <code>encoded text</code> (,è™½ç„¶æ–‡æ¡£æ²¡æœ‰è¯´,åº”è¯¥å«åš <code>decoded text</code>,è¿™ç§æ‰æ˜¯äººç±»æ‰€è¯»çš„æ–‡æœ¬).
</p>

<p>
å…³äºå­—ç¬¦ç è½¬æ¢ä¹Ÿå¯ä»¥çœ‹çœ‹<a href="https://www.ibm.com/support/knowledgecenter/ssw_ibm_i_74/db2/rbafzccseta.htm">è¿™é‡Œ</a>, å…³äº <code>Emacs</code> æ˜¯æ˜¾ç¤ºå­—ç¬¦çš„ç»†èŠ‚å¯ä»¥çœ‹è¿™é‡Œ <code>M-: (info "(elisp)Character Display")</code>.
</p>

<p>
ä¿å­˜æ–‡ä»¶åˆ™æ˜¯æ–‡ä»¶è¯»å–çš„é€†è¿‡ç¨‹: æ ¹æ® <code>Emacs</code> ç¼–ç æ ‡å‡†æŠŠç¼“å†²åŒºçš„å†…å®¹è½¬æ¢ä¸ºæ–‡ä»¶çš„ç¼–ç æ ‡å‡†æ‰€èƒ½å¤Ÿè§£æçš„ç»“æ„,
</p>

<p>
ä¹Ÿå°±æ˜¯æŠŠç¼“å†²åŒºçš„å†…å®¹è½¬å› <code>encoded text</code>, æœ€åå†™å…¥åˆ°æ–‡ä»¶ä¸­.
</p>

<p>
ä¸€èˆ¬æƒ…å†µæ˜¯è¿™æ ·çš„,ç„¶è€Œ <code>Emacs</code> ä½œä¸ºä¸€æ¬¾çµæ´»çš„ç¼–è¾‘å™¨,å®ƒæ”¯æŒç”¨æˆ·åœ¨ä¿å­˜æ—¶é€‰æ‹©åˆ«çš„ç¼–ç æ ‡å‡†,
</p>

<p>
è¿™ä¹ˆä¸€æ¥æ–‡ä»¶å°±å®Œæˆäº†å­—ç¬¦ç è½¬ç äº†,å°±åƒ <code>Linux</code> çš„ <code>iconv</code> å‘½ä»¤ä¸€æ ·,
</p>

<p>
åœ¨æ—¥å¸¸ä½¿ç”¨ <code>Emacs</code> ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶æ—¶,å¯ä»¥é€šè¿‡ <code>buffer-file-coding-system</code> å˜é‡æ¥æŸ¥çœ‹æ–‡ä»¶æ‰€ä½¿ç”¨çš„ç¼–ç æ ‡å‡†,
</p>

<p>
å¯ä»¥é€šè¿‡ <code>set-buffer-file-coding-system</code> å‘½ä»¤ç»™å½“å‰æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶é€‰æ‹©åˆ«çš„ç¼–ç æ ‡å‡†,
</p>

<p>
è¿™åªå½±å“æ–‡ä»¶ä¿å­˜æ—¶ä½¿ç”¨çš„ç¼–ç ,å¹¶ä¸å½±å“ç¼“å†²åŒºçš„å†…å®¹,è™½ç„¶æœ‰ç‚¹å•°å—¦,ä½†è¿˜æ˜¯ä¸¾ä¸€ä¸ªä¾‹å­å§,
</p>

<p>
æ¯”å¦‚ä½ æ‰“å¼€äº†ä¸€ä¸ª <code>utf-8-dos</code> ç¼–ç çš„æ–‡ä»¶,å‘ç°ä¸Šé¢æœ‰å¾ˆå¤š <code>^M</code> ç¬¦å·,è¿™äº›ç¬¦å·ä¸€èˆ¬æ˜¯ä¸åº”è¯¥çœ‹è§çš„,
</p>

<p>
å› ä¸º <code>Emacs</code> é»˜è®¤ä½¿ç”¨ <code>utf-8</code> ç¼–ç æ‰“å¼€æ–‡ä»¶,ç¼–ç ä¸å¯¹æ‰€ä»¥æ²¡æ³•æ­£å¸¸æ˜¾ç¤º,ä½ æƒ³æœ€å¿«åœ°æŠŠè¿™äº›ç¬¦å·éšè—èµ·æ¥,
</p>

<p>
æœ€å¿«çš„åŠæ³•å°±æ˜¯ä½¿ç”¨æ­£ç¡®çš„ç¼–ç æ‰“å¼€æ–‡ä»¶äº†,ä½† <code>set-buffer-file-coding-system</code> åªä¼šæ”¹å˜æ–‡ä»¶ä¿å­˜æ—¶å€™çš„ç¼–ç ,
</p>

<p>
è¦è®©ç¼“å†²åŒºä¸Šæ˜¾ç¤ºçš„å†…å®¹ç”Ÿæ•ˆ,å°±åº”è¯¥é‡æ–°å¯¹ <code>encoded text</code> è¿›è¡Œè½¬ç : <code>M-: (decode-coding-region (point-min) (point-min) 'utf-8-dos)</code>.
</p>

<p>
<code>Emacs</code> ä¹Ÿå¯ä»¥ä¸å¯¹ <code>encoded text</code> è¿›è¡Œè½¬ç æ˜¾ç¤º,ç”¨æˆ·å¯ä»¥åœ¨è¿™ç§çŠ¶æ€ä¸‹å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¾‘,
</p>

<p>
å¦‚æœè¦åˆ†ææ–‡ä»¶å­—èŠ‚æµ,é‚£ä¹ˆè¿™ç§æ–¹å¼æ˜¯æœ€å¥½çš„.
</p>

<p>
åœ¨ <code>Emacs</code> ä¸­,è¿™ç§å‚¨å­˜ <code>encoded text</code> çš„ç¼“å†²åŒºå’Œå­—ç¬¦ä¸²å«åš <code>unibyte</code> ç¼“å†²åŒºå’Œå­—ç¬¦ä¸²,
</p>

<p>
<code>unibyte</code> ç¼“å†²åŒºå’Œå­—ç¬¦ä¸²åœ¨ <code>Emacs</code> é‡Œé¢æ˜¯ä»¥å…«è¿›åˆ¶çš„å½¢å¼æ˜¾ç¤ºçš„,æ¯”å¦‚ <code>\237</code>,
</p>

<p>
ç”¨æˆ·å¹³æ—¶çœ‹åˆ°çš„æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ç”±1åˆ°å¤šä¸ªå­—èŠ‚è§£æå¾—åˆ°çš„,å‚¨å­˜è¿™ç§å­—èŠ‚åºåˆ—çš„ç¼“å†²åŒºå’Œå­—ç¬¦ä¸²å«åš <code>multibyte</code> ç¼“å†²åŒºå’Œå­—ç¬¦ä¸².
</p>

<p>
æ€»çš„æ¥è¯´, <code>unibyte</code> ç¼“å†²åŒºå’Œå­—ç¬¦ä¸²ä¸æ˜¯ç»™äººçœ‹çš„, <code>multibyte</code> ç¼“å†²åŒºå’Œå­—ç¬¦ä¸²æ‰æ˜¯.
</p>

<p>
<code>Emacs Lisp</code> çš„å­—ç¬¦å’Œå­—ç¬¦ä¸²æ•°æ®ç±»å‹æ”¯æŒç›´æ¥ä½¿ç”¨å­—ç¬¦ç æ¥è¡¨ç¤ºå¯¹åº”å­—ç¬¦,å…·ä½“å¯ä»¥çœ‹ <code>M-: (info "(elisp)Character Codes")</code>.
</p>

<p>
è¿™ä¸‹é¢æœ‰ä¸ªä¾‹å­: è¯·æ±‚ä¸€ä¸ªä¸­æ–‡é¡µé¢,è¯·æ±‚å¾—åˆ°çš„å†…å®¹ä¼šå†™å…¥åˆ°ç¼“å†²åŒºé‡Œé¢,ç„¶åæŠŠæŠŠè¯·æ±‚å†…å®¹è§£ææˆ <code>DOM</code> æ ‘.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(url-retrieve
  <span style="color: #CC9393;">"https://gaokao.chsi.com.cn/sch/search--ss-on,option-qg,searchType-1,start-0.dhtml"</span>
  (<span style="color: #F0DFAF; font-weight: bold;">lambda</span> (status)
    (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((buf (current-buffer)))
      (<span style="color: #F0DFAF; font-weight: bold;">with-current-buffer</span> buf
        (set-buffer-multibyte t)
        <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(prin1 (decode-coding-string (buffer-substring-no-properties (point-min) (point-max)) 'utf-8-dos))</span>
        (decode-coding-region (point-min) (point-max) 'utf-8-dos)
        (prin1 (libxml-parse-html-region (point-min) (point-max)))
        ))))
</pre>
</div>

<p>
è¯·æ±‚å¾—åˆ°çš„å†…å®¹æ˜¯å­—èŠ‚æµ,é»˜è®¤æƒ…å†µä¸‹, <code>Emacs</code> çš„ç¼–ç æ ‡å‡†æ˜¯ <code>utf-8</code>, æ‰€ä»¥ <code>ASCII</code> å­—ç¬¦æ˜¯æ­£å¸¸æ˜¾ç¤ºçš„,ä½†æ˜¯ç”±äºå­—èŠ‚æµæ˜¯ <code>unibyte</code> å­—ç¬¦ä¸²,
</p>

<p>
å…¶ä¸­ä¸­æ–‡å­—ç¬¦ä¸èƒ½è¢«æ­£ç¡®è§£æ,åªèƒ½æ˜¾ç¤ºä¸ºå…«è¿›åˆ¶.
</p>

<p>
è¿™é‡Œå¯ä»¥ç¨å¾®åšä¸€ä¸ªå°å®éªŒ: é€šè¿‡æµè§ˆå™¨æŠŠä¸Šé¢è¯·æ±‚çš„é¡µé¢ä¿å­˜ä¸‹æ¥,ç„¶åé€šè¿‡ <code>hexl-mode</code> ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ç¼–è¾‘é¡µé¢,
</p>

<p>
ç”¨ <b>ä¸Šé¢çš„è¯·æ±‚å†…å®¹</b> å’Œ <b>äºŒè¿›åˆ¶æ¨¡å¼ä¸‹æ˜¾ç¤ºçš„å†…å®¹</b> è¿›è¡Œå¯¹æ¯”å,ä½ ä¼šå‘ç°å‰è€…æ˜¾ç¤ºå…«è¿›åˆ¶çš„ä½ç½®å’Œåè€…æ˜¾ç¤º <code>.</code> çš„ä½ç½®æ˜¯å¯¹åº”çš„,
</p>

<p>
è¿™äº›ä½ç½®ä¸Šçš„éƒ½æ˜¯ <code>NON-ASCII</code> å­—ç¬¦,è¿™å°±æ˜¯å‰é¢è¯´çš„ä¸å¯¹æ–‡ä»¶è¿›è¡Œè½¬ç æ˜¾ç¤º.
</p>

<p>
<code>nhexl-mode</code> ä½œä¸º <code>hexl-mode</code> çš„æ‹“å±•ç‰ˆå¯ä»¥æ­£å¸¸æ˜¾ç¤ºå‡ºè¿™äº›å­—ç¬¦.
</p>

<p>
åœ¨è¿™ç§æƒ…å†µä¸‹è°ƒç”¨ <code>libxml-parse-html-region</code> æ˜¯ä¸ä¼šè§£æå‡ºæ­£ç¡®ç»“æœ(å› ä¸º <code>libxml-parse-html-region</code> ä¼šæŠŠ <code>unibyte</code> ç¼“å†²åŒº çš„ <code>(buffer string)</code> ä½œä¸ºæ–‡æœ¬è¿›è¡Œè§£æ),
</p>

<p>
å› æ­¤è¦è°ƒç”¨ <code>set-buffer-multibyte</code> æŠŠ ç¼“å†²åŒº å˜æˆ <code>multibyte</code> ç¼“å†²åŒº æ­£å¸¸æ˜¾ç¤ºå‡ºæ–‡æœ¬.
</p>

<p>
è§£æå‰è¿˜å¯ä»¥è°ƒç”¨ <code>decode-coding-region</code> å¯¹å½“å‰ç¼“å†²åŒºè¿›è¡Œé‡æ–°è§£ç ,è¿™ä¸ªé¡µé¢æ˜¯æœ€æ—©åº”è¯¥æ˜¯å†™åœ¨ <code>Windows</code> ä¸Šçš„,
</p>

<p>
å› ä¸ºä½¿ç”¨ <code>utf-8</code> å¯¹è¯¥é¡µé¢çš„å­—èŠ‚æµè§£ç çš„è¯ä¼šæ˜¾ç¤º <code>Windows utf-8</code> ç‰¹æœ‰çš„è¡Œå°¾ç¬¦å·(<code>^M</code>),
</p>

<p>
æ‰€ä»¥è¿™é‡Œä½¿ç”¨æ­£ç¡®çš„ç¼–ç æ ‡å‡†å¯¹ç¼“å†²åŒºé‡æ–°è§£ç è®©è¡Œå°¾ç¬¦å·éšè—èµ·æ¥.
</p>

<p>
å½“ç„¶,è¿™ä¸ªè¡Œå°¾ç¬¦å·ä¸å½±å“ <code>libxml-parse-html-region</code> çš„è§£æç»“æœ.
</p>

<p>
æœ€åè¿™é‡Œæœ‰ä¸€ä¸ªå®Œæ•´çš„çˆ¬è™«<a href="../../../files/web-scrapy-example.el">ä¾‹å­</a>,æœ‰å…´è¶£å¯ä»¥å‚è€ƒä¸€ä¸‹.
</p>
</div>
</div>


<div id="outline-container-org564d34f" class="outline-3">
<h3 id="org564d34f">æ–‡æ¡£ (Documentation)</h3>
</div>


<div id="outline-container-orgfa2012a" class="outline-3">
<h3 id="orgfa2012a">æ‰“åŒ… (Packaging)</h3>
</div>


<div id="outline-container-orgafc9962" class="outline-3">
<h3 id="orgafc9962">GNU Emacs Internals</h3>
<div class="outline-text-3" id="text-orgafc9962">
<p>
å¦‚æœä½ æœ‰ä»¥ä¸‹æƒ³æ³•:
</p>

<ul class="org-ul">
<li>æƒ³äº†è§£ç¼–è¯‘ <code>Emacs</code> çš„è¿‡ç¨‹</li>

<li>æƒ³äº†è§£ <code>Emacs</code> å¯¹è±¡çš„å®ç°</li>

<li>æƒ³äº†è§£ <code>Emacs</code> æ•´æ•°ç±»å‹çš„å®ç°</li>

<li>æƒ³äº†è§£ <code>Emacs</code> çš„åˆ†é…/å‚¨å­˜/åƒåœ¾å›æ”¶æœºåˆ¶</li>

<li>æƒ³äº†è§£ <code>Emacs</code> çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</li>

<li>æƒ³äº†è§£å¦‚ä½•ç¼–å†™è‡ªå·±çš„ <code>primitive</code></li>

<li>æƒ³äº†è§£å¦‚ä½•ä½¿ç”¨ <code>C</code> è¯­è¨€ç¼–å†™åŠ¨æ€åŠ è½½æ¨¡å—</li>
</ul>


<p>
<br>
</p>


<p>
ä½†æ˜¯åˆä¸çŸ¥é“ä»ä½•å…¥æ‰‹,å¯ä»¥è¯»ä¸€ä¸‹å®˜æ–¹çš„æ–‡æ¡£ <code>M-: (info "(elisp)GNU Emacs Internals")</code>.
</p>

<p>
é€šå¸¸å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½æœ‰è‡ªå·±å†™åŠ¨æ€åŠ è½½æ¨¡å—çš„æƒ³æ³•,æ°å¥½æ–‡æ¡£å…³äºè¿™éƒ¨åˆ†çš„å†…å®¹ååˆ†è¯¦ç»†,
</p>

<p>
ä¸è¿‡è¿™è¦æ±‚ç”¨æˆ·æœ‰ä¸€å®šçš„ <code>C</code> è¯­è¨€åŸºç¡€,å¦‚æœä½ æœ‰å…¶å®ƒè¯­è¨€çš„ç»éªŒ,å¯ä»¥è¿™æ ·å…¥æ‰‹:
</p>

<p>
å¦‚æœä¹‹å‰æ²¡æœ‰ä½¿ç”¨è¿‡ç¼–è¯‘å‹è¯­è¨€çš„ç»éªŒ,é‚£ä¹ˆè¦å…ˆç†è§£ç›´è¯‘å‹è¯­è¨€ä½•ç¼–è¯‘å‹è¯­è¨€çš„åŒºåˆ«,
</p>

<p>
è¦çŸ¥é“ä»€ä¹ˆæ˜¯é¢„å¤„ç†å™¨,ä»€ä¹ˆæ˜¯ç¼–è¯‘å™¨,ä»€ä¹ˆæ˜¯é“¾æ¥å™¨,å®ƒä»¬æ˜¯æ€ä¹ˆä¸€èµ·å·¥ä½œçš„äº§ç”Ÿç¼–è¯‘ç»“æœçš„;
</p>

<p>
<code>C</code> è¯­è¨€ä¸åƒ <code>C++</code> æˆ–è€… <code>Python</code> é‚£æ ·æœ‰ä¸€ä¸ªå®˜æ–¹ç»„ç»‡å‘å±•,å¯¼è‡´äº†å®ƒçš„è¯­æ³•æ²¡æœ‰ä¸€å¥—å®é™…çš„æ ‡å‡†,
</p>

<p>
ä¹Ÿå°±æ˜¯æœ‰å¾ˆå¤šå¥—æ–¹è¨€,ä½œä¸ºå¼€å‘è€…éœ€è¦çŸ¥é“è‡ªå·±ç”¨çš„æ˜¯å“ªä¸€ç§æ ‡å‡†ä»¥åŠæ˜¯ä»€ä¹ˆç‰ˆæœ¬,
</p>

<p>
å¸¸è§çš„æ ‡å‡†æœ‰ <b>GNU C (gnu90, gnu89)</b> ä»¥åŠ <b>ANSI C (c89, c99, c11)</b>,
</p>

<p>
è¿™é‡Œæ¨èä¸€ä¸ª<a href="https://www.studytonight.com/c/">ç½‘ç«™</a>æ¥åº¦è¿‡ä¸Šæ‰‹æœŸ,ç¼–è¯‘å™¨æ–¹é¢æ¨èå’Œ <code>Emacs</code> ä¸€ä¸ªè€å®¶çš„ <code>gcc</code> ç¼–è¯‘å™¨;
</p>

<p>
ä¸åŒç¼–è¯‘å™¨ä¹‹é—´çš„å·®åˆ«ä¸å°,é…å¥—çš„é¢„å¤„ç†å™¨å°±æ˜¯å…¶ä¸­ä¸€ä¸ªå·®åˆ«,ä¸åŒé¢„å¤„ç†å™¨æ”¯æŒçš„æŒ‡ä»¤ä¸ä¸€æ ·,
</p>

<p>
é€‰æ‹© <code>gcc</code> çš„è¯å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://gcc.gnu.org/onlinedocs/gcc-10.2.0/cpp/">æ–‡æ¡£</a>æ”¯æŒå“ªä¸€äº›æŒ‡ä»¤ä»¥åŠå®ƒä»¬æ˜¯å¹²ä»€ä¹ˆçš„;
</p>

<p>
<code>C</code> è¯­è¨€å’Œå¤§éƒ¨åˆ†è¯­è¨€çš„åŒºåˆ«åœ¨äº C è¯­è¨€é‡‡ç”¨äº†æ˜¾ç¤ºå¼•ç”¨å‹è®¾è®¡,æŒ‡é’ˆè¿™ç§æ•°æ®ç±»å‹å°±æ˜¯è¯¥è®¾è®¡çš„ä½“ç°,
</p>

<p>
ç¨‹åºå…¶ä¸­çš„ä¸€éƒ¨åˆ†å†…å­˜(å †ä¸Šçš„å†…å­˜)çš„åˆ†é…å’Œé‡Šæ”¾æ˜¯ç”±å¼€å‘äººå‘˜å†³å®šçš„,ä¸æä¾›æ²¡æœ‰åƒåœ¾å›æ”¶æœºåˆ¶,
</p>

<p>
ä¹Ÿå°±æ˜¯è¯´è¦çœŸæ­£æŒæ¡æŒ‡é’ˆ,æ˜¯å¿…å®šè¦å»æŒæ¡ <code>C</code> çš„ç¨‹åºçš„å†…å­˜å¸ƒå±€,ä¹Ÿå«ç¨‹åºçš„å†…å­˜æ˜ åƒ(program's image),
</p>

<p>
åé¢ä¹Ÿç¨å¾®æ€»ç»“äº†ä¸€ä¸‹;
</p>

<p>
åœ¨è°ƒè¯•æ–¹é¢é€‰æ‹© <code>gdb</code>,å…³äºå®ƒçš„ä½¿ç”¨å¯ä»¥çœ‹è¿™ä¸ª<a href="http://heather.cs.ucdavis.edu/~matloff/UnixAndC/CLanguage/Debug.html">åœ°å€</a>,
</p>

<p>
æ­¤å¤–è¿˜è¦å­¦ä¼šçœ‹è½¬å‚¨(dump,è¿™é‡Œæ˜¯åè¯),è½¬å‚¨(dumping,åŠ¨åè¯)å°±æ˜¯æŠŠè¿è¡Œæ—¶çš„ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ä¸Š,
</p>

<p>
è¿™ä¸ªæ–‡ä»¶å°±å«åš <code>dump</code>,æ¯”å¦‚ <code>Linux</code> ä¸‹æœ‰åçš„ <code>core dump</code>,å®ƒä¼šåœ¨ç¨‹åºæ„å¤–ç»“æŸçš„æ—¶å€™ç”Ÿæˆ,
</p>

<p>
å¯ä»¥é…åˆ <code>gdb</code> è¿›è¡Œè°ƒè¯•,å…·ä½“æ“ä½œå‚è€ƒ<a href="https://wiki.archlinux.org/index.php/Core_dump">è¿™é‡Œ</a>,ä½†è¿™ä¸æ˜¯é‡ç‚¹,é‡ç‚¹æ˜¯è¦å­¦ä¼šå¦‚ä½•è¯»æ‡‚ <code>core dump</code>,
</p>

<p>
<code>core dump</code> è®°å½•äº†ä¿¡å·(signal),æ¯”å¦‚å¸¸è§çš„ <code>segment fault</code> å°±æ˜¯ <code>SIGSEGV</code>, <code>Linux</code> çš„ <a href="https://www.man7.org/linux/man-pages/man7/signal.7.html">Singalæ–‡æ¡£</a> æˆ–è€… <code>man 7 signal</code> å°±å¾ˆè¯¦ç»†äº†,
</p>

<p>
æœ€å¥½å†å»è¯»ä¸€ä¸‹ <code>APUE 3rd</code> å…³äº <code>Signal</code> çš„ç« èŠ‚äº†è§£ä¸€ä¸‹ä¿¡å·çš„å·¥ä½œæ–¹å¼.
</p>
</div>


<div id="outline-container-orgdc5a921" class="outline-4">
<h4 id="orgdc5a921">C ç¨‹åºçš„å†…å­˜æ˜ åƒ</h4>
<div class="outline-text-4" id="text-orgdc5a921">
<p>
ä¸»è¦å‚è€ƒèµ„æ–™ <code>APUE 3rd</code> çš„ç¬¬7ç« çš„ç¬¬6å°èŠ‚,ä»¥åŠéƒ¨åˆ†å‚è€ƒ <code>Cä¸“å®¶ç¼–ç¨‹(Expert C Programming)</code> çš„ç¬¬6,7ç« ,
</p>

<p>
<code>Cä¸“å®¶ç¼–ç¨‹</code> è®²çš„ååˆ†è¯¦ç»†,æ¨èè®¤çœŸè¯»ä¸€ä¸‹.
</p>

<p>
ä¸€ä¸ª <code>C</code> ç¨‹åºæ–‡ä»¶æœ¬èº«åˆ’åˆ†äº†å¾ˆå¤šä¸ªåŒºåŸŸ,å…¶ä¸­æœ‰ 6 ä¸ªåŒºåŸŸä¼šåœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åŠ è½½è¿›å†…å­˜,
</p>

<p>
ä¹Ÿå°±æ˜¯è¯´å†…å­˜æ˜ åƒç”± 6 ä¸ªç»„æˆéƒ¨åˆ†ç»„æˆ,æ¯”å¦‚è€é¢å­” <code>a.out</code>,
</p>


<div id="orgbcc6fc1" class="figure">
<p><img src="../../../files/program-image.jpg" alt="program-image.jpg">
</p>
<p><span class="figure-number">Figure 4: </span>Cç¨‹åºçš„å†…å­˜æ˜ åƒ</p>
</div>

<p>
è¿™æ˜¯ä¸€å¼ å…¸å‹çš„å†…å­˜æ’åˆ—å›¾,ä»é«˜ä½åˆ°ä½ä½ä¾æ¬¡çœ‹,
</p>

<ol class="org-ol">
<li>å‚¨å­˜äº†å‘½ä»¤è¡Œå‚æ•°ä»¥åŠç¯å¢ƒå˜é‡çš„åŒºåŸŸ/æ®µ;</li>

<li><p>
Stack,åœ¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™,å‡½æ•°é‡Œæ‰€å®šä¹‰çš„å˜é‡(ä¸€èˆ¬å°±æ˜¯å±€éƒ¨å˜é‡)ä»¥åŠç›¸åº”çš„ä¿¡æ¯éƒ½ä¼šè¢«å‚¨å­˜åˆ°è¿™é‡Œ,å½“å‡½æ•°è¿”å›åè¿™äº›å˜é‡ä»¥åŠä¿¡æ¯å°±ä¸¢å¼ƒäº†.
</p>

<p>
å¹¶ä¸”æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶,è¯¥åŒºåŸŸéƒ½ä¼šä¿å­˜è¿”å›çš„åœ°å€ä»¥åŠè°ƒç”¨è€…(caller)çš„ç¯å¢ƒä¿¡æ¯.æ‰€ä»¥æ¯æ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™éƒ½ä¼šåœ¨è¿™ä¸ªåŒºåŸŸä¸ºå‡½æ•°çš„è‡ªåŠ¨ä»¥åŠä¸´æ—¶å˜é‡åˆ†é…ç©ºé—´.
</p>

<p>
æ‰€ä»¥é€’å½’å‡½æ•°é‡Œé¢,æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡å°±ä¼šä½¿ç”¨ä¸€ä¸ªæ ˆå¸§,ä¸åŒæ ˆå¸§ä¸Šçš„åŒåå˜é‡æ˜¯ä¸ä¸€æ ·çš„.è¿™ä¸ªåŒºåŸŸå’Œå«åš <code>stack</code> çš„æ•°æ®ç»“æ„ä¸€æ ·æœ‰ç€åŒæ ·çš„ç‰¹æ€§,è€Œæ ˆåº•ä½äºé«˜ä½,
</p>

<p>
å†…å­˜ä»æ ˆåº•å¼€å§‹å¢é•¿.è¿™ä¸ªåŒºåŸŸç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç®¡ç†,ä¸ <code>stack</code> æ•°æ®ç»“æ„ä¸€æ ·,æ ˆå¸§æ˜¯è¿ç»­çš„,ä¹Ÿå°±æ˜¯è¯´, <code>Stack</code> ä¸Šçš„å†…å­˜åˆ†é…æ˜¯è¿ç»­çš„.
</p>

<p>
(åœ¨æŸä¸ªå‡½æ•°çš„å®šä¹‰ä¸­,)åœ¨å˜é‡ <code>A</code> ä¹‹åå®šä¹‰çš„å˜é‡ <code>B</code> å¿…å®šæ˜¯å†…å­˜åœ°å€ç›¸é‚»çš„.
</p></li>

<li><p>
Heap,è¿™ä¸ªåŒºåŸŸä¸åƒ <code>Stack</code> ä¸€æ ·æœ‰ç€åŒåæ•°æ®ç»“æ„çš„ç‰¹æ€§,åŠ¨æ€å†…å­˜åˆ†é…å°±æ˜¯å‘ç”Ÿåœ¨è¿™ä¸ªåŒºåŸŸçš„,æ‰€è°“åŠ¨æ€åˆ†é…å°±æ˜¯åˆ†é…çš„å†…å­˜å¤§å°ä¸å®š,ç”šè‡³ä¼šåœ¨åˆ†é…åå‘ç”Ÿæ”¹å˜,
</p>

<p>
æ‰€ä»¥è¿™ä¸ªåŒºåŸŸä¸Šçš„å†…å­˜åˆ†é…ä¸èƒ½å¤Ÿæ˜¯è¿ç»­çš„.æ¯”å¦‚ <code>char *s = malloc(s)</code>,è¿™ä¸ªåŒºåŸŸä¸Šé¢æ•°æ®ä¸ä¼šåƒ <code>Stack</code> é‚£æ ·è‡ªåŠ¨é‡Šæ”¾,
</p>

<p>
æ‰€ä»¥ä¸åœ¨ä½¿ç”¨ <code>s</code> çš„æ—¶å€™ä¸€å®šè¦æ‰‹åŠ¨é‡Šæ”¾: <code>free(s)</code>. Heapé¡¶æ˜¯ä½äºé«˜ä½çš„,ä¸Stackç›¸å,ç”±äºHeapåº•ä½äºä½ä½,æ‰€ä»¥Heapçš„å†…å­˜æ˜¯ä»ä½ä½å¾€é«˜ä½å¢é•¿.
</p>

<p>
(<code>Stack</code> ä¹Ÿå¯ä»¥åƒ <code>Heap</code> é‚£æ ·åŠ¨æ€åˆ†é…å¹¶ä¸”åŒæ—¶æ‹¥æœ‰ <code>Stack</code> çš„è‡ªåŠ¨ç®¡ç†ç‰¹ç‚¹, <code>alloca.h</code> æä¾›ä¸€ä¸ª <code>alloca</code> çš„å‡½æ•°å®Œæˆè¿™æ ·çš„äº‹æƒ…).
</p></li>

<li><p>
æœªåˆå§‹æ•°æ® (Uninitialized Data Segment),åˆå«åš (bss, block started by symbol)åŒºåŸŸ/æ®µ,
</p>

<p>
åŒ…å«äº†åœ¨å‡½æ•°å¤–å£°æ˜å´æœªåˆå§‹çš„å˜é‡,ä¹Ÿå°±æ˜¯æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡;
</p>

<p>
æ¯”å¦‚åœ¨å‡½æ•°å¤–å£°æ˜ <code>long sum[1000];</code>, <code>sum</code> å°±æ˜¯å±äºè¿™ä¸ªåŒºåŸŸ,
</p>

<p>
å†…æ ¸(kernel)ä¼šåœ¨ç¨‹åºæ‰§è¡Œå‰ç»™è¿™äº›æ•°æ®ç»™ä¸€ä¸ªåˆå§‹å€¼, 0 æˆ–è€… <code>null pointer</code>.
</p></li>

<li><p>
å·²åˆå§‹æ•°æ® (Initialized Data Segment)åŒºåŸŸ/æ®µ,åŒ…å«äº†åœ¨å‡½æ•°å¤–å£°æ˜è€Œä¸”åˆå§‹åŒ–äº†çš„å˜é‡,ä¹Ÿå°±æ˜¯å·²è¢«åˆå§‹åŒ–çš„å˜é‡;
</p>

<p>
æ¯”å¦‚åœ¨å‡½æ•°å¤–å£°æ˜ <code>int maxcount = 99</code>; <code>maxcount</code> å°±æ˜¯å±äºè¯¥åŒºåŸŸ;
</p></li>

<li><p>
Text åŒºåŸŸ/æ®µ,åŒ…å«äº† <code>CPU</code> èƒ½å¤Ÿæ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤(machine instructions),ä¹Ÿå°±æ˜¯ç¼–è¯‘åçš„å‡½æ•°,
</p>

<p>
è¿™å—åŒºåŸŸæ˜¯å¯ä»¥å…±äº«çš„(sharable),æ‰€ä»¥è¿™å—æ‰éœ€è¦è¢«åŠ è½½è¿›å†…å­˜æ¥æ–¹ä¾¿é¢‘ç¹æ‰§è¡Œ.
</p>

<p>
å¹¶ä¸”è¿™å—åŒºåŸŸåŸºæœ¬ä¸Šæ˜¯åªè¯»çš„,é˜²æ­¢æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«æ„å¤–åœ°ä¿®æ”¹.
</p></li>
</ol>


<p>
<br>
</p>


<p>
<code>a.out</code> æ–‡ä»¶å…¶å®ƒç±»å‹çš„åŒºåŸŸæœ‰ç¬¦å·è¡¨(symbol table),è°ƒè¯•ä¿¡æ¯(debugging information),åŠ¨æ€å…±äº«åº“çš„è¿æ¥è¡¨(linkage tables)ç­‰ç­‰,
</p>

<p>
ä½†æ˜¯åªæœ‰ä¸Šé¢6ä¸ªåŒºåŸŸæ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­,æ‰€ä»¥è¿™äº›é¢å¤–åŒºåŸŸä¸èƒ½ç®—å…¥å†…å­˜æ˜ åƒä¸­.
</p>

<p>
è¿™é‡Œé¢çš„é“¾æ¥åº“å€¼å¾—ä¸€æ,æœ‰ä¸¤ç§ç±»å‹çš„é“¾æ¥åº“,ä¸€ç§æ˜¯é™æ€çš„,è¿˜æœ‰ä¸€ç§åŠ¨æ€çš„,åŠ¨æ€çš„åˆå«å…±äº«åº“(shared libraries).
</p>

<p>
åœ¨ç¼–è¯‘æ—¶,ç¼–è¯‘å™¨ä¼šæŠŠé™æ€åº“é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸Š,è¿™æ ·å¯æ‰§è¡Œæ–‡ä»¶å°±ä¼šåå¤§,å‘å¸ƒçš„æ—¶å€™åªéœ€è¦å‘å¸ƒå¯æ‰§è¡Œæ–‡ä»¶.
</p>

<p>
è€Œå…±äº«åº“åˆ™æ˜¯åœ¨è¿è¡Œæ—¶è¢«åŠ è½½,å‘å¸ƒç¨‹åºçš„æ—¶å€™,å…±äº«åº“éœ€è¦å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¸€èµ·é…å¥—å‘å¸ƒ,å¯æ‰§è¡Œæ–‡ä»¶å¤§å°ç›¸å¯¹äºä½¿ç”¨é™æ€æ—¶å€™å°,
</p>

<p>
ç”±äºå…±äº«åº“ä¸éœ€è¦é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸Š,æ‰€ä»¥å•ç‹¬æ›´æ–°å…±äº«åº“åªéœ€è¦æ›¿æ¢ä¸€ä¸‹.
</p>

<div class="org-src-container">
<pre class="src src-sh">gcc -static source.c <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#38745;&#24577;&#38142;&#25509;&#24211;</span>
gcc source.c         <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#20351;&#29992;&#20849;&#20139;&#24211;(&#40664;&#35748;)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc01d618" class="outline-3">
<h3 id="orgc01d618">EIEIO</h3>
</div>
</div>


<div id="outline-container-org73ff1f7" class="outline-2">
<h2 id="org73ff1f7">Emacs ä¹‹æ·±è—ä¸æ¼</h2>
<div class="outline-text-2" id="text-org73ff1f7">
<pre class="example" id="orgccfb2eb">
å†™äº 2019/12/12
</pre>

<p>
è¿™éƒ¨åˆ†ä¸“é—¨è®°å½•æœ¬äººå¯¹ä¸€äº› Emacs è‡ªå¸¦ mode çš„å­¦ä¹ è®°å½•,è¿™äº› mode å¤§éƒ¨åˆ†éƒ½è—å¾—å¾ˆ"æ·±",
</p>

<p>
æ¯•ç«Ÿè¦ä¸€ä¸ªä¸€ä¸ªè¯•ç”¨éœ€è¦å¾ˆé•¿æ—¶é—´,è€Œä¸”ä¸€äº›çš„å­¦ä¹ æˆæœ¬å¾ˆé«˜,ä¹Ÿå¹¶éæ¯ä¸ªäººéƒ½æœ‰è€å¿ƒå­¦ä¹ ,
</p>

<p>
ä½†è¿™äº› mode éƒ½èƒ½å¾ˆæ–¹ä¾¿çš„è§£å†³å¤§éƒ¨åˆ†é—®é¢˜,è¿˜æ˜¯æœ‰å­¦ä¹ çš„ä»·å€¼çš„,æ‰€ä»¥å°±ä¸“é—¨æœ‰äº†è¿™ä¸€ä¸ªéƒ¨åˆ†.
</p>
</div>

<div id="outline-container-orgb558a43" class="outline-3">
<h3 id="orgb558a43">Calc</h3>
<div class="outline-text-3" id="text-orgb558a43">
<p>
<code>Calc</code> æ˜¯ä¸€ä¸ªåŠŸèƒ½å¤æ‚è€Œå…¨é¢çš„ <code>mode</code>,ä½ å¯ä»¥ç”¨å®ƒæ¥å®Œæˆæ—¶åŒºæ—¶é—´è½¬æ¢,ç»˜å›¾(éœ€è¦gnuplot),å„ç§ä»£æ•°è¿ç®—(æ¯”å¦‚è§£å†³ç­‰å¼é—®é¢˜)ç­‰ç­‰å„ç§æ•°å­¦ä»»åŠ¡.
</p>

<p>
å°±æ˜¯å› ä¸º <code>Calc</code> æ˜¯å¤ªå¤æ‚äº†,æ—¶åˆ»æŸ¥é˜…æ–‡æ¡£æ˜¯å¿…é¡»çš„,å¯èƒ½åœ¨è¿‡å®Œå®˜æ–¹çš„ä¸Šæ‰‹æŒ‡å— <code>M-: (info "(Calc)Tutorial")</code> æ—¶ä¼šè§‰å¾—ç®€å•,
</p>

<p>
ä½†å®é™…ä¸Šä¸€ç”¨,æˆ–è€…è¯´è¿‡ä¸€æ®µæ—¶é—´å†ç”¨çš„æ—¶å€™,éƒ½ä¼šæœ‰è¿™ç§æ„Ÿè§‰: åšä»€ä¹ˆè¦ç”¨ä»€ä¹ˆå‘½ä»¤,è¦ç”¨å“ªä¸ªæŒ‰é”®?
</p>

<p>
è¿™å°±åˆ†æƒ…å†µäº†:
</p>

<p>
<b>å¦‚æœçŸ¥é“è¦åšä»€ä¹ˆè®¡ç®—çš„è¯</b>, è¿™æ–‡æ¡£å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº†: <b>è®¡ç®—å™¨å‘½ä»¤ç´¢å¼•</b> <code>M-: (info "(Calc)Command Index")</code>.
</p>

<p>
å¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯çŸ¥é“åšä»€ä¹ˆè®¡ç®—,ä½†æ˜¯ä¸çŸ¥é“å‘½ä»¤ä»¥åŠå…¶å¯¹åº”çš„æŒ‰é”®åºåˆ—ç´¢å¼•,
</p>

<p>
å¾—ç›Šäº <code>Calc</code> çš„å¼€å‘è€…éµå®ˆ <b>è¯­ä¹‰ä¸€è‡´</b> ä»¥åŠ <b>å®šä¹‰çš„åå­—ç¬¦åˆå…¶å«ä¹‰</b> çš„åŸåˆ™,
</p>

<p>
å¯ä»¥åœ¨ <b>è®¡ç®—å™¨å‘½ä»¤ç´¢å¼•</b> ä¸­é€šè¿‡ <code>\C-s</code> æœç´¢å…³é”®å­—æ¥æŸ¥æ‰¾å‡ºå‘½ä»¤,å†åæŸ¥å‡ºå‘½ä»¤å¯¹åº”çš„æŒ‰é”®.
</p>

<p>
æ¯”å¦‚æƒ³è¦è®¡ç®—ä¸¤ä¸ªå‘é‡çš„å‰ç§¯,é‚£ä¹ˆé€šè¿‡ <code>\C-s</code> æœç´¢å‰ç§¯(<code>cross product</code>)çš„è‹±æ–‡ä¸­çš„å…³é”®å­— <code>cross</code> å°±å¯ä»¥æ‰¾åˆ° <code>calc-cross</code>,
</p>

<p>
å›è½¦è¿›å»åå¯ä»¥çœ‹åˆ°å®ƒçš„æè¿°æ˜¯å¦ç¬¦åˆè¦æ‰¾çš„å‰ç§¯(ç­”æ¡ˆæ˜¯è‚¯å®šçš„),å¹¶ä¸”æè¿°ä¸­è¿˜æœ‰å‘½ä»¤å¯¹åº”æŒ‰é”®.
</p>

<p>
<b>å¦‚æœæŒ‰é”®,æƒ³åæŸ¥å‘½ä»¤</b>, é‚£ä¹ˆè¿™ä»½æ–‡æ¡£å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªçš„é—®é¢˜: <code>(info "(Calc) Key Index")</code>.
</p>
</div>
</div>
</div>


<div id="outline-container-orgddcef05" class="outline-2">
<h2 id="orgddcef05">ä¸ªäººè®¤ä¸ºä¸é”™çš„çš„ä¸€äº›å‚è€ƒèµ„æºå’Œåšå®¢</h2>
<div class="outline-text-2" id="text-orgddcef05">
<ul class="org-ul">
<li><p>
è¿™ç¯‡æ–‡ç« ç»™æƒ³è¿›å‘Emacsçš„äººåšæ€æƒ³å·¥ä½œ
</p>

<p>
<a href="https://github.com/redguardtoo/mastering-emacs-in-one-year-guide/blob/master/guide-en.org">https://github.com/redguardtoo/mastering-emacs-in-one-year-guide/blob/master/guide-en.org</a>
</p></li>

<li><p>
æŒºä¸é”™çš„æ–°æ‰‹ç”Ÿå­˜æŒ‡å—
</p>

<p>
<a href="https://github.com/emacs-tw/emacs-101-beginner-survival-guide">https://github.com/emacs-tw/emacs-101-beginner-survival-guide</a>
</p></li>

<li><p>
ElispCookbook,ä¸è¿‡æ¯”PythonCookbookè½»é‡,ä¹Ÿå°±æ˜¯ä¸åŒ…æ‹¬å†…ç½®åº“çš„ä¾‹å­
</p>

<p>
<a href="https://www.emacswiki.org/emacs/ElispCookbook">https://www.emacswiki.org/emacs/ElispCookbook</a>
</p></li>

<li><p>
EmacsWiki,è™½ç„¶é¡µé¢æ˜¯æ¯”è¾ƒä¹±,ä½†æ˜¯èµ„æºè¿˜æ˜¯å¾ˆèµçš„
</p>

<p>
<a href="https://www.emacswiki.org/">https://www.emacswiki.org/</a>
</p></li>

<li><p>
Xah Emacs,ä¸€ä¸ªååˆ†å‹å¥½è€Œå…¨é¢çš„æ•™ç¨‹,ä½œè€…æ˜¯ä¸€ä¸ªå¤šå¹´çš„Emacsç”¨æˆ·,æœ‰å¾ˆå¤šä¸é”™çš„å­¦ä¹ å»ºè®®
</p>

<p>
<a href="http://ergoemacs.org/index.html">http://ergoemacs.org/index.html</a>
</p></li>

<li><p>
ä¸€ä¸ªæŒºæœ‰åçš„åšå®¢
</p>

<p>
<a href="http://endlessparentheses.com/">http://endlessparentheses.com/</a>
</p></li>

<li><p>
M-x Chris-An-Emacser,æœ‰ä¸å°‘æœ‰ç”¨çš„å°æŠ€å·§,æ¯”å¦‚æ‘©æ–¯å¯†ç 
</p>

<p>
<a href="https://chriszheng.science/">https://chriszheng.science/</a>
</p></li>
</ul>
</div>
</div>


<div id="outline-container-orgab6ee07" class="outline-2">
<h2 id="orgab6ee07">æˆ‘ä¸Emacsçš„ä¸€äº›äº‹æƒ…</h2>
<div class="outline-text-2" id="text-orgab6ee07">
<blockquote>
<p>
å†™äº 2018/8/31
</p>
</blockquote>

<ul class="org-ul">
<li><p>
<b>æœ€åˆ</b>
</p>

<p>
æˆ‘æ˜¯åœ¨17å¹´çš„4åˆ°6æœˆä¸­æ–­æ–­ç»­ç»­çš„æ¥è§¦Emacs,åœ¨è¿™ä¹‹å‰å…ˆæ˜¯ç”¨VSCODE,æœ¬æƒ³é•¿æœŸä½¿ç”¨VSCODE,ä¸€æ¬¡æ„å¤–æ”¹å˜äº†æˆ‘çš„æƒ³æ³•: <b>æ“ä½œç³»ç»Ÿçš„æ¡Œé¢å´©äº†</b>.
</p>

<p>
äºæ˜¯æ‰¾äº†ä¸€ä¸ªå¯ä»¥åœ¨CLIç¯å¢ƒä¸‹é¢ä½¿ç”¨çš„ç¼–è¾‘å™¨,ä¾¿æœ‰äº†ä¸€æ®µå¾ˆçŸ­çš„VIMç»å†,æ²¡è®°é”™çš„è¯å°±æ˜¯4æœˆä»½çš„æ—¶å€™,ç­‰åˆ°é€‚åº”äº†VIMåå°±æ²¡æƒ³åˆ°è¿‡è¦ç”¨åˆ«çš„
</p>

<p>
ç¼–è¾‘å™¨äº†.ç„¶è€Œä¸€æ¬¡å¶ç„¶çœ‹åˆ°äº†ä¸€ä¸ªè´´æåˆ°äº†ä¸¤ä¸ª"ç¥è¯"ç¼–è¾‘å™¨,å…¶ä¸­ä¸€ä¸ªå°±æ˜¯VIM,å¦å¤–ä¸€ä¸ªå°±æ˜¯Emacs.æŠ±ç€å¥½å¥‡çš„æƒ³æ³•å»äº†è§£ä¸€ä¸‹Emacs,ä¸è¿‡
</p>

<p>
å…ˆå…¥ä¸ºä¸»çš„æƒ³æ³•è®©æˆ‘å¹¶æ²¡æœ‰è§‰å¾—Emacsæœ‰å¤šå¥½,ç‰¹åˆ«æ˜¯æ“ä½œæ¯”èµ·VIMçš„ç¹çå¤šäº†.ç”±äºå½“æ—¶æ‰‹å¤´ä¸Šè¿˜æœ‰å·¥ä½œ,æ‰€ä»¥Emacså°±æ”¾ä¸€è¾¹äº†,ç»§ç»­åˆ©ç”¨VIMçº¢
</p>

<p>
ä½œ.åé¢æ— èŠçš„æ—¶å€™åœ¨ä¸€ä¸ªå‘¨æœ«é‡Œé¢æ‰¾äº†å„ç§å…³äºEmacsé…ç½®Pythonå¼€å‘ç¯å¢ƒçš„æ–‡ç« ,é…ç½®å¥½äº†ç”¨å®ƒæ¥å·¥ä½œäº†,ä½†è¿˜æ˜¯ä¸ä¹ æƒ¯,è‡³äºæ˜¯ä»€ä¹ˆæ—¶å€™ä¹ æƒ¯
</p>

<p>
çš„,é‚£åº”è¯¥æ˜¯æˆ‘ä¸å†é…ç½®VIMçš„æ—¶å€™,å½“æ—¶å·²ç»æŠŠVIMè´Ÿè´£çš„å…¨éƒ¨å·¥ä½œéƒ½äº¤ç»™Emacså¤„ç†äº†,æ•´ä¸ªè¿‡ç¨‹èŠ±äº†ä¸€ä¸ªæœˆå·¦å³.å…¶å®VIMæŒºä¸é”™çš„,åˆšå¼€å§‹ç”¨
</p>

<p>
Emacsçš„æ—¶å€™æˆ‘è¿˜ç”¨äº† <code>Evil</code> æ¨¡æ‹ŸVIMçš„æŒ‰é”®,ä¸è¿‡é‚£ä¸ªæ—¶å€™ç»å¸¸é…ç½®å‡ºé”™å¯¼è‡´ä½¿ç”¨ä¸äº†,è€Œæˆ‘åˆå¤ªä¾èµ–äºVIMçš„æŒ‰é”®å¯¼è‡´äº†æˆ‘ä¸€ç›´æ²¡æœ‰ç†Ÿæ‚‰Emacs
</p>

<p>
è‡ªå¸¦çš„æŒ‰é”®,æ¯æ¬¡æŠ¥é”™æˆ‘éƒ½å¾—ä½¿ç”¨åˆ«å¾—ç¼–è¾‘å™¨ä¿®æ­£é…ç½®.äºæ˜¯æˆ‘ä¸‹å®šå†³å®šä¸å†ä¾èµ–VIMäº†,æ­£å¼è¿›å…¥äººç”Ÿä¸­Emacsæ—¶ä»£.
</p></li>

<li><p>
<b>ç°åœ¨</b>
</p>

<p>
ç°åœ¨å¼€å§‹å­¦ä¹ å¦‚ä½•å†™Package,å…¶å®ä¹‹å‰ä¹Ÿæœ‰å°è¯•å†™è¿‡,å†™äº†å‡ ä¸ª"æ²¡ç”¨"çš„ä¸œè¥¿å‡ºæ¥,ç°åœ¨çœ‹æ¥å°±æ˜¯åœ¨æµªè´¹æ—¶é—´,ä¸è¿‡è¿™è®©æˆ‘è‡ªå·±æ˜ç™½äº†è¿˜æœ‰å¾ˆå¤šä¸œè¥¿ä¸æ‡‚å’Œä¸è¶³.
</p>

<p>
è®°å½•è¿™äº›ä¸è¶³çš„ç›®çš„æ˜¯ä¸ºäº†ä¸æ–­åœ°æé†’è‡ªå·±,ä¸è®©è‡ªå·±åç¦»ç›®æ ‡.
</p>

<ul class="org-ul">
<li><p>
ä¸è¶³ä¸€: å­¦ä¹ æ€åº¦ä¸å¤Ÿç«¯æ­£,ä¸å¤Ÿè™šå¿ƒ.
</p>

<p>
æ€»æ˜¯è®¤ä¸ºåœ¨å‡ å¤©å†…ç†Ÿç»ƒä½¿ç”¨ä¸€é—¨ç¼–ç¨‹è¯­è¨€,åœ¨æœ‰å…¶å®ƒè¯­è¨€åŸºç¡€çš„æƒ…å†µä¸‹,å…¥é—¨åˆ«è¯­è¨€çš„ç¡®æ˜¯å¯ä»¥å¾ˆå¿«.
</p>

<p>
ä½†æ˜¯ç†Ÿç»ƒä½¿ç”¨å°±æ˜¯å¦å¤–ä¸€ä¸ªä¸ªæ¦‚å¿µäº†:æ·±å…¥ç»†èŠ‚åœ°å­¦ä¹ è¯­è¨€çš„ç‰¹æ€§ä»¥åŠç»è¿‡å¤§é‡å®è·µå­¦ä¹ å…¶ä¸­çš„ç»†èŠ‚.
</p>

<p>
è¿˜æœ‰å°±æ˜¯ä¸è¦è€æƒ³ç€é€ è½®å­,é€ è½®å­å¹¶ä¸å…·å¤‡åˆ›é€ æ€§.è€Œæˆ‘ä¹Ÿåœ¨è¿™ä¸Šé¢æµªè´¹äº†å¾ˆå¤šæ—¶é—´,æŠ—æ‹’ä½¿ç”¨åˆ«äººçš„package,æµªè´¹å¤§é‡æ—¶é—´èŠ±åœ¨æ‰€è°“çš„"è‡ªå·±å†™"ä¸Šé¢.
</p>

<p>
ç¡®å®"è‡ªå·±å†™"çš„ç¡®å¯ä»¥å­¦ä¹ åˆ°å¾ˆå¤šä¸œè¥¿,ä½†æ˜¯æ•ˆç‡å¤ªä½äº†,è€ŒEmacsæœ¬èº«å°±æ˜¯æƒ³ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªé«˜æ•ˆçš„å·¥å…·,è€Œä¸æ˜¯è®©ä½ å»èˆå¼ƒæ•ˆç‡.å¯ä»¥é€‰æ‹©åœ¨ç©ºä½™æ—¶é—´é‡Œæ·±å…¥å­¦ä¹ .
</p>

<p>
åœ¨ç©ºä½™æ—¶é—´å­¦ä¹ è¦æ³¨æ„åšå¥½çŸ¥è¯†ç®¡ç†,å› ä¸ºå¤§éƒ¨ä»½äººçš„ç©ºä½™æ—¶é—´éƒ½ä¸ä¼šå¤ªå¤š,å› ä¸ºå­¦åˆ°çš„ä¸œè¥¿å¯èƒ½éƒ½å¾ˆç¢ç‰‡,è¶Šæ˜¯ç¢ç‰‡å°±è¶Šå®¹æ˜“å¿˜æ‰,æ‰€ä»¥çŸ¥è¯†ç®¡ç†å°±å¾ˆæœ‰å¿…è¦äº†.
</p>

<p>
åœ¨è¿™çŸ¥è¯†ç®¡ç†è¿™ç‚¹ä¸Šæˆ‘æ˜¯åšçš„ä¸å¤Ÿå¥½,å¯¼è‡´å¾ˆå¤šçŸ¥è¯†å¿˜äº†,ä»¥å‰ä»˜å‡ºæ—¶é—´å’ŒåŠªåŠ›éƒ½ç™½è´¹äº†.è¿˜æœ‰ä¸è¦å¿½è§†è¿™ä¸€äº›ç¢ç‰‡,æ—¶é—´ä¹…äº†å›è¿‡å¤´ä¼šå‘ç°æ”¶è·å¾ˆå¤§.(å› ä¸ºæˆ‘è‡ªå·±å¿˜æ‰çš„
</p>

<p>
ä¸œè¥¿å®åœ¨æ˜¯å¤ªå¤šäº†,æˆ‘è‡ªå·±å›è¿‡å¤´æ¥çœ‹éƒ½å“äº†ä¸€è·³).
</p></li>

<li><p>
ä¸è¶³äºŒ: æ€•éº»çƒ¦,è¡ŒåŠ¨åŠ›ä½ä¸‹,æ€»æƒ³ä¸€æ¬¡åšå¥½
</p>

<p>
å¾ˆå¤šäººéƒ½æœ‰è¿™ç§å¿ƒç†: "è¿™ä¸ªå¾ˆç®€å•,åšäº†åªæ˜¯æµªè´¹æ—¶é—´." æˆ–è€… "è¿™ä¸ªç½‘ä¸Šæœ‰è§£å†³æ–¹æ¡ˆ,å…ˆä¼‘æ¯ä¸€ä¸‹ç¨ååŠ¨æ‰‹" åˆæˆ–è€… "è¿™ä¸ªå·¥ä½œé‡å¤ªå¤§äº†,ä¸€ä¸¤å¤©åšä¸å®Œ".
</p>

<p>
å®è·µå¯èƒ½å¾ˆç®€å•,ä½†æ˜¯ä¸çœŸæ­£æ“ä½œä¸€éä½ æ˜¯å‘ç°ä¸äº†ä¸€äº›æ½œåœ¨çš„é—®é¢˜,æ¯”å¦‚ç³»ç»Ÿç¯å¢ƒçš„å½±å“,ä¸€äº›è½¯ä»¶ä¾èµ–å’Œç‰ˆæœ¬é—®é¢˜.
</p>

<p>
è¿˜æœ‰å°½æ—©è§£å†³è‡ªå·±çš„æ‹–å»¶ç—‡,å¦‚æœäº‹æƒ…ä¸€ç‚¹ä¸€ç‚¹åœ°æ‹–ä¸‹å»,å›è¿‡å¤´ä½ ä¼šå‘ç°æ˜æ˜æ˜¯ä¸€ä»¶å¾ˆç®€å•åœ°äº‹æƒ…å´æ‹–äº†ä¸å°‘æ—¶é—´,æ›´ç³Ÿç³•åœ°æ˜¯äº‹æƒ…å¯èƒ½ä¸€ç›´éƒ½ä¸ä¼šå®Œæˆç”šè‡³å¼€å§‹.æ‹–å»¶ç—‡/è¡ŒåŠ¨åŠ›ä½ä¸‹æ˜¯å¾ˆå¤šäººåœ¨ä¸€ä»¶äº‹æƒ…ä¸Šé¢å¤±è´¥çš„ä¸»è¦åŸå› .
</p>

<p>
è‡³äºå·¥ä½œé‡å¤§çš„å·¥ä½œ,è¦æ‰¿è®¤äº‹å®:"çš„ç¡®ä¸€ä¸¤å¤©æ˜¯åšä¸å®Œçš„".åˆ«äººçš„å¤§åœ°å¼€æºé¡¹ç›®æ˜¯æ€ä¹ˆå†™å‡ºæ¥çš„å‘¢?é€šè¿‡ <code>commits</code> å¯ä»¥å‘ç°åˆ«äººä¹Ÿä¸æ˜¯ä¸€ä¸¤å¤©åšå¥½çš„,ä»–ä»¬ä¹Ÿæ˜¯ä¸€ç‚¹ç‚¹åœ°å†™å‡ºæ¥åœ°.
</p>

<p>
å¦‚æœäº‹æƒ…/å·¥ä½œçš„ç¡®ä¸èƒ½é©¬ä¸Šå®Œæˆ,é‚£ä¹ˆè¯·åšå¥½ä»»åŠ¡ç®¡ç†,è®°å½•è¦ä»€ä¹ˆæ—¶å€™åšä»€ä¹ˆ,ä¸è¿™ä¹ˆåšçš„è¯å¾ˆæœ‰å¯èƒ½å°±å›æŠŠè¿™ä»¶äº‹æƒ…ç»™å¿˜äº†.
</p></li>

<li><p>
ä¸è¶³ä¸‰: å®³æ€•å¤±è´¥
</p>

<p>
æ›¾ç»ç»™ <code>fic-mode</code> æäº¤è¿‡ä¸¤ä¸ª <code>pull request</code> ,ç¬¬ä¸€ä¸ªåˆå¹¶äº†,ç¬¬äºŒä¸ªè¢«æ— è§†äº†.ç¬¬äºŒä¸ªæ˜¯æ·»åŠ æ–°åŠŸèƒ½çš„,ç¬¬ä¸€æ¬¡å†™åœ°æŒºè®¤çœŸçš„,æ‰€ä»¥æœ‰ç‚¹ä¼¤å¿ƒ,GitHub <code>issue</code> å’Œ
</p>

<p>
<code>pull request</code> äº§ç”Ÿäº†ææƒ§.ç°åœ¨æƒ³èµ·æ¥è‡ªå·±è¿˜æ˜¯æœ‰ç‚¹ç»ç’ƒå¿ƒ,å› ä¸ºè¿™æ˜¯å¾ˆå¹³å¸¸çš„äº‹æƒ…,å¾ˆå¤šäººéƒ½æœ‰åŒæ ·çš„ç»å†,æˆ‘åªä¸è¿‡æ˜¯å…¶ä¸­ä¸€å‘˜.æ—¢ç„¶å…¶ä»–äººèƒ½å¤ŸæŒºè¿‡æ¥,é‚£ä¹ˆæˆ‘ä¹Ÿèƒ½.æ‰€ä»¥æ²¡å¿…è¦
</p>

<p>
å› ä¸ºä¸€æ¬¡å¤±è´¥è€Œæ°”é¦,ç°åœ¨è§‰å¾—æ—©ç‚¹é‡åˆ°å¤±è´¥ä¹Ÿæ˜¯å¥½äº‹.
</p></li>
</ul></li>

<li><p>
<b>ä»¥å</b>
</p>

<p>
ä»¥åä¹Ÿä¼šä¸€ç›´ä½¿ç”¨Emacs,å› ä¸ºè¿™ä¸ªå¼€æºé¡¹ç›®å·²ç»æ”¹å˜æˆ‘äº†:
</p>

<ol class="org-ol">
<li>å¼€å§‹ç»™åˆ«çš„é¡¹ç›®æäº¤ <code>pull request</code></li>

<li>è·Ÿåˆ«äººäº¤æµ</li>

<li>èƒ½å¤Ÿé™ä¸‹å¿ƒé˜…è¯»ä»£ç å’Œæ–‡æ¡£</li>

<li>èƒ½å¤Ÿæ­£è§†è‡ªå·±çš„ç¼ºç‚¹å’Œä¸è¶³</li>

<li>å¼€å§‹è™šå¿ƒå‘åˆ«äººå­¦ä¹ </li>
</ol>

<p>
æœ‰å¤ªå¤šæ–¹é¢æˆ‘æƒ³ä¸èµ·æ¥,æ€»çš„æ¥è¯´å®ƒå¯¹äºæˆ‘æ¥è¯´å½±å“å®åœ¨å¤ªå¤§äº†,å› æ­¤æˆ‘ä¹Ÿæ„¿æ„æŠŠé—²ä½™æ—¶é—´æŠ•å…¥åˆ°å®ƒçš„èº«ä¸Š.
</p>

<p>
å†™è¿™äº›çš„æ—¶å€™æˆ‘æ‰ç†è§£ä¸ºä»€ä¹ˆæœ‰äººè¯´Emacsæ˜¯ä¸€ç§ç”Ÿæ´»æ€åº¦äº†.
</p></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: saltb0rn (<a href="mailto:asche34@outlook.com">asche34@outlook.com</a>)</p>
<p class="date">Date: 2018-08-31</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.4)</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
